import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{D as n,a,b as t,c as i,e as l,C as r,f as d,g as c,B as o,h as x,S as v,o as m,l as u,u as p,I as h}from"./index-CIZJQuMw.js";import{T as f,a as g,b,c as j,d as y,e as N}from"./table-vnZa3hwR.js";import{S as _,c as w,d as D,a as $,b as k}from"./select-aqE1UuiG.js";import{k as S,a9 as O,aa as A,q as R,T as C,X as T,W as P,Y as z,a8 as M,y as E,Z as L,V as F}from"./utilities-DMEd7dY0.js";import{u as B}from"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";const V=({open:s,onOpenChange:u,delivery:p,afterDeliveryReport:h})=>{if(!p)return null;const f=e=>e?new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"N/A",g=e=>(e||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),b=e=>{switch(e.toLowerCase()){case"verified":return"text-green-600";case"discrepancy found":return"text-red-600";case"pending review":return"text-yellow-600";default:return"text-gray-600"}},j=p.regular_tank_volume+p.plus_tank_volume+p.super_tank_volume,y=p.regular_delivered+p.plus_delivered+p.super_delivered,N=j+y,_=h?h.regular_tank_final+h.plus_tank_final+h.super_tank_final:0,w=h?Math.abs(N-_):0,D=w>5,$=p.regular_tank_volume+p.regular_delivered,k=p.plus_tank_volume+p.plus_delivered,P=p.super_tank_volume+p.super_delivered,z=()=>{const e=`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Fuel Delivery Report - ${p.bol_number||`Record #${p.id}`}</title>\n          <style>\n            @page {\n              size: A4;\n              margin: 0.5in;\n            }\n            body {\n              font-family: 'Arial', sans-serif;\n              margin: 0;\n              padding: 0;\n              color: #333;\n              line-height: 1.4;\n            }\n            .header {\n              text-align: center;\n              margin-bottom: 30px;\n              border-bottom: 3px solid #2563eb;\n              padding-bottom: 20px;\n            }\n            .company-logo {\n              font-size: 28px;\n              font-weight: bold;\n              color: #1e40af;\n              margin-bottom: 5px;\n            }\n            .report-title {\n              font-size: 20px;\n              color: #374151;\n              margin-bottom: 10px;\n            }\n            .report-meta {\n              display: grid;\n              grid-template-columns: repeat(3, 1fr);\n              gap: 20px;\n              background: #f8fafc;\n              padding: 15px;\n              border-radius: 8px;\n              margin-bottom: 25px;\n            }\n            .meta-item {\n              text-align: center;\n            }\n            .meta-label {\n              font-size: 12px;\n              color: #6b7280;\n              text-transform: uppercase;\n              font-weight: 600;\n            }\n            .meta-value {\n              font-size: 14px;\n              font-weight: bold;\n              margin-top: 5px;\n            }\n            .station-badge {\n              display: inline-block;\n              padding: 4px 12px;\n              border-radius: 20px;\n              color: white;\n              font-size: 12px;\n              font-weight: 600;\n            }\n            .section {\n              margin-bottom: 25px;\n              break-inside: avoid;\n            }\n            .section-header {\n              display: flex;\n              align-items: center;\n              margin-bottom: 15px;\n              padding-bottom: 10px;\n              border-bottom: 2px solid #e5e7eb;\n            }\n            .section-icon {\n              margin-right: 10px;\n              color: #2563eb;\n              font-size: 18px;\n            }\n            .section-title {\n              font-size: 18px;\n              font-weight: bold;\n              color: #1f2937;\n            }\n            .data-grid {\n              display: grid;\n              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n              gap: 15px;\n            }\n            .fuel-grid {\n              display: grid;\n              grid-template-columns: repeat(4, 1fr);\n              gap: 15px;\n            }\n            .data-card {\n              border: 1px solid #e5e7eb;\n              border-radius: 8px;\n              padding: 15px;\n              background: #ffffff;\n              text-align: center;\n            }\n            .fuel-card {\n              border: 2px solid;\n              border-radius: 10px;\n              padding: 20px;\n              text-align: center;\n            }\n            .fuel-regular {\n              border-color: #3b82f6;\n              background: #eff6ff;\n            }\n            .fuel-plus {\n              border-color: #10b981;\n              background: #f0fdf4;\n            }\n            .fuel-super {\n              border-color: #8b5cf6;\n              background: #faf5ff;\n            }\n            .fuel-total {\n              border-color: #f59e0b;\n              background: #fffbeb;\n            }\n            .data-label {\n              font-size: 12px;\n              color: #6b7280;\n              text-transform: uppercase;\n              font-weight: 600;\n              margin-bottom: 8px;\n            }\n            .data-value {\n              font-size: 18px;\n              font-weight: bold;\n              color: #1f2937;\n            }\n            .fuel-amount {\n              font-size: 24px;\n              font-weight: bold;\n              margin-bottom: 5px;\n            }\n            .fuel-label {\n              font-size: 12px;\n              color: #6b7280;\n              font-weight: 600;\n            }\n            .comparison-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 15px;\n            }\n            .comparison-table th,\n            .comparison-table td {\n              padding: 12px;\n              text-align: center;\n              border: 1px solid #e5e7eb;\n            }\n            .comparison-table th {\n              background: #f3f4f6;\n              font-weight: 600;\n              font-size: 12px;\n              text-transform: uppercase;\n            }\n            .verification-section {\n              background: #f0fdf4;\n              border: 2px solid #10b981;\n              border-radius: 8px;\n              padding: 20px;\n              margin: 20px 0;\n            }\n            .verification-warning {\n              background: #fffbeb;\n              border-color: #f59e0b;\n            }\n            .verification-error {\n              background: #fef2f2;\n              border-color: #ef4444;\n            }\n            .status-verified {\n              color: #059669;\n              font-weight: bold;\n            }\n            .status-warning {\n              color: #d97706;\n              font-weight: bold;\n            }\n            .status-error {\n              color: #dc2626;\n              font-weight: bold;\n            }\n            .notes-section {\n              background: #fffbeb;\n              border-left: 4px solid #f59e0b;\n              padding: 15px;\n              margin: 20px 0;\n            }\n            .footer {\n              margin-top: 40px;\n              text-align: center;\n              font-size: 11px;\n              color: #6b7280;\n              border-top: 1px solid #e5e7eb;\n              padding-top: 20px;\n            }\n            @media print {\n              body { font-size: 11pt; }\n              .section { page-break-inside: avoid; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <div class="company-logo">DFS Manager Portal</div>\n            <div class="report-title">Fuel Delivery Report - Enhanced</div>\n          </div>\n\n          <div class="report-meta">\n            <div class="meta-item">\n              <div class="meta-label">Delivery Date</div>\n              <div class="meta-value">${f(p.delivery_date)}</div>\n            </div>\n            <div class="meta-item">\n              <div class="meta-label">Station</div>\n              <div class="meta-value">\n                <span class="station-badge" style="background: ${"MOBIL"===p.station?"#ef4444":"AMOCO ROSEDALE"===p.station?"#3b82f6":"#10b981"}">${p.station}</span>\n              </div>\n            </div>\n            <div class="meta-item">\n              <div class="meta-label">BOL Number</div>\n              <div class="meta-value">${p.bol_number||"Not Assigned"}</div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">üìä</span>\n              <span class="section-title">Delivery Summary</span>\n            </div>\n            <div class="data-grid">\n              <div class="data-card">\n                <div class="data-label">Record ID</div>\n                <div class="data-value">#${p.id}</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Total Delivered</div>\n                <div class="data-value">${g(y)} gal</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Total Before</div>\n                <div class="data-value">${g(j)} gal</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Expected Total After</div>\n                <div class="data-value">${g(N)} gal</div>\n              </div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">‚õΩ</span>\n              <span class="section-title">Tank Volumes Before Delivery</span>\n            </div>\n            <div class="fuel-grid">\n              <div class="fuel-card fuel-regular">\n                <div class="fuel-amount">${g(p.regular_tank_volume)}</div>\n                <div class="fuel-label">Regular Tank (gal)</div>\n              </div>\n              <div class="fuel-card fuel-plus">\n                <div class="fuel-amount">${g(p.plus_tank_volume)}</div>\n                <div class="fuel-label">Plus Tank (gal)</div>\n              </div>\n              <div class="fuel-card fuel-super">\n                <div class="fuel-amount">${g(p.super_tank_volume)}</div>\n                <div class="fuel-label">Super Tank (gal)</div>\n              </div>\n              <div class="fuel-card fuel-total">\n                <div class="fuel-amount">${g(j)}</div>\n                <div class="fuel-label">Total Volume (gal)</div>\n              </div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">üöõ</span>\n              <span class="section-title">Fuel Delivered</span>\n            </div>\n            <div class="fuel-grid">\n              <div class="fuel-card fuel-regular">\n                <div class="fuel-amount">${g(p.regular_delivered)}</div>\n                <div class="fuel-label">Regular Delivered (gal)</div>\n              </div>\n              <div class="fuel-card fuel-plus">\n                <div class="fuel-amount">${g(p.plus_delivered)}</div>\n                <div class="fuel-label">Plus Delivered (gal)</div>\n              </div>\n              <div class="fuel-card fuel-super">\n                <div class="fuel-amount">${g(p.super_delivered)}</div>\n                <div class="fuel-label">Super Delivered (gal)</div>\n              </div>\n              <div class="fuel-card fuel-total">\n                <div class="fuel-amount">${g(y)}</div>\n                <div class="fuel-label">Total Delivered (gal)</div>\n              </div>\n            </div>\n          </div>\n\n          ${h?`\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">‚úÖ</span>\n              <span class="section-title">Post-Delivery Verification</span>\n            </div>\n            <table class="comparison-table">\n              <thead>\n                <tr>\n                  <th>Tank Type</th>\n                  <th>Before Delivery</th>\n                  <th>Delivered</th>\n                  <th>Expected After</th>\n                  <th>Actual After</th>\n                  <th>Difference</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr>\n                  <td><strong>Regular</strong></td>\n                  <td>${g(p.regular_tank_volume)}</td>\n                  <td>${g(p.regular_delivered)}</td>\n                  <td>${g($)}</td>\n                  <td>${g(h.regular_tank_final)}</td>\n                  <td class="${Math.abs($-h.regular_tank_final)<=2?"status-verified":"status-error"}">\n                    ${g(Math.abs($-h.regular_tank_final))}\n                  </td>\n                </tr>\n                <tr>\n                  <td><strong>Plus</strong></td>\n                  <td>${g(p.plus_tank_volume)}</td>\n                  <td>${g(p.plus_delivered)}</td>\n                  <td>${g(k)}</td>\n                  <td>${g(h.plus_tank_final)}</td>\n                  <td class="${Math.abs(k-h.plus_tank_final)<=2?"status-verified":"status-error"}">\n                    ${g(Math.abs(k-h.plus_tank_final))}\n                  </td>\n                </tr>\n                <tr>\n                  <td><strong>Super</strong></td>\n                  <td>${g(p.super_tank_volume)}</td>\n                  <td>${g(p.super_delivered)}</td>\n                  <td>${g(P)}</td>\n                  <td>${g(h.super_tank_final)}</td>\n                  <td class="${Math.abs(P-h.super_tank_final)<=2?"status-verified":"status-error"}">\n                    ${g(Math.abs(P-h.super_tank_final))}\n                  </td>\n                </tr>\n                <tr style="border-top: 2px solid #374151; font-weight: bold;">\n                  <td><strong>TOTAL</strong></td>\n                  <td>${g(j)}</td>\n                  <td>${g(y)}</td>\n                  <td>${g(N)}</td>\n                  <td>${g(_)}</td>\n                  <td class="${D?"status-error":"status-verified"}">\n                    ${g(w)}\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n\n          <div class="verification-section ${D?"verification-error":"verification-section"}">\n            <div class="section-header">\n              <span class="section-icon">${D?"‚ö†Ô∏è":"‚úÖ"}</span>\n              <span class="section-title">Verification Status</span>\n            </div>\n            <div class="data-grid">\n              <div class="data-card">\n                <div class="data-label">Status</div>\n                <div class="data-value ${b(h.verification_status)}">${h.verification_status}</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Tank Temperature</div>\n                <div class="data-value">${h.tank_temperature}¬∞F</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Reported By</div>\n                <div class="data-value">${h.reported_by}</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Supervisor Approval</div>\n                <div class="data-value ${h.supervisor_approval?"status-verified":"status-warning"}">\n                  ${h.supervisor_approval?"‚úÖ Approved":"‚è≥ Pending"}\n                </div>\n              </div>\n            </div>\n            ${h.discrepancy_notes?`\n            <div style="margin-top: 15px; padding: 10px; background: #fef2f2; border-radius: 5px;">\n              <strong>Discrepancy Notes:</strong><br>\n              ${h.discrepancy_notes}\n            </div>\n            `:""}\n          </div>\n          `:'\n          <div class="verification-section verification-warning">\n            <div class="section-header">\n              <span class="section-icon">‚è≥</span>\n              <span class="section-title">Verification Pending</span>\n            </div>\n            <p>Post-delivery tank verification has not been completed yet. Please ensure tank levels are measured and recorded after the delivery is complete.</p>\n          </div>\n          '}\n\n          ${p.delivery_notes?`\n          <div class="notes-section">\n            <div class="section-header">\n              <span class="section-icon">üìù</span>\n              <span class="section-title">Delivery Notes</span>\n            </div>\n            <p style="margin: 0; white-space: pre-wrap;">${p.delivery_notes}</p>\n          </div>\n          `:""}\n\n          ${h&&h.additional_notes?`\n          <div class="notes-section">\n            <div class="section-header">\n              <span class="section-icon">üìã</span>\n              <span class="section-title">Additional Verification Notes</span>\n            </div>\n            <p style="margin: 0; white-space: pre-wrap;">${h.additional_notes}</p>\n          </div>\n          `:""}\n\n          <div class="footer">\n            <div>Delivery Record ID: #${p.id} | Generated on ${(new Date).toLocaleString()}</div>\n            <div>Created by User #${p.created_by} | DFS Manager Portal v2.0</div>\n            ${h?`<div>Verification Report ID: #${h.id} | Verified by User #${h.created_by}</div>`:""}\n            <div style="margin-top: 10px; font-style: italic;">\n              This is an official fuel delivery document. Please retain for your records and regulatory compliance.\n            </div>\n          </div>\n        </body>\n      </html>\n    `,s=window.open("","_blank");s&&(s.document.write(e),s.document.close(),s.focus(),setTimeout(()=>{s.print(),s.close()},500))};return e.jsx(n,{open:s,onOpenChange:u,children:e.jsxs(a,{className:"max-w-6xl max-h-[95vh] overflow-y-auto",children:[e.jsx(t,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600"}),"Enhanced Delivery Report - ",p.bol_number||`Record #${p.id}`]}),e.jsxs(l,{onClick:z,variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(O,{className:"h-4 w-4"}),"Print Full Report"]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(r,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-blue-800",children:f(p.delivery_date)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(o,{className:(e=>{switch(e.toUpperCase()){case"MOBIL":return"bg-red-500 text-white";case"AMOCO ROSEDALE":return"bg-blue-500 text-white";case"AMOCO BROOKLYN":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}})(p.station),children:p.station}),e.jsxs("span",{className:"text-sm text-gray-600",children:["BOL: ",p.bol_number||"Not Assigned"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[g(y)," gal"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Delivered"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-blue-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g(p.regular_delivered)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Regular Delivered"})]})}),e.jsx(r,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-green-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g(p.plus_delivered)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Plus Delivered"})]})}),e.jsx(r,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-purple-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g(p.super_delivered)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Super Delivered"})]})}),e.jsx(r,{children:e.jsxs(x,{className:"p-4 text-center",children:[e.jsx(R,{className:"h-8 w-8 mx-auto text-orange-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g(y)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Delivered"})]})})]}),h&&e.jsxs(r,{className:"border-2 "+(D?"border-red-200 bg-red-50":"border-green-200 bg-green-50"),children:[e.jsx(d,{children:e.jsx(c,{className:"flex items-center gap-2",children:D?e.jsxs("div",{className:"text-red-600 flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Volume Discrepancy Detected"]}):e.jsx("div",{className:"text-green-600",children:"‚úì Delivery Verified"})})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`font-medium ${b(h.verification_status)}`,children:h.verification_status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Temperature:"}),e.jsxs("span",{className:"font-medium",children:[h.tank_temperature,"¬∞F"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Volume Difference:"}),e.jsxs("span",{className:"font-medium "+(D?"text-red-600":"text-green-600"),children:[g(w)," gal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Supervisor Approval:"}),e.jsx("span",{className:"font-medium "+(h.supervisor_approval?"text-green-600":"text-yellow-600"),children:h.supervisor_approval?"‚úì Approved":"‚è≥ Pending"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsx(d,{children:e.jsx(c,{className:"text-sm",children:"Tank Volumes Before"})}),e.jsxs(x,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Regular:"}),e.jsxs("span",{className:"font-medium",children:[g(p.regular_tank_volume)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Plus:"}),e.jsxs("span",{className:"font-medium",children:[g(p.plus_tank_volume)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Super:"}),e.jsxs("span",{className:"font-medium",children:[g(p.super_tank_volume)," gal"]})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[g(j)," gal"]})]})]})]}),e.jsxs(r,{children:[e.jsx(d,{children:e.jsx(c,{className:"text-sm",children:"Fuel Delivered"})}),e.jsxs(x,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Regular:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[g(p.regular_delivered)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Plus:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[g(p.plus_delivered)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Super:"}),e.jsxs("span",{className:"font-medium text-purple-600",children:[g(p.super_delivered)," gal"]})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-orange-600",children:[g(y)," gal"]})]})]})]})]}),(p.delivery_notes||h&&h.additional_notes)&&e.jsxs(r,{children:[e.jsx(d,{children:e.jsx(c,{className:"text-sm",children:"Notes"})}),e.jsxs(x,{className:"space-y-3",children:[p.delivery_notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Delivery Notes:"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:p.delivery_notes})]}),h&&h.additional_notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Verification Notes:"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:h.additional_notes})]})]})]})]}),e.jsxs(m,{className:"flex justify-end space-x-2",children:[e.jsxs(l,{variant:"outline",onClick:()=>u(!1),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Close"]}),e.jsxs(l,{onClick:z,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Print Full Report"]})]})]})})},I=()=>{const n=B(),{toast:a}=u(),{userProfile:t,isAdmin:i}=p(),[v,m]=s.useState([]),[O,A]=s.useState(!0),[R,C]=s.useState(""),[T,I]=s.useState("all"),[U,Y]=s.useState(1),[K,q]=s.useState(0),[G,W]=s.useState(null),[Z,H]=s.useState(!1);s.useEffect(()=>{J()},[U,R,T]);const J=async()=>{try{A(!0);const e=[];"all"!==T&&e.push({name:"station",op:"Equal",value:T}),R&&e.push({name:"bol_number",op:"StringContains",value:R});const{data:s,error:n}=await window.ezsite.apis.tablePage(12196,{PageNo:U,PageSize:10,OrderByField:"delivery_date",IsAsc:!1,Filters:e});if(n)throw n;m(s?.List||[]),q(s?.VirtualCount||0)}catch(e){console.error("Error loading deliveries:",e),a({title:"Error",description:"Failed to load delivery records",variant:"destructive"})}finally{A(!1)}},Q=e=>new Date(e).toLocaleDateString(),X=e=>e.toFixed(2),ee=e=>{switch(e){case"MOBIL":return"bg-red-100 text-red-800";case"AMOCO ROSEDALE":return"bg-blue-100 text-blue-800";case"AMOCO BROOKLYN":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},se=Math.ceil(K/10);return O&&0===v.length?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading delivery records..."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Delivery Records"})]}),e.jsxs(l,{onClick:()=>n("/delivery/new"),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"New Delivery"]})]}),e.jsx(r,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(h,{placeholder:"Search by BOL number...",value:R,onChange:e=>C(e.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs(_,{value:T,onValueChange:I,children:[e.jsx(w,{children:e.jsx(D,{placeholder:"Filter by station"})}),e.jsxs($,{children:[e.jsx(k,{value:"all",children:"All Stations"}),["MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN"].map(s=>e.jsx(k,{value:s,children:s},s))]})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(l,{variant:"outline",onClick:J,children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Refresh"]})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(r,{children:e.jsxs(x,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:K}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Deliveries"})]})}),e.jsx(r,{children:e.jsxs(x,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:v.reduce((e,s)=>{return e+((n=s).regular_delivered+n.plus_delivered+n.super_delivered);var n},0).toFixed(0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Gallons Delivered"})]})}),e.jsx(r,{children:e.jsxs(x,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:new Set(v.map(e=>e.station)).size}),e.jsx("p",{className:"text-sm text-gray-600",children:"Stations Served"})]})}),e.jsx(r,{children:e.jsxs(x,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:v.filter(e=>new Date(e.delivery_date)>=new Date(Date.now()-6048e5)).length}),e.jsx("p",{className:"text-sm text-gray-600",children:"This Week"})]})})]}),e.jsxs(r,{children:[e.jsx(d,{children:e.jsx(c,{children:"Delivery Records"})}),e.jsx(x,{children:0===v.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No delivery records found"}),e.jsxs(l,{onClick:()=>n("/delivery/new"),className:"mt-4",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Add First Delivery"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(b,{children:[e.jsx(j,{children:"Serial"}),e.jsx(j,{children:"Date"}),e.jsx(j,{children:"BOL Number"}),e.jsx(j,{children:"Station Name"}),e.jsx(j,{children:"Regular (Delivered)"}),e.jsx(j,{children:"Plus Delivered"}),e.jsx(j,{children:"Super Delivered"}),e.jsx(j,{children:"Actions"})]})}),e.jsx(y,{children:v.map((s,t)=>e.jsxs(b,{children:[e.jsx(N,{className:"font-medium",children:10*(U-1)+t+1}),e.jsx(N,{className:"font-medium text-gray-900",children:Q(s.delivery_date)}),e.jsx(N,{className:"font-medium text-indigo-600",children:s.bol_number||"N/A"}),e.jsx(N,{children:e.jsx(o,{className:ee(s.station),children:s.station})}),e.jsxs(N,{className:"font-medium text-blue-600",children:[X(s.regular_delivered)," gal"]}),e.jsxs(N,{className:"font-medium text-green-600",children:[X(s.plus_delivered)," gal"]}),e.jsxs(N,{className:"font-medium text-purple-600",children:[X(s.super_delivered)," gal"]}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>(e=>{W(e),H(!0)})(s),className:"h-8 w-8 p-0 hover:bg-blue-50",title:"View Report",children:e.jsx(E,{className:"h-4 w-4 text-blue-600"})}),i()&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>(e=>{if(i())try{const s=v.find(s=>s.id===e);if(!s)return a({title:"Error",description:"Delivery record not found. Please refresh the list and try again.",variant:"destructive"}),void J();n(`/delivery/${e}/edit`),console.log("Navigating to edit delivery:",e,s)}catch(s){console.error("Error navigating to edit form:",s),a({title:"Navigation Error",description:"Failed to open edit form. Please try again.",variant:"destructive"})}else a({title:"Access Denied",description:"Only administrators can edit delivery records.",variant:"destructive"})})(s.id),className:"h-8 w-8 p-0 hover:bg-orange-50",title:"Edit Delivery",children:e.jsx(L,{className:"h-4 w-4 text-orange-600"})}),i()&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(!i())return void a({title:"Access Denied",description:"Only administrators can delete delivery records.",variant:"destructive"});const s=v.find(s=>s.id===e);if(!s)return a({title:"Error",description:"Delivery record not found. Please refresh the list and try again.",variant:"destructive"}),void J();if(confirm(`Are you sure you want to delete delivery record for ${s.station} on ${Q(s.delivery_date)}? This action cannot be undone.`))try{const{error:n}=await window.ezsite.apis.tableDelete(12196,{ID:e});if(n)throw n;a({title:"Success",description:`Delivery record for ${s.station} deleted successfully`}),J()}catch(n){console.error("Error deleting delivery:",n),a({title:"Error",description:`Failed to delete delivery record for ${s.station}`,variant:"destructive"})}})(s.id),className:"h-8 w-8 p-0 hover:bg-red-50",title:"Delete Delivery",children:e.jsx(F,{className:"h-4 w-4 text-red-600"})})]})})]},s.id))})]})}),!i()&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-700",children:[e.jsx("strong",{children:"Access Restrictions:"}),"Only administrators can edit or delete delivery records."]})}),se>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",10*(U-1)+1," to ",Math.min(10*U,K)," of ",K," records"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Y(e=>Math.max(1,e-1)),disabled:1===U,children:"Previous"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Y(e=>Math.min(se,e+1)),disabled:U===se,children:"Next"})]})]})]})})]}),e.jsx(V,{open:Z,onOpenChange:H,delivery:G})]})};export{I as default};
