import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{C as a,f as t,g as r,h as l,L as i,l as o,D as n,a as d,b as c,c as m,I as x,e as h,B as p,d as u,A as g,n as j,o as v,u as f,k as y}from"./index-DyvxZZaK.js";import{T as N}from"./textarea-DRHimfhP.js";import{S as b,c as C,d as S,a as w,b as F}from"./select-DxfsAJPc.js";import{S as _}from"./StationDropdown-CDxlHRcN.js";import{N as E}from"./number-input-C8fwd0Bs.js";import{a as D}from"./use-mobile-BQxxJ7Jh.js";import{aa as I,ab as A,I as O,ac as $,ad as R,D as q,a4 as G,C as T,s as L,W as k,F as P,V as M,U as H,ae as z,n as B,af as U,p as V,a5 as Y,T as J,ag as K,r as W,f as Q,R as Z,K as X,ah as ee,a9 as se,ai as ae,Q as te}from"./utilities-DMEd7dY0.js";import{P as re}from"./progress-BuqgJQWg.js";import{E as le}from"./EnhancedFileUpload-DFFx6aVh.js";import{E as ie}from"./EnhancedSalesReportPrintDialog-CW7LgwrC.js";import{u as oe,d as ne}from"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";import"./use-station-store-DDC1HmYO.js";import"./imageCompression-DvX-F3tO.js";const de=({station:s,values:o,onChange:n})=>{const d=D(),c="MOBIL"===s,m=o.creditCardAmount+o.debitCardAmount+o.mobileAmount+o.cashAmount+o.grocerySales,x=(o.groceryCashSales||0)+(o.groceryCardSales||0)+(o.ebtSales||0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(a,{className:"bg-blue-50 border-blue-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-blue-800 flex items-center space-x-2",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{children:"Gas & Grocery Sales"})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(d?"gap-4":"md:grid-cols-2 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"creditCard",children:"Credit Card Amount ($) *"}),e.jsx(E,{id:"creditCard",value:o.creditCardAmount,onChange:e=>n("creditCardAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"debitCard",children:"Debit Card Amount ($) *"}),e.jsx(E,{id:"debitCard",value:o.debitCardAmount,onChange:e=>n("debitCardAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"mobile",children:"Mobile Payment Amount ($) *"}),e.jsx(E,{id:"mobile",value:o.mobileAmount,onChange:e=>n("mobileAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"cash",children:"Cash Amount ($) *"}),e.jsx(E,{id:"cash",value:o.cashAmount,onChange:e=>n("cashAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"grocery",children:"Grocery Sales ($) *"}),e.jsx(E,{id:"grocery",value:o.grocerySales,onChange:e=>n("grocerySales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-lg font-semibold",children:"Total Sales (Auto-calculated)"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Credit Card + Debit Card + Mobile Payment + Cash + Grocery = $",m.toFixed(2)]})]})]})]}),e.jsxs(a,{className:"bg-green-50 border-green-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-green-800 flex items-center space-x-2",children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{children:"Grocery Sales Breakdown"})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(d?"gap-4":"md:grid-cols-3 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"groceryCash",children:"Cash Sales ($) *"}),e.jsx(E,{id:"groceryCash",value:o.groceryCashSales||0,onChange:e=>n("groceryCashSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"groceryCard",children:"Credit/Debit Card ($) *"}),e.jsx(E,{id:"groceryCard",value:o.groceryCardSales||0,onChange:e=>n("groceryCardSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"ebt",children:"EBT ($) *"}),e.jsx(E,{id:"ebt",value:o.ebtSales||0,onChange:e=>n("ebtSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-lg font-semibold",children:"Total Grocery Sales (Auto-calculated)"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",x.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cash Sales ($",(o.groceryCashSales||0).toFixed(2),") + Credit/Debit Card ($",(o.groceryCardSales||0).toFixed(2),")",c?` + EBT (${(o.ebtSales||0).toFixed(2)})`:""," = $",x.toFixed(2)]}),x!==o.grocerySales&&e.jsxs("div",{className:"text-xs text-amber-600 mt-1 bg-amber-50 p-2 rounded border border-amber-200",children:[e.jsx(O,{className:"w-3 h-3 inline mr-1"}),"Grocery sales total will be updated automatically when you save."]})]})]})]})]})},ce=({values:s,onChange:o})=>{const n=D(),d=s.lotteryNetSales+s.scratchOffSales;return e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs(a,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-yellow-800 flex items-center space-x-2",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:"NY Lottery Sales"})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(n?"gap-4":"md:grid-cols-2 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"lotteryNet",children:"Net Sales ($) *"}),e.jsx(E,{id:"lotteryNet",value:s.lotteryNetSales,onChange:e=>o("lotteryNetSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"scratchOff",children:"Scratch Off Sales ($) *"}),e.jsx(E,{id:"scratchOff",value:s.scratchOffSales,onChange:e=>o("scratchOffSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"text-lg font-semibold",children:"Total Sales Cash (Auto-calculated)"}),e.jsxs("div",{className:"text-2xl font-bold text-yellow-800",children:["$",d.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Net Sales + Scratch Off Sales = $",d.toFixed(2)]})]})]})]})})},me=({values:s,onChange:o})=>{const n=D(),d=s.regularGallons+s.superGallons+s.dieselGallons;return e.jsx("div",{className:"space-y-4",children:e.jsxs(a,{className:"bg-red-50 border-red-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-red-800 flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"Gas Tank Report"})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(n?"gap-4":"md:grid-cols-3 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"regular",children:"Regular (Gallons) *"}),e.jsx(E,{id:"regular",value:s.regularGallons,onChange:e=>o("regularGallons",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"super",children:"Super (Gallons) *"}),e.jsx(E,{id:"super",value:s.superGallons,onChange:e=>o("superGallons",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"diesel",children:"Diesel (Gallons) *"}),e.jsx(E,{id:"diesel",value:s.dieselGallons,onChange:e=>o("dieselGallons",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{className:"peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-lg font-semibold",children:"Total Gallon Sold"}),e.jsxs("div",{className:"text-2xl font-bold text-red-800",children:[d.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Regular + Super + Diesel = ",d.toFixed(2)," gallons"]})]})]})]})})},xe=({open:a,onClose:t,onSubmit:r,loading:l=!1})=>{const{toast:p}=o(),[u,g]=s.useState([]),[j,v]=s.useState(!1),[f,y]=s.useState(!1),[N,_]=s.useState(0),[D,I]=s.useState({vendor:"",othersName:"",amount:0,paymentType:"Cash",chequeNumber:"",invoiceFileId:void 0,invoiceFileName:""});s.useEffect(()=>{a&&(A(),I({vendor:"",othersName:"",amount:0,paymentType:"Cash",chequeNumber:"",invoiceFileId:void 0,invoiceFileName:""}),_(0))},[a]);const A=async()=>{try{v(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(11729,{PageNo:1,PageSize:100,OrderByField:"vendor_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(s)throw new Error(s);g(e?.List||[])}catch(e){console.error("Error loading vendors:",e),p({title:"Error",description:"Failed to load vendors",variant:"destructive"})}finally{v(!1)}},O=(e,s)=>{I(a=>({...a,[e]:s}))};return e.jsx(n,{open:a,onOpenChange:t,children:e.jsxs(d,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(c,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Add Expense"]})}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),D.vendor||D.othersName.trim()?D.amount<=0?p({title:"Validation Error",description:"Please enter a valid amount",variant:"destructive"}):"Cheque"!==D.paymentType||D.chequeNumber.trim()?D.invoiceFileId?(r(D),t()):p({title:"Validation Error",description:"Invoice upload is mandatory",variant:"destructive"}):p({title:"Validation Error",description:"Cheque number is required for cheque payments",variant:"destructive"}):p({title:"Validation Error",description:"Please select a vendor or enter Other's Name",variant:"destructive"})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"vendor",children:"Vendor Name"}),e.jsxs(b,{value:D.vendor,onValueChange:e=>{O("vendor",e),e&&"none"!==e&&O("othersName","")},disabled:j,children:[e.jsx(C,{children:e.jsx(S,{placeholder:j?"Loading vendors...":"Select vendor"})}),e.jsxs(w,{children:[e.jsx(F,{value:"none",children:"Select a vendor"}),u.map(s=>e.jsxs(F,{value:s.vendor_name,children:[s.vendor_name," (",s.category,")"]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"othersName",children:"Other's Name"}),e.jsx(x,{id:"othersName",value:D.othersName,onChange:e=>{O("othersName",e.target.value),e.target.value&&O("vendor","")},placeholder:"Enter name if not using vendor list",disabled:!(!D.vendor||"none"===D.vendor)}),D.vendor&&"none"!==D.vendor&&e.jsx("p",{className:"text-sm text-gray-500",children:"Clear vendor selection to enter other's name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"amount",children:"Amount *"}),e.jsx(E,{id:"amount",value:D.amount,onChange:e=>O("amount",e),placeholder:"0.00",min:0,step:.01,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"paymentType",children:"Payment Type *"}),e.jsxs(b,{value:D.paymentType,onValueChange:e=>{O("paymentType",e),"Cheque"!==e&&O("chequeNumber","")},children:[e.jsx(C,{children:e.jsx(S,{})}),e.jsxs(w,{children:[e.jsx(F,{value:"Cash",children:"Cash"}),e.jsx(F,{value:"Credit Card",children:"Credit Card"}),e.jsx(F,{value:"Cheque",children:"Cheque"})]})]})]}),"Cheque"===D.paymentType&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"chequeNumber",children:"Cheque Number *"}),e.jsx(x,{id:"chequeNumber",value:D.chequeNumber,onChange:e=>O("chequeNumber",e.target.value),placeholder:"Enter cheque number",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"invoice",children:"Invoice Upload *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",id:"invoice",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;if(["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type))if(s.size>10485760)p({title:"File Too Large",description:"Please upload a file smaller than 10MB",variant:"destructive"});else try{y(!0),_(0);const e=setInterval(()=>{_(s=>s>=90?(clearInterval(e),90):s+10)},100),{data:a,error:t}=await window.ezsite.apis.upload({filename:s.name,file:s});if(clearInterval(e),t)throw new Error(t);_(100),I(e=>({...e,invoiceFileId:a,invoiceFileName:s.name})),p({title:"Success",description:"Invoice uploaded successfully"})}catch(a){console.error("Error uploading file:",a),p({title:"Upload Failed",description:"Failed to upload invoice file",variant:"destructive"})}finally{y(!1)}else p({title:"Invalid File Type",description:"Please upload a PDF, image, or document file",variant:"destructive"})},className:"hidden",disabled:f}),e.jsxs(h,{type:"button",variant:"outline",onClick:()=>document.getElementById("invoice")?.click(),disabled:f,className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),f?"Uploading...":"Choose File"]}),D.invoiceFileName&&e.jsx("span",{className:"text-sm text-gray-600 truncate",children:D.invoiceFileName})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{value:N,className:"h-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Uploading... ",N,"%"]})]}),D.invoiceFileId&&!f&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Invoice uploaded successfully"})]}),!D.invoiceFileId&&!f&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Invoice upload is required"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>{I({vendor:"",othersName:"",amount:0,paymentType:"Cash",chequeNumber:"",invoiceFileId:void 0,invoiceFileName:""}),_(0),t()},disabled:l||f,children:"Cancel"}),e.jsxs(h,{type:"submit",disabled:l||f||!D.invoiceFileId,className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),l?"Adding...":"Add Expense"]})]})]})]})})},he=({station:t="MOBIL",reportDate:r,onExpensesChange:l})=>{const{toast:n}=o(),d=D(),[c,m]=s.useState([]),[x,u]=s.useState(!1),[g,j]=s.useState(!1);s.useEffect(()=>{r&&v()},[t,r]),s.useEffect(()=>{const e=f();l?.(e.totalExpenses,e.cashExpense)},[c,l]);const v=async()=>{try{u(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(18494,{PageNo:1,PageSize:100,OrderByField:"expense_date",IsAsc:!1,Filters:[{name:"station",op:"Equal",value:t},{name:"expense_date",op:"StringStartsWith",value:r?.split("T")[0]||(new Date).toISOString().split("T")[0]}]});if(s)throw s;m(e?.List||[])}catch(e){console.error("Error loading expenses:",e),n({title:"Error",description:"Failed to load expenses",variant:"destructive"})}finally{u(!1)}},f=()=>{const e=c.filter(e=>"Cash"===e.payment_type).reduce((e,s)=>e+(s.amount||0),0),s=c.filter(e=>"Credit"===e.payment_type).reduce((e,s)=>e+(s.amount||0),0),a=c.filter(e=>"Cheque"===e.payment_type).reduce((e,s)=>e+(s.amount||0),0);return{cashExpense:e,cardExpense:s,chequeExpense:a,totalExpenses:e+s+a}},{cashExpense:y,cardExpense:N,chequeExpense:b,totalExpenses:C}=f(),S=e=>{switch(e){case"Cash":return"ðŸ’µ";case"Credit":return"ðŸ’³";case"Cheque":return"ðŸ§¾";default:return"ðŸ’°"}};return e.jsxs(e.Fragment,{children:[e.jsxs(a,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Expenses"]}),e.jsxs(h,{onClick:()=>j(!0),size:"sm",className:"gap-2 hover:bg-blue-600 transition-colors",disabled:x,type:"button",children:[e.jsx(k,{className:"h-4 w-4"}),"Add Expense"]})]}),e.jsx("div",{className:"space-y-4",children:x?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(q,{className:"h-8 w-8 mx-auto mb-2 opacity-50 animate-spin"}),e.jsx("p",{children:"Loading expenses..."})]}):0===c.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No expenses added yet"}),e.jsx("p",{className:"text-sm",children:'Click "Add Expense" to get started'})]}):c.map(s=>{return e.jsxs(a,{className:"p-4 space-y-3 border-l-4 border-l-blue-500",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(p,{variant:"outline",className:"gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"Expense #",s.id]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{u(!0);const{error:s}=await window.ezsite.apis.tableDelete(18494,{ID:e});if(s)throw s;n({title:"Success",description:"Expense deleted successfully"}),v()}catch(s){console.error("Error deleting expense:",s),n({title:"Error",description:"Failed to delete expense",variant:"destructive"})}finally{u(!1)}})(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors",disabled:x,type:"button",children:e.jsx(M,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid gap-3 "+(d?"grid-cols-1":"grid-cols-2 lg:grid-cols-3"),children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(i,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),s.vendor_name?"Vendor":"Other's Name"]}),e.jsx("div",{className:"text-sm font-medium",children:s.vendor_name||s.others_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(i,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),"Amount"]}),e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["$",s.amount.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(i,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),"Payment Type"]}),e.jsxs(p,{variant:"Cash"===s.payment_type?"default":"secondary",className:"gap-1",children:[S(s.payment_type),s.payment_type,"Cheque"===s.payment_type&&s.cheque_number&&e.jsxs("span",{className:"ml-1",children:["#",s.cheque_number]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(i,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Date"]}),e.jsx("div",{className:"text-sm",children:(t=s.expense_date,new Date(t).toLocaleDateString())})]}),s.invoice_file_id&&e.jsxs("div",{className:"space-y-1 col-span-full",children:[e.jsxs(i,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"Invoice Attached"]}),e.jsxs(p,{variant:"secondary",className:"gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"File ID: ",s.invoice_file_id]})]})]})]},s.id);var t})}),c.length>0&&e.jsxs(a,{className:"p-4 bg-gray-50 border-2 border-gray-200",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Expense Summary"]}),e.jsxs("div",{className:"grid gap-3 "+(d?"grid-cols-1":"grid-cols-2 lg:grid-cols-4"),children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx(i,{className:"text-sm text-gray-600",children:"Cash Expense"}),e.jsxs("div",{className:"text-xl font-bold text-red-600",children:["$",y.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Used in Short/Over calculation"})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx(i,{className:"text-sm text-gray-600",children:"Card Expense"}),e.jsxs("div",{className:"text-xl font-bold text-red-600",children:["$",N.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx(i,{className:"text-sm text-gray-600",children:"Cheque Expense"}),e.jsxs("div",{className:"text-xl font-bold text-red-600",children:["$",b.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-red-300",children:[e.jsx(i,{className:"text-sm text-gray-600",children:"Total Expenses"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["$",C.toFixed(2)]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Short/Over Calculation:"}),e.jsx("p",{className:"text-xs",children:"Cash Collection on Hand - (Gas Cash + Grocery Cash + Lottery Cash - Cash Expenses)"})]})})]})]}),e.jsx(xe,{open:g,onClose:()=>j(!1),onSubmit:async e=>{try{u(!0);const s={vendor_name:e.vendor||"",others_name:e.othersName,amount:e.amount,payment_type:e.paymentType,cheque_number:e.chequeNumber||"",invoice_file_id:e.invoiceFileId||0,station:t,expense_date:r||(new Date).toISOString(),created_by:1},{error:a}=await window.ezsite.apis.tableCreate(18494,s);if(a)throw a;n({title:"Success",description:"Expense added successfully"}),v()}catch(s){console.error("Error adding expense:",s),n({title:"Error",description:"Failed to add expense",variant:"destructive"})}finally{u(!1)}}})]})},pe=({documents:s,onChange:i})=>{const{toast:n}=o(),d=[{name:"Day Report",field:"dayReportFileId",fileId:s.dayReportFileId,required:!0},{name:"Veeder Root Report",field:"veederRootFileId",fileId:s.veederRootFileId,required:!0},{name:"Lotto Report",field:"lottoReportFileId",fileId:s.lottoReportFileId,required:!0},{name:"Scratch Off Report",field:"scratchOffReportFileId",fileId:s.scratchOffReportFileId,required:!0}],c=d.filter(e=>e.fileId).length,m=d.length;return e.jsxs(a,{className:"bg-purple-50 border-purple-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-purple-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{children:"Documents Upload"})]}),e.jsxs(p,{variant:"outline",className:c===m?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800",children:[c,"/",m," Submitted"]})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Mandatory Submission Required"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"All documents must be uploaded before submitting the sales report."})]}),e.jsx("div",{className:"space-y-4",children:d.map(s=>{const a=(s=>s.fileId?{icon:e.jsx(T,{className:"w-4 h-4"}),text:"Submitted",color:"bg-green-100 text-green-800 border-green-200"}:{icon:e.jsx(L,{className:"w-4 h-4"}),text:"Not Submitted",color:"bg-red-100 text-red-800 border-red-200"})(s);return e.jsxs("div",{className:"border border-purple-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:s.name}),s.required&&e.jsx(p,{variant:"destructive",className:"text-xs",children:"Required"})]}),e.jsx(p,{className:a.color,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[a.icon,e.jsx("span",{children:a.text})]})})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(le,{onFileSelect:e=>(async(e,s)=>{try{const{data:a,error:t}=await window.ezsite.apis.upload({filename:s.name,file:s});if(t)throw t;i(e,a),n({title:"Success",description:`${e.replace("FileId","").replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())} uploaded successfully`})}catch(a){console.error("Error uploading document:",a),n({title:"Error",description:"Failed to upload document",variant:"destructive"})}})(s.field,e),accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,image/*",label:s.fileId?"Re-upload Document":"Upload Document",maxSize:15,className:"w-full"})}),s.fileId&&e.jsxs("div",{className:"mt-2 text-xs text-green-600 flex items-center space-x-1",children:[e.jsx(T,{className:"w-3 h-3"}),e.jsxs("span",{children:["File uploaded successfully (ID: ",s.fileId,")"]})]})]},s.field)})}),e.jsx("div",{className:"pt-4 border-t border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Submission Progress:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:c/m*100+"%"}})}),e.jsxs("span",{className:"font-medium text-purple-800",children:[Math.round(c/m*100),"%"]})]})]})})]})]})},ue=({values:s,onChange:o})=>{const n=s.totalShortOver??s.cashCollectionOnHand-(s.totalCashFromSales-s.totalCashFromExpenses),d=n<0,c=n>0,m=s.totalCashFromSales-s.totalCashFromExpenses;return e.jsxs(a,{className:"bg-gray-50 border-gray-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-gray-800 flex items-center space-x-2",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{children:"Cash Collection"})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"cashOnHand",children:"Cash Collection on Hand ($) *"}),e.jsx(E,{id:"cashOnHand",value:s.cashCollectionOnHand,onChange:e=>o("cashCollectionOnHand",e||0),allowNegative:!0,step:.01,precision:2,required:!0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Physical cash counted at end of shift (can be negative if short)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Expected Cash ($)"}),e.jsx("div",{className:"h-10 px-3 py-2 border border-gray-200 rounded-md bg-gray-100 flex items-center",children:e.jsxs("span",{className:"text-gray-700 font-medium",children:["$",m.toFixed(2)]})}),e.jsx("div",{className:"text-xs text-gray-600",children:"Cash sales - Cash expenses"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Total (+/-) Short/Over"}),e.jsxs("div",{className:"h-10 px-3 py-2 border rounded-md flex items-center justify-between bg-white",children:[e.jsxs("span",{className:"font-bold text-lg "+(d?"text-red-600":c?"text-green-600":"text-gray-700"),children:[d?"-":c?"+":"","$",Math.abs(n).toFixed(2)]}),d&&e.jsx(U,{className:"w-5 h-5 text-red-600"}),c&&e.jsx(V,{className:"w-5 h-5 text-green-600"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[d&&e.jsx(p,{variant:"destructive",className:"text-xs",children:"Short"}),c&&e.jsx(p,{className:"bg-green-100 text-green-800 text-xs",children:"Over"}),!d&&!c&&e.jsx(p,{variant:"outline",className:"text-xs",children:"Exact"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-blue-800",children:"Short/Over Calculation Breakdown"})]}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Cash from Sales:"}),e.jsxs("span",{className:"font-medium",children:["+$",s.totalCashFromSales.toFixed(2)]})]}),e.jsxs("div",{className:"text-xs text-blue-600 ml-4 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"â€¢ Gas & Grocery Cash:"}),e.jsx("span",{children:"Included above"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"â€¢ Grocery Breakdown Cash:"}),e.jsx("span",{children:"Included above"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"â€¢ NY Lottery Total Cash:"}),e.jsx("span",{children:"Included above"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cash Expenses:"}),e.jsxs("span",{className:"font-medium",children:["-$",s.totalCashFromExpenses.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t border-blue-200 pt-2 font-semibold",children:[e.jsx("span",{children:"Expected Cash:"}),e.jsxs("span",{children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Actual Cash on Hand:"}),e.jsxs("span",{className:"font-medium",children:["$",s.cashCollectionOnHand.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t border-blue-200 pt-2 font-bold "+(d?"text-red-600":c?"text-green-600":"text-blue-800"),children:[e.jsx("span",{children:"Difference (Short/Over):"}),e.jsxs("span",{children:[d?"-":c?"+":"","$",Math.abs(n).toFixed(2)]})]})]})]})]})]})},ge="sales_report_draft_";class je{static getDraftKey(e,s){const a=e.replace(/\s+/g,"_").toLowerCase(),t=s.replace(/[^0-9-]/g,"");return`${ge}${a}_${t}`}static saveDraft(e,s,a){try{const t=this.getDraftKey(e,s),r=Date.now(),l={data:a,timestamp:r,expiresAt:r+432e5};return localStorage.setItem(t,JSON.stringify(l)),console.log(`Draft saved successfully for ${e} on ${s}`),!0}catch(t){return console.error("Error saving draft:",t),!1}}static loadDraft(e,s){try{const a=this.getDraftKey(e,s),t=localStorage.getItem(a);if(!t)return null;const r=JSON.parse(t);return Date.now()>r.expiresAt?(console.log(`Draft expired for ${e} on ${s}, removing...`),this.deleteDraft(e,s),null):(console.log(`Draft loaded for ${e} on ${s}`),r.data)}catch(a){return console.error("Error loading draft:",a),null}}static deleteDraft(e,s){try{const a=this.getDraftKey(e,s);localStorage.removeItem(a),console.log(`Draft deleted for ${e} on ${s}`)}catch(a){console.error("Error deleting draft:",a)}}static hasDraft(e,s){try{const a=this.getDraftKey(e,s),t=localStorage.getItem(a);if(!t)return!1;const r=JSON.parse(t);return Date.now()<=r.expiresAt}catch(a){return console.error("Error checking draft:",a),!1}}static getDraftInfo(e,s){try{const a=this.getDraftKey(e,s),t=localStorage.getItem(a);if(!t)return null;const r=JSON.parse(t),l=Date.now();if(l>r.expiresAt)return null;const i=(r.expiresAt-l)/36e5;return{savedAt:new Date(r.timestamp),expiresAt:new Date(r.expiresAt),timeRemainingHours:i}}catch(a){return console.error("Error getting draft info:",a),null}}static cleanupExpiredDrafts(){let e=0;try{const a=Object.keys(localStorage).filter(e=>e.startsWith(ge)),t=Date.now();for(const r of a)try{const s=localStorage.getItem(r);if(s){t>JSON.parse(s).expiresAt&&(localStorage.removeItem(r),e++)}}catch(s){localStorage.removeItem(r),e++}e>0&&console.log(`Cleaned up ${e} expired drafts`)}catch(s){console.error("Error during draft cleanup:",s)}return e}static getAllDrafts(){try{const s=Object.keys(localStorage).filter(e=>e.startsWith(ge)),a=Date.now(),t=[];for(const r of s)try{const e=localStorage.getItem(r);if(e){const s=JSON.parse(e);if(a>s.expiresAt)continue;const l=r.replace(ge,"").split("_"),i=l.pop()||"",o=l.join(" ").toUpperCase(),n=(s.expiresAt-a)/36e5;t.push({station:o,reportDate:i,savedAt:new Date(s.timestamp),expiresAt:new Date(s.expiresAt),timeRemainingHours:n})}}catch(e){console.error("Error parsing draft:",e)}return t.sort((e,s)=>s.savedAt.getTime()-e.savedAt.getTime())}catch(e){return console.error("Error getting all drafts:",e),[]}}}const ve=({open:t,onClose:r,onLoadDraft:i,currentStation:x,currentReportDate:f})=>{const{toast:y}=o(),[N,b]=s.useState([]),[C,S]=s.useState(!1);s.useEffect(()=>{t&&(w(),je.cleanupExpiredDrafts())},[t]);const w=()=>{S(!0);try{const e=je.getAllDrafts();b(e)}catch(e){console.error("Error loading drafts:",e),y({title:"Error",description:"Failed to load drafts",variant:"destructive"})}finally{S(!1)}},F=e=>{if(e<1){const s=Math.floor(60*e);return`${s} minute${1!==s?"s":""}`}return`${Math.floor(e)} hour${1!==Math.floor(e)?"s":""}`},_=e=>e.station===x&&e.reportDate===f;return e.jsx(n,{open:t,onOpenChange:r,children:e.jsxs(d,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(c,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Draft Management"]}),e.jsx(u,{children:"Manage your saved drafts. Drafts are automatically deleted after 12 hours."})]}),e.jsx("div",{className:"space-y-4",children:C?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading drafts..."})]}):0===N.length?e.jsxs(g,{children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(j,{children:'No drafts found. Drafts are automatically saved when you use the "Save as Draft" button.'})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Found ",N.length," draft",1!==N.length?"s":""]}),N.map((s,t)=>e.jsx(a,{className:"relative",children:e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",className:"gap-1",children:[e.jsx(K,{className:"w-3 h-3"}),s.station]}),e.jsxs(p,{variant:"outline",className:"gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),new Date(s.reportDate).toLocaleDateString()]}),_(s)&&e.jsxs(p,{className:"gap-1 bg-green-100 text-green-800",children:[e.jsx(W,{className:"w-3 h-3"}),"Current Form"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),"Saved: ",s.savedAt.toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Expires in: ",F(s.timeRemainingHours)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>(e=>{try{const s=je.loadDraft(e.station,e.reportDate);s?(i?.(s,e.station,e.reportDate),y({title:"Draft Loaded",description:`Draft from ${e.station} loaded successfully`}),r()):y({title:"Error",description:"Draft data could not be loaded",variant:"destructive"})}catch(s){console.error("Error loading draft:",s),y({title:"Error",description:"Failed to load draft",variant:"destructive"})}})(s),className:"gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),"Load"]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>(e=>{try{je.deleteDraft(e.station,e.reportDate),b(s=>s.filter(s=>s.station!==e.station||s.reportDate!==e.reportDate)),y({title:"Draft Deleted",description:`Draft from ${e.station} deleted successfully`})}catch(s){console.error("Error deleting draft:",s),y({title:"Error",description:"Failed to delete draft",variant:"destructive"})}})(s),className:"gap-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(M,{className:"w-3 h-3"})})]})]}),s.timeRemainingHours<2&&e.jsxs(g,{className:"mt-3 border-amber-200 bg-amber-50",children:[e.jsx(J,{className:"h-4 w-4 text-amber-600"}),e.jsx(j,{className:"text-amber-800",children:"This draft will expire soon. Load it now to preserve your data."})]})]})},`${s.station}-${s.reportDate}`))]})}),e.jsx(v,{children:e.jsx(h,{variant:"outline",onClick:r,children:"Close"})})]})})};function fe(){const n=oe(),{id:d}=ne(),{toast:c}=o(),{user:m}=f(),u=!!d,[v,E]=s.useState(""),[D,I]=s.useState([]),[A,O]=s.useState(!1),[$,R]=s.useState(0),[q,G]=s.useState(0),[T,L]=s.useState(!1),[k,P]=s.useState(!1),[M,H]=s.useState(null),[z,B]=s.useState(!1),[U,V]=s.useState(!1),[J,K]=s.useState(null),[W,re]=s.useState({report_date:(new Date).toISOString().split("T")[0],station:"",shift:"DAY",employee_name:"",employee_id:"",cashCollectionOnHand:0,creditCardAmount:0,debitCardAmount:0,mobileAmount:0,cashAmount:0,grocerySales:0,ebtSales:0,groceryCashSales:0,groceryCardSales:0,lotteryNetSales:0,scratchOffSales:0,regularGallons:0,superGallons:0,dieselGallons:0,dayReportFileId:void 0,veederRootFileId:void 0,lottoReportFileId:void 0,scratchOffReportFileId:void 0,notes:""});s.useEffect(()=>{v&&(re(e=>({...e,station:v})),Se(v),u||be())},[v,u]),s.useEffect(()=>{u&&d&&Ce()},[u,d]),s.useEffect(()=>{v&&W.report_date&&!u&&be()},[v,W.report_date,u]);const le=s.useMemo(()=>W.creditCardAmount+W.debitCardAmount+W.mobileAmount+W.cashAmount+W.grocerySales,[W.creditCardAmount,W.debitCardAmount,W.mobileAmount,W.cashAmount,W.grocerySales]),xe=s.useMemo(()=>W.regularGallons+W.superGallons+W.dieselGallons,[W.regularGallons,W.superGallons,W.dieselGallons]),ge=s.useMemo(()=>W.lotteryNetSales+W.scratchOffSales,[W.lotteryNetSales,W.scratchOffSales]),fe=s.useMemo(()=>W.groceryCashSales+W.groceryCardSales+W.ebtSales,[W.groceryCashSales,W.groceryCardSales,W.ebtSales]),ye=s.useMemo(()=>W.cashAmount+W.groceryCashSales+ge,[W.cashAmount,W.groceryCashSales,ge]),Ne=s.useMemo(()=>W.cashCollectionOnHand-(ye-q),[W.cashCollectionOnHand,ye,q]),be=()=>{if(v&&W.report_date&&!u){const e=je.getDraftInfo(v,W.report_date);H(e)}},Ce=async()=>{if(d){V(!0);try{const{data:s,error:a}=await window.ezsite.apis.tablePage(12356,{PageNo:1,PageSize:1,Filters:[{name:"id",op:"Equal",value:parseInt(d)}]});if(a)throw new Error(a);if(s?.List&&s.List.length>0){const a=s.List[0];K(a),E(a.station);const t=e=>{if(null==e||""===e)return 0;const s=parseFloat(e);return isNaN(s)?0:s},r=e=>e?new Date(e).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0];let l={total_expenses:0,cash_expenses:0};if(a.expenses_data)try{l=JSON.parse(a.expenses_data),l.grocery_breakdown&&(groceryBreakdown=l.grocery_breakdown)}catch(e){console.warn("Failed to parse expenses data:",e)}re({report_date:r(a.report_date),station:a.station||"",shift:a.shift||"DAY",employee_name:a.employee_name||"",employee_id:a.employee_id||"",cashCollectionOnHand:t(a.cash_collection_on_hand),creditCardAmount:t(a.credit_card_amount),debitCardAmount:t(a.debit_card_amount),mobileAmount:t(a.mobile_amount),cashAmount:t(a.cash_amount),grocerySales:t(a.grocery_sales),ebtSales:t(a.ebt_sales),groceryCashSales:t(groceryBreakdown.groceryCashSales),groceryCardSales:t(groceryBreakdown.groceryCardSales),lotteryNetSales:t(a.lottery_net_sales),scratchOffSales:t(a.scratch_off_sales),regularGallons:t(a.regular_gallons),superGallons:t(a.super_gallons),dieselGallons:t(a.diesel_gallons),dayReportFileId:a.day_report_file_id||void 0,veederRootFileId:a.veeder_root_file_id||void 0,lottoReportFileId:a.lotto_report_file_id||void 0,scratchOffReportFileId:a.scratch_off_report_file_id||void 0,notes:a.notes||""}),R(t(l.total_expenses)),G(t(l.cash_expenses)),c({title:"Report Loaded",description:"Existing report data has been loaded successfully."})}else c({title:"Report Not Found",description:"The requested report could not be found.",variant:"destructive"}),n("/sales-reports")}catch(s){console.error("Error loading report:",s),c({title:"Error Loading Report",description:s instanceof Error?s.message:"Failed to load existing report",variant:"destructive"})}finally{V(!1)}}},Se=async e=>{O(!0);try{const{data:s,error:a}=await window.ezsite.apis.tablePage(11727,{PageNo:1,PageSize:100,OrderByField:"first_name",IsAsc:!0,Filters:[{name:"station",op:"Equal",value:e},{name:"is_active",op:"Equal",value:!0}]});if(a)throw new Error(a);I(s?.List||[])}catch(s){console.error("Error loading employees:",s),c({title:"Error",description:"Failed to load employees",variant:"destructive"})}finally{O(!1)}},we=(e,s)=>{let a=s;"string"!=typeof s||isNaN(parseFloat(s))?"number"==typeof s&&(a=s):a=parseFloat(s),re(s=>{const t={...s,[e]:a};if("groceryCashSales"===e||"groceryCardSales"===e||"ebtSales"===e){const r="groceryCashSales"===e?a:s.groceryCashSales||0,l="groceryCardSales"===e?a:s.groceryCardSales||0,i="ebtSales"===e?a:s.ebtSales||0;t.grocerySales=r+l+i}return t})},Fe=D.filter(e=>e.employee_id&&""!==e.employee_id.trim());return U?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading report data..."})]})})})}):v?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(h,{variant:"outline",onClick:()=>n("/sales-reports"),className:"mb-4",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Back to Reports"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[u?"Edit":"Create"," Daily Sales Report"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Station: ",e.jsx("span",{className:"font-semibold",children:v})]})]})]}),M&&!u&&e.jsxs(g,{className:"mb-6 border-amber-200 bg-amber-50",children:[e.jsx(Q,{className:"h-4 w-4 text-amber-600"}),e.jsx(j,{className:"text-amber-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["You have a saved draft from ",M.savedAt.toLocaleString(),". Expires in ",Math.floor(M.timeRemainingHours)," hours."]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>L(!0),className:"ml-4 text-amber-800 border-amber-300 hover:bg-amber-100",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Manage Drafts"]})]})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),B(!0);try{if(!W.station||!W.report_date||!W.employee_name)return void c({title:"Missing Required Fields",description:"Please fill in all required fields: Station, Report Date, and Employee Name.",variant:"destructive"});if(!u){if(["dayReportFileId","veederRootFileId","lottoReportFileId","scratchOffReportFileId"].filter(e=>!W[e]).length>0)return void c({title:"Missing Documents",description:"Please upload all required documents before submitting.",variant:"destructive"})}const e=e=>{const s=parseFloat(String(e))||0;return Math.round(100*s)/100},s={report_date:W.report_date,station:W.station,shift:W.shift,employee_name:W.employee_name,employee_id:W.employee_id,cash_collection_on_hand:e(W.cashCollectionOnHand),total_short_over:e(Ne),credit_card_amount:e(W.creditCardAmount),debit_card_amount:e(W.debitCardAmount),mobile_amount:e(W.mobileAmount),cash_amount:e(W.cashAmount),grocery_sales:e(W.grocerySales),ebt_sales:e(W.ebtSales),lottery_net_sales:e(W.lotteryNetSales),scratch_off_sales:e(W.scratchOffSales),lottery_total_cash:e(ge),regular_gallons:e(W.regularGallons),super_gallons:e(W.superGallons),diesel_gallons:e(W.dieselGallons),total_gallons:e(xe),expenses_data:JSON.stringify({total_expenses:e($),cash_expenses:e(q),grocery_breakdown:{groceryCashSales:e(W.groceryCashSales),groceryCardSales:e(W.groceryCardSales)}}),day_report_file_id:W.dayReportFileId||null,veeder_root_file_id:W.veederRootFileId||null,lotto_report_file_id:W.lottoReportFileId||null,scratch_off_report_file_id:W.scratchOffReportFileId||null,total_sales:e(le),notes:W.notes||"",created_by:m?.ID||0};let a;if(a=u?await window.ezsite.apis.tableUpdate(12356,{...s,id:parseInt(d)}):await window.ezsite.apis.tableCreate(12356,s),a.error)throw new Error(a.error);c({title:u?"Report Updated":"Report Created",description:`Sales report has been ${u?"updated":"created"} successfully.`}),v&&W.report_date&&!u&&je.deleteDraft(v,W.report_date),K({...s,id:parseInt(d)||a.data?.id||0,created_by:m?.ID||0}),u?Ce():(re({report_date:(new Date).toISOString().split("T")[0],station:v,shift:"DAY",employee_name:"",employee_id:"",cashCollectionOnHand:0,creditCardAmount:0,debitCardAmount:0,mobileAmount:0,cashAmount:0,grocerySales:0,ebtSales:0,groceryCashSales:0,groceryCardSales:0,lotteryNetSales:0,scratchOffSales:0,regularGallons:0,superGallons:0,dieselGallons:0,dayReportFileId:void 0,veederRootFileId:void 0,lottoReportFileId:void 0,scratchOffReportFileId:void 0,notes:""}),R(0),G(0),H(null),c({title:"Form Reset",description:"Form has been reset for new entry"}))}catch(s){console.error("Error saving report:",s),c({title:"Error",description:s instanceof Error?s.message:"Failed to save report",variant:"destructive"})}finally{B(!1)}},className:"space-y-6",children:[e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(r,{className:"text-lg",children:"Basic Information"})}),e.jsx(l,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"report_date",children:"Report Date *"}),e.jsx(x,{type:"date",id:"report_date",value:W.report_date,onChange:e=>we("report_date",e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Station"}),e.jsx("div",{className:"h-9 px-3 py-2 border border-gray-200 rounded-md bg-gray-100 flex items-center",children:e.jsx("span",{className:"text-gray-700 font-medium",children:v})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"shift",children:"Shift *"}),e.jsxs(b,{value:W.shift,onValueChange:e=>we("shift",e),children:[e.jsx(C,{children:e.jsx(S,{placeholder:"Select shift"})}),e.jsxs(w,{children:[e.jsx(F,{value:"DAY",children:"DAY"}),e.jsx(F,{value:"NIGHT",children:"NIGHT"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"employee",children:"Employee Name *"}),e.jsxs(b,{value:W.employee_id,onValueChange:e=>{const s=Fe.find(s=>s.employee_id===e);s&&(we("employee_id",e),we("employee_name",`${s.first_name} ${s.last_name}`))},disabled:A,children:[e.jsx(C,{children:e.jsx(S,{placeholder:A?"Loading employees...":"Select employee"})}),e.jsxs(w,{children:[0===Fe.length&&!A&&e.jsxs("div",{className:"p-2 text-center text-gray-500",children:["No active employees found for ",v]}),Fe.map(s=>e.jsxs(F,{value:s.employee_id,children:[s.first_name," ",s.last_name," (ID: ",s.employee_id,")"]},s.id))]})]})]})]})})]}),e.jsx(ue,{values:{cashCollectionOnHand:W.cashCollectionOnHand,totalCashFromSales:ye,totalCashFromExpenses:q,totalShortOver:Ne},onChange:we}),e.jsxs(a,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:[e.jsxs(t,{children:[e.jsxs(r,{className:"text-green-800 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Total (+/-) Short/Over Calculation"]}),e.jsx(y,{className:"text-green-700",children:"User Requirements: Gas Cash + Grocery Cash + Lottery Cash - Cash Expenses"})]}),e.jsxs(l,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Gas & Grocery Cash"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",W.cashAmount.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"From Gas & Grocery Section"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Grocery Breakdown Cash"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",W.groceryCashSales.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"From Grocery Breakdown"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"NY Lottery Total Cash"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",ge.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Net Sales + Scratch Off"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-sm text-red-600 mb-1",children:"Cash Expenses"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["-$",q.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Subtracted from total"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg border-2 border-green-300",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Expected Cash from Sales"}),e.jsxs("div",{className:"text-3xl font-bold text-green-800",children:["$",ye.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Formula: $",W.cashAmount.toFixed(2)," + $",W.groceryCashSales.toFixed(2)," + $",ge.toFixed(2)]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-300",children:[e.jsx("div",{className:"text-sm text-blue-600 mb-1",children:"Final Short/Over Calculation"}),e.jsxs("div",{className:"text-3xl font-bold "+(Ne>=0?"text-green-800":"text-red-800"),children:[Ne>=0?"+":"","$",Ne.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["Cash Collection ($",W.cashCollectionOnHand.toFixed(2),") - (Expected Cash - Cash Expenses) = ",Ne>=0?"Over":"Short"]})]})]})]}),e.jsx(de,{station:v,values:{creditCardAmount:W.creditCardAmount,debitCardAmount:W.debitCardAmount,mobileAmount:W.mobileAmount,cashAmount:W.cashAmount,grocerySales:W.grocerySales,ebtSales:W.ebtSales,groceryCashSales:W.groceryCashSales,groceryCardSales:W.groceryCardSales},onChange:we}),e.jsx(ce,{values:{lotteryNetSales:W.lotteryNetSales,scratchOffSales:W.scratchOffSales},onChange:we}),e.jsx(me,{values:{regularGallons:W.regularGallons,superGallons:W.superGallons,dieselGallons:W.dieselGallons},onChange:we}),e.jsx(he,{station:v,reportDate:W.report_date,onExpensesChange:(e,s=0)=>{R(e),G(s)}}),e.jsx(pe,{documents:{dayReportFileId:W.dayReportFileId,veederRootFileId:W.veederRootFileId,lottoReportFileId:W.lottoReportFileId,scratchOffReportFileId:W.scratchOffReportFileId},onChange:(e,s)=>{re(a=>({...a,[e]:s}))}}),e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(r,{className:"text-lg",children:"Additional Notes"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"notes",children:"Notes"}),e.jsx(N,{id:"notes",value:W.notes,onChange:e=>we("notes",e.target.value),placeholder:"Enter any additional notes about the day's operations...",rows:4})]})})]}),e.jsxs(a,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:[e.jsx(t,{children:e.jsx(r,{className:"text-blue-800",children:"Report Summary"})}),e.jsxs(l,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:["$",le.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Sales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-800",children:xe.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gallons"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-800",children:["$",ge.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Lottery Sales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",fe.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Grocery Sales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-800",children:["$",$.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Expenses"})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-blue-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-blue-600 mb-1",children:"Total (+/-) Short/Over"}),e.jsxs("div",{className:"text-4xl font-bold "+(Ne>=0?"text-green-800":"text-red-800"),children:[Ne>=0?"+":"","$",Ne.toFixed(2)]}),e.jsx(p,{variant:Ne>=0?"default":"destructive",className:"mt-2",children:Ne>=0?"Over":"Short"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>n("/sales-reports"),children:"Cancel"}),!u&&e.jsxs(h,{type:"button",variant:"outline",onClick:()=>L(!0),className:"gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Manage Drafts"]}),e.jsxs(h,{type:"button",variant:"outline",onClick:()=>{J?P(!0):c({title:"No Report to Print",description:"Please save the report first before printing",variant:"destructive"})},disabled:!J,className:"gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Print Report"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[!u&&e.jsxs(h,{type:"button",variant:"secondary",onClick:()=>{try{if(!v||!W.report_date)return void c({title:"Cannot Save Draft",description:"Please select a station and report date first",variant:"destructive"});je.saveDraft(v,W.report_date,{...W,totalExpenses:$,cashExpenses:q,calculatedValues:{totalSales:le,totalGallons:xe,totalLotteryCash:ge,totalGrocerySales:fe,expectedCashFromSales:ye,totalShortOver:Ne}})?(c({title:"Draft Saved",description:`Form data saved for ${v} on ${W.report_date}. Will expire in 12 hours.`}),be()):c({title:"Error",description:"Failed to save draft",variant:"destructive"})}catch(e){console.error("Error saving draft:",e),c({title:"Error",description:"Failed to save draft",variant:"destructive"})}},className:"gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Save as Draft"]}),e.jsxs(h,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 gap-2",disabled:z,children:[z?e.jsx(Z,{className:"w-4 h-4 animate-spin"}):e.jsx(te,{className:"w-4 h-4"}),u?"Update":"Create"," Report"]})]})]})]}),e.jsx(ve,{open:T,onClose:()=>L(!1),onLoadDraft:(e,s,a)=>{try{E(s),re({...e,station:s}),e.totalExpenses&&R(e.totalExpenses),e.cashExpenses&&G(e.cashExpenses),je.deleteDraft(s,a),H(null)}catch(t){console.error("Error loading draft:",t),c({title:"Error",description:"Failed to load draft data",variant:"destructive"})}},currentStation:v,currentReportDate:W.report_date}),e.jsx(ie,{open:k,onOpenChange:P,report:J})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(h,{variant:"outline",onClick:()=>n("/dashboard"),className:"mb-4",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Back to Reports"]}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[u?"Edit":"Create"," Daily Sales Report"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Step 1: Select your station to begin"})]}),e.jsx(_,{id:"station",label:"Station",value:v,onValueChange:E,placeholder:"Select a station",required:!0,includeAll:!0})]})})}export{fe as default};
