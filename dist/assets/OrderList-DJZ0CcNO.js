import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{u as r,t,C as a,h as i,f as n,g as l,k as d,e as o,I as c,B as m}from"./index-mhPlV2HJ.js";import{T as x,a as u,b as h,c as p,d as j,e as v}from"./table-CifGLKnD.js";import{u as b,V as y}from"./use-keyboard-shortcuts-Bkhg6oge.js";import{u as g}from"./routing-DcURAnU1.js";import{D as f,n as N,ae as w,W as _,Y as O,y as D,Z as S,V as C,F as k}from"./utilities-BBdJI3Xi.js";import{m as E}from"./animations-CdlE0-Ca.js";import"./data-management-r38r-ocq.js";const $=()=>{const[$,I]=s.useState([]),[A,P]=s.useState(!0),[L,F]=s.useState(""),[M,z]=s.useState(1),[U,R]=s.useState(0),[V,T]=s.useState(null),[B,Y]=s.useState(!1),[K,W]=s.useState(null),Z=g(),{userProfile:q,isAdmin:G}=r();s.useEffect(()=>{H()},[M,L]);const H=async()=>{try{P(!0);const e=[];L&&e.push({name:"order_number",op:"StringContains",value:L});const{data:s,error:r}=await window.ezsite.apis.tablePage("11730",{PageNo:M,PageSize:10,OrderByField:"order_date",IsAsc:!1,Filters:e});if(r)throw r;I(s?.List||[]),R(s?.VirtualCount||0)}catch(e){console.error("Error loading orders:",e),t({title:"Error",description:"Failed to load orders",variant:"destructive"})}finally{P(!1)}},J=e=>{W(e),T(e.ID),Y(!0)},Q=e=>{if(G())try{if(!$.find(s=>s.ID===e))return t({title:"Error",description:"Order not found. Please refresh the list and try again.",variant:"destructive"}),void H();Z(`/orders/${e}/edit`)}catch(s){console.error("Error navigating to edit form:",s),t({title:"Navigation Error",description:"Failed to open edit form. Please try again.",variant:"destructive"})}else t({title:"Access Denied",description:"Only administrators can edit orders.",variant:"destructive"})},X=async e=>{if(!G())return void t({title:"Access Denied",description:"Only administrators can delete orders.",variant:"destructive"});const s=$.find(s=>s.ID===e);if(!s)return t({title:"Error",description:"Order not found. Please refresh the list and try again.",variant:"destructive"}),void H();if(confirm(`Are you sure you want to delete order #${s.order_number}? This action cannot be undone.`))try{const{error:r}=await window.ezsite.apis.tableDelete("11730",{ID:e});if(r)throw r;t({title:"Success",description:`Order #${s.order_number} deleted successfully`}),H(),Y(!1)}catch(r){console.error("Error deleting order:",r),t({title:"Error",description:`Failed to delete order #${s.order_number}`,variant:"destructive"})}};b(V,e=>{const s=$.find(s=>s.ID===e);s&&J(s)},Q,X,()=>Z("/orders/new"));const ee=e=>{switch(e.toLowerCase()){case"pending":return"bg-yellow-500";case"approved":return"bg-blue-500";case"shipped":return"bg-purple-500";case"delivered":return"bg-green-500";case"cancelled":return"bg-red-500";default:return"bg-gray-500"}},se=e=>{switch(e.toUpperCase()){case"MOBIL":return"bg-blue-600";case"AMOCO ROSEDALE":return"bg-green-600";case"AMOCO BROOKLYN":return"bg-purple-600";default:return"bg-gray-600"}},re=e=>e?new Date(e).toLocaleDateString():"N/A",te=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),ae=Math.ceil(U/10),ie=$.reduce((e,s)=>({total_amount:e.total_amount+(s.total_amount||0),pending_orders:e.pending_orders+("pending"===s.status.toLowerCase()?1:0),delivered_orders:e.delivered_orders+("delivered"===s.status.toLowerCase()?1:0)}),{total_amount:0,pending_orders:0,delivered_orders:0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Order Value"}),e.jsx("p",{className:"text-2xl font-bold",children:te(ie.total_amount)})]})]})})}),e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:ie.pending_orders})]})]})})}),e.jsx(a,{children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Delivered Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:ie.delivered_orders})]})]})})})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(l,{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-6 h-6"}),e.jsx("span",{children:"Orders"})]}),e.jsx(d,{children:"Manage your purchase orders and deliveries"})]}),e.jsxs(o,{onClick:()=>Z("/orders/new"),className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Order"})]})]})}),e.jsxs(i,{children:[e.jsx("div",{className:"flex items-center space-x-2 mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(c,{placeholder:"Search orders...",value:L,onChange:e=>F(e.target.value),className:"pl-10"})]})}),A?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,r)=>e.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},r))}):0===$.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No orders found"}),e.jsx(o,{variant:"outline",className:"mt-4",onClick:()=>Z("/orders/new"),children:"Create Your First Order"})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsxs(h,{children:[e.jsx(p,{children:"Order Number"}),e.jsx(p,{children:"Order Date"}),e.jsx(p,{children:"Station"}),e.jsx(p,{children:"Total Amount"}),e.jsx(p,{children:"Expected Delivery"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(j,{children:$.map((s,r)=>e.jsxs(E.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},className:"border-b hover:bg-gray-50 transition-colors cursor-pointer "+(V===s.ID?"bg-blue-50 border-blue-200":""),onClick:()=>T(s.ID),children:[e.jsxs(v,{className:"font-medium",children:[s.order_number,s.notes&&e.jsx("p",{className:"text-sm text-gray-500 truncate max-w-xs mt-1",children:s.notes})]}),e.jsx(v,{children:re(s.order_date)}),e.jsx(v,{children:e.jsx(m,{className:`text-white ${se(s.station)}`,children:s.station})}),e.jsx(v,{className:"font-medium",children:te(s.total_amount)}),e.jsx(v,{children:re(s.expected_delivery)}),e.jsx(v,{children:e.jsx(m,{className:`text-white ${ee(s.status)}`,children:s.status})}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),J(s)},className:"text-blue-600 hover:text-blue-700",children:e.jsx(D,{className:"w-4 h-4"})}),G()&&e.jsx(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),Q(s.ID)},title:"Edit Order",children:e.jsx(S,{className:"w-4 h-4"})}),G()&&e.jsx(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),X(s.ID)},className:"text-red-600 hover:text-red-700",title:"Delete Order",children:e.jsx(C,{className:"w-4 h-4"})})]})})]},s.ID))})]})}),!G()&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-700",children:[e.jsx("strong",{children:"Access Restrictions:"}),"Only administrators can edit or delete orders."]})}),ae>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",10*(M-1)+1," to ",Math.min(10*M,U)," of ",U," orders"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>z(e=>Math.max(e-1,1)),disabled:1===M,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",M," of ",ae]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>z(e=>Math.min(e+1,ae)),disabled:M===ae,children:"Next"})]})]})]})]}),K&&e.jsx(y,{isOpen:B,onClose:()=>{Y(!1),W(null),T(null)},title:`Order #${K.order_number}`,subtitle:`${K.station} • ${te(K.total_amount)} • ${K.status}`,data:K,fields:(ne=K,[{key:"order_number",label:"Order Number",value:ne.order_number,type:"text",icon:k},{key:"vendor_id",label:"Vendor ID",value:ne.vendor_id,type:"number"},{key:"order_date",label:"Order Date",value:ne.order_date,type:"date"},{key:"expected_delivery",label:"Expected Delivery",value:ne.expected_delivery,type:"date"},{key:"station",label:"Station",value:ne.station,type:"badge",badgeColor:se(ne.station)},{key:"total_amount",label:"Total Amount",value:ne.total_amount,type:"currency"},{key:"status",label:"Status",value:ne.status,type:"badge",badgeColor:ee(ne.status)},{key:"notes",label:"Notes",value:ne.notes,type:"text"}]),onEdit:()=>{Y(!1),Q(K.ID)},onDelete:()=>X(K.ID),onExport:()=>{if(!K)return;const e=["Field,Value",`Order Number,${K.order_number}`,`Vendor ID,${K.vendor_id}`,`Order Date,${K.order_date}`,`Expected Delivery,${K.expected_delivery}`,`Station,${K.station}`,`Total Amount,${K.total_amount}`,`Status,${K.status}`,`Notes,${K.notes}`].join("\n"),s=new Blob([e],{type:"text/csv"}),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`order_${K.order_number}_details.csv`,a.click(),window.URL.revokeObjectURL(r),t({title:"Success",description:"Order details exported successfully"})},canEdit:G(),canDelete:G(),canExport:!0})]});var ne};export{$ as default};
