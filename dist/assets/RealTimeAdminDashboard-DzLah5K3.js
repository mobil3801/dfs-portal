import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{l as a,u as t,C as l,f as r,g as i,h as c,e as n,B as d,L as x,I as o,D as h,a as m,b as j,c as u}from"./index-DyvxZZaK.js";import{P as p}from"./progress-BuqgJQWg.js";import{T as g,a as N,b as v,c as f,d as b,e as y}from"./table-CTSRIdN4.js";import{S as w,c as A,d as C,a as S,b as L}from"./select-DxfsAJPc.js";import{C as U}from"./CreateUserDialog-B4ycYjU0.js";import{z as _,C as D,A as E,R as O,G as R,l as I,s as M,g as P,S as k,aw as F,aE as z,ak as T,Z as B,V}from"./utilities-DMEd7dY0.js";const $=()=>{const{toast:$}=a(),{user:H}=t(),[K,Y]=s.useState(!0),[G,Z]=s.useState(!1),[q,J]=s.useState([]),[Q,W]=s.useState({totalUsers:0,activeUsers:0,inactiveUsers:0,totalProfiles:0,administrators:0,managers:0,employees:0,lastUpdate:(new Date).toISOString()}),[X,ee]=s.useState(!1),[se,ae]=s.useState(null),[te,le]=s.useState(!1),[re,ie]=s.useState(""),[ce,ne]=s.useState("All"),[de,xe]=s.useState("All"),oe=["Administrator","Management","Employee"],he=["ALL","MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN"],[me,je]=s.useState({role:"",station:"",employee_id:"",phone:"",hire_date:"",is_active:!0});s.useEffect(()=>{ue();const e=setInterval(()=>{ue()},1e4);return()=>clearInterval(e)},[]);const ue=async()=>{K||Z(!0);try{const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:500,OrderByField:"id",IsAsc:!1,Filters:[]});if(s)throw new Error(`Failed to fetch profiles: ${s}`);const a=e?.List||[];J(a);const t=a.filter(e=>e.is_active).length,l=a.filter(e=>!e.is_active).length,r=a.filter(e=>"Administrator"===e.role).length,i=a.filter(e=>"Management"===e.role).length,c=a.filter(e=>"Employee"===e.role).length;W({totalUsers:a.length,activeUsers:t,inactiveUsers:l,totalProfiles:a.length,administrators:r,managers:i,employees:c,lastUpdate:(new Date).toISOString()}),console.log("Real-time data updated:",{profiles:a.length,active:t,inactive:l})}catch(e){console.error("Error fetching real-time data:",e),$({title:"Database Error",description:`Failed to fetch real-time data: ${e}`,variant:"destructive"})}finally{Y(!1),Z(!1)}},pe=q.filter(e=>{const s=(e.employee_id?.toLowerCase()||"").includes(re.toLowerCase())||(e.phone?.toLowerCase()||"").includes(re.toLowerCase())||(e.role?.toLowerCase()||"").includes(re.toLowerCase()),a="All"===ce||e.role===ce,t="All"===de||e.station===de;return s&&a&&t}),ge=e=>{switch(e){case"Administrator":return"bg-red-100 text-red-800";case"Management":return"bg-blue-100 text-blue-800";case"Employee":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},Ne=e=>{switch(e){case"ALL":return"bg-purple-100 text-purple-800";case"MOBIL":return"bg-blue-100 text-blue-800";case"AMOCO ROSEDALE":return"bg-orange-100 text-orange-800";case"AMOCO BROOKLYN":return"bg-teal-100 text-teal-800";default:return"bg-gray-100 text-gray-800"}};return K?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-lg font-semibold",children:"Loading Real-Time Admin Dashboard..."}),e.jsx("p",{className:"text-sm text-gray-600",children:"Connecting to production database"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Real-Time Admin Dashboard"}),e.jsxs("p",{className:"opacity-90",children:["Administrator: ",H?.Name," â€¢ Live Database Integration"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm",children:"Production Database Connected"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm opacity-75",children:"Last Updated"}),e.jsx("p",{className:"text-sm font-mono",children:new Date(Q.lastUpdate).toLocaleTimeString()})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(l,{children:[e.jsx(r,{className:"pb-3",children:e.jsx(i,{className:"text-sm text-gray-600",children:"Database Status"})}),e.jsxs(c,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Connected & Active"})]}),e.jsx(p,{value:100,className:"mt-2 h-2"})]})]}),e.jsxs(l,{children:[e.jsx(r,{className:"pb-3",children:e.jsx(i,{className:"text-sm text-gray-600",children:"Auto-Refresh"})}),e.jsxs(c,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Every 10 seconds"})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Real-time updates"})]})]})]}),e.jsxs(l,{children:[e.jsx(r,{className:"pb-3",children:e.jsx(i,{className:"text-sm text-gray-600",children:"Actions"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(n,{size:"sm",onClick:async()=>{Z(!0),await ue(),$({title:"Success",description:"Real-time data refreshed successfully"})},disabled:G,className:"flex-1",children:[e.jsx(O,{className:"w-4 h-4 mr-1 "+(G?"animate-spin":"")}),G?"Refreshing...":"Refresh"]}),e.jsxs(n,{size:"sm",onClick:()=>ee(!0),className:"flex-1",children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"Add User"]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:Q.totalUsers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:Q.activeUsers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"w-6 h-6 text-orange-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:Q.inactiveUsers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Inactive"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:Q.administrators}),e.jsx("p",{className:"text-sm text-gray-600",children:"Admins"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:Q.managers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Managers"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:Q.employees}),e.jsx("p",{className:"text-sm text-gray-600",children:"Employees"})]})})}),e.jsx(l,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"w-6 h-6 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold",children:Q.totalProfiles}),e.jsx("p",{className:"text-sm text-gray-600",children:"Profiles"})]})})})]}),e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(i,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Real-Time User Management"}),e.jsxs(d,{className:"bg-green-100 text-green-800",children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"Live Data"]})]})}),e.jsxs(c,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Search"}),e.jsx(o,{placeholder:"Search users...",value:re,onChange:e=>ie(e.target.value)})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Role"}),e.jsxs(w,{value:ce,onValueChange:ne,children:[e.jsx(A,{children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(L,{value:"All",children:"All Roles"}),oe.map(s=>e.jsx(L,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Station"}),e.jsxs(w,{value:de,onValueChange:xe,children:[e.jsx(A,{children:e.jsx(C,{})}),e.jsxs(S,{children:[e.jsx(L,{value:"All",children:"All Stations"}),he.map(s=>e.jsx(L,{value:s,children:s},s))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(n,{variant:"outline",onClick:()=>{ie(""),ne("All"),xe("All")},children:"Clear Filters"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(g,{children:[e.jsx(N,{children:e.jsxs(v,{children:[e.jsx(f,{children:"Employee ID"}),e.jsx(f,{children:"Role"}),e.jsx(f,{children:"Station"}),e.jsx(f,{children:"Phone"}),e.jsx(f,{children:"Hire Date"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(b,{children:pe.map(s=>e.jsxs(v,{children:[e.jsx(y,{className:"font-medium",children:s.employee_id}),e.jsx(y,{children:e.jsx(d,{className:ge(s.role),children:s.role})}),e.jsx(y,{children:e.jsx(d,{className:Ne(s.station),children:"ALL"===s.station?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"ALL"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),s.station]})})}),e.jsx(y,{children:s.phone}),e.jsx(y,{children:s.hire_date?new Date(s.hire_date).toLocaleDateString():"N/A"}),e.jsx(y,{children:e.jsx(d,{className:s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:s.is_active?"Active":"Inactive"})}),e.jsx(y,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>(e=>{ae(e),je({role:e.role,station:e.station,employee_id:e.employee_id,phone:e.phone,hire_date:e.hire_date?.split("T")[0]||"",is_active:e.is_active}),le(!0)})(s),children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const{error:s}=await window.ezsite.apis.tableDelete(11725,{id:e.id});if(s)throw s;$({title:"Success",description:"User deleted successfully from production database"}),ue()}catch(s){console.error("Error deleting user:",s),$({title:"Error",description:`Failed to delete user: ${s}`,variant:"destructive"})}})(s),className:"text-red-600 hover:text-red-700",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},s.id))})]})}),0===pe.length&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No users found matching your criteria"})]})]})]}),e.jsx(U,{isOpen:X,onClose:()=>ee(!1),onUserCreated:()=>{ue(),$({title:"Success",description:"User created successfully in production database"})}}),e.jsx(h,{open:te,onOpenChange:le,children:e.jsxs(m,{children:[e.jsx(j,{children:e.jsx(u,{children:"Edit User Profile"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Role"}),e.jsxs(w,{value:me.role,onValueChange:e=>je({...me,role:e}),children:[e.jsx(A,{children:e.jsx(C,{})}),e.jsx(S,{children:oe.map(s=>e.jsx(L,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Station"}),e.jsxs(w,{value:me.station,onValueChange:e=>je({...me,station:e}),children:[e.jsx(A,{children:e.jsx(C,{})}),e.jsx(S,{children:he.map(s=>e.jsx(L,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Employee ID"}),e.jsx(o,{value:me.employee_id,onChange:e=>je({...me,employee_id:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Phone"}),e.jsx(o,{value:me.phone,onChange:e=>je({...me,phone:e.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Hire Date"}),e.jsx(o,{type:"date",value:me.hire_date,onChange:e=>je({...me,hire_date:e.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_active","aria-label":"Active User",checked:me.is_active,onChange:e=>je({...me,is_active:e.target.checked})}),e.jsx(x,{htmlFor:"is_active",children:"Active User"})]}),e.jsx(n,{onClick:async()=>{if(se)try{const{error:e}=await window.ezsite.apis.tableUpdate(11725,{id:se.id,...me});if(e)throw e;$({title:"Success",description:"User updated successfully in production database"}),le(!1),ae(null),ue()}catch(e){console.error("Error updating user:",e),$({title:"Error",description:`Failed to update user: ${e}`,variant:"destructive"})}},className:"w-full",children:"Update User"})]})]})})]})};export{$ as R};
