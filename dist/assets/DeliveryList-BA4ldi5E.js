import{j as e}from"./radix-ui-BhRELLXi.js";import{r as s}from"./react-core-CKNU0hQt.js";import{f as n,C as a,g as t,h as i,B as l,i as r,S as d,n as c,u as o,I as x,T as v,a as m,b as u,c as p,d as h,e as f}from"./index-s81fdLZV.js";import{S as g,c as b,d as j,a as y,b as N}from"./select-CiDiYLaC.js";import{D as _,a as w,b as D,c as $,f as k}from"./dialog-DoXR3LdX.js";import{i as S,a7 as O,ab as A,o as C,T as R,X as T,Q as P,V as z,a6 as E,w as M,W as L,O as F}from"./utilities-DVevn_gw.js";import{u as B}from"./routing-DcURAnU1.js";import"./data-management-CF8GQrOz.js";import"./animations-Cc9qW4PM.js";const V=({open:s,onOpenChange:c,delivery:o,afterDeliveryReport:x})=>{if(!o)return null;const v=e=>e?new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"N/A",m=e=>(e||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),u=e=>{switch(e.toLowerCase()){case"verified":return"text-green-600";case"discrepancy found":return"text-red-600";case"pending review":return"text-yellow-600";default:return"text-gray-600"}},p=o.regular_tank_volume+o.plus_tank_volume+o.super_tank_volume,h=o.regular_delivered+o.plus_delivered+o.super_delivered,f=p+h,g=x?x.regular_tank_final+x.plus_tank_final+x.super_tank_final:0,b=x?Math.abs(f-g):0,j=b>5,y=o.regular_tank_volume+o.regular_delivered,N=o.plus_tank_volume+o.plus_delivered,P=o.super_tank_volume+o.super_delivered,z=()=>{const e=`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Fuel Delivery Report - ${o.bol_number||`Record #${o.id}`}</title>\n          <style>\n            @page {\n              size: A4;\n              margin: 0.5in;\n            }\n            body {\n              font-family: 'Arial', sans-serif;\n              margin: 0;\n              padding: 0;\n              color: #333;\n              line-height: 1.4;\n            }\n            .header {\n              text-align: center;\n              margin-bottom: 30px;\n              border-bottom: 3px solid #2563eb;\n              padding-bottom: 20px;\n            }\n            .company-logo {\n              font-size: 28px;\n              font-weight: bold;\n              color: #1e40af;\n              margin-bottom: 5px;\n            }\n            .report-title {\n              font-size: 20px;\n              color: #374151;\n              margin-bottom: 10px;\n            }\n            .report-meta {\n              display: grid;\n              grid-template-columns: repeat(3, 1fr);\n              gap: 20px;\n              background: #f8fafc;\n              padding: 15px;\n              border-radius: 8px;\n              margin-bottom: 25px;\n            }\n            .meta-item {\n              text-align: center;\n            }\n            .meta-label {\n              font-size: 12px;\n              color: #6b7280;\n              text-transform: uppercase;\n              font-weight: 600;\n            }\n            .meta-value {\n              font-size: 14px;\n              font-weight: bold;\n              margin-top: 5px;\n            }\n            .station-badge {\n              display: inline-block;\n              padding: 4px 12px;\n              border-radius: 20px;\n              color: white;\n              font-size: 12px;\n              font-weight: 600;\n            }\n            .section {\n              margin-bottom: 25px;\n              break-inside: avoid;\n            }\n            .section-header {\n              display: flex;\n              align-items: center;\n              margin-bottom: 15px;\n              padding-bottom: 10px;\n              border-bottom: 2px solid #e5e7eb;\n            }\n            .section-icon {\n              margin-right: 10px;\n              color: #2563eb;\n              font-size: 18px;\n            }\n            .section-title {\n              font-size: 18px;\n              font-weight: bold;\n              color: #1f2937;\n            }\n            .data-grid {\n              display: grid;\n              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n              gap: 15px;\n            }\n            .fuel-grid {\n              display: grid;\n              grid-template-columns: repeat(4, 1fr);\n              gap: 15px;\n            }\n            .data-card {\n              border: 1px solid #e5e7eb;\n              border-radius: 8px;\n              padding: 15px;\n              background: #ffffff;\n              text-align: center;\n            }\n            .fuel-card {\n              border: 2px solid;\n              border-radius: 10px;\n              padding: 20px;\n              text-align: center;\n            }\n            .fuel-regular {\n              border-color: #3b82f6;\n              background: #eff6ff;\n            }\n            .fuel-plus {\n              border-color: #10b981;\n              background: #f0fdf4;\n            }\n            .fuel-super {\n              border-color: #8b5cf6;\n              background: #faf5ff;\n            }\n            .fuel-total {\n              border-color: #f59e0b;\n              background: #fffbeb;\n            }\n            .data-label {\n              font-size: 12px;\n              color: #6b7280;\n              text-transform: uppercase;\n              font-weight: 600;\n              margin-bottom: 8px;\n            }\n            .data-value {\n              font-size: 18px;\n              font-weight: bold;\n              color: #1f2937;\n            }\n            .fuel-amount {\n              font-size: 24px;\n              font-weight: bold;\n              margin-bottom: 5px;\n            }\n            .fuel-label {\n              font-size: 12px;\n              color: #6b7280;\n              font-weight: 600;\n            }\n            .comparison-table {\n              width: 100%;\n              border-collapse: collapse;\n              margin-top: 15px;\n            }\n            .comparison-table th,\n            .comparison-table td {\n              padding: 12px;\n              text-align: center;\n              border: 1px solid #e5e7eb;\n            }\n            .comparison-table th {\n              background: #f3f4f6;\n              font-weight: 600;\n              font-size: 12px;\n              text-transform: uppercase;\n            }\n            .verification-section {\n              background: #f0fdf4;\n              border: 2px solid #10b981;\n              border-radius: 8px;\n              padding: 20px;\n              margin: 20px 0;\n            }\n            .verification-warning {\n              background: #fffbeb;\n              border-color: #f59e0b;\n            }\n            .verification-error {\n              background: #fef2f2;\n              border-color: #ef4444;\n            }\n            .status-verified {\n              color: #059669;\n              font-weight: bold;\n            }\n            .status-warning {\n              color: #d97706;\n              font-weight: bold;\n            }\n            .status-error {\n              color: #dc2626;\n              font-weight: bold;\n            }\n            .notes-section {\n              background: #fffbeb;\n              border-left: 4px solid #f59e0b;\n              padding: 15px;\n              margin: 20px 0;\n            }\n            .footer {\n              margin-top: 40px;\n              text-align: center;\n              font-size: 11px;\n              color: #6b7280;\n              border-top: 1px solid #e5e7eb;\n              padding-top: 20px;\n            }\n            @media print {\n              body { font-size: 11pt; }\n              .section { page-break-inside: avoid; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <div class="company-logo">DFS Manager Portal</div>\n            <div class="report-title">Fuel Delivery Report - Enhanced</div>\n          </div>\n\n          <div class="report-meta">\n            <div class="meta-item">\n              <div class="meta-label">Delivery Date</div>\n              <div class="meta-value">${v(o.delivery_date)}</div>\n            </div>\n            <div class="meta-item">\n              <div class="meta-label">Station</div>\n              <div class="meta-value">\n                <span class="station-badge" style="background: ${"MOBIL"===o.station?"#ef4444":"AMOCO ROSEDALE"===o.station?"#3b82f6":"#10b981"}">${o.station}</span>\n              </div>\n            </div>\n            <div class="meta-item">\n              <div class="meta-label">BOL Number</div>\n              <div class="meta-value">${o.bol_number||"Not Assigned"}</div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">📊</span>\n              <span class="section-title">Delivery Summary</span>\n            </div>\n            <div class="data-grid">\n              <div class="data-card">\n                <div class="data-label">Record ID</div>\n                <div class="data-value">#${o.id}</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Total Delivered</div>\n                <div class="data-value">${m(h)} gal</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Total Before</div>\n                <div class="data-value">${m(p)} gal</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Expected Total After</div>\n                <div class="data-value">${m(f)} gal</div>\n              </div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">⛽</span>\n              <span class="section-title">Tank Volumes Before Delivery</span>\n            </div>\n            <div class="fuel-grid">\n              <div class="fuel-card fuel-regular">\n                <div class="fuel-amount">${m(o.regular_tank_volume)}</div>\n                <div class="fuel-label">Regular Tank (gal)</div>\n              </div>\n              <div class="fuel-card fuel-plus">\n                <div class="fuel-amount">${m(o.plus_tank_volume)}</div>\n                <div class="fuel-label">Plus Tank (gal)</div>\n              </div>\n              <div class="fuel-card fuel-super">\n                <div class="fuel-amount">${m(o.super_tank_volume)}</div>\n                <div class="fuel-label">Super Tank (gal)</div>\n              </div>\n              <div class="fuel-card fuel-total">\n                <div class="fuel-amount">${m(p)}</div>\n                <div class="fuel-label">Total Volume (gal)</div>\n              </div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">🚛</span>\n              <span class="section-title">Fuel Delivered</span>\n            </div>\n            <div class="fuel-grid">\n              <div class="fuel-card fuel-regular">\n                <div class="fuel-amount">${m(o.regular_delivered)}</div>\n                <div class="fuel-label">Regular Delivered (gal)</div>\n              </div>\n              <div class="fuel-card fuel-plus">\n                <div class="fuel-amount">${m(o.plus_delivered)}</div>\n                <div class="fuel-label">Plus Delivered (gal)</div>\n              </div>\n              <div class="fuel-card fuel-super">\n                <div class="fuel-amount">${m(o.super_delivered)}</div>\n                <div class="fuel-label">Super Delivered (gal)</div>\n              </div>\n              <div class="fuel-card fuel-total">\n                <div class="fuel-amount">${m(h)}</div>\n                <div class="fuel-label">Total Delivered (gal)</div>\n              </div>\n            </div>\n          </div>\n\n          ${x?`\n          <div class="section">\n            <div class="section-header">\n              <span class="section-icon">✅</span>\n              <span class="section-title">Post-Delivery Verification</span>\n            </div>\n            <table class="comparison-table">\n              <thead>\n                <tr>\n                  <th>Tank Type</th>\n                  <th>Before Delivery</th>\n                  <th>Delivered</th>\n                  <th>Expected After</th>\n                  <th>Actual After</th>\n                  <th>Difference</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr>\n                  <td><strong>Regular</strong></td>\n                  <td>${m(o.regular_tank_volume)}</td>\n                  <td>${m(o.regular_delivered)}</td>\n                  <td>${m(y)}</td>\n                  <td>${m(x.regular_tank_final)}</td>\n                  <td class="${Math.abs(y-x.regular_tank_final)<=2?"status-verified":"status-error"}">\n                    ${m(Math.abs(y-x.regular_tank_final))}\n                  </td>\n                </tr>\n                <tr>\n                  <td><strong>Plus</strong></td>\n                  <td>${m(o.plus_tank_volume)}</td>\n                  <td>${m(o.plus_delivered)}</td>\n                  <td>${m(N)}</td>\n                  <td>${m(x.plus_tank_final)}</td>\n                  <td class="${Math.abs(N-x.plus_tank_final)<=2?"status-verified":"status-error"}">\n                    ${m(Math.abs(N-x.plus_tank_final))}\n                  </td>\n                </tr>\n                <tr>\n                  <td><strong>Super</strong></td>\n                  <td>${m(o.super_tank_volume)}</td>\n                  <td>${m(o.super_delivered)}</td>\n                  <td>${m(P)}</td>\n                  <td>${m(x.super_tank_final)}</td>\n                  <td class="${Math.abs(P-x.super_tank_final)<=2?"status-verified":"status-error"}">\n                    ${m(Math.abs(P-x.super_tank_final))}\n                  </td>\n                </tr>\n                <tr style="border-top: 2px solid #374151; font-weight: bold;">\n                  <td><strong>TOTAL</strong></td>\n                  <td>${m(p)}</td>\n                  <td>${m(h)}</td>\n                  <td>${m(f)}</td>\n                  <td>${m(g)}</td>\n                  <td class="${j?"status-error":"status-verified"}">\n                    ${m(b)}\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n\n          <div class="verification-section ${j?"verification-error":"verification-section"}">\n            <div class="section-header">\n              <span class="section-icon">${j?"⚠️":"✅"}</span>\n              <span class="section-title">Verification Status</span>\n            </div>\n            <div class="data-grid">\n              <div class="data-card">\n                <div class="data-label">Status</div>\n                <div class="data-value ${u(x.verification_status)}">${x.verification_status}</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Tank Temperature</div>\n                <div class="data-value">${x.tank_temperature}°F</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Reported By</div>\n                <div class="data-value">${x.reported_by}</div>\n              </div>\n              <div class="data-card">\n                <div class="data-label">Supervisor Approval</div>\n                <div class="data-value ${x.supervisor_approval?"status-verified":"status-warning"}">\n                  ${x.supervisor_approval?"✅ Approved":"⏳ Pending"}\n                </div>\n              </div>\n            </div>\n            ${x.discrepancy_notes?`\n            <div style="margin-top: 15px; padding: 10px; background: #fef2f2; border-radius: 5px;">\n              <strong>Discrepancy Notes:</strong><br>\n              ${x.discrepancy_notes}\n            </div>\n            `:""}\n          </div>\n          `:'\n          <div class="verification-section verification-warning">\n            <div class="section-header">\n              <span class="section-icon">⏳</span>\n              <span class="section-title">Verification Pending</span>\n            </div>\n            <p>Post-delivery tank verification has not been completed yet. Please ensure tank levels are measured and recorded after the delivery is complete.</p>\n          </div>\n          '}\n\n          ${o.delivery_notes?`\n          <div class="notes-section">\n            <div class="section-header">\n              <span class="section-icon">📝</span>\n              <span class="section-title">Delivery Notes</span>\n            </div>\n            <p style="margin: 0; white-space: pre-wrap;">${o.delivery_notes}</p>\n          </div>\n          `:""}\n\n          ${x&&x.additional_notes?`\n          <div class="notes-section">\n            <div class="section-header">\n              <span class="section-icon">📋</span>\n              <span class="section-title">Additional Verification Notes</span>\n            </div>\n            <p style="margin: 0; white-space: pre-wrap;">${x.additional_notes}</p>\n          </div>\n          `:""}\n\n          <div class="footer">\n            <div>Delivery Record ID: #${o.id} | Generated on ${(new Date).toLocaleString()}</div>\n            <div>Created by User #${o.created_by} | DFS Manager Portal v2.0</div>\n            ${x?`<div>Verification Report ID: #${x.id} | Verified by User #${x.created_by}</div>`:""}\n            <div style="margin-top: 10px; font-style: italic;">\n              This is an official fuel delivery document. Please retain for your records and regulatory compliance.\n            </div>\n          </div>\n        </body>\n      </html>\n    `,s=window.open("","_blank");s&&(s.document.write(e),s.document.close(),s.focus(),setTimeout(()=>{s.print(),s.close()},500))};return e.jsx(_,{open:s,onOpenChange:c,children:e.jsxs(w,{className:"max-w-6xl max-h-[95vh] overflow-y-auto",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600"}),"Enhanced Delivery Report - ",o.bol_number||`Record #${o.id}`]}),e.jsxs(n,{onClick:z,variant:"outline",size:"sm",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(O,{className:"h-4 w-4"}),"Print Full Report"]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(a,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:e.jsx(t,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-blue-800",children:v(o.delivery_date)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(l,{className:(e=>{switch(e.toUpperCase()){case"MOBIL":return"bg-red-500 text-white";case"AMOCO ROSEDALE":return"bg-blue-500 text-white";case"AMOCO BROOKLYN":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}})(o.station),children:o.station}),e.jsxs("span",{className:"text-sm text-gray-600",children:["BOL: ",o.bol_number||"Not Assigned"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:[m(h)," gal"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Delivered"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(a,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-blue-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m(o.regular_delivered)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Regular Delivered"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-green-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m(o.plus_delivered)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Plus Delivered"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-purple-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m(o.super_delivered)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Super Delivered"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(C,{className:"h-8 w-8 mx-auto text-orange-600 mb-2"}),e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:m(h)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Delivered"})]})})]}),x&&e.jsxs(a,{className:"border-2 "+(j?"border-red-200 bg-red-50":"border-green-200 bg-green-50"),children:[e.jsx(t,{children:e.jsx(i,{className:"flex items-center gap-2",children:j?e.jsxs("div",{className:"text-red-600 flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Volume Discrepancy Detected"]}):e.jsx("div",{className:"text-green-600",children:"✓ Delivery Verified"})})}),e.jsx(r,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`font-medium ${u(x.verification_status)}`,children:x.verification_status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Temperature:"}),e.jsxs("span",{className:"font-medium",children:[x.tank_temperature,"°F"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Volume Difference:"}),e.jsxs("span",{className:"font-medium "+(j?"text-red-600":"text-green-600"),children:[m(b)," gal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Supervisor Approval:"}),e.jsx("span",{className:"font-medium "+(x.supervisor_approval?"text-green-600":"text-yellow-600"),children:x.supervisor_approval?"✓ Approved":"⏳ Pending"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(i,{className:"text-sm",children:"Tank Volumes Before"})}),e.jsxs(r,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Regular:"}),e.jsxs("span",{className:"font-medium",children:[m(o.regular_tank_volume)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Plus:"}),e.jsxs("span",{className:"font-medium",children:[m(o.plus_tank_volume)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Super:"}),e.jsxs("span",{className:"font-medium",children:[m(o.super_tank_volume)," gal"]})]}),e.jsx(d,{}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[m(p)," gal"]})]})]})]}),e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(i,{className:"text-sm",children:"Fuel Delivered"})}),e.jsxs(r,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Regular:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[m(o.regular_delivered)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Plus:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[m(o.plus_delivered)," gal"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Super:"}),e.jsxs("span",{className:"font-medium text-purple-600",children:[m(o.super_delivered)," gal"]})]}),e.jsx(d,{}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-orange-600",children:[m(h)," gal"]})]})]})]})]}),(o.delivery_notes||x&&x.additional_notes)&&e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(i,{className:"text-sm",children:"Notes"})}),e.jsxs(r,{className:"space-y-3",children:[o.delivery_notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Delivery Notes:"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:o.delivery_notes})]}),x&&x.additional_notes&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Verification Notes:"}),e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:x.additional_notes})]})]})]})]}),e.jsxs(k,{className:"flex justify-end space-x-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>c(!1),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Close"]}),e.jsxs(n,{onClick:z,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Print Full Report"]})]})]})})},I=()=>{const d=B(),{toast:_}=c(),{userProfile:w,isAdmin:D}=o(),[$,k]=s.useState([]),[O,A]=s.useState(!0),[C,R]=s.useState(""),[T,I]=s.useState("all"),[U,Y]=s.useState(1),[K,G]=s.useState(0),[W,q]=s.useState(null),[Q,H]=s.useState(!1);s.useEffect(()=>{J()},[U,C,T]);const J=async()=>{try{A(!0);const e=[];"all"!==T&&e.push({name:"station",op:"Equal",value:T}),C&&e.push({name:"bol_number",op:"StringContains",value:C});const{data:s,error:n}=await window.ezsite.apis.tablePage(12196,{PageNo:U,PageSize:10,OrderByField:"delivery_date",IsAsc:!1,Filters:e});if(n)throw n;k(s?.List||[]),G(s?.VirtualCount||0)}catch(e){console.error("Error loading deliveries:",e),_({title:"Error",description:"Failed to load delivery records",variant:"destructive"})}finally{A(!1)}},X=e=>new Date(e).toLocaleDateString(),Z=e=>e.toFixed(2),ee=e=>{switch(e){case"MOBIL":return"bg-red-100 text-red-800";case"AMOCO ROSEDALE":return"bg-blue-100 text-blue-800";case"AMOCO BROOKLYN":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},se=Math.ceil(K/10);return O&&0===$.length?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading delivery records..."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Delivery Records"})]}),e.jsxs(n,{onClick:()=>d("/delivery/new"),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"New Delivery"]})]}),e.jsx(a,{children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(x,{placeholder:"Search by BOL number...",value:C,onChange:e=>R(e.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs(g,{value:T,onValueChange:I,children:[e.jsx(b,{children:e.jsx(j,{placeholder:"Filter by station"})}),e.jsxs(y,{children:[e.jsx(N,{value:"all",children:"All Stations"}),["MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN"].map(s=>e.jsx(N,{value:s,children:s},s))]})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{variant:"outline",onClick:J,children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Refresh"]})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(a,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:K}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Deliveries"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:$.reduce((e,s)=>{return e+((n=s).regular_delivered+n.plus_delivered+n.super_delivered);var n},0).toFixed(0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Gallons Delivered"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:new Set($.map(e=>e.station)).size}),e.jsx("p",{className:"text-sm text-gray-600",children:"Stations Served"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:$.filter(e=>new Date(e.delivery_date)>=new Date(Date.now()-6048e5)).length}),e.jsx("p",{className:"text-sm text-gray-600",children:"This Week"})]})})]}),e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(i,{children:"Delivery Records"})}),e.jsx(r,{children:0===$.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No delivery records found"}),e.jsxs(n,{onClick:()=>d("/delivery/new"),className:"mt-4",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Add First Delivery"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(v,{children:[e.jsx(m,{children:e.jsxs(u,{children:[e.jsx(p,{children:"Serial"}),e.jsx(p,{children:"Date"}),e.jsx(p,{children:"BOL Number"}),e.jsx(p,{children:"Station Name"}),e.jsx(p,{children:"Regular (Delivered)"}),e.jsx(p,{children:"Plus Delivered"}),e.jsx(p,{children:"Super Delivered"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(h,{children:$.map((s,a)=>e.jsxs(u,{children:[e.jsx(f,{className:"font-medium",children:10*(U-1)+a+1}),e.jsx(f,{className:"font-medium text-gray-900",children:X(s.delivery_date)}),e.jsx(f,{className:"font-medium text-indigo-600",children:s.bol_number||"N/A"}),e.jsx(f,{children:e.jsx(l,{className:ee(s.station),children:s.station})}),e.jsxs(f,{className:"font-medium text-blue-600",children:[Z(s.regular_delivered)," gal"]}),e.jsxs(f,{className:"font-medium text-green-600",children:[Z(s.plus_delivered)," gal"]}),e.jsxs(f,{className:"font-medium text-purple-600",children:[Z(s.super_delivered)," gal"]}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(e=>{q(e),H(!0)})(s),className:"h-8 w-8 p-0 hover:bg-blue-50",title:"View Report",children:e.jsx(M,{className:"h-4 w-4 text-blue-600"})}),D()&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(e=>{if(D())try{const s=$.find(s=>s.id===e);if(!s)return _({title:"Error",description:"Delivery record not found. Please refresh the list and try again.",variant:"destructive"}),void J();d(`/delivery/${e}/edit`),console.log("Navigating to edit delivery:",e,s)}catch(s){console.error("Error navigating to edit form:",s),_({title:"Navigation Error",description:"Failed to open edit form. Please try again.",variant:"destructive"})}else _({title:"Access Denied",description:"Only administrators can edit delivery records.",variant:"destructive"})})(s.id),className:"h-8 w-8 p-0 hover:bg-orange-50",title:"Edit Delivery",children:e.jsx(L,{className:"h-4 w-4 text-orange-600"})}),D()&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(!D())return void _({title:"Access Denied",description:"Only administrators can delete delivery records.",variant:"destructive"});const s=$.find(s=>s.id===e);if(!s)return _({title:"Error",description:"Delivery record not found. Please refresh the list and try again.",variant:"destructive"}),void J();if(confirm(`Are you sure you want to delete delivery record for ${s.station} on ${X(s.delivery_date)}? This action cannot be undone.`))try{const{error:n}=await window.ezsite.apis.tableDelete(12196,{ID:e});if(n)throw n;_({title:"Success",description:`Delivery record for ${s.station} deleted successfully`}),J()}catch(n){console.error("Error deleting delivery:",n),_({title:"Error",description:`Failed to delete delivery record for ${s.station}`,variant:"destructive"})}})(s.id),className:"h-8 w-8 p-0 hover:bg-red-50",title:"Delete Delivery",children:e.jsx(F,{className:"h-4 w-4 text-red-600"})})]})})]},s.id))})]})}),!D()&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-700",children:[e.jsx("strong",{children:"Access Restrictions:"}),"Only administrators can edit or delete delivery records."]})}),se>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",10*(U-1)+1," to ",Math.min(10*U,K)," of ",K," records"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>Y(e=>Math.max(1,e-1)),disabled:1===U,children:"Previous"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>Y(e=>Math.min(se,e+1)),disabled:U===se,children:"Next"})]})]})]})})]}),e.jsx(V,{open:Q,onOpenChange:H,delivery:W})]})};export{I as default};
