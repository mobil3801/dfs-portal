import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{t as i,C as a,f as t,g as r,k as n,e as l,h as c,L as d,I as o}from"./index-CIZJQuMw.js";import{S as u,c as m,d as x,a as h,b as p}from"./select-aqE1UuiG.js";import{E as j}from"./EnhancedFileUpload-DqBJDceM.js";import{u as y,d as _}from"./routing-DcURAnU1.js";import{F as g,K as f,a0 as v,Q as N}from"./utilities-DMEd7dY0.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";import"./imageCompression-DvX-F3tO.js";const w=()=>{const[w,b]=s.useState({license_name:"",license_number:"",issuing_authority:"",issue_date:"",expiry_date:"",station:"",category:"",status:"Active",document_file_id:0}),[S,C]=s.useState(!1),[D,F]=s.useState(!1),[L,E]=s.useState(null),[O,I]=s.useState(!1),A=y(),{id:P}=_();s.useEffect(()=>{P&&(F(!0),T(parseInt(P)))},[P]);const T=async e=>{try{C(!0);const{data:s,error:i}=await window.ezsite.apis.tablePage("11731",{PageNo:1,PageSize:1,Filters:[{name:"ID",op:"Equal",value:e}]});if(i)throw i;if(s&&s.List&&s.List.length>0){const e=s.List[0];b({license_name:e.license_name||"",license_number:e.license_number||"",issuing_authority:e.issuing_authority||"",issue_date:e.issue_date?e.issue_date.split("T")[0]:"",expiry_date:e.expiry_date?e.expiry_date.split("T")[0]:"",station:e.station||"",category:e.category||"",status:e.status||"Active",document_file_id:e.document_file_id||0})}}catch(s){console.error("Error loading license:",s),i({title:"Error",description:"Failed to load license details",variant:"destructive"})}finally{C(!1)}},z=(e,s)=>{b(i=>({...i,[e]:s}))},B=e=>{if(!e)return!1;const s=new Date,i=new Date(e),a=Math.ceil((i.getTime()-s.getTime())/864e5);return a<=30&&a>=0},k=e=>{if(!e)return!1;const s=new Date;return new Date(e)<s};return e.jsx("div",{className:"space-y-6",children:e.jsxs(a,{children:[e.jsx(t,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(r,{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-6 h-6"}),e.jsx("span",{children:D?"Edit License":"Add New License"})]}),e.jsx(n,{children:D?"Update license information":"Add a new license or certificate"})]}),e.jsxs(l,{variant:"outline",onClick:()=>A("/licenses"),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Back to Licenses"]})]})}),e.jsx(c,{children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{C(!0);const e={...w,issue_date:w.issue_date?new Date(w.issue_date).toISOString():"",expiry_date:w.expiry_date?new Date(w.expiry_date).toISOString():"",created_by:1};if(D&&P){const{error:s}=await window.ezsite.apis.tableUpdate("11731",{ID:parseInt(P),...e});if(s)throw s;i({title:"Success",description:"License updated successfully"})}else{const{error:s}=await window.ezsite.apis.tableCreate("11731",e);if(s)throw s;i({title:"Success",description:"License created successfully"})}A("/licenses")}catch(s){console.error("Error saving license:",s),i({title:"Error",description:`Failed to ${D?"update":"create"} license`,variant:"destructive"})}finally{C(!1)}},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"license_name",children:"License Name *"}),e.jsx(o,{id:"license_name",value:w.license_name,onChange:e=>z("license_name",e.target.value),placeholder:"Enter license name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"license_number",children:"License Number *"}),e.jsx(o,{id:"license_number",value:w.license_number,onChange:e=>z("license_number",e.target.value),placeholder:"Enter license number",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"issuing_authority",children:"Issuing Authority *"}),e.jsx(o,{id:"issuing_authority",value:w.issuing_authority,onChange:e=>z("issuing_authority",e.target.value),placeholder:"Enter issuing authority",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"category",children:"Category *"}),e.jsxs(u,{value:w.category,onValueChange:e=>z("category",e),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Select category"})}),e.jsx(h,{children:["Business","Environmental","Safety","Health","Fire","Building","Other"].map(s=>e.jsx(p,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"station",children:"Station *"}),e.jsxs(u,{value:w.station,onValueChange:e=>z("station",e),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Select station"})}),e.jsx(h,{children:["MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN","ALL"].map(s=>e.jsx(p,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(u,{value:w.status,onValueChange:e=>z("status",e),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Select status"})}),e.jsx(h,{children:["Active","Expired","Pending Renewal"].map(s=>e.jsx(p,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"issue_date",children:"Issue Date"}),e.jsx(o,{id:"issue_date",type:"date",value:w.issue_date,onChange:e=>z("issue_date",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"expiry_date",children:"Expiry Date"}),e.jsx(o,{id:"expiry_date",type:"date",value:w.expiry_date,onChange:e=>z("expiry_date",e.target.value),className:k(w.expiry_date)?"border-red-500":B(w.expiry_date)?"border-yellow-500":""}),k(w.expiry_date)&&e.jsx("p",{className:"text-sm text-red-600",children:"⚠️ This license has expired"}),B(w.expiry_date)&&!k(w.expiry_date)&&e.jsx("p",{className:"text-sm text-yellow-600",children:"⚠️ This license expires within 30 days"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{children:"License Document"}),e.jsx(j,{onFileSelect:async e=>{try{I(!0);const{data:s,error:a}=await window.ezsite.apis.upload({filename:e.name,file:e});if(a)throw a;b(e=>({...e,document_file_id:s})),E(e),i({title:"Success",description:"File uploaded successfully"})}catch(s){console.error("Error uploading file:",s),i({title:"Error",description:"Failed to upload file",variant:"destructive"})}finally{I(!1)}},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,image/*",label:"Upload License Document or Take Photo",currentFile:L?.name||(w.document_file_id>0?`Document ID: ${w.document_file_id}`:void 0),maxSize:10,allowCamera:!0,disabled:O}),L&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm text-green-800",children:["Recently uploaded: ",L.name]})]})}),w.document_file_id>0&&!L&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-800",children:["Document uploaded (ID: ",w.document_file_id,")"]})]})}),e.jsx("p",{className:"text-sm text-gray-500",children:"PDF, DOC, DOCX, JPG, PNG files up to 10MB"})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>A("/licenses"),children:"Cancel"}),e.jsx(l,{type:"submit",disabled:S||O,children:S?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),D?"Update License":"Create License"]})})]})]})})]})})};export{w as default};
