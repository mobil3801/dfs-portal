import{j as e}from"./radix-ui-BhRELLXi.js";import{r as s}from"./react-core-CKNU0hQt.js";import{u as a,k as t,t as r,C as n,g as i,h as c,l as o,f as l,B as d,i as m,I as x,T as h,a as v,b as p,c as u,d as j,e as y}from"./index-s81fdLZV.js";import{u as g,V as b}from"./use-keyboard-shortcuts-DcZvEkXs.js";import{u as f}from"./routing-DcURAnU1.js";import{a8 as N,Q as w,V as _,aa as C,r as D,a5 as k,w as A,W as E,O as S}from"./utilities-DVevn_gw.js";import{m as P}from"./animations-Cc9qW4PM.js";import"./data-management-CF8GQrOz.js";import"./dialog-DoXR3LdX.js";const I=()=>{const[I,V]=s.useState([]),[$,F]=s.useState(!0),[z,O]=s.useState(""),[M,L]=s.useState(1),[R,T]=s.useState(0),[B,U]=s.useState(null),[Y,Q]=s.useState(!1),[W,q]=s.useState(null),G=f(),{isAdmin:H}=a(),{canCreate:J,canEdit:K,canDelete:X,isModuleAccessEnabled:Z}=t(),ee=J("vendors"),se=K("vendors")&&H(),ae=X("vendors")&&H();s.useEffect(()=>{te()},[M,z]);const te=async()=>{try{F(!0);const e=[];z&&e.push({name:"vendor_name",op:"StringContains",value:z});const{data:s,error:a}=await window.ezsite.apis.tablePage("11729",{PageNo:M,PageSize:10,OrderByField:"vendor_name",IsAsc:!0,Filters:e});if(a)throw a;V(s?.List||[]),T(s?.VirtualCount||0)}catch(e){console.error("Error loading vendors:",e),r({title:"Error",description:"Failed to load vendors",variant:"destructive"})}finally{F(!1)}},re=e=>{q(e),U(e.ID),Q(!0)},ne=e=>{if(H())if(se)try{const s=I.find(s=>s.ID===e);if(!s)return r({title:"Error",description:"Vendor not found. Please refresh the list and try again.",variant:"destructive"}),void te();G(`/vendors/${e}/edit`),console.log("Navigating to edit vendor:",e,s)}catch(s){console.error("Error navigating to edit form:",s),r({title:"Navigation Error",description:"Failed to open edit form. Please try again.",variant:"destructive"})}else r({title:"Access Denied",description:"You don't have permission to edit vendors.",variant:"destructive"});else r({title:"Access Denied",description:"Only administrators can edit vendors.",variant:"destructive"})},ie=async e=>{if(H())if(ae){if(confirm("Are you sure you want to delete this vendor?"))try{const{error:s}=await window.ezsite.apis.tableDelete("11729",{ID:e});if(s)throw s;r({title:"Success",description:"Vendor deleted successfully"}),te(),Q(!1)}catch(s){console.error("Error deleting vendor:",s),r({title:"Error",description:"Failed to delete vendor",variant:"destructive"})}}else r({title:"Access Denied",description:"You don't have permission to delete vendors.",variant:"destructive"});else r({title:"Access Denied",description:"Only administrators can delete vendors.",variant:"destructive"})},ce=()=>{ee?G("/vendors/new"):r({title:"Access Denied",description:"You don't have permission to create vendors.",variant:"destructive"})};g(B,e=>{const s=I.find(s=>s.ID===e);s&&re(s)},ne,ie,ce);const oe=e=>({"Fuel Supplier":"bg-blue-500","Food & Beverages":"bg-green-500",Automotive:"bg-orange-500",Maintenance:"bg-purple-500","Office Supplies":"bg-gray-500",Technology:"bg-indigo-500"}[e]||"bg-gray-500"),le=Math.ceil(R/10);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"w-6 h-6"}),e.jsx("span",{children:"Vendors"})]}),e.jsx(o,{children:"Manage your vendor contacts and information"})]}),ee?e.jsxs(l,{onClick:ce,className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Vendor"})]}):Z&&e.jsx(d,{variant:"secondary",className:"text-xs",children:"Create access disabled by admin"})]})}),e.jsxs(m,{children:[e.jsx("div",{className:"flex items-center space-x-2 mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(x,{placeholder:"Search vendors...",value:z,onChange:e=>O(e.target.value),className:"pl-10"})]})}),$?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},a))}):0===I.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No vendors found"}),ee&&e.jsx(l,{variant:"outline",className:"mt-4",onClick:ce,children:"Add Your First Vendor"})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(h,{children:[e.jsx(v,{children:e.jsxs(p,{children:[e.jsx(u,{children:"Vendor Name"}),e.jsx(u,{children:"Contact Person"}),e.jsx(u,{children:"Contact Info"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Payment Terms"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(j,{children:I.map((s,a)=>e.jsxs(P.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"border-b hover:bg-gray-50 transition-colors cursor-pointer "+(B===s.ID?"bg-blue-50 border-blue-200":""),onClick:()=>U(s.ID),children:[e.jsx(y,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.vendor_name}),s.address&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500 mt-1",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-xs",children:s.address})]})]})}),e.jsx(y,{children:e.jsx("p",{className:"font-medium",children:s.contact_person})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-1",children:[s.email&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx(k,{className:"w-3 h-3"}),e.jsx("span",{children:s.phone})]})]})}),e.jsx(y,{children:e.jsx(d,{className:`text-white ${oe(s.category)}`,children:s.category})}),e.jsx(y,{children:e.jsx("span",{className:"text-sm",children:s.payment_terms||"N/A"})}),e.jsx(y,{children:e.jsx(d,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),re(s)},className:"text-blue-600 hover:text-blue-700",children:e.jsx(A,{className:"w-4 h-4"})}),H()&&se&&e.jsx(l,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),ne(s.ID)},children:e.jsx(E,{className:"w-4 h-4"})}),H()&&ae&&e.jsx(l,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),ie(s.ID)},className:"text-red-600 hover:text-red-700",children:e.jsx(S,{className:"w-4 h-4"})})]})})]},s.ID))})]})}),(!H()||!se||!ae)&&Z&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-700",children:[e.jsx("strong",{children:"Access Restrictions:"}),!H()&&" Edit and Delete access restricted to administrators only.",H()&&!se&&" Edit access disabled by admin.",H()&&!ae&&" Delete access disabled by admin."]})}),le>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",10*(M-1)+1," to ",Math.min(10*M,R)," of ",R," vendors"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>L(e=>Math.max(e-1,1)),disabled:1===M,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",M," of ",le]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>L(e=>Math.min(e+1,le)),disabled:M===le,children:"Next"})]})]})]})]}),W&&e.jsx(b,{isOpen:Y,onClose:()=>{Q(!1),q(null),U(null)},title:W.vendor_name,subtitle:`Contact: ${W.contact_person} â€¢ ${W.category}`,data:W,fields:(de=W,[{key:"vendor_name",label:"Vendor Name",value:de.vendor_name,type:"text",icon:N},{key:"contact_person",label:"Contact Person",value:de.contact_person,type:"text"},{key:"email",label:"Email",value:de.email,type:"email"},{key:"phone",label:"Phone",value:de.phone,type:"phone"},{key:"address",label:"Address",value:de.address,type:"text",icon:C},{key:"category",label:"Category",value:de.category,type:"badge",badgeColor:oe(de.category)},{key:"payment_terms",label:"Payment Terms",value:de.payment_terms,type:"text"},{key:"is_active",label:"Status",value:de.is_active,type:"boolean"}]),onEdit:()=>{Q(!1),ne(W.ID)},onDelete:()=>ie(W.ID),onExport:()=>{if(!W)return;const e=["Field,Value",`Vendor Name,${W.vendor_name}`,`Contact Person,${W.contact_person}`,`Email,${W.email}`,`Phone,${W.phone}`,`Address,${W.address}`,`Category,${W.category}`,`Payment Terms,${W.payment_terms}`,"Status,"+(W.is_active?"Active":"Inactive")].join("\n"),s=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`vendor_${W.vendor_name.replace(/\s+/g,"_")}_details.csv`,t.click(),window.URL.revokeObjectURL(a),r({title:"Success",description:"Vendor details exported successfully"})},canEdit:H()&&se,canDelete:H()&&ae,canExport:!0})]});var de};export{I as default};
