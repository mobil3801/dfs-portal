import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{C as a,f as t,g as r,k as l,h as i,e as n,B as o,L as d,l as c,D as x,a as m,b as h,c as p,I as u,d as g,A as j,n as v,o as f,u as N}from"./index-DQt9P8ND.js";import{T as y}from"./textarea-DB5ktOuO.js";import{S as b,c as S,d as C,a as w,b as F}from"./select-D06ifptu.js";import{a as _}from"./use-station-service-CZ4ENYJn.js";import{aa as E,z as A,ab as D,ac as I,ad as O,ae as R,I as $,af as L,ag as G,D as q,a4 as T,C as M,s as k,W as P,F as B,V as H,U as z,ah as U,n as V,ai as Y,p as K,a5 as J,T as W,r as Q,f as Z,R as X,K as ee,aj as se,a9 as ae,ak as te,Q as re}from"./utilities-BV0J3KZr.js";import{N as le}from"./number-input-Do8twij3.js";import{a as ie}from"./use-mobile-BQxxJ7Jh.js";import{P as ne}from"./progress-DmzlKm_G.js";import{E as oe}from"./EnhancedFileUpload-CLbCE8AB.js";import{E as de}from"./EnhancedSalesReportPrintDialog-BftKU2Im.js";import{u as ce,d as xe}from"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";import"./stationService-CEciqnCB.js";import"./imageCompression-DvX-F3tO.js";const me=({onStationSelect:s,title:d="Select Station",description:c="Choose the station to create a daily sales report for",includeAll:x=!0})=>{const{stationOptions:m,canSelectAll:h,loading:p,error:u}=_(x),g=m.filter(e=>"ALL"!==e.value||h),j=e=>{if("ALL"===e||"ALL_STATIONS"===e)return"View and manage all stations";switch(e){case"MOBIL":return"Gas station with convenience store";case"AMOCO ROSEDALE":case"AMOCO BROOKLYN":return"Full service gas station";default:return"Gas station location"}},v=e=>{if("ALL"===e||"ALL_STATIONS"===e)return"All Locations";switch(e){case"MOBIL":return"Far Rockaway";case"AMOCO ROSEDALE":return"Rosedale";case"AMOCO BROOKLYN":return"Brooklyn";default:return"Location"}},f=e=>{if("ALL"===e.value||"ALL_STATIONS"===e.value)return"bg-gray-50 border-gray-300 hover:bg-gray-100";switch(e.value){case"MOBIL":return"bg-blue-50 border-blue-200 hover:bg-blue-100";case"AMOCO ROSEDALE":return"bg-green-50 border-green-200 hover:bg-green-100";case"AMOCO BROOKLYN":return"bg-purple-50 border-purple-200 hover:bg-purple-100";default:return"bg-gray-50 border-gray-200 hover:bg-gray-100"}};return p?e.jsxs(a,{children:[e.jsxs(t,{className:"text-center",children:[e.jsxs(r,{className:"flex items-center justify-center space-x-2",children:[e.jsx(E,{className:"w-6 h-6"}),e.jsx("span",{children:d})]}),e.jsx(l,{children:c})]}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading stations..."})]})})]}):u?e.jsxs(a,{children:[e.jsxs(t,{className:"text-center",children:[e.jsxs(r,{className:"flex items-center justify-center space-x-2",children:[e.jsx(E,{className:"w-6 h-6"}),e.jsx("span",{children:d})]}),e.jsx(l,{children:c})]}),e.jsx(i,{children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-red-600 mb-4",children:"Error loading stations"}),e.jsx("div",{className:"text-sm text-gray-500",children:u})]})})]}):e.jsxs(a,{children:[e.jsxs(t,{className:"text-center",children:[e.jsxs(r,{className:"flex items-center justify-center space-x-2",children:[e.jsx(E,{className:"w-6 h-6"}),e.jsx("span",{children:d})]}),e.jsx(l,{children:c})]}),e.jsxs(i,{children:[e.jsx("div",{className:`grid grid-cols-1 ${g.length<=2?"md:grid-cols-2":3===g.length?"md:grid-cols-3":"md:grid-cols-2 lg:grid-cols-4"} gap-4`,children:g.map(a=>{return e.jsxs(n,{variant:"outline",className:`h-auto p-6 flex flex-col items-center space-y-3 ${f(a)} transition-all duration-200`,onClick:()=>s(a.value),children:[(t=a.value,"ALL"===t||"ALL_STATIONS"===t?e.jsx(D,{className:"w-8 h-8"}):e.jsx(I,{className:"w-8 h-8"})),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-semibold text-lg flex items-center justify-center space-x-2",children:[e.jsx("span",{children:a.label}),("ALL"===a.value||"ALL_STATIONS"===a.value)&&e.jsx(o,{variant:"secondary",className:"text-xs",children:"All"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:v(a.value)}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:j(a.value)})]})]},a.value);var t})}),x&&!h&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note:"}),' The "ALL" option is available for Administrators and Management only.']})})]})]})},he=({station:s,values:l,onChange:n})=>{const o=ie(),c="MOBIL"===s,x=l.creditCardAmount+l.debitCardAmount+l.mobileAmount+l.cashAmount+l.grocerySales,m=(l.groceryCashSales||0)+(l.groceryCardSales||0)+(l.ebtSales||0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(a,{className:"bg-blue-50 border-blue-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-blue-800 flex items-center space-x-2",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{children:"Gas & Grocery Sales"})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(o?"gap-4":"md:grid-cols-2 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"creditCard",children:"Credit Card Amount ($) *"}),e.jsx(le,{id:"creditCard",value:l.creditCardAmount,onChange:e=>n("creditCardAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"debitCard",children:"Debit Card Amount ($) *"}),e.jsx(le,{id:"debitCard",value:l.debitCardAmount,onChange:e=>n("debitCardAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"mobile",children:"Mobile Payment Amount ($) *"}),e.jsx(le,{id:"mobile",value:l.mobileAmount,onChange:e=>n("mobileAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"cash",children:"Cash Amount ($) *"}),e.jsx(le,{id:"cash",value:l.cashAmount,onChange:e=>n("cashAmount",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"grocery",children:"Grocery Sales ($) *"}),e.jsx(le,{id:"grocery",value:l.grocerySales,onChange:e=>n("grocerySales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"text-lg font-semibold",children:"Total Sales (Auto-calculated)"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:["$",x.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Credit Card + Debit Card + Mobile Payment + Cash + Grocery = $",x.toFixed(2)]})]})]})]}),e.jsxs(a,{className:"bg-green-50 border-green-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-green-800 flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"Grocery Sales Breakdown"})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(o?"gap-4":"md:grid-cols-3 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"groceryCash",children:"Cash Sales ($) *"}),e.jsx(le,{id:"groceryCash",value:l.groceryCashSales||0,onChange:e=>n("groceryCashSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"groceryCard",children:"Credit/Debit Card ($) *"}),e.jsx(le,{id:"groceryCard",value:l.groceryCardSales||0,onChange:e=>n("groceryCardSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"ebt",children:"EBT ($) *"}),e.jsx(le,{id:"ebt",value:l.ebtSales||0,onChange:e=>n("ebtSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"text-lg font-semibold",children:"Total Grocery Sales (Auto-calculated)"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Cash Sales ($",(l.groceryCashSales||0).toFixed(2),") + Credit/Debit Card ($",(l.groceryCardSales||0).toFixed(2),")",c?` + EBT (${(l.ebtSales||0).toFixed(2)})`:""," = $",m.toFixed(2)]}),m!==l.grocerySales&&e.jsxs("div",{className:"text-xs text-amber-600 mt-1 bg-amber-50 p-2 rounded border border-amber-200",children:[e.jsx($,{className:"w-3 h-3 inline mr-1"}),"Grocery sales total will be updated automatically when you save."]})]})]})]})]})},pe=({values:s,onChange:l})=>{const n=ie(),o=s.lotteryNetSales+s.scratchOffSales;return e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs(a,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-yellow-800 flex items-center space-x-2",children:[e.jsx(L,{className:"w-5 h-5"}),e.jsx("span",{children:"NY Lottery Sales"})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(n?"gap-4":"md:grid-cols-2 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"lotteryNet",children:"Net Sales ($) *"}),e.jsx(le,{id:"lotteryNet",value:s.lotteryNetSales,onChange:e=>l("lotteryNetSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"scratchOff",children:"Scratch Off Sales ($) *"}),e.jsx(le,{id:"scratchOff",value:s.scratchOffSales,onChange:e=>l("scratchOffSales",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-yellow-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"text-lg font-semibold",children:"Total Sales Cash (Auto-calculated)"}),e.jsxs("div",{className:"text-2xl font-bold text-yellow-800",children:["$",o.toFixed(2)]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Net Sales + Scratch Off Sales = $",o.toFixed(2)]})]})]})]})})},ue=({values:s,onChange:l})=>{const n=ie(),o=s.regularGallons+s.superGallons+s.dieselGallons;return e.jsx("div",{className:"space-y-4",children:e.jsxs(a,{className:"bg-red-50 border-red-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-red-800 flex items-center space-x-2",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{children:"Gas Tank Report"})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 "+(n?"gap-4":"md:grid-cols-3 gap-4"),children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"regular",children:"Regular (Gallons) *"}),e.jsx(le,{id:"regular",value:s.regularGallons,onChange:e=>l("regularGallons",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"super",children:"Super (Gallons) *"}),e.jsx(le,{id:"super",value:s.superGallons,onChange:e=>l("superGallons",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"diesel",children:"Diesel (Gallons) *"}),e.jsx(le,{id:"diesel",value:s.dieselGallons,onChange:e=>l("dieselGallons",e||0),allowNegative:!0,step:.01,precision:2,required:!0})]})]}),e.jsxs("div",{className:"pt-4 border-t border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-lg font-semibold",children:"Total Gallon Sold"}),e.jsxs("div",{className:"text-2xl font-bold text-red-800",children:[o.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Regular + Super + Diesel = ",o.toFixed(2)," gallons"]})]})]})]})})},ge=({open:a,onClose:t,onSubmit:r,loading:l=!1})=>{const{toast:i}=c(),[o,g]=s.useState([]),[j,v]=s.useState(!1),[f,N]=s.useState(!1),[y,_]=s.useState(0),[E,A]=s.useState({vendor:"",othersName:"",amount:0,paymentType:"Cash",chequeNumber:"",invoiceFileId:void 0,invoiceFileName:""});s.useEffect(()=>{a&&(D(),A({vendor:"",othersName:"",amount:0,paymentType:"Cash",chequeNumber:"",invoiceFileId:void 0,invoiceFileName:""}),_(0))},[a]);const D=async()=>{try{v(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(11729,{PageNo:1,PageSize:100,OrderByField:"vendor_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(s)throw new Error(s);g(e?.List||[])}catch(e){console.error("Error loading vendors:",e),i({title:"Error",description:"Failed to load vendors",variant:"destructive"})}finally{v(!1)}},I=(e,s)=>{A(a=>({...a,[e]:s}))};return e.jsx(x,{open:a,onOpenChange:t,children:e.jsxs(m,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Add Expense"]})}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),E.vendor||E.othersName.trim()?E.amount<=0?i({title:"Validation Error",description:"Please enter a valid amount",variant:"destructive"}):"Cheque"!==E.paymentType||E.chequeNumber.trim()?E.invoiceFileId?(r(E),t()):i({title:"Validation Error",description:"Invoice upload is mandatory",variant:"destructive"}):i({title:"Validation Error",description:"Cheque number is required for cheque payments",variant:"destructive"}):i({title:"Validation Error",description:"Please select a vendor or enter Other's Name",variant:"destructive"})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"vendor",children:"Vendor Name"}),e.jsxs(b,{value:E.vendor,onValueChange:e=>{I("vendor",e),e&&"none"!==e&&I("othersName","")},disabled:j,children:[e.jsx(S,{children:e.jsx(C,{placeholder:j?"Loading vendors...":"Select vendor"})}),e.jsxs(w,{children:[e.jsx(F,{value:"none",children:"Select a vendor"}),o.map(s=>e.jsxs(F,{value:s.vendor_name,children:[s.vendor_name," (",s.category,")"]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"othersName",children:"Other's Name"}),e.jsx(u,{id:"othersName",value:E.othersName,onChange:e=>{I("othersName",e.target.value),e.target.value&&I("vendor","")},placeholder:"Enter name if not using vendor list",disabled:!(!E.vendor||"none"===E.vendor)}),E.vendor&&"none"!==E.vendor&&e.jsx("p",{className:"text-sm text-gray-500",children:"Clear vendor selection to enter other's name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"amount",children:"Amount *"}),e.jsx(le,{id:"amount",value:E.amount,onChange:e=>I("amount",e),placeholder:"0.00",min:0,step:.01,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"paymentType",children:"Payment Type *"}),e.jsxs(b,{value:E.paymentType,onValueChange:e=>{I("paymentType",e),"Cheque"!==e&&I("chequeNumber","")},children:[e.jsx(S,{children:e.jsx(C,{})}),e.jsxs(w,{children:[e.jsx(F,{value:"Cash",children:"Cash"}),e.jsx(F,{value:"Credit Card",children:"Credit Card"}),e.jsx(F,{value:"Cheque",children:"Cheque"})]})]})]}),"Cheque"===E.paymentType&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"chequeNumber",children:"Cheque Number *"}),e.jsx(u,{id:"chequeNumber",value:E.chequeNumber,onChange:e=>I("chequeNumber",e.target.value),placeholder:"Enter cheque number",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"invoice",children:"Invoice Upload *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",id:"invoice",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;if(["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type))if(s.size>10485760)i({title:"File Too Large",description:"Please upload a file smaller than 10MB",variant:"destructive"});else try{N(!0),_(0);const e=setInterval(()=>{_(s=>s>=90?(clearInterval(e),90):s+10)},100),{data:a,error:t}=await window.ezsite.apis.upload({filename:s.name,file:s});if(clearInterval(e),t)throw new Error(t);_(100),A(e=>({...e,invoiceFileId:a,invoiceFileName:s.name})),i({title:"Success",description:"Invoice uploaded successfully"})}catch(a){console.error("Error uploading file:",a),i({title:"Upload Failed",description:"Failed to upload invoice file",variant:"destructive"})}finally{N(!1)}else i({title:"Invalid File Type",description:"Please upload a PDF, image, or document file",variant:"destructive"})},className:"hidden",disabled:f}),e.jsxs(n,{type:"button",variant:"outline",onClick:()=>document.getElementById("invoice")?.click(),disabled:f,className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),f?"Uploading...":"Choose File"]}),E.invoiceFileName&&e.jsx("span",{className:"text-sm text-gray-600 truncate",children:E.invoiceFileName})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{value:y,className:"h-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Uploading... ",y,"%"]})]}),E.invoiceFileId&&!f&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Invoice uploaded successfully"})]}),!E.invoiceFileId&&!f&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Invoice upload is required"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 pt-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>{A({vendor:"",othersName:"",amount:0,paymentType:"Cash",chequeNumber:"",invoiceFileId:void 0,invoiceFileName:""}),_(0),t()},disabled:l||f,children:"Cancel"}),e.jsxs(n,{type:"submit",disabled:l||f||!E.invoiceFileId,className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),l?"Adding...":"Add Expense"]})]})]})]})})},je=({station:t="MOBIL",reportDate:r,onExpensesChange:l})=>{const{toast:i}=c(),x=ie(),[m,h]=s.useState([]),[p,u]=s.useState(!1),[g,j]=s.useState(!1);s.useEffect(()=>{r&&v()},[t,r]),s.useEffect(()=>{const e=f();l?.(e.totalExpenses,e.cashExpense)},[m,l]);const v=async()=>{try{u(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(18494,{PageNo:1,PageSize:100,OrderByField:"expense_date",IsAsc:!1,Filters:[{name:"station",op:"Equal",value:t},{name:"expense_date",op:"StringStartsWith",value:r?.split("T")[0]||(new Date).toISOString().split("T")[0]}]});if(s)throw s;h(e?.List||[])}catch(e){console.error("Error loading expenses:",e),i({title:"Error",description:"Failed to load expenses",variant:"destructive"})}finally{u(!1)}},f=()=>{const e=m.filter(e=>"Cash"===e.payment_type).reduce((e,s)=>e+(s.amount||0),0),s=m.filter(e=>"Credit"===e.payment_type).reduce((e,s)=>e+(s.amount||0),0),a=m.filter(e=>"Cheque"===e.payment_type).reduce((e,s)=>e+(s.amount||0),0);return{cashExpense:e,cardExpense:s,chequeExpense:a,totalExpenses:e+s+a}},{cashExpense:N,cardExpense:y,chequeExpense:b,totalExpenses:S}=f(),C=e=>{switch(e){case"Cash":return"ðŸ’µ";case"Credit":return"ðŸ’³";case"Cheque":return"ðŸ§¾";default:return"ðŸ’°"}};return e.jsxs(e.Fragment,{children:[e.jsxs(a,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Expenses"]}),e.jsxs(n,{onClick:()=>j(!0),size:"sm",className:"gap-2 hover:bg-blue-600 transition-colors",disabled:p,type:"button",children:[e.jsx(P,{className:"h-4 w-4"}),"Add Expense"]})]}),e.jsx("div",{className:"space-y-4",children:p?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(q,{className:"h-8 w-8 mx-auto mb-2 opacity-50 animate-spin"}),e.jsx("p",{children:"Loading expenses..."})]}):0===m.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(q,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No expenses added yet"}),e.jsx("p",{className:"text-sm",children:'Click "Add Expense" to get started'})]}):m.map(s=>{return e.jsxs(a,{className:"p-4 space-y-3 border-l-4 border-l-blue-500",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{variant:"outline",className:"gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Expense #",s.id]}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{u(!0);const{error:s}=await window.ezsite.apis.tableDelete(18494,{ID:e});if(s)throw s;i({title:"Success",description:"Expense deleted successfully"}),v()}catch(s){console.error("Error deleting expense:",s),i({title:"Error",description:"Failed to delete expense",variant:"destructive"})}finally{u(!1)}})(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 transition-colors",disabled:p,type:"button",children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid gap-3 "+(x?"grid-cols-1":"grid-cols-2 lg:grid-cols-3"),children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(d,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),s.vendor_name?"Vendor":"Other's Name"]}),e.jsx("div",{className:"text-sm font-medium",children:s.vendor_name||s.others_name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(d,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),"Amount"]}),e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["$",s.amount.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(d,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),"Payment Type"]}),e.jsxs(o,{variant:"Cash"===s.payment_type?"default":"secondary",className:"gap-1",children:[C(s.payment_type),s.payment_type,"Cheque"===s.payment_type&&s.cheque_number&&e.jsxs("span",{className:"ml-1",children:["#",s.cheque_number]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs(d,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"}),"Date"]}),e.jsx("div",{className:"text-sm",children:(t=s.expense_date,new Date(t).toLocaleDateString())})]}),s.invoice_file_id&&e.jsxs("div",{className:"space-y-1 col-span-full",children:[e.jsxs(d,{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Invoice Attached"]}),e.jsxs(o,{variant:"secondary",className:"gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"File ID: ",s.invoice_file_id]})]})]})]},s.id);var t})}),m.length>0&&e.jsxs(a,{className:"p-4 bg-gray-50 border-2 border-gray-200",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Expense Summary"]}),e.jsxs("div",{className:"grid gap-3 "+(x?"grid-cols-1":"grid-cols-2 lg:grid-cols-4"),children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx(d,{className:"text-sm text-gray-600",children:"Cash Expense"}),e.jsxs("div",{className:"text-xl font-bold text-red-600",children:["$",N.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Used in Short/Over calculation"})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx(d,{className:"text-sm text-gray-600",children:"Card Expense"}),e.jsxs("div",{className:"text-xl font-bold text-red-600",children:["$",y.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx(d,{className:"text-sm text-gray-600",children:"Cheque Expense"}),e.jsxs("div",{className:"text-xl font-bold text-red-600",children:["$",b.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-red-300",children:[e.jsx(d,{className:"text-sm text-gray-600",children:"Total Expenses"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["$",S.toFixed(2)]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Short/Over Calculation:"}),e.jsx("p",{className:"text-xs",children:"Cash Collection on Hand - (Gas Cash + Grocery Cash + Lottery Cash - Cash Expenses)"})]})})]})]}),e.jsx(ge,{open:g,onClose:()=>j(!1),onSubmit:async e=>{try{u(!0);const s={vendor_name:e.vendor||"",others_name:e.othersName,amount:e.amount,payment_type:e.paymentType,cheque_number:e.chequeNumber||"",invoice_file_id:e.invoiceFileId||0,station:t,expense_date:r||(new Date).toISOString(),created_by:1},{error:a}=await window.ezsite.apis.tableCreate(18494,s);if(a)throw a;i({title:"Success",description:"Expense added successfully"}),v()}catch(s){console.error("Error adding expense:",s),i({title:"Error",description:"Failed to add expense",variant:"destructive"})}finally{u(!1)}}})]})},ve=({documents:s,onChange:l})=>{const{toast:n}=c(),d=[{name:"Day Report",field:"dayReportFileId",fileId:s.dayReportFileId,required:!0},{name:"Veeder Root Report",field:"veederRootFileId",fileId:s.veederRootFileId,required:!0},{name:"Lotto Report",field:"lottoReportFileId",fileId:s.lottoReportFileId,required:!0},{name:"Scratch Off Report",field:"scratchOffReportFileId",fileId:s.scratchOffReportFileId,required:!0}],x=d.filter(e=>e.fileId).length,m=d.length;return e.jsxs(a,{className:"bg-purple-50 border-purple-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-purple-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{children:"Documents Upload"})]}),e.jsxs(o,{variant:"outline",className:x===m?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800",children:[x,"/",m," Submitted"]})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Mandatory Submission Required"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"All documents must be uploaded before submitting the sales report."})]}),e.jsx("div",{className:"space-y-4",children:d.map(s=>{const a=(s=>s.fileId?{icon:e.jsx(M,{className:"w-4 h-4"}),text:"Submitted",color:"bg-green-100 text-green-800 border-green-200"}:{icon:e.jsx(k,{className:"w-4 h-4"}),text:"Not Submitted",color:"bg-red-100 text-red-800 border-red-200"})(s);return e.jsxs("div",{className:"border border-purple-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:s.name}),s.required&&e.jsx(o,{variant:"destructive",className:"text-xs",children:"Required"})]}),e.jsx(o,{className:a.color,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[a.icon,e.jsx("span",{children:a.text})]})})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(oe,{onFileSelect:e=>(async(e,s)=>{try{const{data:a,error:t}=await window.ezsite.apis.upload({filename:s.name,file:s});if(t)throw t;l(e,a),n({title:"Success",description:`${e.replace("FileId","").replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())} uploaded successfully`})}catch(a){console.error("Error uploading document:",a),n({title:"Error",description:"Failed to upload document",variant:"destructive"})}})(s.field,e),accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,image/*",label:s.fileId?"Re-upload Document":"Upload Document",maxSize:15,className:"w-full"})}),s.fileId&&e.jsxs("div",{className:"mt-2 text-xs text-green-600 flex items-center space-x-1",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsxs("span",{children:["File uploaded successfully (ID: ",s.fileId,")"]})]})]},s.field)})}),e.jsx("div",{className:"pt-4 border-t border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Submission Progress:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:x/m*100+"%"}})}),e.jsxs("span",{className:"font-medium text-purple-800",children:[Math.round(x/m*100),"%"]})]})]})})]})]})},fe=({values:s,onChange:l})=>{const n=s.totalShortOver??s.cashCollectionOnHand-(s.totalCashFromSales-s.totalCashFromExpenses),c=n<0,x=n>0,m=s.totalCashFromSales-s.totalCashFromExpenses;return e.jsxs(a,{className:"bg-gray-50 border-gray-200",children:[e.jsx(t,{children:e.jsxs(r,{className:"text-gray-800 flex items-center space-x-2",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{children:"Cash Collection"})]})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"cashOnHand",children:"Cash Collection on Hand ($) *"}),e.jsx(le,{id:"cashOnHand",value:s.cashCollectionOnHand,onChange:e=>l("cashCollectionOnHand",e||0),allowNegative:!0,step:.01,precision:2,required:!0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Physical cash counted at end of shift (can be negative if short)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Expected Cash ($)"}),e.jsx("div",{className:"h-10 px-3 py-2 border border-gray-200 rounded-md bg-gray-100 flex items-center",children:e.jsxs("span",{className:"text-gray-700 font-medium",children:["$",m.toFixed(2)]})}),e.jsx("div",{className:"text-xs text-gray-600",children:"Cash sales - Cash expenses"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Total (+/-) Short/Over"}),e.jsxs("div",{className:"h-10 px-3 py-2 border rounded-md flex items-center justify-between bg-white",children:[e.jsxs("span",{className:"font-bold text-lg "+(c?"text-red-600":x?"text-green-600":"text-gray-700"),children:[c?"-":x?"+":"","$",Math.abs(n).toFixed(2)]}),c&&e.jsx(Y,{className:"w-5 h-5 text-red-600"}),x&&e.jsx(K,{className:"w-5 h-5 text-green-600"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[c&&e.jsx(o,{variant:"destructive",className:"text-xs",children:"Short"}),x&&e.jsx(o,{className:"bg-green-100 text-green-800 text-xs",children:"Over"}),!c&&!x&&e.jsx(o,{variant:"outline",className:"text-xs",children:"Exact"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(J,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-blue-800",children:"Short/Over Calculation Breakdown"})]}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Cash from Sales:"}),e.jsxs("span",{className:"font-medium",children:["+$",s.totalCashFromSales.toFixed(2)]})]}),e.jsxs("div",{className:"text-xs text-blue-600 ml-4 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"â€¢ Gas & Grocery Cash:"}),e.jsx("span",{children:"Included above"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"â€¢ Grocery Breakdown Cash:"}),e.jsx("span",{children:"Included above"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"â€¢ NY Lottery Total Cash:"}),e.jsx("span",{children:"Included above"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cash Expenses:"}),e.jsxs("span",{className:"font-medium",children:["-$",s.totalCashFromExpenses.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t border-blue-200 pt-2 font-semibold",children:[e.jsx("span",{children:"Expected Cash:"}),e.jsxs("span",{children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Actual Cash on Hand:"}),e.jsxs("span",{className:"font-medium",children:["$",s.cashCollectionOnHand.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between border-t border-blue-200 pt-2 font-bold "+(c?"text-red-600":x?"text-green-600":"text-blue-800"),children:[e.jsx("span",{children:"Difference (Short/Over):"}),e.jsxs("span",{children:[c?"-":x?"+":"","$",Math.abs(n).toFixed(2)]})]})]})]})]})]})},Ne="sales_report_draft_";class ye{static getDraftKey(e,s){const a=e.replace(/\s+/g,"_").toLowerCase(),t=s.replace(/[^0-9-]/g,"");return`${Ne}${a}_${t}`}static saveDraft(e,s,a){try{const t=this.getDraftKey(e,s),r=Date.now(),l={data:a,timestamp:r,expiresAt:r+432e5};return localStorage.setItem(t,JSON.stringify(l)),console.log(`Draft saved successfully for ${e} on ${s}`),!0}catch(t){return console.error("Error saving draft:",t),!1}}static loadDraft(e,s){try{const a=this.getDraftKey(e,s),t=localStorage.getItem(a);if(!t)return null;const r=JSON.parse(t);return Date.now()>r.expiresAt?(console.log(`Draft expired for ${e} on ${s}, removing...`),this.deleteDraft(e,s),null):(console.log(`Draft loaded for ${e} on ${s}`),r.data)}catch(a){return console.error("Error loading draft:",a),null}}static deleteDraft(e,s){try{const a=this.getDraftKey(e,s);localStorage.removeItem(a),console.log(`Draft deleted for ${e} on ${s}`)}catch(a){console.error("Error deleting draft:",a)}}static hasDraft(e,s){try{const a=this.getDraftKey(e,s),t=localStorage.getItem(a);if(!t)return!1;const r=JSON.parse(t);return Date.now()<=r.expiresAt}catch(a){return console.error("Error checking draft:",a),!1}}static getDraftInfo(e,s){try{const a=this.getDraftKey(e,s),t=localStorage.getItem(a);if(!t)return null;const r=JSON.parse(t),l=Date.now();if(l>r.expiresAt)return null;const i=(r.expiresAt-l)/36e5;return{savedAt:new Date(r.timestamp),expiresAt:new Date(r.expiresAt),timeRemainingHours:i}}catch(a){return console.error("Error getting draft info:",a),null}}static cleanupExpiredDrafts(){let e=0;try{const a=Object.keys(localStorage).filter(e=>e.startsWith(Ne)),t=Date.now();for(const r of a)try{const s=localStorage.getItem(r);if(s){t>JSON.parse(s).expiresAt&&(localStorage.removeItem(r),e++)}}catch(s){localStorage.removeItem(r),e++}e>0&&console.log(`Cleaned up ${e} expired drafts`)}catch(s){console.error("Error during draft cleanup:",s)}return e}static getAllDrafts(){try{const s=Object.keys(localStorage).filter(e=>e.startsWith(Ne)),a=Date.now(),t=[];for(const r of s)try{const e=localStorage.getItem(r);if(e){const s=JSON.parse(e);if(a>s.expiresAt)continue;const l=r.replace(Ne,"").split("_"),i=l.pop()||"",n=l.join(" ").toUpperCase(),o=(s.expiresAt-a)/36e5;t.push({station:n,reportDate:i,savedAt:new Date(s.timestamp),expiresAt:new Date(s.expiresAt),timeRemainingHours:o})}}catch(e){console.error("Error parsing draft:",e)}return t.sort((e,s)=>s.savedAt.getTime()-e.savedAt.getTime())}catch(e){return console.error("Error getting all drafts:",e),[]}}}const be=({open:t,onClose:r,onLoadDraft:l,currentStation:d,currentReportDate:u})=>{const{toast:N}=c(),[y,b]=s.useState([]),[S,C]=s.useState(!1);s.useEffect(()=>{t&&(w(),ye.cleanupExpiredDrafts())},[t]);const w=()=>{C(!0);try{const e=ye.getAllDrafts();b(e)}catch(e){console.error("Error loading drafts:",e),N({title:"Error",description:"Failed to load drafts",variant:"destructive"})}finally{C(!1)}},F=e=>{if(e<1){const s=Math.floor(60*e);return`${s} minute${1!==s?"s":""}`}return`${Math.floor(e)} hour${1!==Math.floor(e)?"s":""}`},_=e=>e.station===d&&e.reportDate===u;return e.jsx(x,{open:t,onOpenChange:r,children:e.jsxs(m,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(h,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Draft Management"]}),e.jsx(g,{children:"Manage your saved drafts. Drafts are automatically deleted after 12 hours."})]}),e.jsx("div",{className:"space-y-4",children:S?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading drafts..."})]}):0===y.length?e.jsxs(j,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(v,{children:'No drafts found. Drafts are automatically saved when you use the "Save as Draft" button.'})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Found ",y.length," draft",1!==y.length?"s":""]}),y.map((s,t)=>e.jsx(a,{className:"relative",children:e.jsxs(i,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",className:"gap-1",children:[e.jsx(I,{className:"w-3 h-3"}),s.station]}),e.jsxs(o,{variant:"outline",className:"gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),new Date(s.reportDate).toLocaleDateString()]}),_(s)&&e.jsxs(o,{className:"gap-1 bg-green-100 text-green-800",children:[e.jsx(Q,{className:"w-3 h-3"}),"Current Form"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),"Saved: ",s.savedAt.toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"}),"Expires in: ",F(s.timeRemainingHours)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>(e=>{try{const s=ye.loadDraft(e.station,e.reportDate);s?(l?.(s,e.station,e.reportDate),N({title:"Draft Loaded",description:`Draft from ${e.station} loaded successfully`}),r()):N({title:"Error",description:"Draft data could not be loaded",variant:"destructive"})}catch(s){console.error("Error loading draft:",s),N({title:"Error",description:"Failed to load draft",variant:"destructive"})}})(s),className:"gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),"Load"]}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(e=>{try{ye.deleteDraft(e.station,e.reportDate),b(s=>s.filter(s=>s.station!==e.station||s.reportDate!==e.reportDate)),N({title:"Draft Deleted",description:`Draft from ${e.station} deleted successfully`})}catch(s){console.error("Error deleting draft:",s),N({title:"Error",description:"Failed to delete draft",variant:"destructive"})}})(s),className:"gap-1 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(H,{className:"w-3 h-3"})})]})]}),s.timeRemainingHours<2&&e.jsxs(j,{className:"mt-3 border-amber-200 bg-amber-50",children:[e.jsx(W,{className:"h-4 w-4 text-amber-600"}),e.jsx(v,{className:"text-amber-800",children:"This draft will expire soon. Load it now to preserve your data."})]})]})},`${s.station}-${s.reportDate}`))]})}),e.jsx(f,{children:e.jsx(n,{variant:"outline",onClick:r,children:"Close"})})]})})};function Se(){const x=ce(),{id:m}=xe(),{toast:h}=c(),{user:p}=N(),g=!!m,[f,_]=s.useState(""),[E,A]=s.useState([]),[D,I]=s.useState(!1),[O,R]=s.useState(0),[$,L]=s.useState(0),[G,q]=s.useState(!1),[T,M]=s.useState(!1),[k,P]=s.useState(null),[B,H]=s.useState(!1),[z,U]=s.useState(!1),[V,Y]=s.useState(null),[K,W]=s.useState({report_date:(new Date).toISOString().split("T")[0],station:"",shift:"DAY",employee_name:"",employee_id:"",cashCollectionOnHand:0,creditCardAmount:0,debitCardAmount:0,mobileAmount:0,cashAmount:0,grocerySales:0,ebtSales:0,groceryCashSales:0,groceryCardSales:0,lotteryNetSales:0,scratchOffSales:0,regularGallons:0,superGallons:0,dieselGallons:0,dayReportFileId:void 0,veederRootFileId:void 0,lottoReportFileId:void 0,scratchOffReportFileId:void 0,notes:""});s.useEffect(()=>{f&&(W(e=>({...e,station:f})),Ce(f),g||Ne())},[f,g]),s.useEffect(()=>{g&&m&&Se()},[g,m]),s.useEffect(()=>{f&&K.report_date&&!g&&Ne()},[f,K.report_date,g]);const Q=s.useMemo(()=>K.creditCardAmount+K.debitCardAmount+K.mobileAmount+K.cashAmount+K.grocerySales,[K.creditCardAmount,K.debitCardAmount,K.mobileAmount,K.cashAmount,K.grocerySales]),le=s.useMemo(()=>K.regularGallons+K.superGallons+K.dieselGallons,[K.regularGallons,K.superGallons,K.dieselGallons]),ie=s.useMemo(()=>K.lotteryNetSales+K.scratchOffSales,[K.lotteryNetSales,K.scratchOffSales]),ne=s.useMemo(()=>K.groceryCashSales+K.groceryCardSales+K.ebtSales,[K.groceryCashSales,K.groceryCardSales,K.ebtSales]),oe=s.useMemo(()=>K.cashAmount+K.groceryCashSales+ie,[K.cashAmount,K.groceryCashSales,ie]),ge=s.useMemo(()=>K.cashCollectionOnHand-(oe-$),[K.cashCollectionOnHand,oe,$]),Ne=()=>{if(f&&K.report_date&&!g){const e=ye.getDraftInfo(f,K.report_date);P(e)}},Se=async()=>{if(m){U(!0);try{const{data:s,error:a}=await window.ezsite.apis.tablePage(12356,{PageNo:1,PageSize:1,Filters:[{name:"id",op:"Equal",value:parseInt(m)}]});if(a)throw new Error(a);if(s?.List&&s.List.length>0){const a=s.List[0];Y(a),_(a.station);const t=e=>{if(null==e||""===e)return 0;const s=parseFloat(e);return isNaN(s)?0:s},r=e=>e?new Date(e).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0];let l={total_expenses:0,cash_expenses:0},i={groceryCashSales:0,groceryCardSales:0};if(a.expenses_data)try{l=JSON.parse(a.expenses_data),l.grocery_breakdown&&(i=l.grocery_breakdown)}catch(e){console.warn("Failed to parse expenses data:",e)}W({report_date:r(a.report_date),station:a.station||"",shift:a.shift||"DAY",employee_name:a.employee_name||"",employee_id:a.employee_id||"",cashCollectionOnHand:t(a.cash_collection_on_hand),creditCardAmount:t(a.credit_card_amount),debitCardAmount:t(a.debit_card_amount),mobileAmount:t(a.mobile_amount),cashAmount:t(a.cash_amount),grocerySales:t(a.grocery_sales),ebtSales:t(a.ebt_sales),groceryCashSales:t(i.groceryCashSales),groceryCardSales:t(i.groceryCardSales),lotteryNetSales:t(a.lottery_net_sales),scratchOffSales:t(a.scratch_off_sales),regularGallons:t(a.regular_gallons),superGallons:t(a.super_gallons),dieselGallons:t(a.diesel_gallons),dayReportFileId:a.day_report_file_id||void 0,veederRootFileId:a.veeder_root_file_id||void 0,lottoReportFileId:a.lotto_report_file_id||void 0,scratchOffReportFileId:a.scratch_off_report_file_id||void 0,notes:a.notes||""}),R(t(l.total_expenses)),L(t(l.cash_expenses)),h({title:"Report Loaded",description:"Existing report data has been loaded successfully."})}else h({title:"Report Not Found",description:"The requested report could not be found.",variant:"destructive"}),x("/sales-reports")}catch(s){console.error("Error loading report:",s),h({title:"Error Loading Report",description:s instanceof Error?s.message:"Failed to load existing report",variant:"destructive"})}finally{U(!1)}}},Ce=async e=>{I(!0);try{const{data:s,error:a}=await window.ezsite.apis.tablePage(11727,{PageNo:1,PageSize:100,OrderByField:"first_name",IsAsc:!0,Filters:[{name:"station",op:"Equal",value:e},{name:"is_active",op:"Equal",value:!0}]});if(a)throw new Error(a);A(s?.List||[])}catch(s){console.error("Error loading employees:",s),h({title:"Error",description:"Failed to load employees",variant:"destructive"})}finally{I(!1)}},we=(e,s)=>{let a=s;"string"!=typeof s||isNaN(parseFloat(s))?"number"==typeof s&&(a=s):a=parseFloat(s),W(s=>{const t={...s,[e]:a};if("groceryCashSales"===e||"groceryCardSales"===e||"ebtSales"===e){const r="groceryCashSales"===e?a:s.groceryCashSales||0,l="groceryCardSales"===e?a:s.groceryCardSales||0,i="ebtSales"===e?a:s.ebtSales||0;t.grocerySales=r+l+i}return t})},Fe=E.filter(e=>e.employee_id&&""!==e.employee_id.trim());return z?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading report data..."})]})})})}):f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(n,{variant:"outline",onClick:()=>x("/sales-reports"),className:"mb-4",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Back to Reports"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[g?"Edit":"Create"," Daily Sales Report"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Station: ",e.jsx("span",{className:"font-semibold",children:f})]})]})]}),k&&!g&&e.jsxs(j,{className:"mb-6 border-amber-200 bg-amber-50",children:[e.jsx(Z,{className:"h-4 w-4 text-amber-600"}),e.jsx(v,{className:"text-amber-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["You have a saved draft from ",k.savedAt.toLocaleString(),". Expires in ",Math.floor(k.timeRemainingHours)," hours."]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>q(!0),className:"ml-4 text-amber-800 border-amber-300 hover:bg-amber-100",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Manage Drafts"]})]})})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),H(!0);try{if(!K.station||!K.report_date||!K.employee_name)return void h({title:"Missing Required Fields",description:"Please fill in all required fields: Station, Report Date, and Employee Name.",variant:"destructive"});if(!g){if(["dayReportFileId","veederRootFileId","lottoReportFileId","scratchOffReportFileId"].filter(e=>!K[e]).length>0)return void h({title:"Missing Documents",description:"Please upload all required documents before submitting.",variant:"destructive"})}const e=e=>{const s=parseFloat(String(e))||0;return Math.round(100*s)/100},s={report_date:K.report_date,station:K.station,shift:K.shift,employee_name:K.employee_name,employee_id:K.employee_id,cash_collection_on_hand:e(K.cashCollectionOnHand),total_short_over:e(ge),credit_card_amount:e(K.creditCardAmount),debit_card_amount:e(K.debitCardAmount),mobile_amount:e(K.mobileAmount),cash_amount:e(K.cashAmount),grocery_sales:e(K.grocerySales),ebt_sales:e(K.ebtSales),lottery_net_sales:e(K.lotteryNetSales),scratch_off_sales:e(K.scratchOffSales),lottery_total_cash:e(ie),regular_gallons:e(K.regularGallons),super_gallons:e(K.superGallons),diesel_gallons:e(K.dieselGallons),total_gallons:e(le),expenses_data:JSON.stringify({total_expenses:e(O),cash_expenses:e($),grocery_breakdown:{groceryCashSales:e(K.groceryCashSales),groceryCardSales:e(K.groceryCardSales)}}),day_report_file_id:K.dayReportFileId||null,veeder_root_file_id:K.veederRootFileId||null,lotto_report_file_id:K.lottoReportFileId||null,scratch_off_report_file_id:K.scratchOffReportFileId||null,total_sales:e(Q),notes:K.notes||"",created_by:p?.ID||0};let a;if(a=g?await window.ezsite.apis.tableUpdate(12356,{...s,id:parseInt(m)}):await window.ezsite.apis.tableCreate(12356,s),a.error)throw new Error(a.error);h({title:g?"Report Updated":"Report Created",description:`Sales report has been ${g?"updated":"created"} successfully.`}),f&&K.report_date&&!g&&ye.deleteDraft(f,K.report_date),Y({...s,id:parseInt(m)||a.data?.id||0,created_by:p?.ID||0}),g?Se():(W({report_date:(new Date).toISOString().split("T")[0],station:f,shift:"DAY",employee_name:"",employee_id:"",cashCollectionOnHand:0,creditCardAmount:0,debitCardAmount:0,mobileAmount:0,cashAmount:0,grocerySales:0,ebtSales:0,groceryCashSales:0,groceryCardSales:0,lotteryNetSales:0,scratchOffSales:0,regularGallons:0,superGallons:0,dieselGallons:0,dayReportFileId:void 0,veederRootFileId:void 0,lottoReportFileId:void 0,scratchOffReportFileId:void 0,notes:""}),R(0),L(0),P(null),h({title:"Form Reset",description:"Form has been reset for new entry"}))}catch(s){console.error("Error saving report:",s),h({title:"Error",description:s instanceof Error?s.message:"Failed to save report",variant:"destructive"})}finally{H(!1)}},className:"space-y-6",children:[e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(r,{className:"text-lg",children:"Basic Information"})}),e.jsx(i,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"report_date",children:"Report Date *"}),e.jsx(u,{type:"date",id:"report_date",value:K.report_date,onChange:e=>we("report_date",e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Station"}),e.jsx("div",{className:"h-9 px-3 py-2 border border-gray-200 rounded-md bg-gray-100 flex items-center",children:e.jsx("span",{className:"text-gray-700 font-medium",children:f})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"shift",children:"Shift *"}),e.jsxs(b,{value:K.shift,onValueChange:e=>we("shift",e),children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Select shift"})}),e.jsxs(w,{children:[e.jsx(F,{value:"DAY",children:"DAY"}),e.jsx(F,{value:"NIGHT",children:"NIGHT"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"employee",children:"Employee Name *"}),e.jsxs(b,{value:K.employee_id,onValueChange:e=>{const s=Fe.find(s=>s.employee_id===e);s&&(we("employee_id",e),we("employee_name",`${s.first_name} ${s.last_name}`))},disabled:D,children:[e.jsx(S,{children:e.jsx(C,{placeholder:D?"Loading employees...":"Select employee"})}),e.jsxs(w,{children:[0===Fe.length&&!D&&e.jsxs("div",{className:"p-2 text-center text-gray-500",children:["No active employees found for ",f]}),Fe.map(s=>e.jsxs(F,{value:s.employee_id,children:[s.first_name," ",s.last_name," (ID: ",s.employee_id,")"]},s.id))]})]})]})]})})]}),e.jsx(fe,{values:{cashCollectionOnHand:K.cashCollectionOnHand,totalCashFromSales:oe,totalCashFromExpenses:$,totalShortOver:ge},onChange:we}),e.jsxs(a,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:[e.jsxs(t,{children:[e.jsxs(r,{className:"text-green-800 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Total (+/-) Short/Over Calculation"]}),e.jsx(l,{className:"text-green-700",children:"User Requirements: Gas Cash + Grocery Cash + Lottery Cash - Cash Expenses"})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Gas & Grocery Cash"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",K.cashAmount.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"From Gas & Grocery Section"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Grocery Breakdown Cash"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",K.groceryCashSales.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"From Grocery Breakdown"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"NY Lottery Total Cash"}),e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",ie.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Net Sales + Scratch Off"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-sm text-red-600 mb-1",children:"Cash Expenses"}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["-$",$.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Subtracted from total"})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg border-2 border-green-300",children:[e.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Expected Cash from Sales"}),e.jsxs("div",{className:"text-3xl font-bold text-green-800",children:["$",oe.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Formula: $",K.cashAmount.toFixed(2)," + $",K.groceryCashSales.toFixed(2)," + $",ie.toFixed(2)]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-300",children:[e.jsx("div",{className:"text-sm text-blue-600 mb-1",children:"Final Short/Over Calculation"}),e.jsxs("div",{className:"text-3xl font-bold "+(ge>=0?"text-green-800":"text-red-800"),children:[ge>=0?"+":"","$",ge.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:["Cash Collection ($",K.cashCollectionOnHand.toFixed(2),") - (Expected Cash - Cash Expenses) = ",ge>=0?"Over":"Short"]})]})]})]}),e.jsx(he,{station:f,values:{creditCardAmount:K.creditCardAmount,debitCardAmount:K.debitCardAmount,mobileAmount:K.mobileAmount,cashAmount:K.cashAmount,grocerySales:K.grocerySales,ebtSales:K.ebtSales,groceryCashSales:K.groceryCashSales,groceryCardSales:K.groceryCardSales},onChange:we}),e.jsx(pe,{values:{lotteryNetSales:K.lotteryNetSales,scratchOffSales:K.scratchOffSales},onChange:we}),e.jsx(ue,{values:{regularGallons:K.regularGallons,superGallons:K.superGallons,dieselGallons:K.dieselGallons},onChange:we}),e.jsx(je,{station:f,reportDate:K.report_date,onExpensesChange:(e,s=0)=>{R(e),L(s)}}),e.jsx(ve,{documents:{dayReportFileId:K.dayReportFileId,veederRootFileId:K.veederRootFileId,lottoReportFileId:K.lottoReportFileId,scratchOffReportFileId:K.scratchOffReportFileId},onChange:(e,s)=>{W(a=>({...a,[e]:s}))}}),e.jsxs(a,{children:[e.jsx(t,{children:e.jsx(r,{className:"text-lg",children:"Additional Notes"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(y,{id:"notes",value:K.notes,onChange:e=>we("notes",e.target.value),placeholder:"Enter any additional notes about the day's operations...",rows:4})]})})]}),e.jsxs(a,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:[e.jsx(t,{children:e.jsx(r,{className:"text-blue-800",children:"Report Summary"})}),e.jsxs(i,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-800",children:["$",Q.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Sales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-800",children:le.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Gallons"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-800",children:["$",ie.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Lottery Sales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",ne.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Grocery Sales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-800",children:["$",O.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Expenses"})]})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-blue-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-blue-600 mb-1",children:"Total (+/-) Short/Over"}),e.jsxs("div",{className:"text-4xl font-bold "+(ge>=0?"text-green-800":"text-red-800"),children:[ge>=0?"+":"","$",ge.toFixed(2)]}),e.jsx(o,{variant:ge>=0?"default":"destructive",className:"mt-2",children:ge>=0?"Over":"Short"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>x("/sales-reports"),children:"Cancel"}),!g&&e.jsxs(n,{type:"button",variant:"outline",onClick:()=>q(!0),className:"gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Manage Drafts"]}),e.jsxs(n,{type:"button",variant:"outline",onClick:()=>{V?M(!0):h({title:"No Report to Print",description:"Please save the report first before printing",variant:"destructive"})},disabled:!V,className:"gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Print Report"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[!g&&e.jsxs(n,{type:"button",variant:"secondary",onClick:()=>{try{if(!f||!K.report_date)return void h({title:"Cannot Save Draft",description:"Please select a station and report date first",variant:"destructive"});ye.saveDraft(f,K.report_date,{...K,totalExpenses:O,cashExpenses:$,calculatedValues:{totalSales:Q,totalGallons:le,totalLotteryCash:ie,totalGrocerySales:ne,expectedCashFromSales:oe,totalShortOver:ge}})?(h({title:"Draft Saved",description:`Form data saved for ${f} on ${K.report_date}. Will expire in 12 hours.`}),Ne()):h({title:"Error",description:"Failed to save draft",variant:"destructive"})}catch(e){console.error("Error saving draft:",e),h({title:"Error",description:"Failed to save draft",variant:"destructive"})}},className:"gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Save as Draft"]}),e.jsxs(n,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 gap-2",disabled:B,children:[B?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"}),g?"Update":"Create"," Report"]})]})]})]}),e.jsx(be,{open:G,onClose:()=>q(!1),onLoadDraft:(e,s,a)=>{try{_(s),W({...e,station:s}),e.totalExpenses&&R(e.totalExpenses),e.cashExpenses&&L(e.cashExpenses),ye.deleteDraft(s,a),P(null)}catch(t){console.error("Error loading draft:",t),h({title:"Error",description:"Failed to load draft data",variant:"destructive"})}},currentStation:f,currentReportDate:K.report_date}),e.jsx(de,{open:T,onOpenChange:M,report:V})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(n,{variant:"outline",onClick:()=>x("/dashboard"),className:"mb-4",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Back to Reports"]}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[g?"Edit":"Create"," Daily Sales Report"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Step 1: Select your station to begin"})]}),e.jsx(me,{onStationSelect:_})]})})}export{Se as default};
