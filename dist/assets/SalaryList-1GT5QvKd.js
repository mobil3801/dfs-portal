import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{l as a,u as r,C as t,f as i,g as d,h as l,k as n,B as o,e as c,L as m,I as h}from"./index-BJg4_aev.js";import{N as x}from"./number-input-KV-cjSGf.js";import{S as u,c as p,d as y,a as j,b as g}from"./select-DCbSmMef.js";import{T as v}from"./textarea-C4IJWV4T.js";import{f as _,g as N,a as f,b,v as S,c as $,d as C}from"./payPeriodUtils-G1zG_LNG.js";import{n as F,O as w,B as O,K as P,l as k,I as M,D as A,a5 as D,Q as E}from"./utilities-DMEd7dY0.js";import"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";const B=()=>{const[B,R]=s.useState([]),[I,L]=s.useState(!0),[q,H]=s.useState({}),{toast:V}=a(),{userProfile:W,isAdmin:G}=r(),z=[{id:"MOBIL",name:"MOBIL",color:"bg-blue-50 border-blue-200 hover:bg-blue-100"},{id:"AMOCO ROSEDALE",name:"AMOCO (Rosedale)",color:"bg-green-50 border-green-200 hover:bg-green-100"},{id:"AMOCO BROOKLYN",name:"AMOCO (Brooklyn)",color:"bg-purple-50 border-purple-200 hover:bg-purple-100"},{id:"MANAGER",name:"Manager",color:"bg-orange-50 border-orange-200 hover:bg-orange-100"}],[K,Q]=s.useState({}),[T,Y]=s.useState(null),U=e=>{const s=N();return{employee_id:"",pay_period_start:f(s.startDate),pay_period_end:f(s.endDate),pay_date:f(s.payDate),pay_frequency:"Weekly",hourly_rate:0,regular_hours:0,assign_hours:0,overtime_hours:0,overtime_rate:0,overtime_pay:0,bonus_amount:0,commission:0,gross_pay:0,federal_tax:0,state_tax:0,social_security:0,medicare:0,health_insurance:0,retirement_401k:0,other_deductions:0,total_deductions:0,net_pay:0,station:"MANAGER"===e?"":e,status:"Pending",notes:"",created_by:W?.id||1}};s.useEffect(()=>{X(),J()},[]);const J=()=>{const e={};z.forEach(s=>{e[s.id]=U(s.id)}),Q(e)},X=s.useCallback(async()=>{try{const{data:e,error:s}=await window.ezsite.apis.tablePage("11727",{PageNo:1,PageSize:1e3,OrderByField:"first_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(s)throw s;R(e?.List||[])}catch(e){console.error("❌ Error fetching employees:",e),V({title:"Error",description:"Failed to fetch employee data",variant:"destructive"})}finally{L(!1)}},[V]),Z=e=>"MANAGER"===e?B.filter(e=>e.station&&!["MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN"].includes(e.station)):B.filter(s=>s.station===e),ee=(e,s,a)=>{Q(r=>{const t={...r};if(t[e]={...t[e],[s]:a},["hourly_rate","regular_hours","overtime_rate","overtime_hours","bonus_amount","commission","health_insurance","retirement_401k","other_deductions"].includes(s)){const s=t[e];se(s,e,t)}return t})},se=(e,s,a)=>{const r=e.overtime_rate*e.overtime_hours,t=e.hourly_rate*e.regular_hours+e.bonus_amount+e.commission+r,i=t-(e.health_insurance+e.retirement_401k+e.other_deductions);a[s]={...e,overtime_pay:r,gross_pay:t,net_pay:i}};return I?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Station-Based Salary Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Select a station below to manage salary records"})]}),e.jsxs(t,{children:[e.jsx(i,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Current Pay Period"]})}),e.jsx(l,{children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pay Period"}),e.jsx("div",{className:"font-semibold",children:_(N())})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pay Date"}),e.jsx("div",{className:"font-semibold text-green-700",children:w(N().payDate,"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Frequency"}),e.jsx("div",{className:"font-semibold",children:"Weekly (Sunday to Saturday)"})]})]})})})]}),T?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(c,{variant:"outline",onClick:()=>Y(null),className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Back to Station Selection"]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[z.find(e=>e.id===T)?.name," - Salary Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"Fill out the salary form for employees at this station"})]})]}),(s=>{const a=Z(s.id),r=K[s.id]||U(s.id),_=q[s.id]||!1;return e.jsxs(t,{className:`${s.color} border-2`,children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),s.name]}),e.jsxs(n,{children:["Salary management for ",s.name," station",e.jsxs(o,{variant:"outline",className:"ml-2",children:[a.length," employee",1!==a.length?"s":""]})]})]}),e.jsx(l,{className:"space-y-4",children:0===a.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("p",{children:"No active employees found for this station"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`employee-${s.id}`,children:"Employee *"}),e.jsxs(u,{value:r.employee_id,onValueChange:e=>((e,s)=>{const a=B.find(e=>e.employee_id===s);a&&Q(r=>{const t={...r};return t[e]={...t[e],employee_id:s,station:a.station,hourly_rate:a.salary||0},se(t[e],e,t),t})})(s.id,e),children:[e.jsx(p,{children:e.jsx(y,{placeholder:"Select employee"})}),e.jsx(j,{children:a.map(s=>e.jsxs(g,{value:s.employee_id,children:[s.first_name," ",s.last_name," (",s.employee_id,")"]},s.employee_id))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(m,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),"Pay Period Configuration"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`pay-period-quick-${s.id}`,children:"Quick Select Pay Period"}),e.jsxs(u,{onValueChange:e=>((e,s)=>{const a=$(s);Q(s=>({...s,[e]:{...s[e],pay_period_start:f(a.startDate),pay_period_end:f(a.endDate),pay_date:f(a.payDate)}}))})(s.id,e),children:[e.jsx(p,{children:e.jsx(y,{placeholder:"Select a predefined pay period"})}),e.jsx(j,{children:b().map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`pay-start-${s.id}`,children:"Pay Period Start"}),e.jsx(h,{id:`pay-start-${s.id}`,type:"date",value:r.pay_period_start,onChange:e=>((e,s)=>{const a=$(s);Q(s=>({...s,[e]:{...s[e],pay_period_start:f(a.startDate),pay_period_end:f(a.endDate),pay_date:f(a.payDate)}}))})(s.id,e.target.value)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Must be a Sunday"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`pay-end-${s.id}`,children:"Pay Period End"}),e.jsx(h,{id:`pay-end-${s.id}`,type:"date",value:r.pay_period_end,onChange:e=>{return a=s.id,r=e.target.value,void Q(e=>({...e,[a]:{...e[a],pay_period_end:r,pay_date:f(C(r))}}));var a,r}}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Must be a Saturday"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`pay-date-${s.id}`,children:"Pay Date"}),e.jsx(h,{id:`pay-date-${s.id}`,type:"date",value:r.pay_date,onChange:e=>ee(s.id,"pay_date",e.target.value),className:"bg-muted"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Auto-calculated: Following Sunday"})]})]}),(()=>{const s=S(r.pay_period_start,r.pay_period_end);return!s.isValid&&s.errors.length>0&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 text-sm font-medium mb-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Pay Period Issues:"]}),e.jsx("ul",{className:"text-amber-600 text-sm space-y-1",children:s.errors.map((s,a)=>e.jsxs("li",{children:["• ",s]},a))})]})})(),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`frequency-${s.id}`,children:"Pay Frequency"}),e.jsxs(u,{value:r.pay_frequency,onValueChange:e=>ee(s.id,"pay_frequency",e),children:[e.jsx(p,{children:e.jsx(y,{})}),e.jsxs(j,{children:[e.jsx(g,{value:"Weekly",children:"Weekly (Sunday to Saturday)"}),e.jsx(g,{value:"Biweekly",children:"Biweekly"}),e.jsx(g,{value:"Monthly",children:"Monthly"}),e.jsx(g,{value:"Semi-monthly",children:"Semi-monthly"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(m,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Earnings"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`hourly-rate-${s.id}`,children:"Hourly Rate"}),e.jsx(x,{id:`hourly-rate-${s.id}`,step:"0.01",value:r.hourly_rate,onChange:e=>ee(s.id,"hourly_rate",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`regular-hours-${s.id}`,children:"Worked Hour"}),e.jsx(x,{id:`regular-hours-${s.id}`,step:"0.01",value:r.regular_hours,onChange:e=>ee(s.id,"regular_hours",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`assign-hours-${s.id}`,children:"Assign Hours"}),e.jsx(x,{id:`assign-hours-${s.id}`,step:"0.01",value:r.assign_hours,onChange:e=>ee(s.id,"assign_hours",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`overtime-hours-${s.id}`,children:"Overtime Hours"}),e.jsx(x,{id:`overtime-hours-${s.id}`,step:"0.01",value:r.overtime_hours,onChange:e=>ee(s.id,"overtime_hours",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`bonus-${s.id}`,children:"Bonus"}),e.jsx(x,{id:`bonus-${s.id}`,step:"0.01",value:r.bonus_amount,onChange:e=>ee(s.id,"bonus_amount",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`commission-${s.id}`,children:"Commission"}),e.jsx(x,{id:`commission-${s.id}`,step:"0.01",value:r.commission,onChange:e=>ee(s.id,"commission",e)})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(m,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Calculated Values"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`overtime-rate-${s.id}`,children:"Overtime Rate"}),e.jsx(x,{id:`overtime-rate-${s.id}`,step:"0.01",value:r.overtime_rate,onChange:e=>ee(s.id,"overtime_rate",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`overtime-pay-${s.id}`,children:"Overtime Pay"}),e.jsx(x,{id:`overtime-pay-${s.id}`,step:"0.01",value:r.overtime_pay,onChange:e=>ee(s.id,"overtime_pay",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Gross Pay"}),e.jsxs("div",{className:"p-2 bg-green-50 border border-green-200 rounded-md text-sm font-semibold text-green-700",children:["$",r.gross_pay.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Net Pay"}),e.jsxs("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded-md text-sm font-semibold text-blue-700",children:["$",r.net_pay.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{className:"text-sm font-semibold",children:"Additional Deductions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`health-insurance-${s.id}`,children:"Health Insurance"}),e.jsx(x,{id:`health-insurance-${s.id}`,step:"0.01",value:r.health_insurance,onChange:e=>ee(s.id,"health_insurance",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`retirement-${s.id}`,children:"401(k)"}),e.jsx(x,{id:`retirement-${s.id}`,step:"0.01",value:r.retirement_401k,onChange:e=>ee(s.id,"retirement_401k",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`other-deductions-${s.id}`,children:"Other Deductions"}),e.jsx(x,{id:`other-deductions-${s.id}`,step:"0.01",value:r.other_deductions,onChange:e=>ee(s.id,"other_deductions",e)})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`notes-${s.id}`,children:"Notes"}),e.jsx(v,{id:`notes-${s.id}`,value:r.notes,onChange:e=>ee(s.id,"notes",e.target.value),placeholder:"Additional notes about this salary record...",rows:3})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(c,{onClick:()=>(async e=>{const s=K[e];if(s.employee_id){H(s=>({...s,[e]:!0}));try{const a={...s,pay_period_start:new Date(s.pay_period_start).toISOString(),pay_period_end:new Date(s.pay_period_end).toISOString(),pay_date:new Date(s.pay_date).toISOString()},{error:r}=await window.ezsite.apis.tableCreate("11788",a);if(r)throw r;V({title:"Success",description:`Salary record created successfully for ${e}`,variant:"default"}),Q(s=>({...s,[e]:U(e)}))}catch(a){console.error("Error creating salary record:",a),V({title:"Error",description:"Failed to create salary record",variant:"destructive"})}finally{H(s=>({...s,[e]:!1}))}}else V({title:"Error",description:"Please select an employee",variant:"destructive"})})(s.id),disabled:_||!r.employee_id,className:"w-full",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Create Salary Record"]})})})]})})]},s.id)})(z.find(e=>e.id===T))]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:z.map(s=>{const a=Z(s.id);return e.jsxs(t,{className:`${s.color} border-2 cursor-pointer transition-all duration-200 transform hover:scale-105`,onClick:()=>Y(s.id),children:[e.jsxs(i,{className:"text-center pb-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(O,{className:"h-12 w-12 text-gray-600"})}),e.jsx(d,{className:"text-xl font-bold",children:s.name}),e.jsx(n,{className:"text-sm",children:"Click to manage salary records"})]}),e.jsxs(l,{className:"text-center pt-0",children:[e.jsxs(o,{variant:"outline",className:"text-lg px-4 py-2",children:[a.length," employee",1!==a.length?"s":""]}),e.jsx("div",{className:"mt-4 text-sm text-muted-foreground",children:"Tap to access salary forms"})]})]},s.id)})})})]})};export{B as default};
