import{j as e}from"./radix-ui-BhRELLXi.js";import{r as s}from"./react-core-CKNU0hQt.js";import{u as t,t as r,C as i,i as a,g as l,h as n,B as c,f as o,L as d,A as x,m,n as p,I as h,v as u,p as g,q as j,r as v,s as y,T as f,a as w,b as N,c as b,d as _,e as C}from"./index-s81fdLZV.js";import{D as S,e as A,a as k,b as E,c as O}from"./dialog-DoXR3LdX.js";import{S as F}from"./scroll-area-BfOHpqF9.js";import{S as P,c as L,d as R,a as D,b as U}from"./select-CiDiYLaC.js";import{C as V,u as M,B as $,a as I}from"./BatchDeleteDialog-DlNmvodk.js";import{B as z}from"./BatchEditDialog-DnEgf8QL.js";import{S as B}from"./switch-BZeuVaev.js";import{d as T,ax as q,R as J,U as H,q as W,az as G,x as Q,N as K,A as Y,e as Z,av as X,j as ee,a7 as se,$ as te,O as re,W as ie,Q as ae,w as le,S as ne,aA as ce,a8 as oe,F as de,aB as xe,i as me,aC as pe,aw as he,am as ue,D as ge,m as je,P as ve,o as ye,V as fe,p as we,T as Ne,aD as be,a6 as _e,aE as Ce,I as Se,ap as Ae,ad as ke,y as Ee,aF as Oe}from"./utilities-DVevn_gw.js";import{A as Fe}from"./AccessDenied-wxYpicIE.js";import{C as Pe}from"./CreateUserDialog-Yj_AY2M9.js";import"./routing-DcURAnU1.js";import"./data-management-CF8GQrOz.js";import"./animations-Cc9qW4PM.js";const Le=()=>{const{userProfile:p}=t(),[h,u]=s.useState([]),[g,j]=s.useState(null),[v,y]=s.useState({}),[f,w]=s.useState(!0),[N,b]=s.useState(!1),[_,C]=s.useState(!1),[S,A]=s.useState(!1),k="Administrator"===p?.role,E=["dashboard","products","employees","sales_reports","vendors","orders","licenses","salary","delivery","settings","user_management","site_management","system_logs","security_settings"],O={Administrator:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},Management:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},Employee:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1}};s.useEffect(()=>{k&&F()},[k]),s.useEffect(()=>{g&&V(g)},[g]);const F=async()=>{try{w(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage("11725",{PageNo:1,PageSize:100,OrderByField:"id",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(s)throw s;u(e?.List||[])}catch(e){console.error("Error loading users:",e),r({title:"Error",description:"Failed to load users",variant:"destructive"})}finally{w(!1)}},V=async e=>{try{w(!0);const{data:t,error:r}=await window.ezsite.apis.tablePage("11725",{PageNo:1,PageSize:1,OrderByField:"id",IsAsc:!0,Filters:[{name:"id",op:"Equal",value:e}]});if(r)throw r;const i=t?.List?.[0];if(i){let e={};if(i.detailed_permissions)try{e=JSON.parse(i.detailed_permissions)}catch(s){console.warn("Failed to parse user permissions:",s)}const t={};E.forEach(s=>{t[s]=e[s]||{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}}),y(t),C(!1)}}catch(t){console.error("Error loading user permissions:",t),r({title:"Error",description:"Failed to load user permissions",variant:"destructive"})}finally{w(!1)}},M=s.useCallback((e,s,t)=>{y(r=>({...r,[e]:{...r[e],[s]:t}})),C(!0),r({title:"Permission Updated",description:`${e} ${s} permission ${t?"enabled":"disabled"}`,duration:2e3})},[]),$=s.useCallback(e=>{const s=O[e];if(!s)return;const t={};E.forEach(e=>{t[e]={...s}}),y(t),C(!0),r({title:"Template Applied",description:`${e} permission template applied to all modules`,duration:3e3})},[E]),I=s.useCallback(()=>{g&&(V(g),r({title:"Permissions Reset",description:"All changes have been reverted",duration:2e3}))},[g]),z=e=>({dashboard:"Dashboard",products:"Products",employees:"Employees",sales_reports:"Sales Reports",vendors:"Vendors",orders:"Orders",licenses:"Licenses",salary:"Salary",delivery:"Delivery",settings:"Settings",user_management:"User Management",site_management:"Site Management",system_logs:"System Logs",security_settings:"Security Settings"}[e]||e),ne=()=>g?h.find(e=>e.id===g):null;return k?e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:"border-blue-200 bg-blue-50",children:e.jsx(l,{children:e.jsxs(n,{className:"flex items-center justify-between text-blue-900",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-6 h-6"}),e.jsx("span",{children:"Real-Time Permission Management"}),e.jsx(c,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Live System"})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:async()=>{A(!0);try{await F(),g&&await V(g),r({title:"Data Refreshed",description:"User data and permissions have been refreshed",duration:2e3})}catch(e){console.error("Error refreshing data:",e)}finally{A(!1)}},disabled:S,className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4 "+(S?"animate-spin":"")}),e.jsx("span",{children:"Refresh"})]})]})})}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"Select User"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Choose User to Manage"}),e.jsxs(P,{value:g?.toString()||"",onValueChange:e=>j(parseInt(e)),children:[e.jsx(L,{className:"w-full",children:e.jsx(R,{placeholder:"Select a user to manage their permissions"})}),e.jsx(D,{children:h.map(s=>e.jsx(U,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:s.employee_id}),e.jsx(c,{variant:"outline",className:"text-xs",children:s.role}),e.jsx(c,{variant:"outline",className:"text-xs",children:s.station})]})},s.id))})]})]}),g&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{children:"Quick Role Templates:"}),Object.keys(O).map(s=>e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>$(s),className:"text-xs",children:["Apply ",s]},s))]}),ne()&&e.jsxs(x,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs(m,{children:["Managing permissions for: ",e.jsx("strong",{children:ne()?.employee_id}),"(",ne()?.role," at ",ne()?.station,")"]})]})]})})]}),g&&e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:"Module Permissions"})]}),_&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Unsaved Changes"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:I,disabled:N,children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsxs(o,{size:"sm",onClick:async()=>{if(g)try{b(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage("11725",{PageNo:1,PageSize:1,OrderByField:"id",IsAsc:!0,Filters:[{name:"id",op:"Equal",value:g}]});if(s)throw s;const t=e?.List?.[0];if(!t)throw new Error("User not found");const i=await window.ezsite.apis.tableUpdate("11725",{id:t.id,detailed_permissions:JSON.stringify(v)});if(i.error)throw i.error;C(!1),r({title:"Success",description:"User permissions updated successfully",duration:3e3}),setTimeout(()=>{V(g)},500)}catch(e){console.error("Error saving permissions:",e),r({title:"Error",description:"string"==typeof e?e:"Failed to save permissions",variant:"destructive"})}finally{b(!1)}else r({title:"Error",description:"Please select a user first",variant:"destructive"})},disabled:N,className:"bg-green-600 hover:bg-green-700",children:[N?e.jsx(Q,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(K,{className:"w-4 h-4 mr-1"}),N?"Saving...":"Save Changes"]})]})]})}),e.jsx(a,{children:f?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Q,{className:"w-6 h-6 animate-spin text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading permissions..."})]}):e.jsx("div",{className:"space-y-6",children:E.map(s=>{const t=v[s]||{},{enabled:r,total:n}=(e=>({enabled:Object.values(e).filter(Boolean).length,total:Object.keys(e).length}))(t);return e.jsxs(i,{className:"border-gray-200",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:z(s)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r,"/",n," permissions enabled"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:r===n?e.jsx(Z,{className:"w-5 h-5 text-green-500"}):0===r?e.jsx(X,{className:"w-5 h-5 text-red-500"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-yellow-400 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-yellow-800",children:r})})})]})}),e.jsx(a,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.keys(t).map(r=>{const i={view:le,create:ae,edit:ie,delete:re,export:te,print:se}[r];const a=t[r];return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`\n                                    w-6 h-6 rounded-full flex items-center justify-center\n                                    ${a?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"}\n                                  `,children:e.jsx(i,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium capitalize",children:r})]}),e.jsx(B,{checked:a,onCheckedChange:e=>M(s,r,e),className:"data-[state=checked]:bg-green-500"})]},r)})})})]},s)})})})]}),!g&&!f&&e.jsx(i,{className:"border-gray-200",children:e.jsx(a,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a User to Manage Permissions"}),e.jsx("p",{className:"text-gray-600",children:"Choose a user from the dropdown above to view and modify their module permissions."})]})})})]}):e.jsx(i,{className:"border-orange-200 bg-orange-50",children:e.jsx(a,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-orange-900",children:"Permission Management"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Administrator access required to manage user permissions"})]})]})})})},Re={view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1,approve:!1,bulk_operations:!1,advanced_features:!1},De={"Core Dashboard":[{key:"dashboard",label:"Dashboard",icon:ye,color:"text-blue-600",route:"/dashboard",description:"Main dashboard with analytics and quick access"}],"Product Management":[{key:"products",label:"Product List",icon:ve,color:"text-green-600",route:"/products",description:"View and manage product inventory"},{key:"product_form",label:"Product Form",icon:ie,color:"text-green-500",route:"/products/new",description:"Add and edit product records"}],"Sales & Reports":[{key:"sales_reports",label:"Sales Reports",icon:de,color:"text-orange-600",route:"/sales-reports",description:"Daily sales reporting and enhanced print dialogs"},{key:"sales_report_form",label:"Sales Report Form",icon:je,color:"text-orange-500",route:"/sales-reports/new",description:"Create daily sales reports"}],"Human Resources":[{key:"employees",label:"Employee List",icon:ee,color:"text-purple-600",route:"/employees",description:"Employee records management"},{key:"employee_form",label:"Employee Form",icon:ce,color:"text-purple-500",route:"/employees/new",description:"Add and edit employee records"},{key:"salary",label:"Salary Management",icon:ge,color:"text-yellow-600",route:"/salary",description:"Payroll and salary records"},{key:"salary_form",label:"Salary Form",icon:je,color:"text-yellow-500",route:"/salary/new",description:"Create salary records"}],"Business Operations":[{key:"vendors",label:"Vendor List",icon:oe,color:"text-teal-600",route:"/vendors",description:"Supplier relationships"},{key:"vendor_form",label:"Vendor Form",icon:oe,color:"text-teal-500",route:"/vendors/new",description:"Add and edit vendors"},{key:"orders",label:"Order List",icon:me,color:"text-indigo-600",route:"/orders",description:"Purchase orders management"},{key:"order_form",label:"Order Form",icon:ue,color:"text-indigo-500",route:"/orders/new",description:"Create purchase orders"}],"Delivery & Inventory":[{key:"delivery",label:"Delivery List",icon:me,color:"text-pink-600",route:"/delivery",description:"Fuel delivery tracking"},{key:"delivery_form",label:"Delivery Form",icon:pe,color:"text-pink-500",route:"/delivery/new",description:"Create delivery records"},{key:"inventory_alerts",label:"Inventory Alerts",icon:he,color:"text-red-600",route:"/inventory/alerts",description:"Stock level alerts"},{key:"alert_settings",label:"Alert Settings",icon:ne,color:"text-red-500",route:"/inventory/settings",description:"Configure inventory alerts"},{key:"gas_delivery_inventory",label:"Gas Delivery Inventory",icon:q,color:"text-cyan-600",route:"/inventory/gas-delivery",description:"Gas tank monitoring"}],"Licenses & Compliance":[{key:"licenses",label:"License List",icon:T,color:"text-red-600",route:"/licenses",description:"Business licenses and compliance"},{key:"license_form",label:"License Form",icon:xe,color:"text-red-500",route:"/licenses/new",description:"Add and edit licenses"}],"System Administration":[{key:"settings",label:"App Settings",icon:ne,color:"text-gray-600",route:"/settings",description:"Application configuration"},{key:"user_management",label:"User Management",icon:ce,color:"text-red-600",route:"/admin/users",description:"User accounts and permissions"},{key:"site_management",label:"Site Management",icon:oe,color:"text-blue-600",route:"/admin/sites",description:"Multi-station management"},{key:"system_logs",label:"System Logs",icon:de,color:"text-gray-600",route:"/admin/logs",description:"System activity logs"},{key:"security_settings",label:"Security Settings",icon:T,color:"text-red-600",route:"/admin/security",description:"Security policies"}]},Ue=[{key:"view",label:"View",icon:le,description:"Can view and access the page",color:"text-blue-600"},{key:"create",label:"Create",icon:ae,description:"Can create new records",color:"text-green-600"},{key:"edit",label:"Edit",icon:ie,description:"Can modify existing records",color:"text-yellow-600"},{key:"delete",label:"Delete",icon:re,description:"Can delete records",color:"text-red-600"},{key:"export",label:"Export",icon:de,description:"Can export data",color:"text-purple-600"},{key:"print",label:"Print",icon:ne,description:"Can print reports",color:"text-indigo-600"}],Ve={Administrator:{description:"Full system access with all permissions",permissions:()=>{const e={};return Object.values(De).flat().forEach(s=>{e[s.key]={...Re},Ue.forEach(t=>{e[s.key][t.key]=!0})}),e}},Management:{description:"Full operational access with limited admin features",permissions:()=>{const e={};return Object.values(De).flat().forEach(s=>{e[s.key]={...Re},["user_management","system_logs","security_settings"].includes(s.key)?(e[s.key].view=!0,e[s.key].export=!0):Ue.forEach(t=>{e[s.key][t.key]=!0})}),e}},Employee:{description:"Basic operational access for daily tasks",permissions:()=>{const e={},s=["dashboard","sales_reports","sales_report_form","delivery","delivery_form"];return Object.values(De).flat().forEach(t=>{e[t.key]={...Re},s.includes(t.key)?(e[t.key].view=!0,e[t.key].create=!0,e[t.key].edit=!0,e[t.key].print=!0):["products","inventory_alerts","gas_delivery_inventory"].includes(t.key)&&(e[t.key].view=!0)}),e}}},Me=({trigger:t,selectedUserId:r})=>{const[u,g]=s.useState([]),[j,v]=s.useState(null),[y,f]=s.useState({}),[w,N]=s.useState(!0),[b,_]=s.useState(!1),[C,V]=s.useState(!1),[M,$]=s.useState(""),[I,z]=s.useState("All"),[H,W]=s.useState("Custom"),[G,Q]=s.useState(!1),{toast:Y}=p();s.useEffect(()=>{G&&Z()},[G]),s.useEffect(()=>{j&&se(j)},[j]),s.useEffect(()=>{if(r&&u.length>0){const e=u.find(e=>e.id===r);e&&v(e)}},[r,u]);const Z=async()=>{try{N(!0),console.log("Fetching user profiles for comprehensive permission management...");const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"id",IsAsc:!1,Filters:[]});if(s)throw console.error("Error fetching user profiles:",s),s;console.log("User profiles loaded:",e?.List?.length||0),g(e?.List||[])}catch(e){console.error("Error fetching user profiles:",e),Y({title:"Database Error",description:`Failed to fetch user profiles: ${e}`,variant:"destructive"})}finally{N(!1)}},se=e=>{try{if(console.log("Loading permissions for user:",e.employee_id),e.detailed_permissions&&""!==e.detailed_permissions.trim()&&"{}"!==e.detailed_permissions){const s=JSON.parse(e.detailed_permissions);f(s),W("Custom"),console.log("Loaded existing permissions")}else te(e.role,!1),console.log("Applied default role template:",e.role)}catch(s){console.error("Error parsing permissions for user:",e.employee_id,s),te(e.role,!1)}},te=(e,s=!0)=>{const t=Ve[e];if(t){const r=t.permissions();f(r),W(e),console.log("Applied role template:",e),s&&Y({title:"Template Applied",description:`${e} permission template has been applied`})}else{const e={};Object.values(De).flat().forEach(s=>{e[s.key]={...Re}}),f(e),W("Custom"),s&&Y({title:"Custom Template",description:"Initialize custom permissions for this role"})}},re=e=>{try{const s=e.detailed_permissions&&""!==e.detailed_permissions.trim()?JSON.parse(e.detailed_permissions):{},t=Object.values(De).flat().length,r=Object.values(De).flat().filter(e=>s[e.key]?.view).length;return{summary:`${r}/${t}`,hasAccess:r>0,pagesWithAccess:r,totalPages:t}}catch{return{summary:"0/0",hasAccess:!1,pagesWithAccess:0,totalPages:0}}},ie=(e,s)=>{const t=De[e]||[],r={...y};t.forEach(e=>{const t={...Re};switch(s){case"grant_all":Ue.forEach(e=>{t[e.key]=!0});break;case"view_only":t.view=!0,t.export=!0}r[e.key]=t}),f(r),W("Custom"),Y({title:"Bulk Update",description:`${s.replace("_"," ")} applied to ${e}`})},ae=u.filter(e=>{const s=e.employee_id.toLowerCase().includes(M.toLowerCase())||e.phone.toLowerCase().includes(M.toLowerCase())||e.role.toLowerCase().includes(M.toLowerCase()),t="All"===I||e.role===I;return s&&t});return e.jsxs(S,{open:G,onOpenChange:Q,children:[e.jsx(A,{asChild:!0,children:t}),e.jsxs(k,{className:"max-w-7xl h-[90vh] overflow-hidden",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{children:"Real-Time Permission Management"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"bg-green-50 text-green-700",children:[u.length," Users"]}),e.jsx(o,{onClick:async()=>{V(!0),await Z(),V(!1),Y({title:"Success",description:"User data refreshed successfully"})},disabled:C,variant:"outline",size:"sm",children:e.jsx(J,{className:"w-4 h-4 "+(C?"animate-spin":"")})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(F,{className:"h-full",children:e.jsxs("div",{className:"space-y-6 pr-4",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Select User & Apply Templates"})]})}),e.jsx(a,{className:"space-y-4",children:w?e.jsx("div",{className:"text-center py-4",children:"Loading users from database..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(h,{placeholder:"Search users...",value:M,onChange:e=>$(e.target.value),className:"pl-10"})]}),e.jsxs(P,{value:I,onValueChange:z,children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Filter by role"})}),e.jsxs(D,{children:[e.jsx(U,{value:"All",children:"All Roles"}),e.jsx(U,{value:"Administrator",children:"Administrator"}),e.jsx(U,{value:"Management",children:"Management"}),e.jsx(U,{value:"Employee",children:"Employee"})]})]}),e.jsxs(P,{onValueChange:e=>{const s=u.find(s=>s.id.toString()===e);s&&(v(s),console.log("Selected user for permission management:",s.employee_id))},value:j?.id.toString()||"",children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Select user to manage"})}),e.jsx(D,{children:ae.map(s=>{const t=re(s);return e.jsx(U,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("span",{children:[s.employee_id," - ",s.role]}),e.jsx(c,{variant:"outline",className:"ml-2",children:t.summary})]})},s.id)})})]})]}),j&&e.jsxs(x,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:j.employee_id})," - ",j.role," at ",j.station,e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Template: ",H]})]}),e.jsx("div",{className:"text-right",children:e.jsx(c,{className:j.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:j.is_active?"Active":"Inactive"})})]})})]}),j&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"text-sm font-medium",children:"Quick Permission Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:Object.entries(Ve).map(([s,t])=>e.jsx(o,{variant:H===s?"default":"outline",size:"sm",onClick:()=>te(s),className:"text-xs h-auto py-2 px-3 flex flex-col items-center space-y-1",title:t.description,children:e.jsx("span",{className:"font-medium",children:s})},s))})]})]})})]}),j&&e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsxs("span",{children:["Real-Time Permissions for ",j.employee_id]})]}),e.jsxs(o,{onClick:async()=>{if(j){_(!0);try{console.log("Saving permissions for user:",j.employee_id);const{error:e}=await window.ezsite.apis.tableUpdate(11725,{id:j.id,detailed_permissions:JSON.stringify(y)});if(e)throw console.error("Database error saving permissions:",e),e;Y({title:"Success",description:`Permissions updated successfully for ${j.employee_id}`}),g(e=>e.map(e=>e.id===j.id?{...e,detailed_permissions:JSON.stringify(y)}:e)),console.log("Permissions saved to production database successfully")}catch(e){console.error("Error saving permissions:",e),Y({title:"Database Error",description:`Failed to save permissions: ${e}`,variant:"destructive"})}finally{_(!1)}}else Y({title:"Error",description:"No user selected",variant:"destructive"})},disabled:b,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),b?"Saving to Database...":"Save Permissions"]})]})}),e.jsxs(a,{children:[e.jsx("div",{className:"space-y-6",children:Object.entries(De).map(([s,t])=>e.jsxs(i,{className:"border-l-4 border-l-blue-500",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-lg",children:s}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>ie(s,"view_only"),className:"text-blue-600",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"View Only"]}),e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>ie(s,"grant_all"),className:"text-green-600",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),"Full Access"]}),e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>ie(s,"revoke_all"),className:"text-red-600",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"No Access"]})]})]})}),e.jsx(a,{children:e.jsx("div",{className:"space-y-4",children:t.map(s=>{const t=y[s.key]||Re;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(s.icon,{className:`w-5 h-5 ${s.color}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.label}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description}),s.route&&e.jsxs("p",{className:"text-xs text-blue-500",children:["Route: ",s.route]})]})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:Ue.map(r=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx(B,{checked:t[r.key]||!1,onCheckedChange:e=>{return t=s.key,i=r.key,a=e,f(e=>({...e,[t]:{...e[t]||Re,[i]:a}})),W("Custom"),void console.log("Permission changed:",t,i,a);var t,i,a},id:`${s.key}-${r.key}`}),e.jsxs(d,{htmlFor:`${s.key}-${r.key}`,className:"text-xs cursor-pointer flex items-center space-x-1",children:[e.jsx(r.icon,{className:`w-3 h-3 ${r.color}`}),e.jsx("span",{children:r.label})]})]},r.key))})]},s.key)})})})]},s))}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2 text-blue-600"}),"Real-Time Production Database Integration"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Button Controls:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"View:"})," Controls page access and navigation visibility"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Create:"}),' Controls "Add" and "Create New" buttons']}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Edit:"}),' Controls "Edit" and modification buttons']}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Delete:"})," Controls delete actions and buttons"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Export:"})," Controls data export functionality"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Print:"})," Controls enhanced print dialogs"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Current Configuration:"}),e.jsx(c,{variant:"outline",className:"mb-2",children:H}),e.jsx("p",{className:"text-gray-600 text-xs",children:Ve[H]?.description||"Custom permissions configured"}),j&&(()=>{const s=re(j);return e.jsxs("p",{className:"text-xs text-green-600 mt-2",children:["Access to ",s.pagesWithAccess," out of ",s.totalPages," pages"]})})()]})]})]})]})]})]})})})]})]})},$e={"Super Admin":{icon:T,color:"bg-red-100 text-red-800 border-red-200",description:"Complete system access - Can manage everything including users, settings, and all data",permissions:["All Pages","All Operations","User Management","System Settings","Security"],level:5},Manager:{icon:ce,color:"bg-blue-100 text-blue-800 border-blue-200",description:"Full operational access - Can view, create, edit all business data (except admin features)",permissions:["Sales Reports","Products","Employees","Orders","Inventory","Print & Export"],level:4},Supervisor:{icon:be,color:"bg-purple-100 text-purple-800 border-purple-200",description:"Department oversight - Can manage specific areas and view reports",permissions:["View All","Edit Some","Create Reports","Approve Requests"],level:3},Employee:{icon:ee,color:"bg-green-100 text-green-800 border-green-200",description:"Daily operations - Can handle routine tasks like sales, basic inventory, and delivery",permissions:["Sales Entry","View Products","Basic Reports","Delivery Records"],level:2},"Read Only":{icon:le,color:"bg-gray-100 text-gray-800 border-gray-200",description:"View only access - Can see reports and data but cannot make changes",permissions:["View Reports","View Data","Export Only"],level:1}},Ie={"New Employee":{description:"Perfect for new staff members who need basic access",role:"Employee",icon:ae},"Department Head":{description:"For department managers who oversee operations",role:"Manager",icon:ce},"Auditor/Viewer":{description:"For external auditors or read-only access",role:"Read Only",icon:le},"System Admin":{description:"For IT administrators who need full access",role:"Super Admin",icon:T}},ze=({trigger:t,selectedUserId:r,onRoleAssigned:d})=>{const[u,g]=s.useState([]),[j,v]=s.useState(null),[y,f]=s.useState(""),[w,N]=s.useState(""),[b,_]=s.useState(!0),[C,P]=s.useState(!1),[L,R]=s.useState(!1),[D,U]=s.useState([]),[M,$]=s.useState(!1),{toast:I}=p();s.useEffect(()=>{L&&z()},[L]),s.useEffect(()=>{if(r&&u.length>0){const e=u.find(e=>e.id===r);e&&(v(e),f(e.role))}},[r,u]);const z=async()=>{try{_(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"employee_id",IsAsc:!0,Filters:[]});if(s)throw s;g(e?.List||[])}catch(e){console.error("Error fetching users:",e),I({title:"Error",description:`Failed to load users: ${e}`,variant:"destructive"})}finally{_(!1)}},B=async(e,s)=>{try{const t=q(s),{error:r}=await window.ezsite.apis.tableUpdate(11725,{id:e,role:s,detailed_permissions:JSON.stringify(t)});if(r)throw r;return!0}catch(t){throw console.error("Error assigning role:",t),t}},q=e=>{const s={"Super Admin":{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},user_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},site_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},system_logs:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},security_settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0}},Manager:{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!1,edit:!0,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},Employee:{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},products:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},employees:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},sales_reports:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},vendors:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},orders:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},licenses:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},delivery:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},"Read Only":{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},products:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},employees:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},vendors:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},orders:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}}};return s[e]||s.Employee},H=u.filter(e=>e.employee_id.toLowerCase().includes(w.toLowerCase())||e.phone.toLowerCase().includes(w.toLowerCase())||e.role.toLowerCase().includes(w.toLowerCase())),G=e.jsxs(o,{variant:"outline",className:"border-blue-500 text-blue-600 hover:bg-blue-50",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Easy Role Assignment"]});return e.jsxs(S,{open:L,onOpenChange:R,children:[e.jsx(A,{asChild:!0,children:t||G}),e.jsxs(k,{className:"max-w-4xl h-[85vh]",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{children:"Simple Role Assignment"}),e.jsx(c,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Easy Mode"})]})}),e.jsx(F,{className:"h-full pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{children:"Quick Assignment Templates"})]})}),e.jsx(a,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(Ie).map(([s,t])=>e.jsxs(o,{variant:"outline",className:"h-auto p-3 flex flex-col items-center space-y-2",onClick:()=>f(t.role),children:[e.jsx(t.icon,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:s}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]},s))})})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Available Roles"})]})}),e.jsx(a,{children:e.jsx("div",{className:"space-y-3",children:Object.entries($e).map(([s,t])=>e.jsx("div",{className:"p-4 rounded-lg border-2 cursor-pointer transition-all "+(y===s?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>f(s),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t.icon,{className:"w-6 h-6 text-gray-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s}),e.jsxs(c,{className:t.color,children:["Level ",t.level]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.permissions.map((s,t)=>e.jsx(c,{variant:"outline",className:"text-xs",children:s},t))})]})]})},s))})})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:"Select Users"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>$(!M),children:M?"Single Mode":"Bulk Mode"}),e.jsx(o,{variant:"outline",size:"sm",onClick:z,disabled:b,children:e.jsx(J,{className:"w-4 h-4 "+(b?"animate-spin":"")})})]})]})}),e.jsx(a,{children:b?e.jsx("div",{className:"text-center py-8",children:"Loading users..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(h,{placeholder:"Search users...",value:w,onChange:e=>N(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:H.map(s=>e.jsx("div",{className:"p-3 border rounded-lg cursor-pointer transition-all "+(M?D.includes(s.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300":j?.id===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>{M?U(e=>e.includes(s.id)?e.filter(e=>e!==s.id):[...e,s.id]):(v(s),f(s.role))},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[M&&e.jsx(V,{checked:D.includes(s.id),onChange:()=>{}}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.employee_id}),e.jsx("div",{className:"text-sm text-gray-500",children:s.phone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:$e[s.role]?.color||"bg-gray-100 text-gray-800",children:s.role}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.station})]})]})},s.id))}),0===H.length&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your search"})]})})]}),(j&&!M||D.length>0&&M)&&y&&e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(we,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Assignment Summary"})]})}),e.jsxs(a,{children:[e.jsxs(x,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Selected Role:"})," ",y]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Target Users:"})," ",M?`${D.length} users`:j?.employee_id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Permissions:"})," ",$e[y]?.description]})]})})]}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsxs(o,{onClick:M?async()=>{if(0!==D.length&&y){P(!0);try{let e=0;for(const s of D)await B(s,y),e++;I({title:"Success",description:`${e} users assigned ${y} role successfully`}),g(e=>e.map(e=>D.includes(e.id)?{...e,role:y,detailed_permissions:JSON.stringify(q(y))}:e)),U([]),$(!1),d?.()}catch(e){I({title:"Error",description:`Failed to assign roles: ${e}`,variant:"destructive"})}finally{P(!1)}}else I({title:"Error",description:"Please select users and a role",variant:"destructive"})}:async()=>{if(j&&y){P(!0);try{await B(j.id,y),I({title:"Success",description:`${j.employee_id} assigned ${y} role successfully`}),g(e=>e.map(e=>e.id===j.id?{...e,role:y,detailed_permissions:JSON.stringify(q(y))}:e)),d?.(),R(!1)}catch(e){I({title:"Error",description:`Failed to assign role: ${e}`,variant:"destructive"})}finally{P(!1)}}else I({title:"Error",description:"Please select a user and role",variant:"destructive"})},disabled:C,className:"bg-blue-600 hover:bg-blue-700 flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),C?"Assigning...":`Assign ${y} Role`]}),e.jsx(o,{variant:"outline",onClick:()=>{v(null),U([]),f("")},children:"Clear Selection"})]})]})]})]})})]})]})},Be=["Super Admin","Manager","Supervisor","Employee","Read Only"],Te={"Super Admin":"bg-red-100 text-red-800",Manager:"bg-blue-100 text-blue-800",Supervisor:"bg-purple-100 text-purple-800",Employee:"bg-green-100 text-green-800","Read Only":"bg-gray-100 text-gray-800"},qe=({trigger:t,onRolesAssigned:r})=>{const[d,u]=s.useState([]),[g,j]=s.useState([]),[v,y]=s.useState(""),[f,w]=s.useState(""),[N,b]=s.useState("All"),[_,C]=s.useState("All"),[F,M]=s.useState(!0),[$,I]=s.useState(!1),[z,B]=s.useState(!1),{toast:T}=p();s.useEffect(()=>{z&&q()},[z]);const q=async()=>{try{M(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"employee_id",IsAsc:!0,Filters:[]});if(s)throw s;u(e?.List||[])}catch(e){console.error("Error fetching users:",e),T({title:"Error",description:`Failed to load users: ${e}`,variant:"destructive"})}finally{M(!1)}},H=Array.from(new Set(d.map(e=>e.station))).filter(Boolean),W=d.filter(e=>{const s=e.employee_id.toLowerCase().includes(f.toLowerCase())||e.phone.toLowerCase().includes(f.toLowerCase()),t="All"===N||e.station===N,r="All"===_||e.role===_;return s&&t&&r}),G=e.jsxs(o,{className:"bg-orange-600 hover:bg-orange-700",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Bulk Role Manager"]});return e.jsxs(S,{open:z,onOpenChange:B,children:[e.jsx(A,{asChild:!0,children:t||G}),e.jsxs(k,{className:"max-w-6xl h-[90vh]",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-6 h-6 text-orange-600"}),e.jsx("span",{children:"Bulk Role Manager"}),e.jsx(c,{className:"bg-orange-100 text-orange-800",children:"Mass Assignment"})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"h-full flex flex-col space-y-4",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:"Filter Users"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(h,{placeholder:"Search users...",value:f,onChange:e=>w(e.target.value),className:"pl-10"})]}),e.jsxs(P,{value:N,onValueChange:b,children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Filter by station"})}),e.jsxs(D,{children:[e.jsx(U,{value:"All",children:"All Stations"}),H.map(s=>e.jsx(U,{value:s,children:s},s))]})]}),e.jsxs(P,{value:_,onValueChange:C,children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Filter by current role"})}),e.jsxs(D,{children:[e.jsx(U,{value:"All",children:"All Roles"}),Be.map(s=>e.jsx(U,{value:s,children:s},s))]})]}),e.jsx(o,{variant:"outline",onClick:()=>{w(""),b("All"),C("All")},children:"Clear Filters"})]})})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),e.jsx("span",{children:"Target Role"})]})}),e.jsx(a,{children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:Be.map(s=>e.jsx(o,{variant:v===s?"default":"outline",className:"h-auto p-3 "+(v===s?"bg-blue-600 hover:bg-blue-700":""),onClick:()=>y(s),children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"font-medium",children:s})})},s))})})]}),e.jsxs(i,{className:"flex-1 overflow-hidden",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsxs("span",{children:["Select Users (",W.length,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",children:[g.length," selected"]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{g.length===W.length?j([]):j(W.map(e=>e.id))},children:g.length===W.length?"Deselect All":"Select All"}),e.jsx(o,{variant:"outline",size:"sm",onClick:q,disabled:F,children:e.jsx(J,{className:"w-4 h-4 "+(F?"animate-spin":"")})})]})]})}),e.jsx(a,{className:"flex-1 overflow-hidden",children:F?e.jsx("div",{className:"text-center py-8",children:"Loading users..."}):e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:W.map(s=>e.jsx("div",{className:"p-3 border rounded-lg cursor-pointer transition-all "+(g.includes(s.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>{return e=s.id,void j(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{checked:g.includes(s.id),onChange:()=>{}}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.employee_id}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.phone," • ",s.station]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:Te[s.role]||"bg-gray-100 text-gray-800",children:s.role}),v&&v!==s.role&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-3 h-3 text-gray-400"}),e.jsx(c,{className:Te[v],children:v})]})]})]})})]})},s.id))})})})]}),g.length>0&&v&&e.jsx(i,{children:e.jsxs(a,{className:"pt-6",children:[e.jsxs(x,{children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:e.jsxs("strong",{children:["Ready to assign ",v," role to ",g.length," users"]})}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Current roles: ",Object.entries((()=>{const e={};return g.forEach(s=>{const t=d.find(e=>e.id===s);t&&(e[t.role]=(e[t.role]||0)+1)}),e})()).map(([e,s])=>`${s} ${e}`).join(", ")]})]})})]}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsxs(o,{onClick:async()=>{if(0!==g.length&&v){I(!0);try{const s=(e=>{const s={"Super Admin":{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},user_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},site_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},system_logs:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},security_settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0}},Manager:{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!1,edit:!0,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},Employee:{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},products:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},employees:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},sales_reports:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},vendors:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},orders:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},licenses:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},delivery:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},"Read Only":{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},products:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},employees:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},vendors:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},orders:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}}};return s[e]||s.Employee})(v);let t=0,i=0;for(const r of g)try{const{error:e}=await window.ezsite.apis.tableUpdate(11725,{id:r,role:v,detailed_permissions:JSON.stringify(s)});e?(console.error(`Failed to update user ${r}:`,e),i++):t++}catch(e){console.error(`Error updating user ${r}:`,e),i++}u(e=>e.map(e=>g.includes(e.id)?{...e,role:v,detailed_permissions:JSON.stringify(s)}:e)),t>0&&T({title:"Bulk Assignment Complete",description:`Successfully assigned ${v} role to ${t} users${i>0?`. ${i} failed.`:""}`}),0===i&&(j([]),y(""),r?.())}catch(e){T({title:"Error",description:`Failed to process bulk assignment: ${e}`,variant:"destructive"})}finally{I(!1)}}else T({title:"Error",description:"Please select users and a target role",variant:"destructive"})},disabled:$,className:"bg-orange-600 hover:bg-orange-700 flex-1",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),$?`Processing ${g.length} users...`:`Assign ${v} to All Selected`]}),e.jsx(o,{variant:"outline",onClick:()=>{j([]),y("")},children:"Clear Selection"})]})]})})]})})]})]})},Je={"Super Admin":{icon:T,color:"bg-red-100 text-red-800 border-red-200",level:5,description:"Complete system access with all permissions",responsibilities:["Manage all users and their permissions","Configure system settings and security","Access all data and operations","System maintenance and monitoring","Final approval authority"],access:{dashboard:"✓ Full Access",products:"✓ All Operations",employees:"✓ All Operations",sales:"✓ All Operations",vendors:"✓ All Operations",orders:"✓ All Operations",inventory:"✓ All Operations",delivery:"✓ All Operations",licenses:"✓ All Operations",salary:"✓ All Operations",settings:"✓ All Operations",userManagement:"✓ Full Control",systemLogs:"✓ Full Access",security:"✓ Full Control"},whenToUse:"For IT administrators and owners who need complete system control"},Manager:{icon:ce,color:"bg-blue-100 text-blue-800 border-blue-200",level:4,description:"Full operational access with limited admin features",responsibilities:["Oversee daily business operations","Manage sales, inventory, and orders","View and generate reports","Supervise employee activities","Handle vendor relationships"],access:{dashboard:"✓ Full Access",products:"✓ All Operations",employees:"✓ View, Create, Edit",sales:"✓ All Operations",vendors:"✓ All Operations",orders:"✓ All Operations",inventory:"✓ View, Edit",delivery:"✓ All Operations",licenses:"✓ View Only",salary:"✓ View, Create, Edit",settings:"✓ Basic Settings",userManagement:"✗ No Access",systemLogs:"✓ View Only",security:"✗ No Access"},whenToUse:"For store managers and department heads who run day-to-day operations"},Supervisor:{icon:be,color:"bg-purple-100 text-purple-800 border-purple-200",level:3,description:"Department oversight with specific area management",responsibilities:["Supervise specific departments","Review and approve reports","Train and guide employees","Monitor daily operations","Assist with inventory management"],access:{dashboard:"✓ View Only",products:"✓ View, Edit",employees:"✓ View Only",sales:"✓ View, Create, Edit",vendors:"✓ View Only",orders:"✓ View, Create",inventory:"✓ View, Edit",delivery:"✓ View, Edit",licenses:"✓ View Only",salary:"✓ View Only",settings:"✗ No Access",userManagement:"✗ No Access",systemLogs:"✗ No Access",security:"✗ No Access"},whenToUse:"For assistant managers and team leaders who oversee specific areas"},Employee:{icon:ee,color:"bg-green-100 text-green-800 border-green-200",level:2,description:"Daily operations access for routine tasks",responsibilities:["Process sales transactions","Handle delivery records","Basic inventory monitoring","Customer service","Follow established procedures"],access:{dashboard:"✓ View Only",products:"✓ View Only",employees:"✗ No Access",sales:"✓ Create, Edit",vendors:"✗ No Access",orders:"✗ No Access",inventory:"✓ View Only",delivery:"✓ Create, Edit",licenses:"✗ No Access",salary:"✗ No Access",settings:"✗ No Access",userManagement:"✗ No Access",systemLogs:"✗ No Access",security:"✗ No Access"},whenToUse:"For front-line staff who handle daily customer interactions and basic operations"},"Read Only":{icon:le,color:"bg-gray-100 text-gray-800 border-gray-200",level:1,description:"View-only access for monitoring and reporting",responsibilities:["View reports and data","Monitor business metrics","Export data for analysis","Audit and compliance review","Read-only system access"],access:{dashboard:"✓ View Only",products:"✓ View Only",employees:"✓ View Only",sales:"✓ View Only",vendors:"✓ View Only",orders:"✓ View Only",inventory:"✓ View Only",delivery:"✓ View Only",licenses:"✓ View Only",salary:"✗ No Access",settings:"✗ No Access",userManagement:"✗ No Access",systemLogs:"✗ No Access",security:"✗ No Access"},whenToUse:"For auditors, accountants, and external reviewers who need read-only access"}},He={dashboard:q,products:ve,employees:ee,sales:de,vendors:ne,orders:ne,inventory:ve,delivery:ne,licenses:T,salary:ge,settings:ne,userManagement:ce,systemLogs:de,security:T},We=({trigger:s})=>{const t=e.jsxs(o,{variant:"outline",className:"border-gray-300",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Role Guide"]}),r=s=>s.startsWith("✓")?e.jsx(we,{className:"w-4 h-4 text-green-600"}):s.startsWith("✗")?e.jsx(X,{className:"w-4 h-4 text-red-600"}):e.jsx(le,{className:"w-4 h-4 text-blue-600"});return e.jsxs(S,{children:[e.jsx(A,{asChild:!0,children:s||t}),e.jsxs(k,{className:"max-w-6xl h-[90vh]",children:[e.jsx(E,{children:e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{children:"Role Definitions & Permissions Guide"}),e.jsx(c,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Reference Guide"})]})}),e.jsx(F,{className:"h-full pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{children:"Role Hierarchy"})]})}),e.jsx(a,{children:e.jsx("div",{className:"flex items-center justify-between bg-gradient-to-r from-red-50 to-gray-50 p-4 rounded-lg",children:Object.entries(Je).map(([s,t],r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`p-3 rounded-lg border-2 ${t.color}`,children:e.jsx(t.icon,{className:"w-6 h-6 mx-auto"})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-semibold text-sm",children:s}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Level ",t.level]})]})]}),r<Object.keys(Je).length-1&&e.jsx(Se,{className:"w-5 h-5 text-gray-400 mx-4"})]},s))})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Object.entries(Je).map(([s,t])=>e.jsxs(i,{className:"border-l-4",style:{borderLeftColor:t.color.includes("red")?"#ef4444":t.color.includes("blue")?"#3b82f6":t.color.includes("purple")?"#8b5cf6":t.color.includes("green")?"#10b981":"#6b7280"},children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-3",children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:s}),e.jsxs(c,{className:t.color,children:["Level ",t.level]})]}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:t.description})]})]})}),e.jsxs(a,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-700",children:"When to Use:"}),e.jsx("p",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:t.whenToUse})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Key Responsibilities:"}),e.jsx("ul",{className:"space-y-1",children:t.responsibilities.map((s,t)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start space-x-2",children:[e.jsx(we,{className:"w-3 h-3 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"System Access:"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Object.entries(t.access).map(([s,t])=>{const i=He[s]||ne;return e.jsxs("div",{className:"flex items-center justify-between text-xs p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{className:"w-3 h-3 text-gray-600"}),e.jsx("span",{className:"capitalize",children:s.replace(/([A-Z])/g," $1").trim()})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[r(t),e.jsx("span",{className:t.startsWith("✓")?"text-green-700":"text-red-700",children:t.replace("✓ ","").replace("✗ ","")})]})]},s)})})]})]})]},s))}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{children:"Quick Reference"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"High Security Roles"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsx("li",{children:"• Super Admin - IT/Owners only"}),e.jsx("li",{children:"• Full system access"}),e.jsx("li",{children:"• Can manage other users"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Operational Roles"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsx("li",{children:"• Manager - Store operations"}),e.jsx("li",{children:"• Supervisor - Department oversight"}),e.jsx("li",{children:"• Employee - Daily tasks"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Special Access"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsx("li",{children:"• Read Only - Auditors/Reviewers"}),e.jsx("li",{children:"• View reports and data"}),e.jsx("li",{children:"• No modification rights"})]})]})]})})]})]})})]})]})},Ge=()=>{const{isAdmin:t}=u(),[r,x]=s.useState([]),[m,B]=s.useState([]),[H,W]=s.useState(!0),[G,Q]=s.useState(!1),[K,Y]=s.useState(""),[Z,X]=s.useState("All"),[se,te]=s.useState("All"),[ie,le]=s.useState(!1),[oe,de]=s.useState(!1),[xe,me]=s.useState(!1),[pe,he]=s.useState(!1),[ue,ge]=s.useState(null),[je,ve]=s.useState(!1),[ye,we]=s.useState(!1),{toast:Ne}=p(),be=M(),[_e,Ce]=s.useState({role:"",station:"",is_active:!0}),Se=["Administrator","Management","Employee"],Ae=["ALL","MOBIL","AMOCO ROSEDALE","AMOCO BROOKLYN"],[ke,Re]=s.useState({user_id:0,role:"Employee",station:"MOBIL",employee_id:"",phone:"",hire_date:"",is_active:!0}),De=()=>Math.floor(1e6*Math.random())+1e5;s.useEffect(()=>{Ue();const e=setInterval(()=>{Ue()},3e4);return()=>clearInterval(e)},[]);const Ue=async()=>{W(!0),await Promise.all([$e(),Ve()]),W(!1)},Ve=async()=>{try{console.log("Fetching users from production database...");const{data:e,error:s}=await window.ezsite.apis.getUserInfo();if(s)return console.log("User info not available:",s),void x([]);console.log("Current user loaded:",e),x([e])}catch(e){console.error("Error fetching current user info:",e),x([])}},$e=async()=>{try{console.log("Fetching user profiles from production database...");const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"id",IsAsc:!1,Filters:[]});if(s)throw console.error("Database API returned error:",s),s;console.log("User profiles loaded from database:",e?.List?.length||0),B(e?.List||[])}catch(e){console.error("Error fetching user profiles:",e),Ne({title:"Database Error",description:`Failed to fetch user profiles: ${e}`,variant:"destructive"}),B([])}},Ie=m.filter(e=>{const s=e.employee_id.toLowerCase().includes(K.toLowerCase())||e.phone.toLowerCase().includes(K.toLowerCase()),t="All"===Z||e.role===Z,r="All"===se||e.station===se;return s&&t&&r}),Be=e=>{switch(e){case"Administrator":return"bg-red-100 text-red-800";case"Management":return"bg-blue-100 text-blue-800";case"Employee":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},Te=e=>{switch(e){case"ALL":return"bg-blue-100 text-blue-800";case"MOBIL":return"bg-purple-100 text-purple-800";case"AMOCO ROSEDALE":return"bg-orange-100 text-orange-800";case"AMOCO BROOKLYN":return"bg-teal-100 text-teal-800";default:return"bg-gray-100 text-gray-800"}};return t?H?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx("div",{className:"text-lg",children:"Loading real-time user management..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Real-Time User Management"}),e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"✓ Production Database Connected - Live Data & Permissions"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),m.length," Users"]}),e.jsxs(o,{onClick:async()=>{Q(!0),await Ue(),Q(!1),Ne({title:"Success",description:"Real-time data refreshed successfully"})},disabled:G,variant:"outline",className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4 "+(G?"animate-spin":"")}),e.jsx("span",{children:G?"Refreshing...":"Refresh Data"})]})]})]}),e.jsxs(g,{defaultValue:"profiles",className:"w-full",children:[e.jsxs(j,{className:"grid w-full grid-cols-2",children:[e.jsxs(v,{value:"profiles",className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"User Profiles"})]}),e.jsxs(v,{value:"permissions",className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Real-Time Permission Management"})]})]}),e.jsxs(y,{value:"profiles",className:"space-y-6",children:[e.jsxs(i,{className:"border-blue-200 bg-blue-50",children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2 text-blue-800",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:"Easy Role Assignment"}),e.jsx(c,{className:"bg-blue-100 text-blue-800",children:"Simplified"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(ze,{onRoleAssigned:()=>{$e(),Ne({title:"Success",description:"Role assignment completed successfully"})}}),e.jsx(qe,{onRolesAssigned:()=>{$e(),Ne({title:"Success",description:"Bulk role assignment completed successfully"})}}),e.jsx(We,{}),e.jsx("div",{className:"text-sm text-blue-700 max-w-md",children:"Use these simplified tools to quickly assign roles without dealing with complex permission settings."})]})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsxs(o,{onClick:()=>we(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create New User"]}),e.jsxs(S,{open:ie,onOpenChange:e=>{if(e){const e=De();Re(s=>({...s,user_id:e}))}le(e)},children:[e.jsx(A,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:"border-blue-600 text-blue-600 hover:bg-blue-50",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Add User Profile Only"]})}),e.jsxs(k,{className:"max-w-lg max-h-[85vh]",children:[e.jsx(E,{children:e.jsx(O,{children:"Create User Profile"})}),e.jsx(F,{className:"max-h-[calc(85vh-120px)] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"user_id",children:"User ID (Auto-generated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"user_id",type:"number",value:ke.user_id,readOnly:!0,disabled:!0,className:"bg-gray-50 text-gray-700 cursor-not-allowed",placeholder:"Auto-generated ID"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-200",onClick:()=>{const e=De();Re(s=>({...s,user_id:e})),Ne({title:"Success",description:`New User ID generated: ${e}`})},title:"Generate new random User ID",children:e.jsx(J,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"User ID is automatically generated. Click the refresh icon to generate a new one."})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"role",children:"Role"}),e.jsxs(P,{value:ke.role,onValueChange:e=>Re({...ke,role:e}),children:[e.jsx(L,{children:e.jsx(R,{})}),e.jsx(D,{children:Se.map(s=>e.jsx(U,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"station",children:"Station"}),e.jsxs(P,{value:ke.station,onValueChange:e=>Re({...ke,station:e}),children:[e.jsx(L,{children:e.jsx(R,{})}),e.jsx(D,{children:Ae.map(s=>e.jsx(U,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"employee_id",children:"Employee ID *"}),e.jsx(h,{id:"employee_id",value:ke.employee_id,onChange:e=>Re({...ke,employee_id:e.target.value}),placeholder:"Enter employee ID",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone",children:"Phone *"}),e.jsx(h,{id:"phone",value:ke.phone,onChange:e=>Re({...ke,phone:e.target.value}),placeholder:"Enter phone number",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"hire_date",children:"Hire Date"}),e.jsx(h,{id:"hire_date",type:"date",value:ke.hire_date,onChange:e=>Re({...ke,hire_date:e.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:ke.is_active,onChange:e=>Re({...ke,is_active:e.target.checked})}),e.jsx(d,{htmlFor:"is_active",children:"Active User"})]}),e.jsx(o,{onClick:async()=>{if(ke.employee_id&&ke.phone)try{console.log("Creating new user profile:",ke);const{error:e}=await window.ezsite.apis.tableCreate(11725,ke);if(e)throw e;Ne({title:"Success",description:"User profile created successfully"}),le(!1),Re({user_id:De(),role:"Employee",station:"MOBIL",employee_id:"",phone:"",hire_date:"",is_active:!0}),$e()}catch(e){console.error("Error creating profile:",e),Ne({title:"Database Error",description:`Failed to create user profile: ${e}`,variant:"destructive"})}else Ne({title:"Validation Error",description:"Employee ID and Phone are required fields",variant:"destructive"})},className:"w-full",children:"Create Profile"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ee,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:m.length})]})]})})}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Administrators"}),e.jsx("p",{className:"text-2xl font-bold",children:m.filter(e=>"Administrator"===e.role).length})]})]})})}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ce,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:m.filter(e=>e.is_active).length})]})]})})}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"With Permissions"}),e.jsx("p",{className:"text-2xl font-bold",children:m.filter(e=>{try{const s=JSON.parse(e.detailed_permissions||"{}");return Object.keys(s).length>0}catch{return!1}}).length})]})]})})})]}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(h,{placeholder:"Search by employee ID or phone...",value:K,onChange:e=>Y(e.target.value),className:"pl-10"})]}),e.jsxs(P,{value:Z,onValueChange:X,children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Filter by role"})}),e.jsxs(D,{children:[e.jsx(U,{value:"All",children:"All Roles"}),Se.map(s=>e.jsx(U,{value:s,children:s},s))]})]}),e.jsxs(P,{value:se,onValueChange:te,children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Filter by station"})}),e.jsxs(D,{children:[e.jsx(U,{value:"All",children:"All Stations"}),Ae.map(s=>e.jsx(U,{value:s,children:s},s))]})]}),e.jsx(o,{variant:"outline",onClick:()=>{Y(""),X("All"),te("All")},children:"Clear Filters"})]})})}),e.jsx($,{selectedCount:be.selectedCount,onBatchEdit:()=>{0!==be.getSelectedData(Ie,e=>e.id).length?me(!0):Ne({title:"No Selection",description:"Please select profiles to edit",variant:"destructive"})},onBatchDelete:()=>{0!==be.getSelectedData(Ie,e=>e.id).length?he(!0):Ne({title:"No Selection",description:"Please select profiles to delete",variant:"destructive"})},onClearSelection:be.clearSelection,isLoading:je}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{children:["Real-Time User Profiles (",Ie.length,")"]})}),e.jsx(a,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs(N,{children:[e.jsx(b,{className:"w-12",children:e.jsx(V,{checked:Ie.length>0&&be.selectedCount===Ie.length,onCheckedChange:()=>be.toggleSelectAll(Ie,e=>e.id),"aria-label":"Select all profiles"})}),e.jsx(b,{children:"Employee ID"}),e.jsx(b,{children:"Role"}),e.jsx(b,{children:"Station"}),e.jsx(b,{children:"Phone"}),e.jsx(b,{children:"Hire Date"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Permissions"}),e.jsx(b,{children:"Actions"})]})}),e.jsx(_,{children:0===Ie.length?e.jsx(N,{children:e.jsx(C,{colSpan:9,className:"text-center py-8",children:e.jsx("div",{className:"flex flex-col items-center space-y-3",children:0===m.length?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-12 h-12 text-gray-300"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-medium",children:"No User Profiles in Database"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first user profile to get started"})]}),e.jsxs(o,{onClick:()=>we(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create First User"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-12 h-12 text-gray-300"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-medium",children:"No Profiles Match Current Filters"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Try adjusting your search criteria"})]}),e.jsx(o,{variant:"outline",onClick:()=>{Y(""),X("All"),te("All")},children:"Clear All Filters"})]})})})}):Ie.map(s=>e.jsxs(N,{className:be.isSelected(s.id)?"bg-blue-50":"",children:[e.jsx(C,{children:e.jsx(V,{checked:be.isSelected(s.id),onCheckedChange:()=>be.toggleItem(s.id),"aria-label":`Select profile ${s.employee_id}`})}),e.jsx(C,{className:"font-medium",children:s.employee_id}),e.jsx(C,{children:e.jsx(c,{className:Be(s.role),children:s.role})}),e.jsx(C,{children:e.jsx(c,{className:Te(s.station),children:s.station})}),e.jsx(C,{children:s.phone}),e.jsx(C,{children:s.hire_date?new Date(s.hire_date).toLocaleDateString():"N/A"}),e.jsx(C,{children:e.jsx(c,{className:s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:s.is_active?"Active":"Inactive"})}),e.jsx(C,{children:(()=>{const t=(e=>{try{if(!e.detailed_permissions||""===e.detailed_permissions.trim()||"{}"===e.detailed_permissions)return{summary:"No permissions set",details:"Permissions not configured",hasAccess:!1,viewCount:0,editCount:0,createCount:0};const s=JSON.parse(e.detailed_permissions),t=["dashboard","products","employees","sales_reports","vendors","orders","licenses","salary","inventory","delivery","settings","user_management","site_management","system_logs","security_settings"],r=t.filter(e=>s[e]?.view).length,i=t.filter(e=>s[e]?.edit).length,a=t.filter(e=>s[e]?.create).length;return{summary:`${r}/${t.length} areas`,details:`View: ${r}, Edit: ${i}, Create: ${a}`,hasAccess:r>0,viewCount:r,editCount:i,createCount:a}}catch{return{summary:"Invalid permissions",details:"Permission data corrupted",hasAccess:!1,viewCount:0,editCount:0,createCount:0}}})(s);return e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{variant:t.hasAccess?"default":"secondary",className:t.hasAccess?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600",children:t.summary}),e.jsx("p",{className:"text-xs text-gray-500",children:t.details})]})})()}),e.jsx(C,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>(e=>{ge(e),Re({user_id:e.user_id,role:e.role,station:e.station,employee_id:e.employee_id,phone:e.phone,hire_date:e.hire_date||"",is_active:e.is_active}),de(!0)})(s),children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx(ze,{selectedUserId:s.id,trigger:e.jsx(o,{size:"sm",variant:"outline",className:"text-green-600 hover:text-green-700",title:"Quick Role Assignment",children:e.jsx(T,{className:"w-4 h-4"})}),onRoleAssigned:()=>{$e(),Ne({title:"Success",description:"Role updated successfully"})}}),e.jsx(Me,{selectedUserId:s.id,trigger:e.jsx(o,{size:"sm",variant:"outline",className:"text-blue-600 hover:text-blue-700",title:"Advanced Permission Management",children:e.jsx(ne,{className:"w-4 h-4"})})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this user profile? This action cannot be undone."))try{console.log("Deleting user profile:",e);const{error:s}=await window.ezsite.apis.tableDelete(11725,{id:e});if(s)throw s;Ne({title:"Success",description:"User profile deleted successfully"}),$e()}catch(s){console.error("Error deleting profile:",s),Ne({title:"Database Error",description:`Failed to delete user profile: ${s}`,variant:"destructive"})}})(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(re,{className:"w-4 h-4"})})]})})]},s.id))})]})})})]}),e.jsx(S,{open:oe,onOpenChange:de,children:e.jsxs(k,{className:"max-w-2xl",children:[e.jsx(E,{children:e.jsx(O,{children:"Edit User Profile"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_role",children:"Role"}),e.jsxs(P,{value:ke.role,onValueChange:e=>Re({...ke,role:e}),children:[e.jsx(L,{children:e.jsx(R,{})}),e.jsx(D,{children:Se.map(s=>e.jsx(U,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_station",children:"Station"}),e.jsxs(P,{value:ke.station,onValueChange:e=>Re({...ke,station:e}),children:[e.jsx(L,{children:e.jsx(R,{})}),e.jsx(D,{children:Ae.map(s=>e.jsx(U,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_employee_id",children:"Employee ID *"}),e.jsx(h,{id:"edit_employee_id",value:ke.employee_id,onChange:e=>Re({...ke,employee_id:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_phone",children:"Phone *"}),e.jsx(h,{id:"edit_phone",value:ke.phone,onChange:e=>Re({...ke,phone:e.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_hire_date",children:"Hire Date"}),e.jsx(h,{id:"edit_hire_date",type:"date",value:ke.hire_date,onChange:e=>Re({...ke,hire_date:e.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit_is_active",checked:ke.is_active,onChange:e=>Re({...ke,is_active:e.target.checked})}),e.jsx(d,{htmlFor:"edit_is_active",children:"Active User"})]}),e.jsx(o,{onClick:async()=>{if(ue)if(ke.employee_id&&ke.phone)try{console.log("Updating user profile:",ue.id,ke);const{error:e}=await window.ezsite.apis.tableUpdate(11725,{id:ue.id,...ke});if(e)throw e;Ne({title:"Success",description:"User profile updated successfully"}),de(!1),ge(null),$e()}catch(e){console.error("Error updating profile:",e),Ne({title:"Database Error",description:`Failed to update user profile: ${e}`,variant:"destructive"})}else Ne({title:"Validation Error",description:"Employee ID and Phone are required fields",variant:"destructive"})},className:"w-full",children:"Update Profile"})]})]})})]}),e.jsx(y,{value:"permissions",children:e.jsx(Le,{})})]}),e.jsx(z,{isOpen:xe,onClose:()=>me(!1),onSave:async()=>{ve(!0);try{const e=be.getSelectedData(Ie,e=>e.id);console.log("Batch editing user profiles:",e.length);const s=e.map(e=>({id:e.id,..._e.role&&{role:_e.role},..._e.station&&{station:_e.station},is_active:_e.is_active}));for(const t of s){const{error:e}=await window.ezsite.apis.tableUpdate(11725,t);if(e)throw e}Ne({title:"Success",description:`Updated ${e.length} user profiles successfully`}),me(!1),be.clearSelection(),$e()}catch(e){console.error("Error in batch edit:",e),Ne({title:"Database Error",description:`Failed to update profiles: ${e}`,variant:"destructive"})}finally{ve(!1)}},selectedCount:be.selectedCount,isLoading:je,itemName:"user profiles",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"batch_role",children:"Role"}),e.jsxs(P,{value:_e.role,onValueChange:e=>Ce({..._e,role:e}),children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Select role to update"})}),e.jsxs(D,{children:[e.jsx(U,{value:"",children:"Keep existing roles"}),Se.map(s=>e.jsx(U,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"batch_station",children:"Station"}),e.jsxs(P,{value:_e.station,onValueChange:e=>Ce({..._e,station:e}),children:[e.jsx(L,{children:e.jsx(R,{placeholder:"Select station to update"})}),e.jsxs(D,{children:[e.jsx(U,{value:"",children:"Keep existing stations"}),Ae.map(s=>e.jsx(U,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"batch_is_active",checked:_e.is_active,onCheckedChange:e=>Ce({..._e,is_active:e})}),e.jsx(d,{htmlFor:"batch_is_active",children:"Set all selected users as active"})]})]})}),e.jsx(I,{isOpen:pe,onClose:()=>he(!1),onConfirm:async()=>{ve(!0);try{const e=be.getSelectedData(Ie,e=>e.id);console.log("Batch deleting user profiles:",e.length);for(const s of e){const{error:e}=await window.ezsite.apis.tableDelete(11725,{id:s.id});if(e)throw e}Ne({title:"Success",description:`Deleted ${e.length} user profiles successfully`}),he(!1),be.clearSelection(),$e()}catch(e){console.error("Error in batch delete:",e),Ne({title:"Database Error",description:`Failed to delete profiles: ${e}`,variant:"destructive"})}finally{ve(!1)}},selectedCount:be.selectedCount,isLoading:je,itemName:"user profiles",selectedItems:be.getSelectedData(Ie,e=>e.id).map(e=>({id:e.id,name:`${e.employee_id} - ${e.role}`}))}),e.jsx(Pe,{isOpen:ye,onClose:()=>we(!1),onUserCreated:()=>{Ue(),Ne({title:"Success",description:"New user account and profile created successfully in production database"})}})]}):e.jsx(Fe,{feature:"User Management",requiredRole:"Administrator"})};export{Ge as default};
