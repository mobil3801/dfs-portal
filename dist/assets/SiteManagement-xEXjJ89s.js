import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{u as a,l as t,D as i,a as n,b as r,c as l,L as o,I as c,e as d,v as m,C as x,h,f as g,g as u,B as p}from"./index-MtEqlP9w.js";import{S as j}from"./switch-DeYgkLk2.js";import{T as v}from"./textarea-C6nhb218.js";import{u as N,B as w,C as b,a as S}from"./BatchDeleteDialog-BBOsxq3a.js";import{s as f}from"./stationService-DqouK_X1.js";import{B as y}from"./BatchEditDialog-D1OH37Dc.js";import{S as _,c as C,d as F,a as A,b as M}from"./select-D0O4Kb7R.js";import{aa as E,T as D,X as k,Q as L,C as O,S as T,R as I,ax as R,v as P,g as q,W as $,Z as z,V as B,ac as U,a7 as G,n as V,ab as H,I as K}from"./utilities-BBdJI3Xi.js";import{A as Q}from"./AccessDenied-ClLBz1Lo.js";import"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";let W={stations:[],stationOptions:[],loading:!1,error:null,lastUpdated:0};const X=new Set,Y=e=>{W={...W,...e},X.forEach(e=>e(W))},Z=()=>{const{userProfile:e}=a(),{toast:i}=t(),[n,r]=s.useState(W);s.useEffect(()=>{var e;return e=r,X.add(e),()=>X.delete(e)},[]);const l=s.useCallback(async(s=!1)=>{if(n.loading)return;const a=Date.now()-n.lastUpdated<12e4;if(!(!s&&a&&n.stations.length>0)){Y({loading:!0,error:null});try{const[s,a]=await Promise.all([f.getStations(),f.getStationOptions(!0,e?.role,e?.permissions)]);Y({stations:s,stationOptions:a,loading:!1,error:null,lastUpdated:Date.now()})}catch(t){const e=t instanceof Error?t.message:"Failed to load stations";Y({loading:!1,error:e}),i({title:"Error",description:e,variant:"destructive"})}}},[e?.role,e?.permissions,i,n.loading,n.lastUpdated,n.stations.length]),o=s.useCallback(async e=>{try{Y({loading:!0,error:null});if(n.stations.find(s=>s.name.toLowerCase()===e.name.toLowerCase()||s.station_name?.toLowerCase()===e.name.toLowerCase()))throw new Error(`Station "${e.name}" already exists`);const s=await f.addStation(e);if(!s.success)throw new Error(s.error||"Failed to add station");return await l(!0),i({title:"Success",description:`Station "${e.name}" added successfully and is now available in all dropdowns`}),{success:!0}}catch(s){const e=s.message||"Failed to add station";return Y({loading:!1,error:e}),i({title:"Error",description:e,variant:"destructive"}),{success:!1,error:e}}},[n.stations,l,i]),c=s.useCallback(async e=>{try{Y({loading:!0,error:null});const s=await f.updateStation(e);if(!s.success)throw new Error(s.error||"Failed to update station");return await l(!0),i({title:"Success",description:`Station "${e.name}" updated successfully`}),{success:!0}}catch(s){const e=s.message||"Failed to update station";return Y({loading:!1,error:e}),i({title:"Error",description:e,variant:"destructive"}),{success:!1,error:e}}},[l,i]),d=s.useCallback(async e=>{try{Y({loading:!0,error:null});const s=await f.deleteStation(e);if(!s.success)throw new Error(s.error||"Failed to delete station");return await l(!0),i({title:"Success",description:"Station deleted successfully"}),{success:!0}}catch(s){const e=s.message||"Failed to delete station";return Y({loading:!1,error:e}),i({title:"Error",description:e,variant:"destructive"}),{success:!1,error:e}}},[l,i]),m=s.useCallback((s=!0)=>{let a=[...n.stationOptions];const t="Administrator"===e?.role||"Management"===e?.role||"Manager"===e?.role||e?.permissions?.includes("view_all_stations");if(s&&t){const e={value:"ALL_STATIONS",label:"All Stations",color:"bg-indigo-600"};a=a.filter(e=>"ALL_STATIONS"!==e.value&&"ALL"!==e.value),a.unshift(e)}return a},[n.stationOptions,e?.role,e?.permissions]);return s.useEffect(()=>{0!==n.stations.length||n.loading||l()},[n.stations.length,n.loading,l]),{stations:n.stations,stationOptions:n.stationOptions,loading:n.loading,error:n.error,loadStations:l,addStation:o,updateStation:c,deleteStation:d,getFilteredStationOptions:m,isDataFresh:Date.now()-n.lastUpdated<12e4,getStationColor:f.getStationColor.bind(f),canSelectAll:()=>"Administrator"===e?.role||"Management"===e?.role||"Manager"===e?.role||e?.permissions?.includes("view_all_stations")||!1}},J=({open:a,onOpenChange:m,station:x,onSave:h,mode:g})=>{const{toast:u}=t(),{addStation:p,updateStation:j,stations:N}=Z(),[w,b]=s.useState(!1),[S,f]=s.useState({}),[y,T]=s.useState({station_name:"",address:"",phone:"",operating_hours:"",manager_name:"",status:"Active"});s.useEffect(()=>{x&&"edit"===g?T({id:x.id,station_name:x.station_name||"",address:x.address||"",phone:x.phone||"",operating_hours:x.operating_hours||"",manager_name:x.manager_name||"",status:x.status||"Active"}):"add"===g&&T({station_name:"",address:"",phone:"",operating_hours:"",manager_name:"",status:"Active"}),f({})},[x,g,a]);const I=()=>{w||m(!1)};return e.jsx(i,{open:a,onOpenChange:I,children:e.jsxs(n,{className:"sm:max-w-md",children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{children:"add"===g?"Add New Station":"Edit Station"})]})}),e.jsxs("form",{onSubmit:async s=>{s.preventDefault(),b(!0),f({});try{const s={};if(y.station_name.trim()?y.station_name.trim().length<2&&(s.station_name="Station name must be at least 2 characters"):s.station_name="Station name is required",y.address.trim()||(s.address="Address is required"),y.phone.trim()?/^[\+]?[\d\s\-\(\)]{10,}$/.test(y.phone.trim())||(s.phone="Please enter a valid phone number"):s.phone="Phone number is required",y.operating_hours.trim()||(s.operating_hours="Operating hours are required"),y.manager_name.trim()||(s.manager_name="Manager name is required"),"add"===g){N.find(e=>e.name?.toLowerCase()===y.station_name.trim().toLowerCase()||e.station_name?.toLowerCase()===y.station_name.trim().toLowerCase())&&(s.station_name=`Station "${y.station_name}" already exists`)}if(Object.keys(s).length>0)return f(s),void u({title:"Validation Error",description:"Please fix the errors below",variant:"destructive"});const a={name:y.station_name.trim(),station_name:y.station_name.trim(),address:y.address.trim(),phone:y.phone.trim(),operating_hours:y.operating_hours.trim(),manager_name:y.manager_name.trim(),status:y.status,active:"Active"===y.status,notes:y.operating_hours.trim(),station_id:"add"===g?y.station_name.trim().toLowerCase().replace(/\s+/g,"-"):x?.station_id||y.station_name.trim().toLowerCase().replace(/\s+/g,"-")};let t;t="add"===g?await p(a):await j({...a,id:x?.id||"",created_at:x?.created_at,updated_at:(new Date).toISOString()}),t.success&&(h(),m(!1),u({title:"Success!",description:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:['Station "',y.station_name,'" ',"add"===g?"created":"updated","and is now available in all station dropdowns"]})]})}))}catch(a){console.error("Error saving station:",a),u({title:"Error",description:"string"==typeof a?a:"Failed to save station",variant:"destructive"})}finally{b(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"station_name",children:"Station Name *"}),e.jsx(c,{id:"station_name",value:y.station_name,onChange:e=>T({...y,station_name:e.target.value}),placeholder:"e.g., MOBIL, AMOCO ROSEDALE",required:!0,className:S.station_name?"border-red-500":""}),S.station_name&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center space-x-1",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:S.station_name})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"address",children:"Address *"}),e.jsx(v,{id:"address",value:y.address,onChange:e=>T({...y,address:e.target.value}),placeholder:"Complete station address",required:!0,rows:2,className:S.address?"border-red-500":""}),S.address&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center space-x-1",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:S.address})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"phone",children:"Phone Number *"}),e.jsx(c,{id:"phone",type:"tel",value:y.phone,onChange:e=>T({...y,phone:e.target.value}),placeholder:"(555) 123-4567",required:!0,className:S.phone?"border-red-500":""}),S.phone&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center space-x-1",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:S.phone})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"operating_hours",children:"Operating Hours *"}),e.jsx(c,{id:"operating_hours",value:y.operating_hours,onChange:e=>T({...y,operating_hours:e.target.value}),placeholder:"e.g., 24/7 or 6:00 AM - 12:00 AM",required:!0,className:S.operating_hours?"border-red-500":""}),S.operating_hours&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center space-x-1",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:S.operating_hours})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"manager_name",children:"Manager Name *"}),e.jsx(c,{id:"manager_name",value:y.manager_name,onChange:e=>T({...y,manager_name:e.target.value}),placeholder:"Station manager name",required:!0,className:S.manager_name?"border-red-500":""}),S.manager_name&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center space-x-1",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:S.manager_name})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"status",children:"Status"}),e.jsxs(_,{value:y.status,onValueChange:e=>T({...y,status:e}),children:[e.jsx(C,{children:e.jsx(F,{placeholder:"Select status"})}),e.jsxs(A,{children:[e.jsx(M,{value:"Active",children:"Active"}),e.jsx(M,{value:"Inactive",children:"Inactive"}),e.jsx(M,{value:"Maintenance",children:"Maintenance"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsxs(d,{type:"button",variant:"outline",onClick:I,disabled:w,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs(d,{type:"submit",disabled:w,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),w?"Saving...":"add"===g?"Add Station":"Update Station"]})]})]})]})})},ee=()=>{const{isAdmin:a}=m(),[i,n]=s.useState({siteName:"DFS Manager Portal",siteDescription:"Comprehensive gas station management system",enableRegistration:!1,enableNotifications:!0,enableMaintenance:!1,maintenanceMessage:"System is under maintenance. Please check back later.",emailFromAddress:"support@ezsite.ai",emailFromName:"DFS Manager Support",maxFileSize:10,allowedFileTypes:"jpg,jpeg,png,pdf,doc,docx,xls,xlsx",sessionTimeout:30,passwordMinLength:8,requirePasswordComplexity:!0,enableTwoFactor:!1,backupFrequency:"daily",logRetentionDays:30}),{stations:r,loading:l,deleteStation:f,updateStation:_}=Z(),[C,F]=s.useState(null),[A,M]=s.useState(!1),[D,k]=s.useState("add"),[W,X]=s.useState(!1),[Y,ee]=s.useState(!1),[se,ae]=s.useState(!1),[te,ie]=s.useState(!1),[ne,re]=s.useState(!1),{toast:le}=t(),oe=N(),[ce,de]=s.useState({status:"",manager_name:"",operating_hours:""}),me=e=>e?"bg-green-100 text-green-800":"bg-red-100 text-red-800";return a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-8 h-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Site Management"})]}),e.jsx(d,{onClick:async()=>{re(!0);try{await new Promise(e=>setTimeout(e,1e3)),le({title:"Success",description:"Site settings saved successfully"})}catch(e){console.error("Error saving settings:",e),le({title:"Error",description:"Failed to save settings",variant:"destructive"})}finally{re(!1)}},disabled:ne,className:"bg-blue-600 hover:bg-blue-700",children:ne?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"System Status"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:"Online"})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(R,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Database"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:"Connected"})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email Service"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600",children:"Active"})]})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Security"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600",children:"Protected"})]})]})})})]}),e.jsx(w,{selectedCount:oe.selectedCount,onBatchEdit:()=>{0!==oe.getSelectedData(r,e=>e.id).length?X(!0):le({title:"No Selection",description:"Please select stations to edit",variant:"destructive"})},onBatchDelete:()=>{0!==oe.getSelectedData(r,e=>e.id).length?ee(!0):le({title:"No Selection",description:"Please select stations to delete",variant:"destructive"})},onClearSelection:oe.clearSelection,isLoading:se}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(u,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{children:"Station Information"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{onClick:()=>{F(null),k("add"),M(!0)},className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Add Station"]}),0===r.length&&e.jsxs(d,{onClick:()=>window.open("/dashboard?tab=setup","_blank"),variant:"outline",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Setup Guide"]}),r.length>0&&e.jsx(b,{checked:r.length>0&&oe.selectedCount===r.length,onCheckedChange:()=>oe.toggleSelectAll(r,e=>e.id),"aria-label":"Select all stations"})]})]})}),e.jsx(h,{children:l?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(s=>e.jsx(x,{className:"border animate-pulse",children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})})},s))}):0===r.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No Stations Configured"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Set up your gas stations (MOBIL, AMOCO ROSEDALE, AMOCO BROOKLYN) to get started."}),e.jsxs(d,{onClick:()=>window.open("/dashboard?tab=setup","_blank"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Go to Setup Guide"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:r.map((s,a)=>e.jsx(x,{className:"border "+(oe.isSelected(s.id)?"bg-blue-50 border-blue-200":""),children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{checked:oe.isSelected(s.id),onCheckedChange:()=>oe.toggleItem(s.id),"aria-label":`Select station ${s.station_name}`}),e.jsx("h3",{className:"font-semibold text-lg",children:s.station_name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:""+("Active"===s.status?"bg-green-100 text-green-800":"Inactive"===s.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:s.status}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>(e=>{F(e),k("edit"),M(!0)})(s),className:"h-8 w-8 p-0",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:async()=>{if(window.confirm(`Are you sure you want to delete "${s.station_name}"?`)){const e=await f(s.id.toString());e.success||le({title:"Error",description:e.error||"Failed to delete station",variant:"destructive"})}},className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(B,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.address})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.phone})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.operating_hours})]}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Manager: ",s.manager_name]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Updated: ",new Date(s.last_updated).toLocaleDateString()]})]})]})]})})},s.id||a))})})]}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"General Settings"})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"siteName",children:"Site Name"}),e.jsx(c,{id:"siteName",value:i.siteName,onChange:e=>n({...i,siteName:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"siteDescription",children:"Site Description"}),e.jsx(c,{id:"siteDescription",value:i.siteDescription,onChange:e=>n({...i,siteDescription:e.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"maintenanceMessage",children:"Maintenance Message"}),e.jsx(v,{id:"maintenanceMessage",value:i.maintenanceMessage,onChange:e=>n({...i,maintenanceMessage:e.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(o,{children:"User Registration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow new user registration"})]}),e.jsx(j,{checked:i.enableRegistration,onCheckedChange:e=>n({...i,enableRegistration:e})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enable system notifications"})]}),e.jsx(j,{checked:i.enableNotifications,onCheckedChange:e=>n({...i,enableNotifications:e})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Maintenance Mode"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Put site in maintenance"})]}),e.jsx(j,{checked:i.enableMaintenance,onCheckedChange:e=>n({...i,enableMaintenance:e})})]})]})]})]}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{children:"Email Configuration"})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"emailFromName",children:"From Name"}),e.jsx(c,{id:"emailFromName",value:i.emailFromName,onChange:e=>n({...i,emailFromName:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"emailFromAddress",children:"From Address"}),e.jsx(c,{id:"emailFromAddress",type:"email",value:i.emailFromAddress,onChange:e=>n({...i,emailFromAddress:e.target.value})})]})]}),e.jsxs(d,{onClick:async()=>{try{const{error:e}=await window.ezsite.apis.sendEmail({from:`${i.emailFromName} <${i.emailFromAddress}>`,to:[i.emailFromAddress],subject:"DFS Manager - Email Configuration Test",html:`\n          <h2>Email Configuration Test</h2>\n          <p>This is a test email to verify your email configuration is working correctly.</p>\n          <p><strong>Site:</strong> ${i.siteName}</p>\n          <p><strong>Time:</strong> ${(new Date).toLocaleString()}</p>\n          <hr>\n          <p>If you received this email, your configuration is working properly.</p>\n        `});if(e)throw e;le({title:"Test Email Sent",description:"Check your inbox for the test email"})}catch(e){console.error("Error sending test email:",e),le({title:"Error",description:"Failed to send test email",variant:"destructive"})}},variant:"outline",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Send Test Email"]})]})]}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{children:"Security Settings"})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"sessionTimeout",children:"Session Timeout (minutes)"}),e.jsx(c,{id:"sessionTimeout",type:"number",value:i.sessionTimeout,onChange:e=>n({...i,sessionTimeout:parseInt(e.target.value)||30})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"passwordMinLength",children:"Password Min Length"}),e.jsx(c,{id:"passwordMinLength",type:"number",value:i.passwordMinLength,onChange:e=>n({...i,passwordMinLength:parseInt(e.target.value)||8})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"logRetentionDays",children:"Log Retention (days)"}),e.jsx(c,{id:"logRetentionDays",type:"number",value:i.logRetentionDays,onChange:e=>n({...i,logRetentionDays:parseInt(e.target.value)||30})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Password Complexity"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Require complex passwords"})]}),e.jsx(j,{checked:i.requirePasswordComplexity,onCheckedChange:e=>n({...i,requirePasswordComplexity:e})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enable 2FA for all users"})]}),e.jsx(j,{checked:i.enableTwoFactor,onCheckedChange:e=>n({...i,enableTwoFactor:e})})]})]})]})]}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"File Upload Settings"})]})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"maxFileSize",children:"Max File Size (MB)"}),e.jsx(c,{id:"maxFileSize",type:"number",value:i.maxFileSize,onChange:e=>n({...i,maxFileSize:parseInt(e.target.value)||10})})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"allowedFileTypes",children:"Allowed File Types"}),e.jsx(c,{id:"allowedFileTypes",value:i.allowedFileTypes,onChange:e=>n({...i,allowedFileTypes:e.target.value}),placeholder:"jpg,png,pdf,doc"})]})]})})]}),e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Configuration"})]})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Registration"}),e.jsx(p,{className:me(i.enableRegistration),children:i.enableRegistration?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Notifications"}),e.jsx(p,{className:me(i.enableNotifications),children:i.enableNotifications?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Maintenance"}),e.jsx(p,{className:me(i.enableMaintenance),children:i.enableMaintenance?"Active":"Inactive"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Two-Factor"}),e.jsx(p,{className:me(i.enableTwoFactor),children:i.enableTwoFactor?"Required":"Optional"})]})]})})]}),e.jsx(J,{open:A,onOpenChange:M,station:C,onSave:handleStationSaved,mode:D}),e.jsx(J,{open:A,onOpenChange:M,mode:D,station:C,onSuccess:e=>{M(!1),F(null)}}),e.jsx(y,{isOpen:W,onClose:()=>X(!1),onSave:async()=>{ae(!0);try{const e=oe.getSelectedData(r,e=>e.id);for(const s of e){const e={...s,...ce.status&&{status:ce.status},...ce.manager_name&&{manager_name:ce.manager_name},...ce.operating_hours&&{operating_hours:ce.operating_hours}},a=await _(e);if(!a.success)throw new Error(a.error||`Failed to update ${s.station_name}`)}le({title:"Success",description:`Updated ${e.length} stations successfully`}),X(!1),oe.clearSelection()}catch(e){console.error("Error in batch edit:",e),le({title:"Error",description:e.message||"Failed to update stations",variant:"destructive"})}finally{ae(!1)}},selectedCount:oe.selectedCount,isLoading:se,itemName:"stations",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"batch_status",children:"Status"}),e.jsxs("select",{id:"batch_status",title:"Station Status",value:ce.status,onChange:e=>de({...ce,status:e.target.value}),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Keep existing status"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"batch_manager",children:"Manager Name"}),e.jsx(c,{id:"batch_manager",value:ce.manager_name,onChange:e=>de({...ce,manager_name:e.target.value}),placeholder:"Leave empty to keep existing managers"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"batch_hours",children:"Operating Hours"}),e.jsx(c,{id:"batch_hours",value:ce.operating_hours,onChange:e=>de({...ce,operating_hours:e.target.value}),placeholder:"Leave empty to keep existing hours"})]})]})}),e.jsx(S,{isOpen:Y,onClose:()=>ee(!1),onConfirm:async()=>{ae(!0);try{const e=oe.getSelectedData(r,e=>e.id);for(const s of e){const e=await f(s.id);if(!e.success)throw new Error(e.error||`Failed to delete ${s.station_name}`)}le({title:"Success",description:`Deleted ${e.length} stations successfully`}),ee(!1),oe.clearSelection()}catch(e){console.error("Error in batch delete:",e),le({title:"Error",description:e.message||"Failed to delete stations",variant:"destructive"})}finally{ae(!1)}},selectedCount:oe.selectedCount,isLoading:se,itemName:"stations",selectedItems:oe.getSelectedData(r,e=>e.id).map(e=>({id:e.id,name:e.station_name}))})]}):e.jsx(Q,{feature:"Site Management",requiredRole:"Administrator"})};export{ee as default};
