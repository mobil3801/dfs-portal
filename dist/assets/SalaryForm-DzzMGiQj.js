import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{l as a,e as r,C as t,f as i,g as d,k as l,h as o,L as n,I as c}from"./index-BJg4_aev.js";import{N as h}from"./number-input-KV-cjSGf.js";import{T as m}from"./textarea-C4IJWV4T.js";import{S as p,c as y,d as u,a as x,b as _}from"./select-DCbSmMef.js";import{g as j,a as v,b as g,v as f,c as N,d as b}from"./payPeriodUtils-G1zG_LNG.js";import{d as w,u as S}from"./routing-DcURAnU1.js";import{O as C,K as F,n as P,f as O,D,Q as E}from"./utilities-DMEd7dY0.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";const M=()=>{const{id:M}=w(),k=S(),{toast:A}=a(),I=Boolean(M&&"new"!==M),[B,R]=s.useState([]),[q,L]=s.useState(!1),[V,z]=s.useState(()=>{const e=j();return{employee_id:"",pay_period_start:v(e.startDate),pay_period_end:v(e.endDate),pay_date:v(e.payDate),pay_frequency:"Weekly",base_salary:0,hourly_rate:0,regular_hours:0,assign_hours:0,overtime_hours:0,overtime_rate:0,overtime_pay:0,bonus_amount:0,commission:0,gross_pay:0,federal_tax:0,state_tax:0,social_security:0,medicare:0,health_insurance:0,retirement_401k:0,other_deductions:0,total_deductions:0,net_pay:0,station:"MOBIL",status:"Pending",notes:"",created_by:1}}),[U]=s.useState(()=>g()),[H,W]=s.useState({isValid:!0,errors:[]}),Q="11788";s.useEffect(()=>{G(),I&&K()},[M]),s.useEffect(()=>{$()},[V.hourly_rate,V.regular_hours,V.overtime_rate,V.overtime_hours,V.bonus_amount,V.commission,V.health_insurance,V.retirement_401k,V.other_deductions]),s.useEffect(()=>{if(V.pay_period_start&&V.pay_period_end){const e=f(V.pay_period_start,V.pay_period_end);W(e)}},[V.pay_period_start,V.pay_period_end]);const G=async()=>{try{const{data:e,error:s}=await window.ezsite.apis.tablePage("11727",{PageNo:1,PageSize:1e3,OrderByField:"first_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(s)throw s;R(e?.List||[])}catch(e){console.error("Error fetching employees:",e),A({title:"Error",description:"Failed to fetch employee data",variant:"destructive"})}},K=async()=>{if(M&&"new"!==M){L(!0);try{const{data:e,error:s}=await window.ezsite.apis.tablePage(Q,{PageNo:1,PageSize:1,Filters:[{name:"id",op:"Equal",value:parseInt(M)}]});if(s)throw s;if(e?.List&&e.List.length>0){const s=e.List[0];z({...s,pay_period_start:C(new Date(s.pay_period_start),"yyyy-MM-dd"),pay_period_end:C(new Date(s.pay_period_end),"yyyy-MM-dd"),pay_date:C(new Date(s.pay_date),"yyyy-MM-dd")})}}catch(e){console.error("Error fetching salary record:",e),A({title:"Error",description:"Failed to fetch salary record",variant:"destructive"})}finally{L(!1)}}},$=()=>{const e=V.overtime_rate*V.overtime_hours,s=V.hourly_rate*V.regular_hours+V.bonus_amount+V.commission+e,a=s-(V.health_insurance+V.retirement_401k+V.other_deductions);z(r=>({...r,overtime_pay:e,gross_pay:s,net_pay:a}))},T=(e,s)=>{z(a=>({...a,[e]:s}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"ghost",onClick:()=>k("/salary"),children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Back to Salary Records"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:I?"Edit Salary Record":"Create Salary Record"}),e.jsx("p",{className:"text-muted-foreground",children:I?"Update salary record details":"Add a new salary record for payroll processing"})]})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),L(!0);try{const e={...V,pay_period_start:new Date(V.pay_period_start).toISOString(),pay_period_end:new Date(V.pay_period_end).toISOString(),pay_date:new Date(V.pay_date).toISOString()};if(I){const{error:s}=await window.ezsite.apis.tableUpdate(Q,{ID:parseInt(M),...e});if(s)throw s}else{const{error:s}=await window.ezsite.apis.tableCreate(Q,e);if(s)throw s}A({title:"Success",description:`Salary record ${I?"updated":"created"} successfully`}),k("/salary")}catch(s){console.error("Error saving salary record:",s),A({title:"Error",description:`Failed to ${I?"update":"create"} salary record`,variant:"destructive"})}finally{L(!1)}},className:"space-y-6",children:[e.jsxs(t,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Basic Information"}),e.jsx(l,{children:"Employee and pay period details"})]}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"employee_id",children:"Employee *"}),e.jsxs(p,{value:V.employee_id,onValueChange:e=>{const s=B.find(s=>s.employee_id===e);s&&z(a=>({...a,employee_id:e,station:s.station,hourly_rate:s.salary||0}))},children:[e.jsx(y,{children:e.jsx(u,{placeholder:"Select employee"})}),e.jsx(x,{children:B.map(s=>e.jsxs(_,{value:s.employee_id,children:[s.first_name," ",s.last_name," (",s.employee_id,")"]},s.employee_id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"station",children:"Station"}),e.jsxs(p,{value:V.station,onValueChange:e=>T("station",e),children:[e.jsx(y,{children:e.jsx(u,{})}),e.jsxs(x,{children:[e.jsx(_,{value:"MOBIL",children:"MOBIL"}),e.jsx(_,{value:"AMOCO ROSEDALE",children:"AMOCO (Rosedale)"}),e.jsx(_,{value:"AMOCO BROOKLYN",children:"AMOCO (Brooklyn)"}),e.jsx(_,{value:"MANAGER",children:"Manager"})]})]})]})]})})]}),e.jsxs(t,{children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Pay Period Configuration"]}),e.jsx(l,{children:"Configure weekly pay periods (Sunday to Saturday) with automatic pay date calculation"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pay_period_quick_select",children:"Quick Select Pay Period"}),e.jsxs(p,{onValueChange:e=>{const s=N(e);z(e=>({...e,pay_period_start:v(s.startDate),pay_period_end:v(s.endDate),pay_date:v(s.payDate)}))},children:[e.jsx(y,{children:e.jsx(u,{placeholder:"Select a predefined pay period"})}),e.jsx(x,{children:U.map(s=>e.jsx(_,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pay_period_start",children:"Pay Period Start *"}),e.jsx(c,{id:"pay_period_start",type:"date",value:V.pay_period_start,onChange:e=>(e=>{const s=N(e);z(e=>({...e,pay_period_start:v(s.startDate),pay_period_end:v(s.endDate),pay_date:v(s.payDate)}))})(e.target.value),required:!0,className:H.isValid?"":"border-red-500"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Must be a Sunday"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pay_period_end",children:"Pay Period End *"}),e.jsx(c,{id:"pay_period_end",type:"date",value:V.pay_period_end,onChange:e=>{return s=e.target.value,void z(e=>({...e,pay_period_end:s,pay_date:v(b(s))}));var s},required:!0,className:H.isValid?"":"border-red-500"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Must be a Saturday"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pay_date",children:"Pay Date *"}),e.jsx(c,{id:"pay_date",type:"date",value:V.pay_date,onChange:e=>T("pay_date",e.target.value),required:!0,className:"bg-muted"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Auto-calculated: Following Sunday"})]})]}),!H.isValid&&H.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700 text-sm font-medium mb-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Pay Period Configuration Issues:"]}),e.jsx("ul",{className:"text-red-600 text-sm space-y-1",children:H.errors.map((s,a)=>e.jsxs("li",{children:["â€¢ ",s]},a))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pay_frequency",children:"Pay Frequency"}),e.jsxs(p,{value:V.pay_frequency,onValueChange:e=>T("pay_frequency",e),children:[e.jsx(y,{children:e.jsx(u,{})}),e.jsxs(x,{children:[e.jsx(_,{value:"Weekly",children:"Weekly (Sunday to Saturday)"}),e.jsx(_,{value:"Biweekly",children:"Biweekly"}),e.jsx(_,{value:"Monthly",children:"Monthly"}),e.jsx(_,{value:"Semi-monthly",children:"Semi-monthly"})]})]})]})})]})]}),e.jsxs(t,{children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Earnings"]}),e.jsx(l,{children:"Base salary, hourly wages, and additional compensation"})]}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"hourly_rate",children:"Hourly Rate"}),e.jsx(h,{id:"hourly_rate",step:"0.01",value:V.hourly_rate,onChange:e=>T("hourly_rate",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"regular_hours",children:"Worked Hour"}),e.jsx(h,{id:"regular_hours",step:"0.01",value:V.regular_hours,onChange:e=>T("regular_hours",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"assign_hours",children:"Assign Hours"}),e.jsx(h,{id:"assign_hours",step:"0.01",value:V.assign_hours,onChange:e=>T("assign_hours",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"overtime_hours",children:"Overtime Hours"}),e.jsx(h,{id:"overtime_hours",step:"0.01",value:V.overtime_hours,onChange:e=>T("overtime_hours",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"overtime_rate",children:"Overtime Rate"}),e.jsx(h,{id:"overtime_rate",step:"0.01",value:V.overtime_rate,onChange:e=>T("overtime_rate",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"overtime_pay",children:"Overtime Pay"}),e.jsx(h,{id:"overtime_pay",step:"0.01",value:V.overtime_pay,onChange:e=>T("overtime_pay",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"bonus_amount",children:"Bonus Amount"}),e.jsx(h,{id:"bonus_amount",step:"0.01",value:V.bonus_amount,onChange:e=>T("bonus_amount",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"commission",children:"Commission"}),e.jsx(h,{id:"commission",step:"0.01",value:V.commission,onChange:e=>T("commission",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"gross_pay",children:"Gross Pay (Auto-calculated)"}),e.jsx(c,{id:"gross_pay",type:"number",step:"0.01",value:V.gross_pay.toFixed(2),disabled:!0,className:"bg-muted font-bold"})]})]})})]}),e.jsxs(t,{children:[e.jsx(i,{children:e.jsx(d,{children:"Additional Information"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"status",children:"Status"}),e.jsxs(p,{value:V.status,onValueChange:e=>T("status",e),children:[e.jsx(y,{children:e.jsx(u,{})}),e.jsxs(x,{children:[e.jsx(_,{value:"Pending",children:"Pending"}),e.jsx(_,{value:"Processed",children:"Processed"}),e.jsx(_,{value:"Paid",children:"Paid"}),e.jsx(_,{value:"Cancelled",children:"Cancelled"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notes",children:"Notes"}),e.jsx(m,{id:"notes",value:V.notes,onChange:e=>T("notes",e.target.value),placeholder:"Additional notes about this salary record...",rows:3})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>k("/salary"),children:"Cancel"}),e.jsx(r,{type:"submit",disabled:q,children:q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),I?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),I?"Update Record":"Create Record"]})})]})]})]})};export{M as default};
