import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{s as a,g as t}from"./invariantSafeHelper-CpdXj1Qs.js";import{u as l,j as r,t as i,C as c,h as n,f as o,g as d,B as x,k as m,e as h,I as j}from"./index-mhPlV2HJ.js";import{T as p,a as u,b as _,c as N,d as g,e as f}from"./table-CifGLKnD.js";import{E as y}from"./EnhancedSalesReportPrintDialog-Cv5GW9TE.js";import{S as v}from"./StationDropdown-B81_j7nj.js";import{u as b}from"./use-station-service-DwD_FQIf.js";import{u as S}from"./routing-DcURAnU1.js";import{D as w,p as A,n as F,W as D,Y as C,a8 as M,a9 as O,Z as E,V as L}from"./utilities-BBdJI3Xi.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";import"./select-KM6PLuaC.js";import"./stationService-CEciqnCB.js";const R=()=>{const[R,I]=s.useState([]),[P,T]=s.useState(!0),[k,z]=s.useState(""),[Y,$]=s.useState("ALL_STATIONS"),[B,V]=s.useState(1),[G,U]=s.useState(0),[Z,H]=s.useState(!1),[K,W]=s.useState(null),q=S(),{userProfile:J,isAdmin:Q}=l(),{canCreate:X,canEdit:ee,canDelete:se,isModuleAccessEnabled:ae}=r(),te=X("sales"),le=ee("sales")&&Q(),re=se("sales")&&Q(),{stationFilters:ie,isAllSelected:ce}=(e=>b(e))(Y);s.useEffect(()=>{ne()},[B,k,Y]);const ne=async()=>{try{T(!0);const e=[];ie&&e.push(...ie),k&&e.push({name:"station",op:"StringContains",value:k});const{data:s,error:a}=await window.ezsite.apis.tablePage("12356",{PageNo:B,PageSize:10,OrderByField:"report_date",IsAsc:!1,Filters:e});if(a)throw a;I(s?.List||[]),U(s?.VirtualCount||0)}catch(e){console.error("Error loading sales reports:",e),i({title:"Error",description:"Failed to load sales reports",variant:"destructive"})}finally{T(!1)}},oe=()=>{te?q("/sales/new"):i({title:"Access Denied",description:"You don't have permission to create sales reports.",variant:"destructive"})},de="employee"===J?.role||Q(),xe=e=>{switch(e.toUpperCase()){case"MOBIL":return"bg-blue-500";case"AMOCO ROSEDALE":return"bg-green-500";case"AMOCO BROOKLYN":return"bg-purple-500";default:return"bg-gray-500"}},me=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),he=Math.ceil(G/10),je=R.reduce((e,s)=>{const a=parseFloat(s.total_sales)||0,t=parseFloat(s.cash_amount)||0,l=parseFloat(s.credit_card_amount)||0,r=parseFloat(s.debit_card_amount)||0,i=parseFloat(s.mobile_amount)||0,c=parseFloat(s.grocery_sales)||0,n=parseFloat(s.total_gallons)||0,o=parseFloat(s.lottery_total_cash)||0,d=t+l+r+i;return Math.abs(d+c-a)>.01&&console.warn(`Report ID ${s.ID}: Payment methods + grocery (${d+c}) don't match total (${a})`),{total_sales:e.total_sales+a,cash_amount:e.cash_amount+t,credit_card_amount:e.credit_card_amount+l,debit_card_amount:e.debit_card_amount+r,mobile_amount:e.mobile_amount+i,grocery_sales:e.grocery_sales+c,total_gallons:e.total_gallons+n,lottery_total_cash:e.lottery_total_cash+o}},{total_sales:0,cash_amount:0,credit_card_amount:0,debit_card_amount:0,mobile_amount:0,grocery_sales:0,total_gallons:0,lottery_total_cash:0}),pe=je.cash_amount+je.credit_card_amount+je.debit_card_amount+je.mobile_amount,ue=pe+je.grocery_sales;return console.log("Summary calculations:",{total_sales:je.total_sales,payment_total:pe,with_grocery:ue,payment_matches:Math.abs(ue-je.total_sales)<=.01}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-bold",children:me(je.total_sales)}),ce&&e.jsx("p",{className:"text-xs text-blue-600",children:"All Stations"})]})]})})}),e.jsx(c,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Gallons"}),e.jsx("p",{className:"text-2xl font-bold",children:je.total_gallons.toFixed(2)}),ce&&e.jsx("p",{className:"text-xs text-blue-600",children:"All Stations"})]})]})})}),e.jsx(c,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Grocery Sales"}),e.jsx("p",{className:"text-2xl font-bold",children:me(je.grocery_sales)}),ce&&e.jsx("p",{className:"text-xs text-blue-600",children:"All Stations"})]})]})})}),e.jsx(c,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Reports"}),e.jsx("p",{className:"text-2xl font-bold",children:G}),ce&&e.jsx("p",{className:"text-xs text-blue-600",children:"All Stations"})]})]})})})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-6 h-6"}),e.jsx("span",{children:"Daily Sales Reports"}),ce&&e.jsx(x,{variant:"outline",className:"ml-2",children:"Viewing All Stations"})]}),e.jsxs(m,{children:["Track daily sales performance across ",ce?"all stations":"selected station"]})]}),te&&de?e.jsxs(h,{onClick:oe,className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Report"})]}):ae&&e.jsx(x,{variant:"secondary",className:"text-xs",children:"Create access disabled by admin"})]})}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(j,{placeholder:"Search by station...",value:k,onChange:e=>z(e.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-4 h-4 text-gray-500"}),e.jsx(v,{value:Y,onValueChange:$,placeholder:"Filter by station",includeAll:!0,showBadge:!0,className:"min-w-[200px]"})]})]}),P?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},a))}):0===R.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No sales reports found","ALL_STATIONS"!==Y&&"ALL"!==Y&&e.jsxs("span",{children:[" for ",Y]})]}),te&&de&&e.jsx(h,{variant:"outline",className:"mt-4",onClick:oe,children:"Add Your First Sales Report"})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(p,{children:[e.jsx(u,{children:e.jsxs(_,{children:[e.jsx(N,{children:"Date"}),e.jsx(N,{children:"Station"}),e.jsx(N,{children:"Shift"}),e.jsx(N,{children:"Total Sales"}),e.jsx(N,{children:"Gallons"}),e.jsx(N,{children:"Grocery"}),e.jsx(N,{children:"Payment Methods"}),e.jsx(N,{children:"Employee"}),e.jsx(N,{children:"Actions"})]})}),e.jsxs(g,{children:[a(R,(s,a)=>{return e.jsxs(_,{children:[e.jsx(f,{className:"font-medium",children:(l=s.report_date,l?new Date(l).toLocaleDateString():"N/A")}),e.jsx(f,{children:e.jsx(x,{className:`text-white ${xe(s.station)}`,children:s.station})}),e.jsx(f,{children:e.jsx(x,{variant:"DAY"===s.shift?"default":"secondary",children:s.shift||"DAY"})}),e.jsx(f,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:me(s.total_sales)}),(()=>{const a=parseFloat(s.total_sales)||0,t=(parseFloat(s.cash_amount)||0)+(parseFloat(s.credit_card_amount)||0)+(parseFloat(s.debit_card_amount)||0)+(parseFloat(s.mobile_amount)||0)+(parseFloat(s.grocery_sales)||0);return Math.abs(t-a)<=.01?e.jsx("span",{className:"text-green-600 text-xs",children:"✓"}):e.jsx("span",{className:"text-red-600 text-xs",title:`Payment total: ${me(t)}`,children:"⚠️"})})()]})}),e.jsx(f,{children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{children:parseFloat(s.total_gallons||"0").toFixed(2)})})}),e.jsx(f,{children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{children:me(s.grocery_sales)})})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{children:["Cash: ",me(s.cash_amount)]}),e.jsxs("div",{children:["Credit: ",me(s.credit_card_amount)]}),e.jsxs("div",{children:["Debit: ",me(s.debit_card_amount)]}),e.jsxs("div",{children:["Mobile: ",me(s.mobile_amount)]})]})}),e.jsx(f,{children:s.employee_name}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>(e=>{W(e),H(!0)})(s),title:"View / Print Report",children:e.jsx(O,{className:"w-4 h-4"})}),le&&e.jsx(h,{variant:"outline",size:"sm",onClick:()=>{return e=s.ID,void(le?q(`/sales/${e}/edit`):i({title:"Access Denied",description:"Only administrators can edit sales reports.",variant:"destructive"}));var e},title:"Edit Report",children:e.jsx(E,{className:"w-4 h-4"})}),re&&e.jsx(h,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(re){if(confirm("Are you sure you want to delete this sales report?"))try{const{error:s}=await window.ezsite.apis.tableDelete("12356",{ID:e});if(s)throw s;i({title:"Success",description:"Sales report deleted successfully"}),ne()}catch(s){console.error("Error deleting sales report:",s),i({title:"Error",description:"Failed to delete sales report",variant:"destructive"})}}else i({title:"Access Denied",description:"Only administrators can delete sales reports.",variant:"destructive"})})(s.ID),className:"text-red-600 hover:text-red-700",title:"Delete Report",children:e.jsx(L,{className:"w-4 h-4"})})]})})]},t(s,a,"report"));var l}),R.length>0&&e.jsxs(_,{className:"bg-gray-50 font-semibold border-t-2",children:[e.jsx(f,{className:"font-bold",children:"TOTALS"}),e.jsx(f,{children:e.jsxs(x,{variant:"outline",className:"text-xs",children:[R.length," reports"]})}),e.jsx(f,{className:"text-gray-500",children:"-"}),e.jsx(f,{className:"font-bold text-green-600",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:me(je.total_sales)}),Math.abs(ue-je.total_sales)<=.01?e.jsx("span",{className:"text-green-600 text-xs",children:"✓"}):e.jsx("span",{className:"text-red-600 text-xs",children:"⚠️"})]})}),e.jsx(f,{className:"font-bold text-blue-600",children:je.total_gallons.toFixed(2)}),e.jsx(f,{className:"font-bold text-purple-600",children:me(je.grocery_sales)}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"font-medium",children:["Cash: ",me(je.cash_amount)]}),e.jsxs("div",{className:"font-medium",children:["Credit: ",me(je.credit_card_amount)]}),e.jsxs("div",{className:"font-medium",children:["Debit: ",me(je.debit_card_amount)]}),e.jsxs("div",{className:"font-medium",children:["Mobile: ",me(je.mobile_amount)]})]})}),e.jsx(f,{className:"text-gray-500",children:"-"}),e.jsx(f,{className:"text-gray-500",children:"-"})]})]})]})}),(!le||!re)&&ae&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-700",children:[e.jsx("strong",{children:"Access Restrictions:"}),!le&&" Edit access restricted to administrators.",!re&&" Delete access restricted to administrators."]})}),he>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",10*(B-1)+1," to ",Math.min(10*B,G)," of ",G," reports","ALL"!==Y&&e.jsxs("span",{children:[" for ",Y]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>V(e=>Math.max(e-1,1)),disabled:1===B,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",B," of ",he]}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>V(e=>Math.min(e+1,he)),disabled:B===he,children:"Next"})]})]})]})]}),e.jsx(y,{open:Z,onOpenChange:H,report:K})]})};export{R as default};
