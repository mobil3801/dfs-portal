import{j as e}from"./radix-ui-woSLwCdF.js";import{r as t}from"./react-core-CKNU0hQt.js";import{l as s,e as a,D as i,a as l,b as r,c as n,C as d,h as o,i as c,L as m,B as u,t as p,f as h,g as x,k as f,I as g}from"./index-CIZJQuMw.js";import{N as _}from"./number-input-DhsXivwV.js";import{T as j}from"./textarea-DdzPPZR3.js";import{S as v,c as y,d as b,a as N,b as w}from"./select-aqE1UuiG.js";import{S as F}from"./switch-C1qVBy4u.js";import{E as P}from"./EnhancedFileUpload-DqBJDceM.js";import{S}from"./StationDropdown-D4NIKsDZ.js";import{c as I,f as D}from"./imageCompression-DvX-F3tO.js";import{P as E}from"./ProfilePicture-BQp4uj4N.js";import{Z as C,a4 as L,V as z,a2 as k,z as U,F as R,X as $,a1 as O,l as M,K as T,Q as B}from"./utilities-DMEd7dY0.js";import{d as G}from"./phoneFormatter-M0vagYYn.js";import{u as q,d as A}from"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";import"./use-station-store-C4ohXaU1.js";const W=({onFileSelect:c,firstName:m="",lastName:u="",imageId:p,previewFile:h,maxSize:x=5,className:f="",disabled:g=!1,showRemoveButton:_=!0})=>{const[j,v]=t.useState(!1),[y,b]=t.useState(!1),[N,w]=t.useState(null),F=t.useRef(null),{toast:P}=s(),S=p||h;return e.jsxs("div",{className:`flex flex-col items-center space-y-4 ${f}`,children:[e.jsxs("div",{className:"relative group",children:[e.jsx(E,{imageId:p,firstName:m,lastName:u,size:"xl",className:"border-4 border-gray-200 transition-all group-hover:border-blue-300",previewFile:h}),e.jsx(a,{type:"button",size:"sm",variant:"default",onClick:()=>v(!0),disabled:g,className:"absolute -bottom-2 -right-2 rounded-full w-8 h-8 p-0 shadow-lg bg-blue-600 hover:bg-blue-700",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(a,{type:"button",variant:"outline",size:"sm",onClick:()=>v(!0),disabled:g,className:"flex items-center space-x-2",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:S?"Change Picture":"Upload Picture"})]}),_&&S&&e.jsx(a,{type:"button",variant:"outline",size:"sm",onClick:()=>{c(null),P({title:"Profile picture removed",description:"The profile picture will be removed when you save."})},disabled:g,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(z,{className:"w-4 h-4"})})]}),h&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200 w-full max-w-sm",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"New picture selected:"}),e.jsx("p",{className:"text-sm text-blue-600",children:h.name}),e.jsx("p",{className:"text-xs text-blue-500 mt-1",children:"This will replace the current picture when saved."})]}),e.jsx(i,{open:j,onOpenChange:v,children:e.jsxs(l,{className:"max-w-lg",children:[e.jsx(r,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Upload Profile Picture"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(E,{imageId:p,firstName:m,lastName:u,size:"lg",className:"border-2 border-gray-200",previewFile:h})}),e.jsx(d,{className:"cursor-pointer hover:bg-gray-50 transition-colors border-dashed border-2",onClick:()=>F.current?.click(),children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-center",children:[e.jsx("div",{className:"p-4 bg-blue-100 rounded-full",children:e.jsx(L,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Choose Profile Picture"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Click here or drag and drop an image"})]})]})})}),y&&e.jsx(d,{className:"border-blue-200 bg-blue-50",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"h-5 w-5 animate-spin text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Optimizing image..."}),e.jsx("p",{className:"text-sm text-blue-600",children:"Preparing for upload"})]})]})})}),e.jsxs("div",{className:"text-center text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:"Supported formats: JPG, PNG, GIF"}),e.jsxs("p",{children:["Maximum file size: ",x,"MB"]}),e.jsx("p",{children:"Recommended: Square image, at least 200x200 pixels"}),e.jsx("div",{className:"mt-3 p-2 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Images are automatically optimized"})]})})]})]})]})}),e.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files?.[0];t&&(e=>e.size>1024*x*1024?(P({title:"File too large",description:`File size must be less than ${x}MB`,variant:"destructive"}),!1):!!e.type.startsWith("image/")||(P({title:"Invalid file type",description:"Please select an image file (JPG, PNG, GIF)",variant:"destructive"}),!1))(t)&&await(async e=>{b(!0);try{const t=await I(e,{maxSizeMB:1,maxWidthOrHeight:800,quality:.85,initialQuality:.85});w(t),t.wasCompressed&&P({title:"Image optimized",description:`File size reduced from ${D(t.originalSize)} to ${D(t.compressedSize)}`,duration:5e3}),c(t.file),v(!1)}catch(t){console.error("Compression failed:",t),P({title:"Optimization failed",description:"Using original file instead",variant:"destructive"}),c(e),v(!1)}finally{b(!1)}})(t),F.current&&(F.current.value="")},className:"hidden"})]})},J=({label:s,onFileSelect:i,onRemove:l,existingFileId:r,selectedFile:n,disabled:h=!1,required:x=!1,className:f=""})=>{const[g,_]=t.useState(!1),[j,v]=t.useState(null),[y,b]=t.useState(!1),[N,w]=t.useState(!1),[F,P]=t.useState(!1),[S,I]=t.useState(!1),[D,E]=t.useState(!1),C=t.useRef(null);t.useEffect(()=>{if(n){const e=URL.createObjectURL(n);return v(e),b(n.type.startsWith("image/")),P(!1),w(!0),()=>{URL.revokeObjectURL(e)}}v(null),b(!1),P(!1),w(!1)},[n]),t.useEffect(()=>{(async()=>{if(r&&!n){E(!0);try{const e=await window.ezsite.apis.tablePage(26928,{PageNo:1,PageSize:1,Filters:[{name:"store_file_id",op:"Equal",value:r}]});if(e.error)console.error("Error checking file existence:",e.error),I(!1);else{const t=e.data?.List?.length>0;if(I(t),t){const e=`${window.location.origin}/api/files/${r}`;v(e),b(!0),P(!1),w(!0)}}}catch(e){console.error("Error checking file existence:",e),I(!1)}finally{E(!1)}}else I(!1),E(!1)})()},[r,n]);const z=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?_(!0):"dragleave"===e.type&&_(!1)},M=e=>{if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(e.type))return void p({title:"Invalid File Type",description:"Please upload PDF, JPG, or PNG files only.",variant:"destructive"});e.size>10485760?p({title:"File Too Large",description:"Please upload files smaller than 10MB.",variant:"destructive"}):(i(e),p({title:"File Selected",description:`${e.name} has been selected and will be uploaded when you save.`}))},T=()=>{C.current?.click()},B=n||r&&S;return e.jsxs("div",{className:c("space-y-4",f),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:s}),x&&e.jsx("span",{className:"text-red-500",children:"*"})]}),B&&e.jsx(a,{type:"button",variant:"outline",size:"sm",onClick:e=>{if(e.preventDefault(),e.stopPropagation(),r&&!n){if(!window.confirm(`Are you sure you want to remove this ${s}? This action cannot be undone and the file will be permanently deleted when you save the employee.`))return}l(),C.current&&(C.current.value=""),p({title:"File Marked for Removal",description:`${s} has been marked for removal and will be permanently deleted when you save.`,variant:"destructive"})},className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-6 px-2 border-red-200 transition-colors touch-manipulation",disabled:h,title:`Remove ${s} - will be permanently deleted when you save`,children:e.jsx($,{className:"w-3 h-3"})})]}),e.jsx(d,{className:c("overflow-hidden border-2 transition-all duration-200",B?"border-blue-200 bg-blue-50":"border-gray-200 bg-gray-50"),children:e.jsxs(o,{className:"p-0",children:[e.jsxs("div",{className:c("relative w-full h-48 transition-all duration-200",B?"bg-gradient-to-br from-blue-50 to-indigo-100":"bg-gradient-to-br from-gray-50 to-gray-100"),children:[D&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:[e.jsx(U,{className:"w-8 h-8 animate-spin text-gray-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Checking file..."})]}),N&&!D&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-blue-100/80",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-blue-600"})}),j&&y&&!F&&!D&&e.jsx("img",{src:j,alt:n?.name||"ID Document",className:c("w-full h-full object-contain bg-white rounded-t-lg",N&&"opacity-0"),onLoad:()=>{w(!1),P(!1)},onError:()=>{w(!1),P(!0)}}),B&&(!y||F)&&!N&&!D&&e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"w-16 h-16 text-blue-500 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-blue-800",children:F?"Preview not available":"Document selected"}),e.jsx("p",{className:"text-xs text-blue-600",children:n?n.name:"ID Document"})]})}),!B&&!D&&e.jsx("div",{className:c("w-full h-full flex items-center justify-center cursor-pointer transition-colors",g?"bg-blue-50":"hover:bg-gray-100"),onClick:h?void 0:T,onDragEnter:z,onDragLeave:z,onDragOver:z,onDrop:e=>{e.preventDefault(),e.stopPropagation(),_(!1),h||e.dataTransfer.files&&e.dataTransfer.files[0]&&M(e.dataTransfer.files[0])},children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx(L,{className:"w-16 h-16 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"No file uploaded"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Click to browse or drag and drop"}),e.jsx("p",{className:"text-xs text-gray-400",children:"PDF, JPG, PNG up to 10MB"})]})}),B&&!D&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx(u,{variant:"secondary",className:"text-xs bg-white/90 text-blue-700 border-blue-300 shadow-sm",children:n?"Ready for Upload":"Uploaded"})}),B&&j&&!D&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(a,{type:"button",variant:"secondary",size:"sm",onClick:()=>{if(j){const e=document.createElement("a");e.href=j,e.download=n?.name||"document",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},className:"bg-white/90 hover:bg-white text-blue-600 shadow-sm touch-manipulation min-h-[32px]",disabled:!j,children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Download"})]})})]}),e.jsx("div",{className:c("p-4 bg-white border-t transition-colors",B?"border-blue-200":"border-gray-200"),children:B&&!D?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate flex-1 min-w-0",children:n?n.name:`Current ${s}`}),e.jsx(u,{variant:"secondary",className:c("text-xs flex-shrink-0",n?"bg-orange-100 text-orange-700 border-orange-300":"bg-green-100 text-green-700 border-green-300"),children:n?"Pending Upload":"Saved"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[y&&!F?e.jsx(k,{className:"w-3 h-3"}):e.jsx(R,{className:"w-3 h-3"}),e.jsx("span",{children:y&&!F?"Image file":"Document file"})]}),n&&e.jsx("span",{children:(e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]})(n.size)}),e.jsx("span",{className:"flex items-center space-x-1",children:e.jsxs("span",{children:["✓ ",n?"Ready to save":"Saved"]})})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs(a,{type:"button",variant:"outline",size:"sm",onClick:T,className:"w-full text-xs touch-manipulation min-h-[32px]",disabled:h,children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Upload Different File"}),e.jsx("span",{className:"sm:hidden",children:"Change File"})]})})]}):D?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(U,{className:"w-4 h-4 animate-spin text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading file information..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["No ",s.toLowerCase()," uploaded"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Upload a file to get started"})]}),e.jsxs(a,{type:"button",variant:"outline",size:"sm",onClick:T,className:"w-full text-xs touch-manipulation min-h-[32px] border-dashed",disabled:h,children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:"Upload File"})]})]})})]})}),e.jsx("input",{ref:C,type:"file",accept:".pdf,.jpg,.jpeg,.png,image/*",onChange:e=>{e.target.files&&e.target.files[0]&&M(e.target.files[0])},className:"hidden",disabled:h}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("p",{children:"• Supported formats: PDF, JPG, PNG (Maximum 10MB per file)"}),e.jsx("p",{children:"• Images will show instant preview with download option"}),e.jsx("p",{children:"• Files will be saved to storage when you save the employee"}),e.jsx("p",{className:"text-red-600",children:"• Click the × button to mark files for deletion"})]})]})},V=()=>{const[s,i]=t.useState({employee_id:"",first_name:"",last_name:"",email:"",phone:"",position:"",station:"",shift:"",hire_date:"",salary:0,is_active:!0,employment_status:"Ongoing",terminated_date:"",left_date:"",date_of_birth:"",current_address:"",mailing_address:"",reference_name:"",id_document_type:"",id_document_file_id:null,id_document_2_file_id:null,id_document_3_file_id:null,id_document_4_file_id:null,profile_image_id:null}),[l,r]=t.useState([{file:null,name:"",preview:null,existingFileId:null},{file:null,name:"",preview:null,existingFileId:null},{file:null,name:"",preview:null,existingFileId:null},{file:null,name:"",preview:null,existingFileId:null}]),[n,c]=t.useState(null),[I,D]=t.useState(!1),[E,C]=t.useState(!1),[L,z]=t.useState(!1),[k,U]=t.useState([]),R=q(),{id:O}=A(),V=[{value:"Ongoing",label:"Ongoing",color:"bg-green-500"},{value:"Terminated",label:"Terminated",color:"bg-red-500"},{value:"Left",label:"Left",color:"bg-orange-500"}];t.useEffect(()=>{O?(z(!0),H(parseInt(O))):Q()},[O]),t.useEffect(()=>()=>{l.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),n&&URL.revokeObjectURL(URL.createObjectURL(n))},[]);const Q=async()=>{try{const{data:e,error:t}=await window.ezsite.apis.tablePage("11727",{PageNo:1,PageSize:1e3,OrderByField:"employee_id",IsAsc:!1,Filters:[{name:"employee_id",op:"StringStartsWith",value:"DFS"}]});if(t)throw console.error("Error fetching existing employee IDs:",t),t;let s=1001;if(e&&e.List&&e.List.length>0){const t=e.List.map(e=>{const t=e.employee_id.match(/^DFS(\d+)$/);return t?parseInt(t[1]):0}).filter(e=>e>0);t.length>0&&(s=Math.max(...t)+1)}const a=`DFS${s}`,{data:l,error:r}=await window.ezsite.apis.tablePage("11727",{PageNo:1,PageSize:1,Filters:[{name:"employee_id",op:"Equal",value:a}]});if(r)throw console.error("Error checking employee ID uniqueness:",r),r;if(l&&l.List&&l.List.length>0){const e=`DFS${s+1}`;i(t=>({...t,employee_id:e}))}else i(e=>({...e,employee_id:a}))}catch(e){console.error("Error generating employee ID:",e),p({title:"Warning",description:"Could not auto-generate employee ID. Please enter manually.",variant:"default"})}},H=async e=>{try{C(!0);const{data:t,error:s}=await window.ezsite.apis.tablePage("11727",{PageNo:1,PageSize:1,Filters:[{name:"ID",op:"Equal",value:e}]});if(s)throw s;if(t&&t.List&&t.List.length>0){const e=t.List[0];i({employee_id:e.employee_id||"",first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",position:e.position||"",station:e.station||"",shift:e.shift||"",hire_date:e.hire_date?e.hire_date.split("T")[0]:"",salary:e.salary||0,is_active:!1!==e.is_active,employment_status:e.employment_status||"Ongoing",terminated_date:e.terminated_date?e.terminated_date.split("T")[0]:"",left_date:e.left_date?e.left_date.split("T")[0]:"",date_of_birth:e.date_of_birth?e.date_of_birth.split("T")[0]:"",current_address:e.current_address||"",mailing_address:e.mailing_address||"",reference_name:e.reference_name||"",id_document_type:e.id_document_type||"",id_document_file_id:e.id_document_file_id||null,id_document_2_file_id:e.id_document_2_file_id||null,id_document_3_file_id:e.id_document_3_file_id||null,id_document_4_file_id:e.id_document_4_file_id||null,profile_image_id:e.profile_image_id||null});const s=[{file:null,name:"",preview:null,existingFileId:e.id_document_file_id||null},{file:null,name:"",preview:null,existingFileId:e.id_document_2_file_id||null},{file:null,name:"",preview:null,existingFileId:e.id_document_3_file_id||null},{file:null,name:"",preview:null,existingFileId:e.id_document_4_file_id||null}];s.forEach((e,t)=>{e.existingFileId&&(e.name=`Existing Document ${t+1}`)}),r(s),U([])}}catch(t){console.error("Error loading employee:",t),p({title:"Error",description:"Failed to load employee details",variant:"destructive"})}finally{C(!1)}},K=async(e,t="document")=>{try{D(!0);const{data:s,error:a}=await window.ezsite.apis.upload({filename:e.name,file:e});if(a)throw console.error("Upload error:",a),new Error(a);const i={file_name:e.name,file_size:e.size,file_type:e.type,store_file_id:s,uploaded_by:1,upload_date:(new Date).toISOString(),associated_table:"employees",associated_record_id:O?parseInt(O):null,file_category:t,is_active:!0,description:`Employee ${t} upload`,file_url:""},{error:l}=await window.ezsite.apis.tableCreate("26928",i);return l&&console.error("Error creating file upload record:",l),s}catch(s){return console.error("Error uploading file:",s),p({title:"Error",description:"Failed to upload file. Please try again.",variant:"destructive"}),null}finally{D(!1)}},Z=async(e,t,s)=>{try{for(let s=0;s<t.length;s++){const a=t[s];if(a){const{data:t,error:i}=await window.ezsite.apis.tablePage("26928",{PageNo:1,PageSize:1,Filters:[{name:"store_file_id",op:"Equal",value:a}]});!i&&t&&t.List&&t.List.length>0&&await window.ezsite.apis.tableUpdate("26928",{ID:t.List[0].id,associated_record_id:e,description:`Employee ID Document ${s+1}`})}}if(s){const{data:t,error:a}=await window.ezsite.apis.tablePage("26928",{PageNo:1,PageSize:1,Filters:[{name:"store_file_id",op:"Equal",value:s}]});!a&&t&&t.List&&t.List.length>0&&await window.ezsite.apis.tableUpdate("26928",{ID:t.List[0].id,associated_record_id:e,description:"Employee Profile Image"})}}catch(a){console.error("Error updating file associations:",a)}},X=e=>{if(!["image/jpeg","image/jpg","image/png","image/gif"].includes(e.type))return void p({title:"Invalid File Type",description:"Please upload JPG, PNG, or GIF files only.",variant:"destructive"});e.size>5242880?p({title:"File Too Large",description:"Please upload files smaller than 5MB.",variant:"destructive"}):(n&&URL.revokeObjectURL(URL.createObjectURL(n)),c(e),p({title:"Profile Picture Selected",description:"Profile picture has been selected for upload."}))},Y=(e,t)=>{i(s=>({...s,[e]:t}))},ee=e=>{switch(e){case 0:return s.id_document_file_id;case 1:return s.id_document_2_file_id;case 2:return s.id_document_3_file_id;case 3:return s.id_document_4_file_id;default:return null}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-6 h-6"}),e.jsx("span",{children:L?"Edit Employee":"Add New Employee"})]}),e.jsx(f,{children:L?"Update employee information":"Add a new employee to your team"})]}),e.jsxs(a,{variant:"outline",onClick:()=>R("/employees"),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Back to Employees"]})]})}),e.jsx(o,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),"ALL"!==s.station){if(k.length>0){if(!window.confirm(`Warning: ${k.length} file${k.length>1?"s":""} will be permanently deleted from database storage. This action cannot be undone. Are you sure you want to proceed?`))return}try{C(!0),console.log("Starting form submission...");let e=s.profile_image_id,t=[s.id_document_file_id,s.id_document_2_file_id,s.id_document_3_file_id,s.id_document_4_file_id];for(let s=0;s<l.length;s++){const e=l[s];if(e.file){console.log(`Uploading ID document ${s+1}...`);const a=await K(e.file,`id_document_${s+1}`);if(null===a)return void C(!1);t[s]=a}else e.file||e.existingFileId?!e.file&&e.existingFileId&&(t[s]=e.existingFileId):t[s]=null}if(n&&(console.log("Uploading profile image..."),e=await K(n,"profile_image"),null===e))return void C(!1);const a={...s,hire_date:s.hire_date?new Date(s.hire_date).toISOString():"",terminated_date:s.terminated_date?new Date(s.terminated_date).toISOString():"",left_date:s.left_date?new Date(s.left_date).toISOString():"",date_of_birth:s.date_of_birth?new Date(s.date_of_birth).toISOString():"",id_document_file_id:t[0],id_document_2_file_id:t[1],id_document_3_file_id:t[2],id_document_4_file_id:t[3],profile_image_id:e,created_by:1};if(console.log("Data to submit:",a),console.log("Files to delete:",k),L&&O){console.log("Updating employee..."),k.length>0&&(console.log("Deleting marked files:",k),await(async e=>{if(e&&0!==e.length)try{for(const t of e){const{data:e,error:s}=await window.ezsite.apis.tablePage("26928",{PageNo:1,PageSize:1,Filters:[{name:"store_file_id",op:"Equal",value:t}]});if(s)console.error(`Error fetching file record ${t}:`,s);else if(e&&e.List&&e.List.length>0){const s=e.List[0],{error:a}=await window.ezsite.apis.tableUpdate("26928",{ID:s.id,is_active:!1,description:`${s.description} - Deleted on ${(new Date).toISOString()}`});if(a){console.error(`Error deactivating file ${t}:`,a);const{error:e}=await window.ezsite.apis.tableDelete("26928",{ID:s.id});e&&console.error(`Error deleting file ${t}:`,e)}}else console.warn(`No file record found for file ID ${t}`)}}catch(s){console.error("Error deleting files from database:",s)}else console.log("No files to delete")})(k),U([]));const{error:s}=await window.ezsite.apis.tableUpdate("11727",{ID:parseInt(O),...a});if(s)throw console.error("Update error:",s),new Error(s);await Z(parseInt(O),t,e),p({title:"Success",description:"Employee updated successfully"})}else{console.log("Creating employee...");const{error:s}=await window.ezsite.apis.tableCreate("11727",a);if(s)throw console.error("Create error:",s),new Error(s);const{data:i}=await window.ezsite.apis.tablePage("11727",{PageNo:1,PageSize:1,OrderByField:"ID",IsAsc:!1,Filters:[{name:"employee_id",op:"Equal",value:a.employee_id}]});if(i&&i.List&&i.List.length>0){const s=i.List[0].id;await Z(s,t,e)}p({title:"Success",description:"Employee created successfully"})}console.log("Form submission completed successfully"),R("/employees")}catch(t){console.error("Error saving employee:",t),p({title:"Error",description:`Failed to ${L?"update":"create"} employee: ${t}`,variant:"destructive"})}finally{C(!1)}}else p({title:"Invalid Station Selection",description:"Please select a specific station for the employee. 'ALL' is not allowed for individual employee records.",variant:"destructive"})},className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Profile Picture"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx(W,{onFileSelect:X,firstName:s.first_name,lastName:s.last_name,imageId:s.profile_image_id,previewFile:n,maxSize:5,disabled:E||I,showRemoveButton:!0}),(s.profile_image_id||n)&&e.jsxs(a,{type:"button",variant:"outline",size:"sm",onClick:()=>{s.profile_image_id&&U(e=>{const t=[...e];return t.includes(s.profile_image_id)||t.push(s.profile_image_id),t}),n&&URL.revokeObjectURL(URL.createObjectURL(n)),c(null),i(e=>({...e,profile_image_id:null})),p({title:"Profile Picture Marked for Removal",description:"The profile picture will be permanently deleted when you save the employee."})},className:"text-red-600 hover:text-red-700",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Remove"]})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(m,{children:"Upload Profile Picture"}),e.jsx(P,{onFileSelect:X,accept:"image/*",label:"Upload Profile Picture",currentFile:n?.name,maxSize:5}),n&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800",children:"New profile picture selected:"}),e.jsx("p",{className:"text-sm text-blue-600",children:n.name}),e.jsx("p",{className:"text-xs text-blue-500 mt-1",children:"This will replace the current profile picture when saved."})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Supported formats: JPG, PNG, GIF (Max 5MB)",e.jsx("br",{}),"Recommended: Square image, at least 200x200 pixels"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"employee_id",children:"Employee ID *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"employee_id",value:s.employee_id,onChange:e=>Y("employee_id",e.target.value),placeholder:L?"Enter employee ID":"Auto-generated",readOnly:!L,className:L?"":"bg-gray-50 cursor-not-allowed",required:!0}),!L&&e.jsx(a,{type:"button",variant:"outline",size:"sm",onClick:Q,className:"shrink-0",children:"Regenerate"})]}),!L&&e.jsx("p",{className:"text-xs text-green-600 bg-green-50 p-2 rounded mt-2",children:"Employee ID is automatically generated"})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(S,{id:"station",label:"Station",value:s.station,onValueChange:e=>Y("station",e),placeholder:"Select station",required:!0,includeAll:!1})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"shift",children:"Shift *"}),e.jsxs(v,{value:s.shift,onValueChange:e=>Y("shift",e),children:[e.jsx(y,{children:e.jsx(b,{placeholder:"Select shift"})}),e.jsx(N,{children:["Day","Night","Day & Night"].map(t=>e.jsx(w,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"first_name",children:"First Name *"}),e.jsx(g,{id:"first_name",value:s.first_name,onChange:e=>Y("first_name",e.target.value),placeholder:"Enter first name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(g,{id:"last_name",value:s.last_name,onChange:e=>Y("last_name",e.target.value),placeholder:"Enter last name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"date_of_birth",children:"Date of Birth"}),e.jsx(g,{id:"date_of_birth",type:"date",value:s.date_of_birth,onChange:e=>Y("date_of_birth",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"Email"}),e.jsx(g,{id:"email",type:"email",value:s.email,onChange:e=>Y("email",e.target.value),placeholder:"Enter email address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:"Phone"}),e.jsx(g,{id:"phone",value:s.phone,onChange:e=>{return t=e.target.value,void i(e=>({...e,phone:t}));var t},placeholder:"Enter phone number (e.g., 1234567890)"}),s.phone&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Display format:"})," ",G(s.phone)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"reference_name",children:"Reference Name"}),e.jsx(g,{id:"reference_name",value:s.reference_name,onChange:e=>Y("reference_name",e.target.value),placeholder:"Enter reference name"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Address Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"current_address",children:"Current Address"}),e.jsx(j,{id:"current_address",value:s.current_address,onChange:e=>Y("current_address",e.target.value),placeholder:"Enter current address",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"mailing_address",children:"Mailing Address"}),e.jsx(j,{id:"mailing_address",value:s.mailing_address,onChange:e=>Y("mailing_address",e.target.value),placeholder:"Enter mailing address",rows:3})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"Employment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"position",children:"Position *"}),e.jsxs(v,{value:s.position,onValueChange:e=>Y("position",e),children:[e.jsx(y,{children:e.jsx(b,{placeholder:"Select position"})}),e.jsx(N,{children:["Manager","Supervisor","Cashier","Attendant","Mechanic","Cleaner"].map(t=>e.jsx(w,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"employment_status",children:"Employment Status *"}),e.jsxs(v,{value:s.employment_status,onValueChange:e=>Y("employment_status",e),children:[e.jsx(y,{children:e.jsx(b,{placeholder:"Select employment status"})}),e.jsx(N,{children:V.map(t=>e.jsx(w,{value:t.value,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.color}`}),e.jsx("span",{children:t.label})]})},t.value))})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(u,{className:`text-white ${(e=>{const t=V.find(t=>t.value===e);return t?t.color:"bg-gray-500"})(s.employment_status)}`,children:s.employment_status}),e.jsx("span",{className:"text-xs text-gray-500",children:"Current employment status"})]})]}),"Terminated"===s.employment_status&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"terminated_date",children:"Terminated Date *"}),e.jsx(g,{id:"terminated_date",type:"date",value:s.terminated_date,onChange:e=>Y("terminated_date",e.target.value),required:!0})]}),"Left"===s.employment_status&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"left_date",children:"Left Date *"}),e.jsx(g,{id:"left_date",type:"date",value:s.left_date,onChange:e=>Y("left_date",e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"hire_date",children:"Hire Date"}),e.jsx(g,{id:"hire_date",type:"date",value:s.hire_date,onChange:e=>Y("hire_date",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"salary",children:"Salary ($)"}),e.jsx(_,{id:"salary",step:"0.01",min:"0",value:s.salary,onChange:e=>Y("salary",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"is_active",children:"Active Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"is_active",checked:s.is_active,onCheckedChange:e=>Y("is_active",e)}),e.jsx("span",{className:"text-sm text-gray-600",children:s.is_active?"Active":"Inactive"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900",children:"ID Documentation"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"id_document_type",children:"ID Document Type"}),e.jsxs(v,{value:s.id_document_type,onValueChange:e=>Y("id_document_type",e),children:[e.jsx(y,{children:e.jsx(b,{placeholder:"Select ID document type"})}),e.jsx(N,{children:["Driving License","Passport","Green Card","SSN","Work Permit"].map(t=>e.jsx(w,{value:t,children:t},t))})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-800",children:"Upload ID Documents"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload up to 4 ID documents. Additional boxes will appear as you upload files."}),e.jsx("div",{className:"space-y-6",children:Array.from({length:(()=>{let e=1;for(let t=0;t<l.length;t++)(l[t].file||l[t].existingFileId)&&(e=Math.max(e,t+2));return Math.min(e,4)})()},(t,a)=>e.jsx(J,{label:`ID Document ${a+1}`,onFileSelect:e=>((e,t)=>{const s=[...l];if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(e.type))return void p({title:"Invalid File Type",description:"Please upload PDF, JPG, or PNG files only.",variant:"destructive"});if(e.size>10485760)return void p({title:"File Too Large",description:"Please upload files smaller than 10MB.",variant:"destructive"});s[t].preview&&URL.revokeObjectURL(s[t].preview);let a=null;e.type.startsWith("image/")&&(a=URL.createObjectURL(e)),s[t]={file:e,name:e.name,preview:a,existingFileId:s[t].existingFileId},r(s),p({title:"Document Selected",description:`ID Document ${t+1} has been selected for upload.`})})(e,a),onRemove:()=>(e=>{try{const t=[...l],a=t[e];a.preview&&URL.revokeObjectURL(a.preview);const n=a.existingFileId||ee(e);n&&(console.log("Marking file for deletion:",n),U(e=>{const t=[...e];return t.includes(n)||t.push(n),t})),t[e]={file:null,name:"",preview:null,existingFileId:null},r(t);const d={...s};switch(e){case 0:d.id_document_file_id=null;break;case 1:d.id_document_2_file_id=null;break;case 2:d.id_document_3_file_id=null;break;case 3:d.id_document_4_file_id=null}i(d),p({title:"Document Marked for Deletion",description:`ID Document ${e+1} has been marked for deletion and will be permanently removed from database storage when you save.`,variant:"destructive"})}catch(t){console.error("Error removing document:",t),p({title:"Error",description:"Failed to remove document. Please try again.",variant:"destructive"})}})(a),existingFileId:l[a].existingFileId,selectedFile:l[a].file,disabled:E||I,required:0===a,className:"w-full"},a))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tip: Additional upload boxes will appear automatically as you upload files"}),k.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-medium text-red-800 mb-2",children:"Files Pending Deletion"}),e.jsxs("p",{className:"text-xs text-red-700",children:[k.length," file",k.length>1?"s":""," will be permanently deleted from database storage when you save."]}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"This action cannot be undone. Make sure you have backups if needed."})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6 border-t",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>R("/employees"),children:"Cancel"}),e.jsx(a,{type:"submit",disabled:E||I,className:k.length>0?"bg-red-600 hover:bg-red-700":"",children:E||I?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),L?"Update Employee":"Create Employee",k.length>0&&e.jsxs("span",{className:"ml-2 text-xs bg-red-800 text-white px-2 py-1 rounded",children:["Will delete ",k.length," file",k.length>1?"s":""]})]})})]})]})})]})})};export{V as default};
