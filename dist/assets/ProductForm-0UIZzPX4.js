import{j as e}from"./radix-ui-woSLwCdF.js";import{r as t}from"./react-core-CKNU0hQt.js";import{l as s,E as r,D as a,m as i,e as c,a as n,b as l,c as o,C as d,h as p,f as m,g as u,B as h,u as x,d as g,I as _,k as j,L as f,S as v}from"./index-CIZJQuMw.js";import{N as w}from"./number-input-DhsXivwV.js";import{T as y}from"./textarea-DdzPPZR3.js";import{S as b,a as N,b as S,c as C,d as P}from"./select-aqE1UuiG.js";import{$ as E,X as F,a0 as k,y as I,a1 as U,V as D,a2 as z,a3 as $,F as L,K as B,a4 as O,a5 as T,D as M,Q as A}from"./utilities-DMEd7dY0.js";import{T as q,a as R,b as W,c as V,d as G,e as H}from"./table-vnZa3hwR.js";import{E as Q}from"./EnhancedFileUpload-DqBJDceM.js";import{f as J}from"./imageCompression-DvX-F3tO.js";import{u as K,d as X}from"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";class Y{static instance;logs=[];maxLogs=100;constructor(){}static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}log(e,t="medium",s,r,a){const i={id:this.generateId(),timestamp:new Date,error:e,errorInfo:r,component:s,userId:this.getCurrentUserId(),userAgent:navigator.userAgent,url:window.location.href,severity:t,context:a};this.logs.unshift(i),this.logs.length>this.maxLogs&&this.logs.pop(),this.logToConsole(i),this.persistLogs(),this.sendToErrorService(i)}logToConsole(e){const t=this.getConsoleStyle(e.severity);console.group(`%cðŸš¨ Error Boundary Caught Error - ${e.severity.toUpperCase()}`,t),console.error("Error:",e.error),console.log("Component:",e.component||"Unknown"),console.log("Timestamp:",e.timestamp.toISOString()),console.log("URL:",e.url),e.errorInfo&&console.log("Component Stack:",e.errorInfo.componentStack),e.context&&console.log("Context:",e.context),console.groupEnd()}getConsoleStyle(e){return{low:"color: #856404; background: #fff3cd; padding: 2px 4px; border-radius: 3px;",medium:"color: #721c24; background: #f8d7da; padding: 2px 4px; border-radius: 3px;",high:"color: #721c24; background: #f5c6cb; padding: 2px 4px; border-radius: 3px; font-weight: bold;",critical:"color: white; background: #dc3545; padding: 2px 4px; border-radius: 3px; font-weight: bold;"}[e]}persistLogs(){try{const e=this.logs.map(e=>({...e,error:{name:e.error.name,message:e.error.message,stack:e.error.stack}}));localStorage.setItem("dfs_error_logs",JSON.stringify(e))}catch(e){console.warn("Failed to persist error logs:",e)}}sendToErrorService(e){}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}getCurrentUserId(){try{return localStorage.getItem("user_id")||void 0}catch{return}}getLogs(){return[...this.logs]}clearLogs(){this.logs=[],localStorage.removeItem("dfs_error_logs")}getLogsSummary(){const e=this.logs.reduce((e,t)=>(e[t.severity]=(e[t.severity]||0)+1,e),{});return{total:this.logs.length,bySeverity:e}}}const Z=({onScan:d,triggerText:p="Scan Barcode",disabled:m=!1})=>{const u=t.useRef(null),h=t.useRef(null),[x,g]=t.useState(!1),[_,j]=t.useState(null),[f,v]=t.useState(!1),{toast:w}=s(),y=()=>{_&&(_.getTracks().forEach(e=>e.stop()),j(null),v(!1))};return t.useEffect(()=>(x?(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});u.current&&(u.current.srcObject=e,j(e),v(!0))}catch(e){console.error("Error accessing camera:",e),w({variant:"destructive",title:"Camera Error",description:"Unable to access camera. Please check permissions."})}})():y(),()=>{y()}),[x]),e.jsx(r,{componentName:"BarcodeScanner",children:e.jsxs(a,{open:x,onOpenChange:g,children:[e.jsx(i,{asChild:!0,children:e.jsxs(c,{type:"button",variant:"outline",size:"sm",disabled:m,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),p]})}),e.jsxs(n,{className:"sm:max-w-md",children:[e.jsx(l,{children:e.jsx(o,{children:"Scan Barcode"})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative w-full max-w-sm aspect-video bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:u,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:h,className:"hidden"}),!f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Initializing camera..."})]})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{onClick:()=>{if(u.current&&h.current){const e=u.current,t=h.current,s=t.getContext("2d");if(s){t.width=e.videoWidth,t.height=e.videoHeight,s.drawImage(e,0,0);const r=Math.random().toString(36).substr(2,12).toUpperCase();d(r),g(!1),y(),w({title:"Barcode Scanned",description:`Detected barcode: ${r}`})}}},disabled:!f,children:"Capture"}),e.jsxs(c,{variant:"outline",onClick:()=>g(!1),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Position the barcode within the camera view and click Capture"})]})]})]})})},ee=({associatedTable:r,associatedRecordId:i,fileCategory:x,allowDelete:g=!1,allowEdit:_=!1,showDescription:j=!0,className:f="",viewMode:v="grid"})=>{const[w,y]=t.useState([]),[b,N]=t.useState(!0),[S,C]=t.useState(null),[P,E]=t.useState(!1),{toast:B}=s();t.useEffect(()=>{O()},[r,i,x]);const O=async()=>{try{N(!0);const e=[{name:"associated_table",op:"Equal",value:r},{name:"associated_record_id",op:"Equal",value:i},{name:"is_active",op:"Equal",value:!0}];x&&e.push({name:"file_category",op:"Equal",value:x});const{data:t,error:s}=await window.ezsite.apis.tablePage(26928,{PageNo:1,PageSize:100,OrderByField:"upload_date",IsAsc:!1,Filters:e});if(s)throw s;y(t.List||[])}catch(e){console.error("Error loading files:",e),B({title:"Error loading files",description:"string"==typeof e?e:"Failed to load files",variant:"destructive"})}finally{N(!1)}},T=e=>{e.file_url&&window.open(e.file_url,"_blank")},M=t=>t.startsWith("image/")?e.jsx(z,{className:"h-5 w-5 text-blue-600"}):t.startsWith("video/")?e.jsx($,{className:"h-5 w-5 text-purple-600"}):t.includes("pdf")?e.jsx(L,{className:"h-5 w-5 text-red-600"}):e.jsx(k,{className:"h-5 w-5 text-gray-600"}),A=e=>e.split("/")[1]?.toUpperCase()||"FILE",q=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=e=>{const t={document:"bg-blue-100 text-blue-800",image:"bg-green-100 text-green-800",receipt:"bg-yellow-100 text-yellow-800",invoice:"bg-purple-100 text-purple-800",report:"bg-orange-100 text-orange-800",license:"bg-indigo-100 text-indigo-800",certificate:"bg-pink-100 text-pink-800",general:"bg-gray-100 text-gray-800"};return t[e]||t.general};return b?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===w.length?e.jsx(d,{className:f,children:e.jsxs(p,{className:"p-8 text-center",children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No files uploaded"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Files will appear here once uploaded"})]})}):e.jsxs("div",{className:f,children:[e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(u,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Uploaded Files"}),e.jsxs(h,{variant:"secondary",children:[w.length," files"]})]})}),e.jsx(p,{children:e.jsx("div",{className:"grid"===v?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3",children:w.map(t=>e.jsxs("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow "+("list"===v?"flex items-center gap-4":""),children:[e.jsxs("div",{className:""+("list"===v?"flex items-center gap-3 flex-1":""),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[M(t.file_type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:t.file_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[J(t.file_size)," â€¢ ",A(t.file_type)]})]})]}),j&&t.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:t.description}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.file_category&&e.jsx(h,{variant:"secondary",className:`text-xs ${R(t.file_category)}`,children:t.file_category}),e.jsx(h,{variant:"outline",className:"text-xs",children:q(t.upload_date)})]})})]}),e.jsxs("div",{className:"flex gap-2 "+("list"===v?"flex-shrink-0":"mt-3"),children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>(e=>{C(e),E(!0)})(t),children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>T(t),children:e.jsx(U,{className:"h-4 w-4"})}),g&&e.jsx(c,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm(`Are you sure you want to delete "${e.file_name}"?`))try{const{error:t}=await window.ezsite.apis.tableUpdate(26928,{id:e.id,is_active:!1});if(t)throw t;B({title:"File deleted",description:"File has been successfully deleted"}),O()}catch(t){console.error("Error deleting file:",t),B({title:"Delete failed",description:"string"==typeof t?t:"Failed to delete file",variant:"destructive"})}})(t),className:"text-red-600 hover:text-red-700",children:e.jsx(D,{className:"h-4 w-4"})})]})]},t.id))})})]}),e.jsx(a,{open:P,onOpenChange:E,children:e.jsxs(n,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(l,{children:e.jsxs(o,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[S&&M(S.file_type),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:S?.file_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[S&&J(S.file_size)," â€¢ ",S&&A(S.file_type)]})]})]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>E(!1),children:e.jsx(F,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-4",children:S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[S.file_category&&e.jsx(h,{className:R(S.file_category),children:S.file_category}),e.jsx(h,{variant:"outline",children:q(S.upload_date)})]}),e.jsxs(c,{onClick:()=>T(S),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Download"]})]}),S.description&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm",children:S.description})}),e.jsx("div",{className:"flex justify-center",children:(W=S,W.file_type.startsWith("image/")?e.jsx("img",{src:W.file_url,alt:W.file_name,className:"max-w-full max-h-96 object-contain rounded-lg"}):"application/pdf"===W.file_type?e.jsx("iframe",{src:W.file_url,className:"w-full h-96 rounded-lg border",title:W.file_name}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg",children:[M(W.file_type),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Preview not available"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click download to view this file"})]}))})]})})]})})]});var W},te=()=>{const E=K(),{id:F}=X(),{toast:k}=s(),{userProfile:I}=x();((e={})=>{const{toast:r}=s(),a=Y.getInstance(),{component:i="Unknown Component",showToast:c=!0,logError:n=!0,severity:l="medium"}=e,o=t.useCallback((e,t,s)=>{const o="string"==typeof e?new Error(e):e;n&&a.log(o,l,i,void 0,s),c&&r({variant:"destructive",title:"Error",description:t||o.message||"An unexpected error occurred"})},[i,c,n,l,r,a]),d=t.useCallback(async(e,t,s)=>{try{return await e()}catch(r){return o(r instanceof Error?r:new Error(String(r)),t,s),null}},[o]),p=t.useCallback(async(e,t,s)=>{try{const t=await e();if(t.error)throw new Error(t.error);return t.data||null}catch(r){return o(r instanceof Error?r:new Error(String(r)),t,s),null}},[o])})({component:"ProductForm",severity:"high"});const D=!!F,[z,$]=t.useState(!1),[L,J]=t.useState([]),[te,se]=t.useState([]),[re,ae]=t.useState([]),[ie,ce]=t.useState(!1),[ne,le]=t.useState(!1),[oe,de]=t.useState({product_name:"",weight:0,weight_unit:"lb",department:"Convenience Store",merchant_id:"",last_updated_date:(new Date).toISOString().split("T")[0],last_shopping_date:"",case_price:0,unit_per_case:1,unit_price:0,retail_price:0,profit_margin:0,category:"",supplier:"",quantity_in_stock:0,minimum_stock:0,description:"",bar_code_case:"",bar_code_unit:"",serial_number:0,overdue:!1}),[pe,me]=t.useState(null);t.useEffect(()=>{ue(),he(),D?ge():xe()},[F]),t.useEffect(()=>{if(oe.case_price>0&&oe.unit_per_case>0){const e=oe.case_price/oe.unit_per_case;de(t=>({...t,unit_price:Math.round(100*e)/100}))}},[oe.case_price,oe.unit_per_case]),t.useEffect(()=>{if(oe.unit_price>0){const e=_e(oe.unit_price);0===oe.retail_price&&de(t=>({...t,retail_price:e}))}else 0===oe.unit_price&&de(e=>({...e,retail_price:0}))},[oe.unit_price]),t.useEffect(()=>{if(oe.unit_price>0&&oe.retail_price>0){const e=(oe.retail_price-oe.unit_price)/oe.retail_price*100;de(t=>({...t,profit_margin:Math.round(100*e)/100}))}else de(e=>({...e,profit_margin:0}))},[oe.unit_price,oe.retail_price]);const ue=async()=>{try{const{data:e,error:t}=await window.ezsite.apis.tablePage("11729",{PageNo:1,PageSize:100,OrderByField:"vendor_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(t)throw t;J(e?.List||[])}catch(e){console.error("Error fetching vendors:",e)}},he=async()=>{try{const{data:e,error:t}=await window.ezsite.apis.tablePage("14389",{PageNo:1,PageSize:100,OrderByField:"category_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(t)throw t;se(e?.List||[])}catch(e){console.error("Error fetching categories:",e)}},xe=async()=>{try{const{data:e,error:t}=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"serial_number",IsAsc:!1,Filters:[]});if(t)throw t;const s=e?.List?.[0]?.serial_number||0;de(e=>({...e,serial_number:s+1}))}catch(e){console.error("Error generating serial number:",e),de(e=>({...e,serial_number:1}))}},ge=async()=>{if(F){$(!0);try{const{data:e,error:t}=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"ID",IsAsc:!0,Filters:[{name:"ID",op:"Equal",value:parseInt(F)}]});if(t)throw t;if(e?.List?.[0]){const t=e.List[0],s={product_name:t.product_name||"",weight:t.weight||0,weight_unit:t.weight_unit||"lb",department:t.department||"Convenience Store",merchant_id:t.merchant_id?.toString()||"",last_updated_date:t.last_updated_date?t.last_updated_date.split("T")[0]:"",last_shopping_date:t.last_shopping_date?t.last_shopping_date.split("T")[0]:"",case_price:t.case_price||0,unit_per_case:t.unit_per_case||1,unit_price:t.unit_price||0,retail_price:t.retail_price||0,profit_margin:0,category:t.category||"",supplier:t.supplier||"",quantity_in_stock:t.quantity_in_stock||0,minimum_stock:t.minimum_stock||0,description:t.description||"",bar_code_case:t.bar_code_case||"",bar_code_unit:t.bar_code_unit||"",serial_number:t.serial_number||0,overdue:t.overdue||!1};de(s),me(s)}}catch(e){console.error("Error fetching product:",e),k({variant:"destructive",title:"Error",description:"Failed to load product data."})}finally{$(!1)}}},_e=e=>{if(0===e)return 0;let t=0;t=e<4?65:e>=4&&e<6?55:e>=6&&e<8?45:e>=8&&e<10?35:25;const s=e*(1+t/100),r=Math.floor(s),a=s-r;let i=.99,c=Math.abs(a-.99);return[.25,.49,.75,.99].forEach(e=>{const t=Math.abs(a-e);t<c&&(c=t,i=e)}),r+i},je=(e,t)=>{de(s=>({...s,[e]:t}))},fe=(e,t)=>{de(s=>({...s,[e]:t})),k({title:"Barcode Scanned",description:`Barcode ${t} added to ${e.replace("_"," ")}`})},ve=async(e,t,s,r,a)=>{try{const{error:i}=await window.ezsite.apis.tableCreate("11756",{product_id:e,field_name:t,old_value:s?.toString()||"",new_value:r?.toString()||"",change_date:(new Date).toISOString(),changed_by:a});i&&console.error("Error logging field change to legacy table:",i);const{error:c}=await window.ezsite.apis.tableCreate("24010",{product_id:e,field_name:t,old_value:s?.toString()||"",new_value:r?.toString()||"",change_timestamp:(new Date).toISOString(),changed_by:a,change_type:"update",change_summary:`Updated ${t.replace(/_/g," ")} from "${s}" to "${r}"`});c&&console.error("Error logging field change to changelog:",c)}catch(i){console.error("Error logging field change:",i)}},we=_e(oe.unit_price),ye=L.filter(e=>e.vendor_name&&""!==e.vendor_name.trim()),be=te.filter(e=>e.category_name&&""!==e.category_name.trim());return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>E("/products"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Back to Products"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:D?"Edit Product":"Add New Product"}),e.jsx("p",{className:"text-muted-foreground",children:D?"Update product information":"Add a new product to your inventory"})]})]}),e.jsxs(a,{open:ie,onOpenChange:ce,children:[e.jsx(i,{asChild:!0,children:e.jsxs(c,{variant:"outline",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Bulk Upload"]})}),e.jsxs(n,{className:"max-w-6xl max-h-[80vh] overflow-auto",children:[e.jsxs(l,{children:[e.jsx(o,{children:"Bulk Product Upload"}),e.jsx(g,{children:'Upload a CSV file with product data. Click "Download Template" for the correct format.'})]}),0===re.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Upload CSV File"}),e.jsxs(c,{variant:"outline",onClick:()=>{const e=["Product Name,Weight,Weight Unit,Department,Merchant,Case Price,Unit Per Case,Unit Price,Retail Price,Category,Supplier,Description","Example Product,12,oz,Food & Beverages,,24.00,24,1.00,1.99,Soft Drinks,Example Supplier,Example description"].join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),r=document.createElement("a");r.style.display="none",r.href=s,r.download="product_import_template.csv",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)},children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Download Template"]})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(O,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Upload CSV File"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a CSV file containing product data"}),e.jsx(_,{type:"file",accept:".csv",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const s=new FileReader;s.onload=e=>{try{const t=e.target?.result,s=t.split("\n").filter(e=>e.trim()),r=s[0].split(",").map(e=>e.trim().toLowerCase()),a=s.slice(1).map((e,t)=>{const s=e.split(","),a={};return r.forEach((e,t)=>{let r=s[t]?.trim()||"";const i={"product name":"product_name",product_name:"product_name",weight:"weight","weight unit":"weight_unit",weight_unit:"weight_unit",department:"department",merchant:"merchant_id",merchant_id:"merchant_id","last shopping date":"last_shopping_date",last_shopping_date:"last_shopping_date","case price":"case_price",case_price:"case_price","unit per case":"unit_per_case",unit_per_case:"unit_per_case","unit price":"unit_price",unit_price:"unit_price","retail price":"retail_price",retail_price:"retail_price",category:"category",supplier:"supplier",description:"description"}[e]||e;["weight","case_price","unit_per_case","unit_price","retail_price","merchant_id"].includes(i)&&(r=r&&parseFloat(r)||0),a[i]=r}),a.case_price>0&&a.unit_per_case>0&&!a.unit_price&&(a.unit_price=Math.round(a.case_price/a.unit_per_case*100)/100),a.unit_price>0&&!a.retail_price&&(a.retail_price=_e(a.unit_price)),a});ae(a),ce(!0)}catch(t){k({variant:"destructive",title:"Error",description:"Failed to parse CSV file. Please check the format."})}},s.readAsText(t)},className:"max-w-xs mx-auto"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Required Columns:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Product Name (required)"}),e.jsx("li",{children:"â€¢ Weight, Weight Unit, Department, Merchant"}),e.jsx("li",{children:"â€¢ Case Price, Unit Per Case, Unit Price, Retail Price"}),e.jsx("li",{children:"â€¢ Category, Supplier, Description"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Preview Import Data (",re.length," products)"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(c,{variant:"outline",onClick:()=>{ae([]),ce(!1)},children:"Cancel"}),e.jsx(c,{onClick:async()=>{if(I){le(!0);try{let t=0,s=0;const r=[],a=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"serial_number",IsAsc:!1,Filters:[]});let i=a.data?.List?.[0]?.serial_number||0;for(const c of re)try{if(!c.product_name?.trim()){r.push(`Row ${t+s+1}: Product name is required`),s++;continue}const e={serial_number:i+t+1,product_name:c.product_name.trim(),last_updated_date:(new Date).toISOString(),overdue:!1,weight:c.weight||0,weight_unit:c.weight_unit||"lb",department:c.department||"Convenience Store",case_price:c.case_price||0,unit_per_case:c.unit_per_case||1,unit_price:c.unit_price||0,retail_price:c.retail_price||0,category:c.category||"",supplier:c.supplier||"",description:c.description||"",quantity_in_stock:0,minimum_stock:0,bar_code_case:"",bar_code_unit:"",created_by:I.user_id};c.merchant_id&&(e.merchant_id=parseInt(c.merchant_id)),c.last_shopping_date&&(e.last_shopping_date=new Date(c.last_shopping_date).toISOString());const{error:a}=await window.ezsite.apis.tableCreate("11726",e);a?(r.push(`${c.product_name}: ${a}`),s++):t++}catch(e){const t=e instanceof Error?e.message:"Unknown error";r.push(`${c.product_name||"Unknown"}: ${t}`),s++}k(t>0?{title:"Import Complete",description:`Successfully imported ${t} products. ${s>0?`${s} errors occurred.`:""}`}:{variant:"destructive",title:"Import Failed",description:`No products were imported. ${s} errors occurred.`}),r.length>0&&console.error("Import errors:",r),t>0&&(ce(!1),ae([]),E("/products"))}catch(e){console.error("Bulk import error:",e),k({variant:"destructive",title:"Import Failed",description:e instanceof Error?e.message:"Failed to import product data."})}finally{le(!1)}}else k({variant:"destructive",title:"Error",description:"User profile not found."})},disabled:ne,children:ne?"Importing...":"Import Products"})]})]}),e.jsx("div",{className:"border rounded-lg max-h-96 overflow-auto",children:e.jsxs(q,{children:[e.jsx(R,{children:e.jsxs(W,{children:[e.jsx(V,{children:"Product Name"}),e.jsx(V,{children:"Weight"}),e.jsx(V,{children:"Department"}),e.jsx(V,{children:"Case Price"}),e.jsx(V,{children:"Unit Price"}),e.jsx(V,{children:"Retail Price"}),e.jsx(V,{children:"Profit %"})]})}),e.jsx(G,{children:re.map((t,s)=>{const r=t.unit_price>0&&t.retail_price>0?((t.retail_price-t.unit_price)/t.retail_price*100).toFixed(1):"0";return e.jsxs(W,{children:[e.jsx(H,{className:"font-medium",children:t.product_name}),e.jsxs(H,{children:[t.weight," ",t.weight_unit]}),e.jsx(H,{children:t.department}),e.jsxs(H,{children:["$",t.case_price?.toFixed(2)||"0.00"]}),e.jsxs(H,{children:["$",t.unit_price?.toFixed(2)||"0.00"]}),e.jsxs(H,{children:["$",t.retail_price?.toFixed(2)||"0.00"]}),e.jsx(H,{children:e.jsxs(h,{variant:parseFloat(r)>20?"default":"secondary",children:[r,"%"]})})]},s)})})]})})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(u,{children:D?"Edit Product":"New Product"}),e.jsx(j,{children:D?"Update the product information below":"Enter the product details below"})]}),e.jsx(p,{children:e.jsx(r,{componentName:"Product Form",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),oe.product_name.trim())if(I){$(!0);try{const e={...oe,last_updated_date:(new Date).toISOString(),last_shopping_date:oe.last_shopping_date?new Date(oe.last_shopping_date).toISOString():null,merchant_id:oe.merchant_id?parseInt(oe.merchant_id):null,created_by:I.user_id};let s,r=null;if(D){const{error:t}=await window.ezsite.apis.tableUpdate("11726",{ID:parseInt(F),...e});s=t}else{const{error:a}=await window.ezsite.apis.tableCreate("11726",e);if(s=a,!a)try{const{data:t}=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"serial_number",IsAsc:!1,Filters:[{name:"serial_number",op:"Equal",value:e.serial_number}]});r=t?.List?.[0]?.ID}catch(t){console.error("Error getting new product ID:",t)}}if(s)throw s;if(D&&pe&&I){const e=["last_shopping_date","case_price","unit_per_case","unit_price","retail_price"];for(const r of e){const e=pe[r],t=oe[r];e!==t&&await ve(parseInt(F),r,e,t,I.user_id)}const t=pe.unit_price>0&&pe.retail_price>0?(pe.retail_price-pe.unit_price)/pe.retail_price*100:0,s=oe.profit_margin;Math.abs(t-s)>.01&&await ve(parseInt(F),"profit_margin",t.toFixed(2),s.toFixed(2),I.user_id)}k({title:"Success",description:`Product ${D?"updated":"created"} successfully.`}),E("/products")}catch(s){console.error("Error saving product:",s),k({variant:"destructive",title:"Error",description:`Failed to ${D?"update":"create"} product.`})}finally{$(!1)}}else k({variant:"destructive",title:"Error",description:"User profile not found."});else k({variant:"destructive",title:"Validation Error",description:"Product name is required."})},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"product_name",children:"Product Name *"}),e.jsx(_,{id:"product_name",placeholder:"Enter product name",value:oe.product_name,onChange:e=>je("product_name",e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"category",children:"Category"}),e.jsx(b,{value:oe.category,onValueChange:e=>je("category",e),children:e.jsx(N,{children:be.map(t=>e.jsx(S,{value:t.category_name,children:t.category_name},t.id))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"weight",children:"Weight"}),e.jsx(w,{id:"weight",step:.01,min:0,value:oe.weight,onChange:e=>je("weight",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"weight_unit",children:"Weight Unit (USA Measurements)"}),e.jsxs(b,{value:oe.weight_unit,onValueChange:e=>je("weight_unit",e),children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Select unit"})}),e.jsx(N,{children:[{value:"lb",label:"Pounds (lb)"},{value:"oz",label:"Ounces (oz)"},{value:"ton",label:"Tons"},{value:"fl_oz",label:"Fluid Ounces (fl oz)"},{value:"gal",label:"Gallons (gal)"},{value:"qt",label:"Quarts (qt)"},{value:"pt",label:"Pints (pt)"},{value:"cup",label:"Cups"},{value:"tbsp",label:"Tablespoons (tbsp)"},{value:"tsp",label:"Teaspoons (tsp)"}].map(t=>e.jsx(S,{value:t.value,children:t.label},t.value))})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Combined: ",oe.weight," ",oe.weight_unit]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"department",children:"Department"}),e.jsxs(b,{value:oe.department,onValueChange:e=>je("department",e),children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Select department"})}),e.jsx(N,{children:["Convenience Store","Fuel & Oil","Automotive","Food & Beverages","Tobacco Products","Lottery & Gaming","Health & Personal Care","Electronics & Accessories","Cleaning Supplies","Office Supplies","Snacks & Candy","Hot Foods & Coffee","Cold Beverages","Energy Drinks","Beer & Wine","Ice & Frozen","Phone Cards & Prepaid","Car Accessories","Gift Cards","Pharmacy & Medicine"].map(t=>e.jsx(S,{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"merchant_id",children:"Merchant"}),e.jsxs(b,{value:oe.merchant_id,onValueChange:e=>je("merchant_id",e),children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Select merchant"})}),e.jsx(N,{children:ye.map(t=>e.jsx(S,{value:t.id.toString(),children:t.vendor_name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"last_updated_date",children:"Last Updated Date"}),e.jsx(_,{id:"last_updated_date",type:"date",value:oe.last_updated_date,onChange:e=>je("last_updated_date",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"last_shopping_date",children:"Last Shopping Date"}),e.jsx(_,{id:"last_shopping_date",type:"date",value:oe.last_shopping_date,onChange:e=>je("last_shopping_date",e.target.value)})]})]}),e.jsx(v,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Pricing Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"case_price",children:"Case Price ($)"}),e.jsx(w,{id:"case_price",step:.01,min:0,value:oe.case_price,onChange:e=>je("case_price",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"unit_per_case",children:"Unit Per Case"}),e.jsx(w,{id:"unit_per_case",min:1,value:oe.unit_per_case,onChange:e=>je("unit_per_case",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"unit_price",children:"Unit Price ($)"}),e.jsx(w,{id:"unit_price",step:.01,min:0,value:oe.unit_price,onChange:e=>je("unit_price",e)}),oe.case_price>0&&oe.unit_per_case>0&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Auto-calculated from case price"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"retail_price",children:"Retail Price ($)"}),e.jsx(w,{id:"retail_price",step:.01,min:0,value:oe.retail_price,onChange:e=>je("retail_price",e)}),oe.unit_price>0&&Math.abs(oe.retail_price-we)<.01&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Auto-calculated from unit price"]}),oe.unit_price>0&&Math.abs(oe.retail_price-we)>=.01&&e.jsxs("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:"text-sm font-medium text-red-800",children:["Suggested: $",we.toFixed(2)]})]}),e.jsx(c,{type:"button",size:"sm",variant:"outline",onClick:()=>je("retail_price",we),className:"text-xs h-6 px-2",children:"Apply"})]}),e.jsxs("p",{className:"text-xs text-red-700 mt-1",children:[oe.unit_price<4?"+65%":oe.unit_price<6?"+55%":oe.unit_price<8?"+45%":oe.unit_price<10?"+35%":"+25%"," markup, rounded to .25/.49/.75/.99"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"profit_margin",children:"Profit Margin (%)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"profit_margin",step:.01,value:oe.profit_margin,disabled:!0,className:"bg-muted"}),e.jsx(h,{variant:oe.profit_margin>20?"default":"secondary",children:oe.profit_margin>20?"Good":"Low"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Auto-calculated from unit and retail price"})]})]})]}),e.jsx(v,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Additional Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"supplier",children:"Supplier"}),e.jsx(_,{id:"supplier",placeholder:"Enter supplier name",value:oe.supplier,onChange:e=>je("supplier",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Stock Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(w,{placeholder:"Current Stock",value:oe.quantity_in_stock,onChange:e=>je("quantity_in_stock",e),min:0}),e.jsx(w,{placeholder:"Min Stock",value:oe.minimum_stock,onChange:e=>je("minimum_stock",e),min:0})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current stock / Minimum stock level"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"description",children:"Description"}),e.jsx(y,{id:"description",placeholder:"Enter product description",rows:4,value:oe.description,onChange:e=>je("description",e.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"bar_code_case",children:"Barcode (Case)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{id:"bar_code_case",placeholder:"Scan or enter case barcode",value:oe.bar_code_case,onChange:e=>je("bar_code_case",e.target.value)}),e.jsx(Z,{onScan:e=>fe("bar_code_case",e)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"bar_code_unit",children:"Barcode (Unit)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{id:"bar_code_unit",placeholder:"Scan or enter unit barcode",value:oe.bar_code_unit,onChange:e=>je("bar_code_unit",e.target.value)}),e.jsx(Z,{onScan:e=>fe("bar_code_unit",e)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-medium",children:"Product Images & Documents"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Product Image"}),e.jsx(Q,{accept:"image/*",label:"Upload Product Image",maxSize:5,useDatabaseStorage:!0,associatedTable:"products",associatedRecordId:parseInt(F||"0"),fileCategory:"product_image",showPreview:!0,onFileUpload:e=>{k({title:"Image uploaded",description:`${e.fileName} has been uploaded successfully`})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Product Documents"}),e.jsx(Q,{accept:".pdf,.doc,.docx,.txt",label:"Upload Documents",maxSize:10,useDatabaseStorage:!0,associatedTable:"products",associatedRecordId:parseInt(F||"0"),fileCategory:"product_document",showPreview:!0,onFileUpload:e=>{k({title:"Document uploaded",description:`${e.fileName} has been uploaded successfully`})}})]})]})]}),D&&parseInt(F||"0")>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-medium",children:"Uploaded Files"}),e.jsx(ee,{associatedTable:"products",associatedRecordId:parseInt(F||"0"),allowDelete:!0,allowEdit:!1,showDescription:!0,viewMode:"grid"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>E("/products"),children:"Cancel"}),e.jsxs(c,{type:"submit",disabled:z,children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),z?"Saving...":D?"Update Product":"Create Product"]})]})]})})})]})]})};export{te as default};
