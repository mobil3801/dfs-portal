import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{l as a,B as t,C as n,f as i,g as r,h as l,T as o,q as d,r as c,s as m,k as u,L as h,I as x,e as g,A as p,n as j}from"./index-MtEqlP9w.js";import{S as f}from"./switch-DeYgkLk2.js";import{T as S}from"./textarea-C6nhb218.js";import{C as y,b,D as v,a7 as w,S as _,_ as N,R as C,aH as k,T as M,ao as F,ab as E}from"./utilities-BBdJI3Xi.js";import"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";const P=[{code:"+1",name:"United States/Canada",enabled:!0},{code:"+44",name:"United Kingdom",enabled:!0},{code:"+61",name:"Australia",enabled:!0},{code:"+64",name:"New Zealand",enabled:!0},{code:"+33",name:"France",enabled:!0},{code:"+49",name:"Germany",enabled:!0},{code:"+81",name:"Japan",enabled:!0},{code:"+86",name:"China",enabled:!1},{code:"+91",name:"India",enabled:!0},{code:"+55",name:"Brazil",enabled:!0}],D=()=>{const{toast:D}=a(),[I,T]=s.useState({service_name:"ClickSend",username:"mobil3801beach@gmail.com",api_key:"54DC23E4-34D7-C6B1-0601-112E36A46B49",from_number:"DFS",test_mode:!1,is_enabled:!0,daily_limit:100,webhook_url:""}),[$,U]=s.useState(!1),[A,L]=s.useState(""),[z,B]=s.useState("This is a test message from DFS Manager SMS system."),[O,R]=s.useState("unknown"),[W,q]=s.useState([]),[H,K]=s.useState({used:0,limit:100,percentage:0}),[V,G]=s.useState(null);s.useEffect(()=>{X(),Y(),Z()},[]);const J=e=>{if("number"==typeof e&&!isNaN(e))return e;if("string"==typeof e){const s=parseFloat(e);return isNaN(s)?0:s}return 0},Q=e=>{for(const s of P)if(e.startsWith(s.code))return{valid:!0,country:s.name,enabled:s.enabled};return{valid:!1}},X=async()=>{try{const{data:e,error:s}=await window.ezsite.apis.tablePage(24201,{PageNo:1,PageSize:1,OrderByField:"id",IsAsc:!1,Filters:[]});if(s)throw new Error(s);if(e?.List&&e.List.length>0){const s=e.List[0];T({id:s.id,service_name:s.service_name||"ClickSend",username:s.username||"mobil3801beach@gmail.com",api_key:s.api_key||"54DC23E4-34D7-C6B1-0601-112E36A46B49",from_number:s.from_number||"DFS",test_mode:s.test_mode||!1,is_enabled:!1!==s.is_enabled,daily_limit:s.daily_limit||100,webhook_url:s.webhook_url||""})}}catch(e){console.error("Error loading SMS configuration:",e),D({title:"Configuration Load Warning",description:"Using default ClickSend configuration. Save to persist settings.",variant:"default"})}},Y=async()=>{try{const{data:e,error:s}=await window.ezsite.apis.tablePage(24202,{PageNo:1,PageSize:50,OrderByField:"sent_at",IsAsc:!1,Filters:[]});if(s)throw new Error(s);q(e?.List||[])}catch(e){console.error("Error loading SMS logs:",e)}},Z=async()=>{try{const e=(new Date).toISOString().split("T")[0],{data:s,error:a}=await window.ezsite.apis.tablePage(24202,{PageNo:1,PageSize:1,OrderByField:"id",IsAsc:!1,Filters:[{name:"sent_at",op:"StringStartsWith",value:e},{name:"status",op:"Equal",value:"Sent"}]});if(a)throw new Error(a);const t=s?.VirtualCount||0,n=I.daily_limit;K({used:t,limit:n,percentage:n>0?t/n*100:0})}catch(e){console.error("Error loading daily usage:",e)}},ee=s=>{switch(s?.toLowerCase()){case"sent":case"success":return e.jsxs(t,{variant:"default",className:"bg-green-500",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Sent"]});case"failed":case"error":return e.jsxs(t,{variant:"destructive",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Failed"]});case"pending":return e.jsxs(t,{variant:"secondary",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return e.jsx(t,{variant:"outline",children:s})}},se=e=>{const s=J(e);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:4}).format(s)};return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"SMS Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage ClickSend SMS service configuration and monitor message activity"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:["connected"===O&&e.jsxs(t,{variant:"default",className:"bg-green-500",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Connected"]}),"error"===O&&e.jsxs(t,{variant:"destructive",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Disconnected"]}),null!==V&&e.jsxs(t,{variant:"outline",children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),"Balance: ",se(V)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Daily Usage"}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[H.used,"/",H.limit]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(H.percentage,100)}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[H.percentage.toFixed(1),"% of daily limit"]})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Service Status"}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:I.is_enabled?"Active":"Disabled"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["ClickSend SMS ",I.test_mode?"(Test Mode)":"(Production)"]})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(r,{className:"text-sm font-medium",children:"Recent Messages"}),e.jsx(N,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:W.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total messages logged"})]})]})]}),e.jsxs(o,{defaultValue:"config",className:"space-y-4",children:[e.jsxs(d,{children:[e.jsx(c,{value:"config",children:"Configuration"}),e.jsx(c,{value:"test",children:"Send Test SMS"}),e.jsx(c,{value:"logs",children:"Message Logs"}),e.jsx(c,{value:"countries",children:"Supported Countries"})]}),e.jsx(m,{value:"config",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(i,{children:[e.jsx(r,{children:"ClickSend Configuration"}),e.jsx(u,{children:"Configure your ClickSend SMS service credentials and settings"})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"username",children:"ClickSend Username/Email"}),e.jsx(x,{id:"username",value:I.username,onChange:e=>T({...I,username:e.target.value}),placeholder:"your-email@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"api_key",children:"API Key"}),e.jsx(x,{id:"api_key",type:"password",value:I.api_key,onChange:e=>T({...I,api_key:e.target.value}),placeholder:"Your ClickSend API Key"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"from_number",children:"Default Sender Name"}),e.jsx(x,{id:"from_number",value:I.from_number,onChange:e=>T({...I,from_number:e.target.value}),placeholder:"DFS"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"daily_limit",children:"Daily SMS Limit"}),e.jsx(x,{id:"daily_limit",type:"number",value:I.daily_limit,onChange:e=>T({...I,daily_limit:parseInt(e.target.value)||100}),placeholder:"100"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"webhook_url",children:"Webhook URL (Optional)"}),e.jsx(x,{id:"webhook_url",value:I.webhook_url,onChange:e=>T({...I,webhook_url:e.target.value}),placeholder:"https://your-domain.com/sms-webhook"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"is_enabled",checked:I.is_enabled,onCheckedChange:e=>T({...I,is_enabled:e})}),e.jsx(h,{htmlFor:"is_enabled",children:"Enable SMS Service"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{id:"test_mode",checked:I.test_mode,onCheckedChange:e=>T({...I,test_mode:e})}),e.jsx(h,{htmlFor:"test_mode",children:"Test Mode"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(g,{onClick:async()=>{U(!0);try{const e={...I,updated_at:(new Date).toISOString()};if(I.id){const{error:s}=await window.ezsite.apis.tableUpdate(24201,{ID:I.id,...e});if(s)throw new Error(s)}else{const{error:s}=await window.ezsite.apis.tableCreate(24201,{...e,created_at:(new Date).toISOString()});if(s)throw new Error(s)}D({title:"Configuration Saved",description:"ClickSend SMS configuration has been saved successfully."}),await X()}catch(e){D({title:"Error",description:`Failed to save configuration: ${e}`,variant:"destructive"})}finally{U(!1)}},disabled:$,children:[$?e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(_,{className:"w-4 h-4 mr-2"}),"Save Configuration"]}),e.jsxs(g,{variant:"outline",onClick:async()=>{U(!0);try{if(!I.username||!I.api_key)throw new Error("Username and API key are required");const e=btoa(`${I.username}:${I.api_key}`),s=await fetch("https://rest.clicksend.com/v3/account",{method:"GET",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.response_msg||`HTTP ${s.status}: ${s.statusText}`);if(!a.data)throw new Error("Invalid response from ClickSend API");{R("connected");const e=J(a.data.balance);G(e),D({title:"Connection Successful",description:`ClickSend API connection is working correctly. Balance: $${e.toFixed(4)}`})}}catch(e){R("error"),D({title:"Connection Failed",description:`Failed to connect to ClickSend API: ${e}`,variant:"destructive"})}finally{U(!1)}},disabled:$,children:[$?e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(k,{className:"w-4 h-4 mr-2"}),"Test Connection"]})]})]})]})}),e.jsx(m,{value:"test",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(i,{children:[e.jsx(r,{children:"Send Test SMS"}),e.jsx(u,{children:"Send a test SMS message to verify your ClickSend configuration"})]}),e.jsxs(l,{className:"space-y-4",children:[!I.is_enabled&&e.jsxs(p,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(j,{children:"SMS service is currently disabled. Enable it in the Configuration tab to send messages."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"test_phone",children:"Phone Number"}),e.jsx(x,{id:"test_phone",value:A,onChange:e=>L(e.target.value),placeholder:"+1234567890",disabled:!I.is_enabled}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use E.164 format (e.g., +1234567890). Check Supported Countries tab for available destinations."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"test_message",children:"Message"}),e.jsx(S,{id:"test_message",value:z,onChange:e=>B(e.target.value),placeholder:"Enter your test message here...",rows:3,disabled:!I.is_enabled}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[z.length,"/160 characters"]})]}),e.jsxs(g,{onClick:async()=>{if(!A||!z)return void D({title:"Missing Information",description:"Please enter both phone number and message.",variant:"destructive"});if(!/^\+\d{10,15}$/.test(A))return void D({title:"Invalid Phone Number",description:"Please use E.164 format (+1234567890)",variant:"destructive"});const e=Q(A);if(e.valid)if(e.enabled){U(!0);try{if(!I.username||!I.api_key)throw new Error("SMS service not configured. Please configure credentials first.");const e=btoa(`${I.username}:${I.api_key}`),a={messages:[{source:I.from_number,to:A,body:z}]},t=await fetch("https://rest.clicksend.com/v3/sms/send",{method:"POST",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await t.json();if(!t.ok||!n.data?.messages?.[0]){let e=n.response_msg||n.error_message||(n.data&&"string"==typeof n.data?n.data:"")||`HTTP ${t.status}: ${t.statusText}`;if(e.toLowerCase().includes("country not enable")||e.toLowerCase().includes("country is not enabled")){e=`SMS sending to ${Q(A).country||"this country"} is not enabled in your ClickSend account. Please enable this destination country in your ClickSend dashboard or contact ClickSend support.`}throw new Error(e)}{const e=n.data.messages[0];try{await window.ezsite.apis.tableCreate(24202,{recipient_phone:A,message_content:z,sender_name:I.from_number,status:"SUCCESS"===e.status?"Sent":"Failed",sent_at:(new Date).toISOString(),message_id:e.message_id||"",clicksend_message_id:e.message_id||"",cost:J(e.message_price),error_message:"SUCCESS"!==e.status?e.custom_string||"Unknown error":"",message_type:"test",sent_by_user_id:1})}catch(s){console.error("Failed to log SMS:",s)}if("SUCCESS"!==e.status){let s=e.custom_string||e.status||"Failed to send SMS";if(s.toLowerCase().includes("country not enable")||s.toLowerCase().includes("country is not enabled")){s=`SMS sending to ${Q(A).country||"this country"} is not enabled in your ClickSend account. Please enable this destination country in your ClickSend dashboard.`}throw new Error(s)}{const s=J(e.message_price);D({title:"Test SMS Sent Successfully",description:`Message sent to ${A}. Message ID: ${e.message_id}. Cost: $${s.toFixed(4)}`})}}await Y(),await Z()}catch(a){console.error("SMS sending error:",a);try{await window.ezsite.apis.tableCreate(24202,{recipient_phone:A,message_content:z,sender_name:I.from_number,status:"Failed",sent_at:(new Date).toISOString(),message_id:"",clicksend_message_id:"",cost:0,error_message:a instanceof Error?a.message:"Unknown error",message_type:"test",sent_by_user_id:1})}catch(s){console.error("Failed to log SMS error:",s)}D({title:"Test SMS Failed",description:`Failed to send test SMS: ${a}`,variant:"destructive"})}finally{U(!1)}}else D({title:"Country Not Enabled",description:`SMS sending to ${e.country} is not enabled in your ClickSend account. Please enable this country in your ClickSend dashboard or contact support.`,variant:"destructive"});else D({title:"Unsupported Country",description:"The phone number's country code is not recognized. Please use a supported country code.",variant:"destructive"})},disabled:$||!I.is_enabled||!A||!z,className:"w-full",children:[$?e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(F,{className:"w-4 h-4 mr-2"}),"Send Test SMS"]})]})]})}),e.jsx(m,{value:"logs",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(r,{children:"SMS Message Logs"}),e.jsx(u,{children:"View and monitor all SMS messages sent through the system"})]}),e.jsxs(g,{variant:"outline",onClick:Y,children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:0===W.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No SMS messages found"})]}):e.jsx("div",{className:"space-y-2",children:W.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:s.recipient_phone}),ee(s.status),e.jsx(t,{variant:"outline",children:s.message_type})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.sent_at).toLocaleString()})]}),e.jsx("p",{className:"text-sm",children:s.message_content}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["From: ",s.sender_name]}),e.jsxs("span",{children:["Cost: ",se(s.cost)]}),s.message_id&&e.jsxs("span",{children:["ID: ",s.message_id]})]}),s.error_message&&e.jsxs("div",{className:"text-xs text-destructive bg-destructive/10 p-2 rounded",children:["Error: ",s.error_message]})]},s.id))})})})]})}),e.jsx(m,{value:"countries",className:"space-y-4",children:e.jsxs(n,{children:[e.jsxs(i,{children:[e.jsx(r,{children:"Supported Countries"}),e.jsx(u,{children:"Countries and regions where SMS sending is supported by ClickSend"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:P.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.code})]})]}),e.jsx(t,{variant:s.enabled?"default":"secondary",children:s.enabled?"Enabled":"Disabled"})]},s.code))}),e.jsxs(p,{className:"mt-4",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(j,{children:'If a country shows as "Disabled" or you receive a "country not enabled" error, you need to enable SMS sending for that country in your ClickSend dashboard. Contact ClickSend support if you need assistance enabling additional countries.'})]})]})]})})]})]})};export{D as default};
