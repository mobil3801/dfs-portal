import{j as e}from"./radix-ui-Crli8-Dx.js";import{r as t}from"./react-core-CKNU0hQt.js";import{E as s,C as r,g as a,h as i,i as c,A as n,m as l,f as o,n as d,o as p,B as m,u as h,I as u,T as x,a as g,b as _,c as j,d as f,e as v,l as y,L as w,S as b}from"./index-CNwujOOT.js";import{N}from"./number-input-32DdsYWC.js";import{T as S}from"./textarea-O8-dWWy-.js";import{S as C,a as F,b as P,c as E,d as k}from"./select-Cf4csPfA.js";import{D,e as I,a as U,b as z,c as R,d as $}from"./dialog-W_eRI_WK.js";import{T as O,R as B,N as T,Z as q,X as A,_ as L,w as M,$ as W,O as V,a0 as G,a1 as H,F as Q,G as J,a2 as Y,a3 as Z,D as K}from"./utilities-BH0DC7Sl.js";import{E as X}from"./EnhancedFileUpload-DdLsSebB.js";import{f as ee}from"./imageCompression-DvX-F3tO.js";import{u as te,d as se}from"./routing-DcURAnU1.js";import"./data-management-CVsxhheF.js";import"./animations-CAl9KjXG.js";class re extends t.Component{errorLogger;constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null},this.errorLogger=s.getInstance()}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){const s=this.props.formName||"Unknown Form";this.errorLogger.log(e,"high",`FormErrorBoundary - ${s}`,t,{form:s,url:window.location.href,timestamp:(new Date).toISOString(),formData:this.attemptFormDataRecovery()}),this.setState({error:e,errorInfo:t})}attemptFormDataRecovery=()=>{try{const e=document.querySelectorAll("input, select, textarea"),t={};return e.forEach(e=>{if(e.name||e.id){const s=e.name||e.id;"checkbox"===e.type||"radio"===e.type?t[s]=e.checked:t[s]=e.value}}),t}catch(e){return console.warn("Failed to recover form data:",e),{}}};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleFormReset=()=>{this.props.onFormReset&&this.props.onFormReset(),this.handleReset()};handleDataSave=()=>{this.props.onDataSave&&this.props.onDataSave()};render(){if(this.state.hasError&&this.state.error){if(this.props.fallback){const t=this.props.fallback;return e.jsx(t,{error:this.state.error,resetError:this.handleReset,errorInfo:this.state.errorInfo,formName:this.props.formName,onFormReset:this.handleFormReset,onDataSave:this.handleDataSave})}return e.jsxs(r,{className:"bg-red-50 border-red-200 border-2",children:[e.jsx(a,{className:"pb-3",children:e.jsxs(i,{className:"flex items-center gap-2 text-red-800 text-lg",children:[e.jsx(O,{size:20}),"Form Error Detected"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs(n,{className:"border-red-300 bg-red-100",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs(l,{className:"text-red-800",children:["An error occurred while processing the"," ",this.props.formName?`${this.props.formName} form`:"form",".",this.props.showDataRecovery&&e.jsx("span",{className:"block mt-1 text-sm",children:"Your form data may have been preserved and can be recovered."})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("p",{className:"text-sm text-red-700",children:[e.jsx("strong",{children:"Error:"})," ",this.state.error.message]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(o,{onClick:this.handleReset,variant:"default",size:"sm",className:"flex items-center gap-2",children:[e.jsx(B,{size:16}),"Retry Form"]}),this.props.onFormReset&&e.jsxs(o,{onClick:this.handleFormReset,variant:"outline",size:"sm",className:"flex items-center gap-2 border-red-300 text-red-700 hover:bg-red-100",children:[e.jsx(B,{size:16}),"Reset Form"]}),this.props.showDataRecovery&&this.props.onDataSave&&e.jsxs(o,{onClick:this.handleDataSave,variant:"secondary",size:"sm",className:"flex items-center gap-2",children:[e.jsx(T,{size:16}),"Save Draft"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 text-sm mb-2",children:"Recovery Tips:"}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• Try refreshing the page and filling out the form again"}),e.jsx("li",{children:"• Check that all required fields are properly filled"}),e.jsx("li",{children:"• Ensure your internet connection is stable"}),this.props.showDataRecovery&&e.jsx("li",{children:'• Use "Save Draft" to preserve your current data'})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-xs text-red-600 hover:text-red-800",children:"Technical Details"}),e.jsxs("div",{className:"mt-2 bg-red-100 p-2 rounded text-xs font-mono text-red-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Component:"})," ",this.props.formName||"Form"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error Type:"})," ",this.state.error.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Time:"})," ",(new Date).toLocaleString()]})]})]})]})]})}return this.props.children}}const ae=({onScan:s,triggerText:r="Scan Barcode",disabled:a=!1})=>{const i=t.useRef(null),c=t.useRef(null),[n,l]=t.useState(!1),[m,h]=t.useState(null),[u,x]=t.useState(!1),{toast:g}=d(),_=()=>{m&&(m.getTracks().forEach(e=>e.stop()),h(null),x(!1))};return t.useEffect(()=>(n?(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});i.current&&(i.current.srcObject=e,h(e),x(!0))}catch(e){console.error("Error accessing camera:",e),g({variant:"destructive",title:"Camera Error",description:"Unable to access camera. Please check permissions."})}})():_(),()=>{_()}),[n]),e.jsx(p,{componentName:"BarcodeScanner",severity:"medium",minHeight:"200px",children:e.jsxs(D,{open:n,onOpenChange:l,children:[e.jsx(I,{asChild:!0,children:e.jsxs(o,{type:"button",variant:"outline",size:"sm",disabled:a,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),r]})}),e.jsxs(U,{className:"sm:max-w-md",children:[e.jsx(z,{children:e.jsx(R,{children:"Scan Barcode"})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative w-full max-w-sm aspect-video bg-black rounded-lg overflow-hidden",children:[e.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:c,className:"hidden"}),!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{children:"Initializing camera..."})]})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{onClick:()=>{if(i.current&&c.current){const e=i.current,t=c.current,r=t.getContext("2d");if(r){t.width=e.videoWidth,t.height=e.videoHeight,r.drawImage(e,0,0);const a=Math.random().toString(36).substr(2,12).toUpperCase();s(a),l(!1),_(),g({title:"Barcode Scanned",description:`Detected barcode: ${a}`})}}},disabled:!u,children:"Capture"}),e.jsxs(o,{variant:"outline",onClick:()=>l(!1),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Position the barcode within the camera view and click Capture"})]})]})]})})},ie=({associatedTable:s,associatedRecordId:n,fileCategory:l,allowDelete:p=!1,allowEdit:h=!1,showDescription:u=!0,className:x="",viewMode:g="grid"})=>{const[_,j]=t.useState([]),[f,v]=t.useState(!0),[y,w]=t.useState(null),[b,N]=t.useState(!1),{toast:S}=d();t.useEffect(()=>{C()},[s,n,l]);const C=async()=>{try{v(!0);const e=[{name:"associated_table",op:"Equal",value:s},{name:"associated_record_id",op:"Equal",value:n},{name:"is_active",op:"Equal",value:!0}];l&&e.push({name:"file_category",op:"Equal",value:l});const{data:t,error:r}=await window.ezsite.apis.tablePage(26928,{PageNo:1,PageSize:100,OrderByField:"upload_date",IsAsc:!1,Filters:e});if(r)throw r;j(t.List||[])}catch(e){console.error("Error loading files:",e),S({title:"Error loading files",description:"string"==typeof e?e:"Failed to load files",variant:"destructive"})}finally{v(!1)}},F=e=>{e.file_url&&window.open(e.file_url,"_blank")},P=t=>t.startsWith("image/")?e.jsx(G,{className:"h-5 w-5 text-blue-600"}):t.startsWith("video/")?e.jsx(H,{className:"h-5 w-5 text-purple-600"}):t.includes("pdf")?e.jsx(Q,{className:"h-5 w-5 text-red-600"}):e.jsx(L,{className:"h-5 w-5 text-gray-600"}),E=e=>e.split("/")[1]?.toUpperCase()||"FILE",k=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),I=e=>{const t={document:"bg-blue-100 text-blue-800",image:"bg-green-100 text-green-800",receipt:"bg-yellow-100 text-yellow-800",invoice:"bg-purple-100 text-purple-800",report:"bg-orange-100 text-orange-800",license:"bg-indigo-100 text-indigo-800",certificate:"bg-pink-100 text-pink-800",general:"bg-gray-100 text-gray-800"};return t[e]||t.general};return f?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):0===_.length?e.jsx(r,{className:x,children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(L,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No files uploaded"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Files will appear here once uploaded"})]})}):e.jsxs("div",{className:x,children:[e.jsxs(r,{children:[e.jsx(a,{children:e.jsxs(i,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Uploaded Files"}),e.jsxs(m,{variant:"secondary",children:[_.length," files"]})]})}),e.jsx(c,{children:e.jsx("div",{className:"grid"===g?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3",children:_.map(t=>e.jsxs("div",{className:"p-4 border rounded-lg hover:shadow-md transition-shadow "+("list"===g?"flex items-center gap-4":""),children:[e.jsxs("div",{className:""+("list"===g?"flex items-center gap-3 flex-1":""),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[P(t.file_type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:t.file_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[ee(t.file_size)," • ",E(t.file_type)]})]})]}),u&&t.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:t.description}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.file_category&&e.jsx(m,{variant:"secondary",className:`text-xs ${I(t.file_category)}`,children:t.file_category}),e.jsx(m,{variant:"outline",className:"text-xs",children:k(t.upload_date)})]})})]}),e.jsxs("div",{className:"flex gap-2 "+("list"===g?"flex-shrink-0":"mt-3"),children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>(e=>{w(e),N(!0)})(t),children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>F(t),children:e.jsx(W,{className:"h-4 w-4"})}),p&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm(`Are you sure you want to delete "${e.file_name}"?`))try{const{error:t}=await window.ezsite.apis.tableUpdate(26928,{id:e.id,is_active:!1});if(t)throw t;S({title:"File deleted",description:"File has been successfully deleted"}),C()}catch(t){console.error("Error deleting file:",t),S({title:"Delete failed",description:"string"==typeof t?t:"Failed to delete file",variant:"destructive"})}})(t),className:"text-red-600 hover:text-red-700",children:e.jsx(V,{className:"h-4 w-4"})})]})]},t.id))})})]}),e.jsx(D,{open:b,onOpenChange:N,children:e.jsxs(U,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(z,{children:e.jsxs(R,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[y&&P(y.file_type),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:y?.file_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[y&&ee(y.file_size)," • ",y&&E(y.file_type)]})]})]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>N(!1),children:e.jsx(A,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-4",children:y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[y.file_category&&e.jsx(m,{className:I(y.file_category),children:y.file_category}),e.jsx(m,{variant:"outline",children:k(y.upload_date)})]}),e.jsxs(o,{onClick:()=>F(y),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Download"]})]}),y.description&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm",children:y.description})}),e.jsx("div",{className:"flex justify-center",children:($=y,$.file_type.startsWith("image/")?e.jsx("img",{src:$.file_url,alt:$.file_name,className:"max-w-full max-h-96 object-contain rounded-lg"}):"application/pdf"===$.file_type?e.jsx("iframe",{src:$.file_url,className:"w-full h-96 rounded-lg border",title:$.file_name}):e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 bg-gray-50 rounded-lg",children:[P($.file_type),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Preview not available"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click download to view this file"})]}))})]})})]})})]});var $},ce=()=>{const n=te(),{id:l}=se(),{toast:p}=d(),{userProfile:O}=h();((e={})=>{const{toast:r}=d(),a=s.getInstance(),{component:i="Unknown Component",showToast:c=!0,logError:n=!0,severity:l="medium"}=e,o=t.useCallback((e,t,s)=>{const o="string"==typeof e?new Error(e):e;n&&a.log(o,l,i,void 0,s),c&&r({variant:"destructive",title:"Error",description:t||o.message||"An unexpected error occurred"})},[i,c,n,l,r,a]),p=t.useCallback(async(e,t,s)=>{try{return await e()}catch(r){return o(r instanceof Error?r:new Error(String(r)),t,s),null}},[o]),m=t.useCallback(async(e,t,s)=>{try{const t=await e();if(t.error)throw new Error(t.error);return t.data||null}catch(r){return o(r instanceof Error?r:new Error(String(r)),t,s),null}},[o])})({component:"ProductForm",severity:"high"});const B=!!l,[q,A]=t.useState(!1),[L,M]=t.useState([]),[V,G]=t.useState([]),[H,Q]=t.useState([]),[ee,ce]=t.useState(!1),[ne,le]=t.useState(!1),[oe,de]=t.useState({product_name:"",weight:0,weight_unit:"lb",department:"Convenience Store",merchant_id:"",last_updated_date:(new Date).toISOString().split("T")[0],last_shopping_date:"",case_price:0,unit_per_case:1,unit_price:0,retail_price:0,profit_margin:0,category:"",supplier:"",quantity_in_stock:0,minimum_stock:0,description:"",bar_code_case:"",bar_code_unit:"",serial_number:0,overdue:!1}),[pe,me]=t.useState(null);t.useEffect(()=>{he(),ue(),B?ge():xe()},[l]),t.useEffect(()=>{if(oe.case_price>0&&oe.unit_per_case>0){const e=oe.case_price/oe.unit_per_case;de(t=>({...t,unit_price:Math.round(100*e)/100}))}},[oe.case_price,oe.unit_per_case]),t.useEffect(()=>{if(oe.unit_price>0){const e=_e(oe.unit_price);0===oe.retail_price&&de(t=>({...t,retail_price:e}))}else 0===oe.unit_price&&de(e=>({...e,retail_price:0}))},[oe.unit_price]),t.useEffect(()=>{if(oe.unit_price>0&&oe.retail_price>0){const e=(oe.retail_price-oe.unit_price)/oe.retail_price*100;de(t=>({...t,profit_margin:Math.round(100*e)/100}))}else de(e=>({...e,profit_margin:0}))},[oe.unit_price,oe.retail_price]);const he=async()=>{try{const{data:e,error:t}=await window.ezsite.apis.tablePage("11729",{PageNo:1,PageSize:100,OrderByField:"vendor_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(t)throw t;M(e?.List||[])}catch(e){console.error("Error fetching vendors:",e)}},ue=async()=>{try{const{data:e,error:t}=await window.ezsite.apis.tablePage("14389",{PageNo:1,PageSize:100,OrderByField:"category_name",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(t)throw t;G(e?.List||[])}catch(e){console.error("Error fetching categories:",e)}},xe=async()=>{try{const{data:e,error:t}=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"serial_number",IsAsc:!1,Filters:[]});if(t)throw t;const s=e?.List?.[0]?.serial_number||0;de(e=>({...e,serial_number:s+1}))}catch(e){console.error("Error generating serial number:",e),de(e=>({...e,serial_number:1}))}},ge=async()=>{if(l){A(!0);try{const{data:e,error:t}=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"ID",IsAsc:!0,Filters:[{name:"ID",op:"Equal",value:parseInt(l)}]});if(t)throw t;if(e?.List?.[0]){const t=e.List[0],s={product_name:t.product_name||"",weight:t.weight||0,weight_unit:t.weight_unit||"lb",department:t.department||"Convenience Store",merchant_id:t.merchant_id?.toString()||"",last_updated_date:t.last_updated_date?t.last_updated_date.split("T")[0]:"",last_shopping_date:t.last_shopping_date?t.last_shopping_date.split("T")[0]:"",case_price:t.case_price||0,unit_per_case:t.unit_per_case||1,unit_price:t.unit_price||0,retail_price:t.retail_price||0,profit_margin:0,category:t.category||"",supplier:t.supplier||"",quantity_in_stock:t.quantity_in_stock||0,minimum_stock:t.minimum_stock||0,description:t.description||"",bar_code_case:t.bar_code_case||"",bar_code_unit:t.bar_code_unit||"",serial_number:t.serial_number||0,overdue:t.overdue||!1};de(s),me(s)}}catch(e){console.error("Error fetching product:",e),p({variant:"destructive",title:"Error",description:"Failed to load product data."})}finally{A(!1)}}},_e=e=>{if(0===e)return 0;let t=0;t=e<4?65:e>=4&&e<6?55:e>=6&&e<8?45:e>=8&&e<10?35:25;const s=e*(1+t/100),r=Math.floor(s),a=s-r;let i=.99,c=Math.abs(a-.99);return[.25,.49,.75,.99].forEach(e=>{const t=Math.abs(a-e);t<c&&(c=t,i=e)}),r+i},je=(e,t)=>{de(s=>({...s,[e]:t}))},fe=(e,t)=>{de(s=>({...s,[e]:t})),p({title:"Barcode Scanned",description:`Barcode ${t} added to ${e.replace("_"," ")}`})},ve=async(e,t,s,r,a)=>{try{const{error:i}=await window.ezsite.apis.tableCreate("11756",{product_id:e,field_name:t,old_value:s?.toString()||"",new_value:r?.toString()||"",change_date:(new Date).toISOString(),changed_by:a});i&&console.error("Error logging field change to legacy table:",i);const{error:c}=await window.ezsite.apis.tableCreate("24010",{product_id:e,field_name:t,old_value:s?.toString()||"",new_value:r?.toString()||"",change_timestamp:(new Date).toISOString(),changed_by:a,change_type:"update",change_summary:`Updated ${t.replace(/_/g," ")} from "${s}" to "${r}"`});c&&console.error("Error logging field change to changelog:",c)}catch(i){console.error("Error logging field change:",i)}},ye=_e(oe.unit_price),we=L.filter(e=>e.vendor_name&&""!==e.vendor_name.trim()),be=V.filter(e=>e.category_name&&""!==e.category_name.trim());return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>n("/products"),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Back to Products"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:B?"Edit Product":"Add New Product"}),e.jsx("p",{className:"text-muted-foreground",children:B?"Update product information":"Add a new product to your inventory"})]})]}),e.jsxs(D,{open:ee,onOpenChange:ce,children:[e.jsx(I,{asChild:!0,children:e.jsxs(o,{variant:"outline",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Bulk Upload"]})}),e.jsxs(U,{className:"max-w-6xl max-h-[80vh] overflow-auto",children:[e.jsxs(z,{children:[e.jsx(R,{children:"Bulk Product Upload"}),e.jsx($,{children:'Upload a CSV file with product data. Click "Download Template" for the correct format.'})]}),0===H.length?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Upload CSV File"}),e.jsxs(o,{variant:"outline",onClick:()=>{const e=["Product Name,Weight,Weight Unit,Department,Merchant,Case Price,Unit Per Case,Unit Price,Retail Price,Category,Supplier,Description","Example Product,12,oz,Food & Beverages,,24.00,24,1.00,1.99,Soft Drinks,Example Supplier,Example description"].join("\n"),t=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(t),r=document.createElement("a");r.style.display="none",r.href=s,r.download="product_import_template.csv",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)},children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Download Template"]})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Upload CSV File"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a CSV file containing product data"}),e.jsx(u,{type:"file",accept:".csv",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const s=new FileReader;s.onload=e=>{try{const t=e.target?.result,s=t.split("\n").filter(e=>e.trim()),r=s[0].split(",").map(e=>e.trim().toLowerCase()),a=s.slice(1).map((e,t)=>{const s=e.split(","),a={};return r.forEach((e,t)=>{let r=s[t]?.trim()||"";const i={"product name":"product_name",product_name:"product_name",weight:"weight","weight unit":"weight_unit",weight_unit:"weight_unit",department:"department",merchant:"merchant_id",merchant_id:"merchant_id","last shopping date":"last_shopping_date",last_shopping_date:"last_shopping_date","case price":"case_price",case_price:"case_price","unit per case":"unit_per_case",unit_per_case:"unit_per_case","unit price":"unit_price",unit_price:"unit_price","retail price":"retail_price",retail_price:"retail_price",category:"category",supplier:"supplier",description:"description"}[e]||e;["weight","case_price","unit_per_case","unit_price","retail_price","merchant_id"].includes(i)&&(r=r&&parseFloat(r)||0),a[i]=r}),a.case_price>0&&a.unit_per_case>0&&!a.unit_price&&(a.unit_price=Math.round(a.case_price/a.unit_per_case*100)/100),a.unit_price>0&&!a.retail_price&&(a.retail_price=_e(a.unit_price)),a});Q(a),ce(!0)}catch(t){p({variant:"destructive",title:"Error",description:"Failed to parse CSV file. Please check the format."})}},s.readAsText(t)},className:"max-w-xs mx-auto"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Required Columns:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Product Name (required)"}),e.jsx("li",{children:"• Weight, Weight Unit, Department, Merchant"}),e.jsx("li",{children:"• Case Price, Unit Per Case, Unit Price, Retail Price"}),e.jsx("li",{children:"• Category, Supplier, Description"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Preview Import Data (",H.length," products)"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{Q([]),ce(!1)},children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(O){le(!0);try{let t=0,s=0;const r=[],a=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"serial_number",IsAsc:!1,Filters:[]});let i=a.data?.List?.[0]?.serial_number||0;for(const c of H)try{if(!c.product_name?.trim()){r.push(`Row ${t+s+1}: Product name is required`),s++;continue}const e={serial_number:i+t+1,product_name:c.product_name.trim(),last_updated_date:(new Date).toISOString(),overdue:!1,weight:c.weight||0,weight_unit:c.weight_unit||"lb",department:c.department||"Convenience Store",case_price:c.case_price||0,unit_per_case:c.unit_per_case||1,unit_price:c.unit_price||0,retail_price:c.retail_price||0,category:c.category||"",supplier:c.supplier||"",description:c.description||"",quantity_in_stock:0,minimum_stock:0,bar_code_case:"",bar_code_unit:"",created_by:O.user_id};c.merchant_id&&(e.merchant_id=parseInt(c.merchant_id)),c.last_shopping_date&&(e.last_shopping_date=new Date(c.last_shopping_date).toISOString());const{error:a}=await window.ezsite.apis.tableCreate("11726",e);a?(r.push(`${c.product_name}: ${a}`),s++):t++}catch(e){const t=e instanceof Error?e.message:"Unknown error";r.push(`${c.product_name||"Unknown"}: ${t}`),s++}p(t>0?{title:"Import Complete",description:`Successfully imported ${t} products. ${s>0?`${s} errors occurred.`:""}`}:{variant:"destructive",title:"Import Failed",description:`No products were imported. ${s} errors occurred.`}),r.length>0&&console.error("Import errors:",r),t>0&&(ce(!1),Q([]),n("/products"))}catch(e){console.error("Bulk import error:",e),p({variant:"destructive",title:"Import Failed",description:e instanceof Error?e.message:"Failed to import product data."})}finally{le(!1)}}else p({variant:"destructive",title:"Error",description:"User profile not found."})},disabled:ne,children:ne?"Importing...":"Import Products"})]})]}),e.jsx("div",{className:"border rounded-lg max-h-96 overflow-auto",children:e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs(_,{children:[e.jsx(j,{children:"Product Name"}),e.jsx(j,{children:"Weight"}),e.jsx(j,{children:"Department"}),e.jsx(j,{children:"Case Price"}),e.jsx(j,{children:"Unit Price"}),e.jsx(j,{children:"Retail Price"}),e.jsx(j,{children:"Profit %"})]})}),e.jsx(f,{children:H.map((t,s)=>{const r=t.unit_price>0&&t.retail_price>0?((t.retail_price-t.unit_price)/t.retail_price*100).toFixed(1):"0";return e.jsxs(_,{children:[e.jsx(v,{className:"font-medium",children:t.product_name}),e.jsxs(v,{children:[t.weight," ",t.weight_unit]}),e.jsx(v,{children:t.department}),e.jsxs(v,{children:["$",t.case_price?.toFixed(2)||"0.00"]}),e.jsxs(v,{children:["$",t.unit_price?.toFixed(2)||"0.00"]}),e.jsxs(v,{children:["$",t.retail_price?.toFixed(2)||"0.00"]}),e.jsx(v,{children:e.jsxs(m,{variant:parseFloat(r)>20?"default":"secondary",children:[r,"%"]})})]},s)})})]})})]})]})]})]}),e.jsxs(r,{children:[e.jsxs(a,{children:[e.jsx(i,{children:B?"Edit Product":"New Product"}),e.jsx(y,{children:B?"Update the product information below":"Enter the product details below"})]}),e.jsx(c,{children:e.jsx(re,{formName:"Product Form",showDataRecovery:!0,onFormReset:()=>{B?ge():(de({product_name:"",weight:0,weight_unit:"lb",department:"Convenience Store",merchant_id:"",last_updated_date:(new Date).toISOString().split("T")[0],last_shopping_date:"",case_price:0,unit_per_case:1,unit_price:0,retail_price:0,profit_margin:0,category:"",supplier:"",quantity_in_stock:0,minimum_stock:0,description:"",bar_code_case:"",bar_code_unit:"",serial_number:0,overdue:!1}),xe())},children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),oe.product_name.trim())if(O){A(!0);try{const e={...oe,last_updated_date:(new Date).toISOString(),last_shopping_date:oe.last_shopping_date?new Date(oe.last_shopping_date).toISOString():null,merchant_id:oe.merchant_id?parseInt(oe.merchant_id):null,created_by:O.user_id};let s,r=null;if(B){const{error:t}=await window.ezsite.apis.tableUpdate("11726",{ID:parseInt(l),...e});s=t}else{const{error:a}=await window.ezsite.apis.tableCreate("11726",e);if(s=a,!a)try{const{data:t}=await window.ezsite.apis.tablePage("11726",{PageNo:1,PageSize:1,OrderByField:"serial_number",IsAsc:!1,Filters:[{name:"serial_number",op:"Equal",value:e.serial_number}]});r=t?.List?.[0]?.ID}catch(t){console.error("Error getting new product ID:",t)}}if(s)throw s;if(B&&pe&&O){const e=["last_shopping_date","case_price","unit_per_case","unit_price","retail_price"];for(const r of e){const e=pe[r],t=oe[r];e!==t&&await ve(parseInt(l),r,e,t,O.user_id)}const t=pe.unit_price>0&&pe.retail_price>0?(pe.retail_price-pe.unit_price)/pe.retail_price*100:0,s=oe.profit_margin;Math.abs(t-s)>.01&&await ve(parseInt(l),"profit_margin",t.toFixed(2),s.toFixed(2),O.user_id)}p({title:"Success",description:`Product ${B?"updated":"created"} successfully.`}),n("/products")}catch(s){console.error("Error saving product:",s),p({variant:"destructive",title:"Error",description:`Failed to ${B?"update":"create"} product.`})}finally{A(!1)}}else p({variant:"destructive",title:"Error",description:"User profile not found."});else p({variant:"destructive",title:"Validation Error",description:"Product name is required."})},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"product_name",children:"Product Name *"}),e.jsx(u,{id:"product_name",placeholder:"Enter product name",value:oe.product_name,onChange:e=>je("product_name",e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"category",children:"Category"}),e.jsx(C,{value:oe.category,onValueChange:e=>je("category",e),children:e.jsx(F,{children:be.map(t=>e.jsx(P,{value:t.category_name,children:t.category_name},t.id))})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"weight",children:"Weight"}),e.jsx(N,{id:"weight",step:.01,min:0,value:oe.weight,onChange:e=>je("weight",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"weight_unit",children:"Weight Unit (USA Measurements)"}),e.jsxs(C,{value:oe.weight_unit,onValueChange:e=>je("weight_unit",e),children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select unit"})}),e.jsx(F,{children:[{value:"lb",label:"Pounds (lb)"},{value:"oz",label:"Ounces (oz)"},{value:"ton",label:"Tons"},{value:"fl_oz",label:"Fluid Ounces (fl oz)"},{value:"gal",label:"Gallons (gal)"},{value:"qt",label:"Quarts (qt)"},{value:"pt",label:"Pints (pt)"},{value:"cup",label:"Cups"},{value:"tbsp",label:"Tablespoons (tbsp)"},{value:"tsp",label:"Teaspoons (tsp)"}].map(t=>e.jsx(P,{value:t.value,children:t.label},t.value))})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Combined: ",oe.weight," ",oe.weight_unit]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"department",children:"Department"}),e.jsxs(C,{value:oe.department,onValueChange:e=>je("department",e),children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select department"})}),e.jsx(F,{children:["Convenience Store","Fuel & Oil","Automotive","Food & Beverages","Tobacco Products","Lottery & Gaming","Health & Personal Care","Electronics & Accessories","Cleaning Supplies","Office Supplies","Snacks & Candy","Hot Foods & Coffee","Cold Beverages","Energy Drinks","Beer & Wine","Ice & Frozen","Phone Cards & Prepaid","Car Accessories","Gift Cards","Pharmacy & Medicine"].map(t=>e.jsx(P,{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"merchant_id",children:"Merchant"}),e.jsxs(C,{value:oe.merchant_id,onValueChange:e=>je("merchant_id",e),children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select merchant"})}),e.jsx(F,{children:we.map(t=>e.jsx(P,{value:t.id.toString(),children:t.vendor_name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"last_updated_date",children:"Last Updated Date"}),e.jsx(u,{id:"last_updated_date",type:"date",value:oe.last_updated_date,onChange:e=>je("last_updated_date",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"last_shopping_date",children:"Last Shopping Date"}),e.jsx(u,{id:"last_shopping_date",type:"date",value:oe.last_shopping_date,onChange:e=>je("last_shopping_date",e.target.value)})]})]}),e.jsx(b,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Pricing Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"case_price",children:"Case Price ($)"}),e.jsx(N,{id:"case_price",step:.01,min:0,value:oe.case_price,onChange:e=>je("case_price",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"unit_per_case",children:"Unit Per Case"}),e.jsx(N,{id:"unit_per_case",min:1,value:oe.unit_per_case,onChange:e=>je("unit_per_case",e)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"unit_price",children:"Unit Price ($)"}),e.jsx(N,{id:"unit_price",step:.01,min:0,value:oe.unit_price,onChange:e=>je("unit_price",e)}),oe.case_price>0&&oe.unit_per_case>0&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Auto-calculated from case price"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"retail_price",children:"Retail Price ($)"}),e.jsx(N,{id:"retail_price",step:.01,min:0,value:oe.retail_price,onChange:e=>je("retail_price",e)}),oe.unit_price>0&&Math.abs(oe.retail_price-ye)<.01&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Auto-calculated from unit price"]}),oe.unit_price>0&&Math.abs(oe.retail_price-ye)>=.01&&e.jsxs("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:"text-sm font-medium text-red-800",children:["Suggested: $",ye.toFixed(2)]})]}),e.jsx(o,{type:"button",size:"sm",variant:"outline",onClick:()=>je("retail_price",ye),className:"text-xs h-6 px-2",children:"Apply"})]}),e.jsxs("p",{className:"text-xs text-red-700 mt-1",children:[oe.unit_price<4?"+65%":oe.unit_price<6?"+55%":oe.unit_price<8?"+45%":oe.unit_price<10?"+35%":"+25%"," markup, rounded to .25/.49/.75/.99"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"profit_margin",children:"Profit Margin (%)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"profit_margin",step:.01,value:oe.profit_margin,disabled:!0,className:"bg-muted"}),e.jsx(m,{variant:oe.profit_margin>20?"default":"secondary",children:oe.profit_margin>20?"Good":"Low"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Auto-calculated from unit and retail price"})]})]})]}),e.jsx(b,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Additional Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"supplier",children:"Supplier"}),e.jsx(u,{id:"supplier",placeholder:"Enter supplier name",value:oe.supplier,onChange:e=>je("supplier",e.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Stock Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(N,{placeholder:"Current Stock",value:oe.quantity_in_stock,onChange:e=>je("quantity_in_stock",e),min:0}),e.jsx(N,{placeholder:"Min Stock",value:oe.minimum_stock,onChange:e=>je("minimum_stock",e),min:0})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current stock / Minimum stock level"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"description",children:"Description"}),e.jsx(S,{id:"description",placeholder:"Enter product description",rows:4,value:oe.description,onChange:e=>je("description",e.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"bar_code_case",children:"Barcode (Case)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{id:"bar_code_case",placeholder:"Scan or enter case barcode",value:oe.bar_code_case,onChange:e=>je("bar_code_case",e.target.value)}),e.jsx(ae,{onScanned:e=>fe("bar_code_case",e)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"bar_code_unit",children:"Barcode (Unit)"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{id:"bar_code_unit",placeholder:"Scan or enter unit barcode",value:oe.bar_code_unit,onChange:e=>je("bar_code_unit",e.target.value)}),e.jsx(ae,{onScanned:e=>fe("bar_code_unit",e)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-medium",children:"Product Images & Documents"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Product Image"}),e.jsx(X,{accept:"image/*",label:"Upload Product Image",maxSize:5,useDatabaseStorage:!0,associatedTable:"products",associatedRecordId:parseInt(l||"0"),fileCategory:"product_image",showPreview:!0,onFileUpload:e=>{p({title:"Image uploaded",description:`${e.fileName} has been uploaded successfully`})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Product Documents"}),e.jsx(X,{accept:".pdf,.doc,.docx,.txt",label:"Upload Documents",maxSize:10,useDatabaseStorage:!0,associatedTable:"products",associatedRecordId:parseInt(l||"0"),fileCategory:"product_document",showPreview:!0,onFileUpload:e=>{p({title:"Document uploaded",description:`${e.fileName} has been uploaded successfully`})}})]})]})]}),B&&parseInt(l||"0")>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-md font-medium",children:"Uploaded Files"}),e.jsx(ie,{associatedTable:"products",associatedRecordId:parseInt(l||"0"),allowDelete:!0,allowEdit:!1,showDescription:!0,viewMode:"grid"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>n("/products"),children:"Cancel"}),e.jsxs(o,{type:"submit",disabled:q,children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),q?"Saving...":B?"Update Product":"Create Product"]})]})]})})})]})]})};export{ce as default};
