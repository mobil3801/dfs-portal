import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{u as i,e as a,C as l,f as r,g as n,k as t,h as d,T as c,q as o,r as m,s as h,B as x,A as j,n as u,j as g,L as f,S as N}from"./index-MtEqlP9w.js";import{S as p}from"./switch-DeYgkLk2.js";import{a as v}from"./routing-DcURAnU1.js";import{H as y,P as b,F as w,k as A,l as I,B as C,n as D,D as P,S as R,g as S,x as _,y as E,R as M,C as k,b as q,s as T,aM as z}from"./utilities-BBdJI3Xi.js";import{E as O}from"./EnhancedNavigationDebugger-Cz00nMUD.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";import"./table-DnenzOH_.js";const L=()=>{const{user:g,userProfile:f,isAuthenticated:N,isLoading:p,isInitialized:z,isAdmin:O,isManager:L,authError:U,refreshUserData:V}=i(),G=v(),[H,Y]=s.useState(!1),[F,W]=s.useState(!1),B=[{name:"Dashboard",href:"/dashboard",icon:y,requiredRole:null},{name:"Products",href:"/products",icon:b,requiredRole:null},{name:"Sales",href:"/sales",icon:w,requiredRole:null},{name:"Delivery",href:"/delivery",icon:A,requiredRole:null},{name:"Employees",href:"/employees",icon:I,requiredRole:"manager"},{name:"Vendors",href:"/vendors",icon:C,requiredRole:"manager"},{name:"Orders",href:"/orders",icon:b,requiredRole:"manager"},{name:"Licenses",href:"/licenses",icon:D,requiredRole:"manager"},{name:"Salary",href:"/salary",icon:P,requiredRole:"manager"},{name:"Settings",href:"/settings",icon:R,requiredRole:null},{name:"Admin",href:"/admin",icon:S,requiredRole:"admin"}],J=e=>!e||!!N&&("admin"===e?O():"manager"!==e||L()),X=B.filter(e=>J(e.requiredRole)),K=B.filter(e=>!J(e.requiredRole)),Q=G.pathname;B.find(e=>Q.startsWith(e.href));const Z=z,$=p,ee=N,se=X.length>0,ie=z&&!p&&N&&!!g&&X.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Navigation Debugger"}),e.jsx("p",{className:"text-gray-600",children:"Analyze navigation menu visibility and access control"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>W(!F),children:[F?e.jsx(_,{className:"h-4 w-4 mr-2"}):e.jsx(E,{className:"h-4 w-4 mr-2"}),F?"Hide":"Show"," Details"]}),e.jsxs(a,{onClick:async()=>{Y(!0);try{await V()}catch(e){console.error("Failed to refresh user data:",e)}finally{Y(!1)}},disabled:H,variant:"outline",size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2 "+(H?"animate-spin":"")}),"Refresh Data"]})]})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[ie?e.jsx(k,{className:"h-5 w-5 text-green-500"}):e.jsx(q,{className:"h-5 w-5 text-red-500"}),"Navigation Health"]}),e.jsx(t,{children:"Overall navigation system status"})]}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+(Z?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:"text-sm",children:"Auth Initialized"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+($?"bg-yellow-500":"bg-green-500")}),e.jsx("span",{className:"text-sm",children:"Not Loading"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+(ee?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:"text-sm",children:"Authenticated"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+(se?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:"text-sm",children:"Has Menu Items"})]})]})})]}),e.jsxs(c,{defaultValue:"status",className:"w-full",children:[e.jsxs(o,{className:"grid w-full grid-cols-4",children:[e.jsx(m,{value:"status",children:"Status"}),e.jsx(m,{value:"access",children:"Access Control"}),e.jsx(m,{value:"items",children:"Menu Items"}),e.jsx(m,{value:"troubleshooting",children:"Troubleshooting"})]}),e.jsxs(h,{value:"status",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Authentication Status"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Initialized:"}),e.jsx(x,{variant:z?"default":"secondary",children:z?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Loading:"}),e.jsx(x,{variant:p?"destructive":"default",children:p?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Authenticated:"}),e.jsx(x,{variant:N?"default":"destructive",children:N?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Has User:"}),e.jsx(x,{variant:g?"default":"destructive",children:g?"Yes":"No"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Has Profile:"}),e.jsx(x,{variant:f?"default":"destructive",children:f?"Yes":"No"})]})]})]}),e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"User Information"]})}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Name:"}),e.jsx("span",{className:"font-medium",children:g?.Name||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Email:"}),e.jsx("span",{className:"font-medium",children:F?g?.Email||"N/A":g?.Email?"***@***.com":"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Role:"}),e.jsx(x,{variant:O()?"default":L()?"secondary":"outline",children:O()?"Admin":L()?"Manager":"Employee"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"User ID:"}),e.jsx("span",{className:"font-medium",children:g?.ID||"N/A"})]}),F&&f&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Profile Role:"}),e.jsx("span",{className:"font-medium",children:f.role||"N/A"})]})]})]})]}),U&&e.jsxs(j,{variant:"destructive",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsxs(u,{children:[e.jsx("strong",{children:"Authentication Error:"})," ",U]})]})]}),e.jsx(h,{value:"access",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsxs(n,{className:"text-green-600",children:["Accessible Items (",X.length,")"]}),e.jsx(t,{children:"Navigation items the current user can access"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-2",children:X.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{children:s.name})]}),e.jsx(x,{variant:"outline",className:"text-green-600",children:s.requiredRole||"All"})]},s.href))})})]}),e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsxs(n,{className:"text-red-600",children:["Inaccessible Items (",K.length,")"]}),e.jsx(t,{children:"Navigation items the current user cannot access"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-2",children:K.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-red-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),e.jsx("span",{children:s.name})]}),e.jsx(x,{variant:"outline",className:"text-red-600",children:s.requiredRole||"All"})]},s.href))})})]})]})}),e.jsx(h,{value:"items",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"All Navigation Items"}),e.jsx(t,{children:"Complete list of navigation items and their access requirements"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-2",children:B.map(s=>{const i=J(s.requiredRole),a=Q.startsWith(s.href);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded border "+(a?"bg-blue-50 border-blue-200":"bg-white"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.icon,{className:"h-5 w-5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.href})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",children:s.requiredRole||"All Users"}),i?e.jsx(k,{className:"h-5 w-5 text-green-500"}):e.jsx(q,{className:"h-5 w-5 text-red-500"}),a&&e.jsx(x,{variant:"default",children:"Current"})]})]},s.href)})})})]})}),e.jsxs(h,{value:"troubleshooting",className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(r,{children:e.jsx(n,{children:"Common Issues & Solutions"})}),e.jsx(d,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"No Navigation Items Visible"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Check if user is authenticated"}),e.jsx("li",{children:"â€¢ Verify user profile has correct role"}),e.jsx("li",{children:"â€¢ Ensure OverflowNavigation is not stuck in loading state"}),e.jsx("li",{children:"â€¢ Check browser console for JavaScript errors"}),e.jsx("li",{children:"â€¢ Verify canAccessRoute function is working properly"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Missing Admin/Manager Items"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Verify user role in database"}),e.jsx("li",{children:"â€¢ Check isAdmin() and isManager() functions"}),e.jsx("li",{children:"â€¢ Ensure user profile is loaded correctly"}),e.jsx("li",{children:"â€¢ Verify role field names match expected values"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Navigation Loading Forever"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Check if container refs are properly set"}),e.jsx("li",{children:"â€¢ Verify ResizeObserver is working"}),e.jsx("li",{children:"â€¢ Look for calculation errors in console"}),e.jsx("li",{children:"â€¢ Try refreshing the page"}),e.jsx("li",{children:"â€¢ Check if emergency fallback is triggered"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Mobile Navigation Issues"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Verify mobile menu state management"}),e.jsx("li",{children:"â€¢ Check if menu items are properly filtered"}),e.jsx("li",{children:"â€¢ Ensure mobile menu closes on navigation"}),e.jsx("li",{children:"â€¢ Test on different screen sizes"})]})]})]})})]}),e.jsxs(l,{children:[e.jsx(r,{children:e.jsx(n,{children:"Debug Information"})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm space-y-2 font-mono bg-gray-50 p-3 rounded",children:[e.jsxs("div",{children:["Current Path: ",Q]}),e.jsxs("div",{children:["Window Width: ","undefined"!=typeof window?window.innerWidth:"N/A","px"]}),e.jsxs("div",{children:["Navigation Items: ",B.length]}),e.jsxs("div",{children:["Accessible Items: ",X.length]}),e.jsxs("div",{children:["APIs Available: ","undefined"!=typeof window&&window.ezsite?.apis?"Yes":"No"]}),e.jsxs("div",{children:["User Agent: ","undefined"!=typeof window?window.navigator.userAgent.substring(0,50)+"...":"N/A"]}),e.jsxs("div",{children:["Timestamp: ",(new Date).toISOString()]})]})})]})]})]})]})},U=()=>{const{user:v,userProfile:y,isAuthenticated:b,isAdmin:w,isManager:A,refreshUserData:I}=i(),{moduleAccess:C,loading:D,error:P}=g(),[R,S]=s.useState(!1),[_,E]=s.useState(!1);s.useEffect(()=>{console.log("ðŸ” DIAGNOSTIC: Navigation diagnostic page loaded"),console.log("ðŸ‘¤ DIAGNOSTIC: User information",{isAuthenticated:b,user:v?{id:v.ID,name:v.Name,email:v.Email}:null,userProfile:y?{id:y.id,role:y.role,roleType:typeof y.role,hasDetailedPermissions:!!y.detailed_permissions,detailedPermissionsType:typeof y.detailed_permissions,detailedPermissionsPreview:"string"==typeof y.detailed_permissions?y.detailed_permissions.substring(0,100)+"...":JSON.stringify(y.detailed_permissions).substring(0,100)+"..."}:null,isAdmin:w(),isManager:A()}),console.log("ðŸ”‘ DIAGNOSTIC: Permission check results",{view_products:hasPermission("view","products"),create_products:hasPermission("create","products"),edit_products:hasPermission("edit","products"),delete_products:hasPermission("delete","products"),view_employees:hasPermission("view","employees"),create_employees:hasPermission("create","employees"),edit_employees:hasPermission("edit","employees"),delete_employees:hasPermission("delete","employees")}),_&&(console.log("ðŸ“‹ DIAGNOSTIC: Module access information",{moduleCount:C.length,moduleError:P,moduleLoading:D,modules:C.map(e=>({name:e.module_name,display:e.display_name,create:e.create_enabled,edit:e.edit_enabled,delete:e.delete_enabled}))}),console.log("ðŸ”’ DIAGNOSTIC: Auth implementation details",{isAdminImplementation:'userProfile?.role === "Administrator" || userProfile?.role === "Admin"',isManagerImplementation:'userProfile?.role === "Management" || userProfile?.role === "Manager" || isAdmin()',authContextState:{isInitialized:isInitialized,isLoading:isLoading,isAuthenticated:b,hasAuthError:!!authError,authErrorMessage:authError}}))},[_,v,y,b,w,A,C,hasPermission,P,D,isInitialized,isLoading,authError]);return e.jsxs("div",{className:"container py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Navigation Diagnostic"}),e.jsx("p",{className:"text-gray-500",children:"Troubleshoot navigation and permission issues"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{id:"debug-mode",checked:_,onCheckedChange:E}),e.jsx(f,{htmlFor:"debug-mode",children:"Detailed Console Logs"})]}),e.jsxs(a,{onClick:async()=>{S(!0);try{await I(),console.log("ðŸ”„ DIAGNOSTIC: User data refreshed")}catch(e){console.error("âŒ DIAGNOSTIC: Failed to refresh user data:",e)}finally{S(!1)}},disabled:R,variant:"outline",children:[e.jsx(M,{className:"h-4 w-4 mr-2 "+(R?"animate-spin":"")}),"Refresh Data"]})]})]}),e.jsxs(j,{variant:"warning",className:"bg-yellow-50 border-yellow-200",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(u,{children:"This page is designed to help diagnose navigation and permission issues. Check the browser console for detailed logs."})]}),e.jsxs(c,{defaultValue:"user",className:"w-full",children:[e.jsxs(o,{className:"grid w-full grid-cols-3",children:[e.jsx(m,{value:"user",children:"User & Permissions"}),e.jsx(m,{value:"navigation",children:"Navigation"}),e.jsx(m,{value:"modules",children:"Module Access"})]}),e.jsx(h,{value:"user",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"User Information"}),e.jsx(t,{children:"Current user details and authentication status"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"User ID"}),e.jsx("p",{className:"text-lg font-medium",children:v?.ID||"Not authenticated"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Name"}),e.jsx("p",{className:"text-lg font-medium",children:v?.Name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Email"}),e.jsx("p",{className:"text-lg font-medium",children:v?.Email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Role"}),e.jsx("p",{className:"text-lg font-medium",children:y?.role||"N/A"})]})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Role Checks"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{variant:b?"default":"destructive",children:b?"Authenticated":"Not Authenticated"}),e.jsx(x,{variant:w()?"default":"outline",children:w()?"Is Admin":"Not Admin"}),e.jsx(x,{variant:A()?"default":"outline",children:A()?"Is Manager":"Not Manager"})]})]}),e.jsx(N,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Permission Tests"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["view","create","edit","delete"].map(s=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-medium capitalize",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mt-1",children:[e.jsx(x,{variant:"outline",className:"text-xs",children:"products"}),e.jsx(x,{variant:"outline",className:"text-xs",children:"employees"})]})]},s))})]})]})]})}),e.jsxs(h,{value:"navigation",className:"space-y-4",children:[e.jsx(L,{}),e.jsx(O,{})]}),e.jsx(h,{value:"modules",className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsx(n,{children:"Module Access"}),e.jsx(t,{children:"Module permissions from the database"})]}),e.jsx(d,{children:D?e.jsx("div",{className:"flex items-center justify-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):P?e.jsxs(j,{variant:"destructive",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(u,{children:P})]}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.map(s=>e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-medium",children:s.display_name}),e.jsx(x,{children:s.module_name})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx(x,{variant:s.create_enabled?"default":"outline",children:s.create_enabled?"Create":"No Create"}),e.jsx(x,{variant:s.edit_enabled?"default":"outline",children:s.edit_enabled?"Edit":"No Edit"}),e.jsx(x,{variant:s.delete_enabled?"default":"outline",children:s.delete_enabled?"Delete":"No Delete"})]})]},s.id))})})})]})})]})]})};export{U as default};
