import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{u as t,t as r,C as i,h as a,f as l,g as n,B as c,e as o,L as d,A as x,n as m,l as p,D as h,m as u,a as j,b as g,c as v,I as y,v as f,T as w,q as N,r as b,s as _}from"./index-BJg4_aev.js";import{T as S,a as C,b as A,c as k,d as E,e as O}from"./table-DMcwkzpY.js";import{S as F}from"./scroll-area-f2cJg0kD.js";import{S as P,c as D,d as R,a as U,b as L}from"./select-DCbSmMef.js";import{C as V,u as M,B as $,a as z}from"./BatchDeleteDialog-CmR2sadE.js";import{B as I}from"./BatchEditDialog-WzGul3oe.js";import{S as T}from"./switch-CFDQIN6S.js";import{g as B,aw as q,R as J,U as H,s as W,ax as G,z as Q,Q as K,A as Z,C as X,b as Y,l as ee,a9 as se,a1 as te,V as re,Z as ie,W as ae,y as le,S as ne,ay as ce,ak as oe,F as de,az as xe,k as me,aA as pe,av as he,am as ue,D as je,n as ge,P as ve,q as ye,Y as fe,r as we,T as Ne,aB as be,a8 as _e,aC as Se,N as Ce,ap as Ae,I as ke,G as Ee,aD as Oe}from"./utilities-DMEd7dY0.js";import{A as Fe}from"./AccessDenied-BjsFXpm4.js";import{C as Pe}from"./CreateUserDialog-Bjj5iGTK.js";import"./routing-DcURAnU1.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";const De=()=>{const{userProfile:p}=t(),[h,u]=s.useState([]),[j,g]=s.useState(null),[v,y]=s.useState({}),[f,w]=s.useState(!0),[N,b]=s.useState(!1),[_,S]=s.useState(!1),[C,A]=s.useState(!1),k="Administrator"===p?.role,E=["dashboard","products","employees","sales_reports","vendors","orders","licenses","salary","delivery","settings","user_management","site_management","system_logs","security_settings"],O={Administrator:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},Management:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},Employee:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1}};s.useEffect(()=>{k&&F()},[k]),s.useEffect(()=>{j&&V(j)},[j]);const F=async()=>{try{w(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage("11725",{PageNo:1,PageSize:100,OrderByField:"id",IsAsc:!0,Filters:[{name:"is_active",op:"Equal",value:!0}]});if(s)throw s;u(e?.List||[])}catch(e){console.error("Error loading users:",e),r({title:"Error",description:"Failed to load users",variant:"destructive"})}finally{w(!1)}},V=async e=>{try{w(!0);const{data:t,error:r}=await window.ezsite.apis.tablePage("11725",{PageNo:1,PageSize:1,OrderByField:"id",IsAsc:!0,Filters:[{name:"id",op:"Equal",value:e}]});if(r)throw r;const i=t?.List?.[0];if(i){let e={};if(i.detailed_permissions)try{e=JSON.parse(i.detailed_permissions)}catch(s){console.warn("Failed to parse user permissions:",s)}const t={};E.forEach(s=>{t[s]=e[s]||{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}}),y(t),S(!1)}}catch(t){console.error("Error loading user permissions:",t),r({title:"Error",description:"Failed to load user permissions",variant:"destructive"})}finally{w(!1)}},M=s.useCallback((e,s,t)=>{y(r=>({...r,[e]:{...r[e],[s]:t}})),S(!0),r({title:"Permission Updated",description:`${e} ${s} permission ${t?"enabled":"disabled"}`,duration:2e3})},[]),$=s.useCallback(e=>{const s=O[e];if(!s)return;const t={};E.forEach(e=>{t[e]={...s}}),y(t),S(!0),r({title:"Template Applied",description:`${e} permission template applied to all modules`,duration:3e3})},[E]),z=s.useCallback(()=>{j&&(V(j),r({title:"Permissions Reset",description:"All changes have been reverted",duration:2e3}))},[j]),I=e=>({dashboard:"Dashboard",products:"Products",employees:"Employees",sales_reports:"Sales Reports",vendors:"Vendors",orders:"Orders",licenses:"Licenses",salary:"Salary",delivery:"Delivery",settings:"Settings",user_management:"User Management",site_management:"Site Management",system_logs:"System Logs",security_settings:"Security Settings"}[e]||e),ne=()=>j?h.find(e=>e.id===j):null;return k?e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:"border-blue-200 bg-blue-50",children:e.jsx(l,{children:e.jsxs(n,{className:"flex items-center justify-between text-blue-900",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-6 h-6"}),e.jsx("span",{children:"Real-Time Permission Management"}),e.jsx(c,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:"Live System"})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:async()=>{A(!0);try{await F(),j&&await V(j),r({title:"Data Refreshed",description:"User data and permissions have been refreshed",duration:2e3})}catch(e){console.error("Error refreshing data:",e)}finally{A(!1)}},disabled:C,className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4 "+(C?"animate-spin":"")}),e.jsx("span",{children:"Refresh"})]})]})})}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"Select User"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Choose User to Manage"}),e.jsxs(P,{value:j?.toString()||"",onValueChange:e=>g(parseInt(e)),children:[e.jsx(D,{className:"w-full",children:e.jsx(R,{placeholder:"Select a user to manage their permissions"})}),e.jsx(U,{children:h.map(s=>e.jsx(L,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:s.employee_id}),e.jsx(c,{variant:"outline",className:"text-xs",children:s.role}),e.jsx(c,{variant:"outline",className:"text-xs",children:s.station})]})},s.id))})]})]}),j&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{children:"Quick Role Templates:"}),Object.keys(O).map(s=>e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>$(s),className:"text-xs",children:["Apply ",s]},s))]}),ne()&&e.jsxs(x,{children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs(m,{children:["Managing permissions for: ",e.jsx("strong",{children:ne()?.employee_id}),"(",ne()?.role," at ",ne()?.station,")"]})]})]})})]}),j&&e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{children:"Module Permissions"})]}),_&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Unsaved Changes"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:z,disabled:N,children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsxs(o,{size:"sm",onClick:async()=>{if(j)try{b(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage("11725",{PageNo:1,PageSize:1,OrderByField:"id",IsAsc:!0,Filters:[{name:"id",op:"Equal",value:j}]});if(s)throw s;const t=e?.List?.[0];if(!t)throw new Error("User not found");const i=await window.ezsite.apis.tableUpdate("11725",{id:t.id,detailed_permissions:JSON.stringify(v)});if(i.error)throw i.error;S(!1),r({title:"Success",description:"User permissions updated successfully",duration:3e3}),setTimeout(()=>{V(j)},500)}catch(e){console.error("Error saving permissions:",e),r({title:"Error",description:"string"==typeof e?e:"Failed to save permissions",variant:"destructive"})}finally{b(!1)}else r({title:"Error",description:"Please select a user first",variant:"destructive"})},disabled:N,className:"bg-green-600 hover:bg-green-700",children:[N?e.jsx(Q,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(K,{className:"w-4 h-4 mr-1"}),N?"Saving...":"Save Changes"]})]})]})}),e.jsx(a,{children:f?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Q,{className:"w-6 h-6 animate-spin text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading permissions..."})]}):e.jsx("div",{className:"space-y-6",children:E.map(s=>{const t=v[s]||{},{enabled:r,total:n}=(e=>({enabled:Object.values(e).filter(Boolean).length,total:Object.keys(e).length}))(t);return e.jsxs(i,{className:"border-gray-200",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:I(s)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r,"/",n," permissions enabled"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:r===n?e.jsx(X,{className:"w-5 h-5 text-green-500"}):0===r?e.jsx(Y,{className:"w-5 h-5 text-red-500"}):e.jsx("div",{className:"w-5 h-5 rounded-full bg-yellow-400 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-yellow-800",children:r})})})]})}),e.jsx(a,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.keys(t).map(r=>{const i={view:le,create:ae,edit:ie,delete:re,export:te,print:se}[r];const a=t[r];return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`\n                                    w-6 h-6 rounded-full flex items-center justify-center\n                                    ${a?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"}\n                                  `,children:e.jsx(i,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-medium capitalize",children:r})]}),e.jsx(T,{checked:a,onCheckedChange:e=>M(s,r,e),className:"data-[state=checked]:bg-green-500"})]},r)})})})]},s)})})})]}),!j&&!f&&e.jsx(i,{className:"border-gray-200",children:e.jsx(a,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a User to Manage Permissions"}),e.jsx("p",{className:"text-gray-600",children:"Choose a user from the dropdown above to view and modify their module permissions."})]})})})]}):e.jsx(i,{className:"border-orange-200 bg-orange-50",children:e.jsx(a,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-orange-900",children:"Permission Management"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Administrator access required to manage user permissions"})]})]})})})},Re={view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1,approve:!1,bulk_operations:!1,advanced_features:!1},Ue={"Core Dashboard":[{key:"dashboard",label:"Dashboard",icon:ye,color:"text-blue-600",route:"/dashboard",description:"Main dashboard with analytics and quick access"}],"Product Management":[{key:"products",label:"Product List",icon:ve,color:"text-green-600",route:"/products",description:"View and manage product inventory"},{key:"product_form",label:"Product Form",icon:ie,color:"text-green-500",route:"/products/new",description:"Add and edit product records"}],"Sales & Reports":[{key:"sales_reports",label:"Sales Reports",icon:de,color:"text-orange-600",route:"/sales-reports",description:"Daily sales reporting and enhanced print dialogs"},{key:"sales_report_form",label:"Sales Report Form",icon:ge,color:"text-orange-500",route:"/sales-reports/new",description:"Create daily sales reports"}],"Human Resources":[{key:"employees",label:"Employee List",icon:ee,color:"text-purple-600",route:"/employees",description:"Employee records management"},{key:"employee_form",label:"Employee Form",icon:ce,color:"text-purple-500",route:"/employees/new",description:"Add and edit employee records"},{key:"salary",label:"Salary Management",icon:je,color:"text-yellow-600",route:"/salary",description:"Payroll and salary records"},{key:"salary_form",label:"Salary Form",icon:ge,color:"text-yellow-500",route:"/salary/new",description:"Create salary records"}],"Business Operations":[{key:"vendors",label:"Vendor List",icon:oe,color:"text-teal-600",route:"/vendors",description:"Supplier relationships"},{key:"vendor_form",label:"Vendor Form",icon:oe,color:"text-teal-500",route:"/vendors/new",description:"Add and edit vendors"},{key:"orders",label:"Order List",icon:me,color:"text-indigo-600",route:"/orders",description:"Purchase orders management"},{key:"order_form",label:"Order Form",icon:ue,color:"text-indigo-500",route:"/orders/new",description:"Create purchase orders"}],"Delivery & Inventory":[{key:"delivery",label:"Delivery List",icon:me,color:"text-pink-600",route:"/delivery",description:"Fuel delivery tracking"},{key:"delivery_form",label:"Delivery Form",icon:pe,color:"text-pink-500",route:"/delivery/new",description:"Create delivery records"},{key:"inventory_alerts",label:"Inventory Alerts",icon:he,color:"text-red-600",route:"/inventory/alerts",description:"Stock level alerts"},{key:"alert_settings",label:"Alert Settings",icon:ne,color:"text-red-500",route:"/inventory/settings",description:"Configure inventory alerts"},{key:"gas_delivery_inventory",label:"Gas Delivery Inventory",icon:q,color:"text-cyan-600",route:"/inventory/gas-delivery",description:"Gas tank monitoring"}],"Licenses & Compliance":[{key:"licenses",label:"License List",icon:B,color:"text-red-600",route:"/licenses",description:"Business licenses and compliance"},{key:"license_form",label:"License Form",icon:xe,color:"text-red-500",route:"/licenses/new",description:"Add and edit licenses"}],"System Administration":[{key:"settings",label:"App Settings",icon:ne,color:"text-gray-600",route:"/settings",description:"Application configuration"},{key:"user_management",label:"User Management",icon:ce,color:"text-red-600",route:"/admin/users",description:"User accounts and permissions"},{key:"site_management",label:"Site Management",icon:oe,color:"text-blue-600",route:"/admin/sites",description:"Multi-station management"},{key:"system_logs",label:"System Logs",icon:de,color:"text-gray-600",route:"/admin/logs",description:"System activity logs"},{key:"security_settings",label:"Security Settings",icon:B,color:"text-red-600",route:"/admin/security",description:"Security policies"}]},Le=[{key:"view",label:"View",icon:le,description:"Can view and access the page",color:"text-blue-600"},{key:"create",label:"Create",icon:ae,description:"Can create new records",color:"text-green-600"},{key:"edit",label:"Edit",icon:ie,description:"Can modify existing records",color:"text-yellow-600"},{key:"delete",label:"Delete",icon:re,description:"Can delete records",color:"text-red-600"},{key:"export",label:"Export",icon:de,description:"Can export data",color:"text-purple-600"},{key:"print",label:"Print",icon:ne,description:"Can print reports",color:"text-indigo-600"}],Ve={Administrator:{description:"Full system access with all permissions",permissions:()=>{const e={};return Object.values(Ue).flat().forEach(s=>{e[s.key]={...Re},Le.forEach(t=>{e[s.key][t.key]=!0})}),e}},Management:{description:"Full operational access with limited admin features",permissions:()=>{const e={};return Object.values(Ue).flat().forEach(s=>{e[s.key]={...Re},["user_management","system_logs","security_settings"].includes(s.key)?(e[s.key].view=!0,e[s.key].export=!0):Le.forEach(t=>{e[s.key][t.key]=!0})}),e}},Employee:{description:"Basic operational access for daily tasks",permissions:()=>{const e={},s=["dashboard","sales_reports","sales_report_form","delivery","delivery_form"];return Object.values(Ue).flat().forEach(t=>{e[t.key]={...Re},s.includes(t.key)?(e[t.key].view=!0,e[t.key].create=!0,e[t.key].edit=!0,e[t.key].print=!0):["products","inventory_alerts","gas_delivery_inventory"].includes(t.key)&&(e[t.key].view=!0)}),e}}},Me=({trigger:t,selectedUserId:r})=>{const[f,w]=s.useState([]),[N,b]=s.useState(null),[_,S]=s.useState({}),[C,A]=s.useState(!0),[k,E]=s.useState(!1),[O,V]=s.useState(!1),[M,$]=s.useState(""),[z,I]=s.useState("All"),[H,W]=s.useState("Custom"),[G,Q]=s.useState(!1),{toast:Z}=p();s.useEffect(()=>{G&&X()},[G]),s.useEffect(()=>{N&&se(N)},[N]),s.useEffect(()=>{if(r&&f.length>0){const e=f.find(e=>e.id===r);e&&b(e)}},[r,f]);const X=async()=>{try{A(!0),console.log("Fetching user profiles for comprehensive permission management...");const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"id",IsAsc:!1,Filters:[]});if(s)throw console.error("Error fetching user profiles:",s),s;console.log("User profiles loaded:",e?.List?.length||0),w(e?.List||[])}catch(e){console.error("Error fetching user profiles:",e),Z({title:"Database Error",description:`Failed to fetch user profiles: ${e}`,variant:"destructive"})}finally{A(!1)}},se=e=>{try{if(console.log("Loading permissions for user:",e.employee_id),e.detailed_permissions&&""!==e.detailed_permissions.trim()&&"{}"!==e.detailed_permissions){const s=JSON.parse(e.detailed_permissions);S(s),W("Custom"),console.log("Loaded existing permissions")}else te(e.role,!1),console.log("Applied default role template:",e.role)}catch(s){console.error("Error parsing permissions for user:",e.employee_id,s),te(e.role,!1)}},te=(e,s=!0)=>{const t=Ve[e];if(t){const r=t.permissions();S(r),W(e),console.log("Applied role template:",e),s&&Z({title:"Template Applied",description:`${e} permission template has been applied`})}else{const e={};Object.values(Ue).flat().forEach(s=>{e[s.key]={...Re}}),S(e),W("Custom"),s&&Z({title:"Custom Template",description:"Initialize custom permissions for this role"})}},re=e=>{try{const s=e.detailed_permissions&&""!==e.detailed_permissions.trim()?JSON.parse(e.detailed_permissions):{},t=Object.values(Ue).flat().length,r=Object.values(Ue).flat().filter(e=>s[e.key]?.view).length;return{summary:`${r}/${t}`,hasAccess:r>0,pagesWithAccess:r,totalPages:t}}catch{return{summary:"0/0",hasAccess:!1,pagesWithAccess:0,totalPages:0}}},ie=(e,s)=>{const t=Ue[e]||[],r={..._};t.forEach(e=>{const t={...Re};switch(s){case"grant_all":Le.forEach(e=>{t[e.key]=!0});break;case"view_only":t.view=!0,t.export=!0}r[e.key]=t}),S(r),W("Custom"),Z({title:"Bulk Update",description:`${s.replace("_"," ")} applied to ${e}`})},ae=f.filter(e=>{const s=e.employee_id.toLowerCase().includes(M.toLowerCase())||e.phone.toLowerCase().includes(M.toLowerCase())||e.role.toLowerCase().includes(M.toLowerCase()),t="All"===z||e.role===z;return s&&t});return e.jsxs(h,{open:G,onOpenChange:Q,children:[e.jsx(u,{asChild:!0,children:t}),e.jsxs(j,{className:"max-w-7xl h-[90vh] overflow-hidden",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(v,{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{children:"Real-Time Permission Management"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"bg-green-50 text-green-700",children:[f.length," Users"]}),e.jsx(o,{onClick:async()=>{V(!0),await X(),V(!1),Z({title:"Success",description:"User data refreshed successfully"})},disabled:O,variant:"outline",size:"sm",children:e.jsx(J,{className:"w-4 h-4 "+(O?"animate-spin":"")})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(F,{className:"h-full",children:e.jsxs("div",{className:"space-y-6 pr-4",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Select User & Apply Templates"})]})}),e.jsx(a,{className:"space-y-4",children:C?e.jsx("div",{className:"text-center py-4",children:"Loading users from database..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(y,{placeholder:"Search users...",value:M,onChange:e=>$(e.target.value),className:"pl-10"})]}),e.jsxs(P,{value:z,onValueChange:I,children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Filter by role"})}),e.jsxs(U,{children:[e.jsx(L,{value:"All",children:"All Roles"}),e.jsx(L,{value:"Administrator",children:"Administrator"}),e.jsx(L,{value:"Management",children:"Management"}),e.jsx(L,{value:"Employee",children:"Employee"})]})]}),e.jsxs(P,{onValueChange:e=>{const s=f.find(s=>s.id.toString()===e);s&&(b(s),console.log("Selected user for permission management:",s.employee_id))},value:N?.id.toString()||"",children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Select user to manage"})}),e.jsx(U,{children:ae.map(s=>{const t=re(s);return e.jsx(L,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("span",{children:[s.employee_id," - ",s.role]}),e.jsx(c,{variant:"outline",className:"ml-2",children:t.summary})]})},s.id)})})]})]}),N&&e.jsxs(x,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("strong",{children:N.employee_id})," - ",N.role," at ",N.station,e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Template: ",H]})]}),e.jsx("div",{className:"text-right",children:e.jsx(c,{className:N.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:N.is_active?"Active":"Inactive"})})]})})]}),N&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"text-sm font-medium",children:"Quick Permission Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:Object.entries(Ve).map(([s,t])=>e.jsx(o,{variant:H===s?"default":"outline",size:"sm",onClick:()=>te(s),className:"text-xs h-auto py-2 px-3 flex flex-col items-center space-y-1",title:t.description,children:e.jsx("span",{className:"font-medium",children:s})},s))})]})]})})]}),N&&e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsxs("span",{children:["Real-Time Permissions for ",N.employee_id]})]}),e.jsxs(o,{onClick:async()=>{if(N){E(!0);try{console.log("Saving permissions for user:",N.employee_id);const{error:e}=await window.ezsite.apis.tableUpdate(11725,{id:N.id,detailed_permissions:JSON.stringify(_)});if(e)throw console.error("Database error saving permissions:",e),e;Z({title:"Success",description:`Permissions updated successfully for ${N.employee_id}`}),w(e=>e.map(e=>e.id===N.id?{...e,detailed_permissions:JSON.stringify(_)}:e)),console.log("Permissions saved to production database successfully")}catch(e){console.error("Error saving permissions:",e),Z({title:"Database Error",description:`Failed to save permissions: ${e}`,variant:"destructive"})}finally{E(!1)}}else Z({title:"Error",description:"No user selected",variant:"destructive"})},disabled:k,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),k?"Saving to Database...":"Save Permissions"]})]})}),e.jsxs(a,{children:[e.jsx("div",{className:"space-y-6",children:Object.entries(Ue).map(([s,t])=>e.jsxs(i,{className:"border-l-4 border-l-blue-500",children:[e.jsx(l,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-lg",children:s}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>ie(s,"view_only"),className:"text-blue-600",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"View Only"]}),e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>ie(s,"grant_all"),className:"text-green-600",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),"Full Access"]}),e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>ie(s,"revoke_all"),className:"text-red-600",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"No Access"]})]})]})}),e.jsx(a,{children:e.jsx("div",{className:"space-y-4",children:t.map(s=>{const t=_[s.key]||Re;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(s.icon,{className:`w-5 h-5 ${s.color}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.label}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description}),s.route&&e.jsxs("p",{className:"text-xs text-blue-500",children:["Route: ",s.route]})]})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:Le.map(r=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx(T,{checked:t[r.key]||!1,onCheckedChange:e=>{return t=s.key,i=r.key,a=e,S(e=>({...e,[t]:{...e[t]||Re,[i]:a}})),W("Custom"),void console.log("Permission changed:",t,i,a);var t,i,a},id:`${s.key}-${r.key}`}),e.jsxs(d,{htmlFor:`${s.key}-${r.key}`,className:"text-xs cursor-pointer flex items-center space-x-1",children:[e.jsx(r.icon,{className:`w-3 h-3 ${r.color}`}),e.jsx("span",{children:r.label})]})]},r.key))})]},s.key)})})})]},s))}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2 text-blue-600"}),"Real-Time Production Database Integration"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Button Controls:"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"View:"})," Controls page access and navigation visibility"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Create:"}),' Controls "Add" and "Create New" buttons']}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Edit:"}),' Controls "Edit" and modification buttons']}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Delete:"})," Controls delete actions and buttons"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Export:"})," Controls data export functionality"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Print:"})," Controls enhanced print dialogs"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:"Current Configuration:"}),e.jsx(c,{variant:"outline",className:"mb-2",children:H}),e.jsx("p",{className:"text-gray-600 text-xs",children:Ve[H]?.description||"Custom permissions configured"}),N&&(()=>{const s=re(N);return e.jsxs("p",{className:"text-xs text-green-600 mt-2",children:["Access to ",s.pagesWithAccess," out of ",s.totalPages," pages"]})})()]})]})]})]})]})]})})})]})]})},$e={"Super Admin":{icon:B,color:"bg-red-100 text-red-800 border-red-200",description:"Complete system access - Can manage everything including users, settings, and all data",permissions:["All Pages","All Operations","User Management","System Settings","Security"],level:5},Manager:{icon:ce,color:"bg-blue-100 text-blue-800 border-blue-200",description:"Full operational access - Can view, create, edit all business data (except admin features)",permissions:["Sales Reports","Products","Employees","Orders","Inventory","Print & Export"],level:4},Supervisor:{icon:be,color:"bg-purple-100 text-purple-800 border-purple-200",description:"Department oversight - Can manage specific areas and view reports",permissions:["View All","Edit Some","Create Reports","Approve Requests"],level:3},Employee:{icon:ee,color:"bg-green-100 text-green-800 border-green-200",description:"Daily operations - Can handle routine tasks like sales, basic inventory, and delivery",permissions:["Sales Entry","View Products","Basic Reports","Delivery Records"],level:2},"Read Only":{icon:le,color:"bg-gray-100 text-gray-800 border-gray-200",description:"View only access - Can see reports and data but cannot make changes",permissions:["View Reports","View Data","Export Only"],level:1}},ze={"New Employee":{description:"Perfect for new staff members who need basic access",role:"Employee",icon:ae},"Department Head":{description:"For department managers who oversee operations",role:"Manager",icon:ce},"Auditor/Viewer":{description:"For external auditors or read-only access",role:"Read Only",icon:le},"System Admin":{description:"For IT administrators who need full access",role:"Super Admin",icon:B}},Ie=({trigger:t,selectedUserId:r,onRoleAssigned:d})=>{const[f,w]=s.useState([]),[N,b]=s.useState(null),[_,S]=s.useState(""),[C,A]=s.useState(""),[k,E]=s.useState(!0),[O,P]=s.useState(!1),[D,R]=s.useState(!1),[U,L]=s.useState([]),[M,$]=s.useState(!1),{toast:z}=p();s.useEffect(()=>{D&&I()},[D]),s.useEffect(()=>{if(r&&f.length>0){const e=f.find(e=>e.id===r);e&&(b(e),S(e.role))}},[r,f]);const I=async()=>{try{E(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"employee_id",IsAsc:!0,Filters:[]});if(s)throw s;w(e?.List||[])}catch(e){console.error("Error fetching users:",e),z({title:"Error",description:`Failed to load users: ${e}`,variant:"destructive"})}finally{E(!1)}},T=async(e,s)=>{try{const t=q(s),{error:r}=await window.ezsite.apis.tableUpdate(11725,{id:e,role:s,detailed_permissions:JSON.stringify(t)});if(r)throw r;return!0}catch(t){throw console.error("Error assigning role:",t),t}},q=e=>{const s={"Super Admin":{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},user_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},site_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},system_logs:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},security_settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0}},Manager:{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!1,edit:!0,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},Employee:{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},products:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},employees:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},sales_reports:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},vendors:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},orders:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},licenses:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},delivery:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},"Read Only":{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},products:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},employees:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},vendors:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},orders:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}}};return s[e]||s.Employee},H=f.filter(e=>e.employee_id.toLowerCase().includes(C.toLowerCase())||e.phone.toLowerCase().includes(C.toLowerCase())||e.role.toLowerCase().includes(C.toLowerCase())),G=e.jsxs(o,{variant:"outline",className:"border-blue-500 text-blue-600 hover:bg-blue-50",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Easy Role Assignment"]});return e.jsxs(h,{open:D,onOpenChange:R,children:[e.jsx(u,{asChild:!0,children:t||G}),e.jsxs(j,{className:"max-w-4xl h-[85vh]",children:[e.jsx(g,{children:e.jsxs(v,{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{children:"Simple Role Assignment"}),e.jsx(c,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Easy Mode"})]})}),e.jsx(F,{className:"h-full pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{children:"Quick Assignment Templates"})]})}),e.jsx(a,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(ze).map(([s,t])=>e.jsxs(o,{variant:"outline",className:"h-auto p-3 flex flex-col items-center space-y-2",onClick:()=>S(t.role),children:[e.jsx(t.icon,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-sm",children:s}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]},s))})})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Available Roles"})]})}),e.jsx(a,{children:e.jsx("div",{className:"space-y-3",children:Object.entries($e).map(([s,t])=>e.jsx("div",{className:"p-4 rounded-lg border-2 cursor-pointer transition-all "+(_===s?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>S(s),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t.icon,{className:"w-6 h-6 text-gray-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s}),e.jsxs(c,{className:t.color,children:["Level ",t.level]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.permissions.map((s,t)=>e.jsx(c,{variant:"outline",className:"text-xs",children:s},t))})]})]})},s))})})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:"Select Users"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>$(!M),children:M?"Single Mode":"Bulk Mode"}),e.jsx(o,{variant:"outline",size:"sm",onClick:I,disabled:k,children:e.jsx(J,{className:"w-4 h-4 "+(k?"animate-spin":"")})})]})]})}),e.jsx(a,{children:k?e.jsx("div",{className:"text-center py-8",children:"Loading users..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(y,{placeholder:"Search users...",value:C,onChange:e=>A(e.target.value),className:"pl-10"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2",children:H.map(s=>e.jsx("div",{className:"p-3 border rounded-lg cursor-pointer transition-all "+(M?U.includes(s.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300":N?.id===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>{M?L(e=>e.includes(s.id)?e.filter(e=>e!==s.id):[...e,s.id]):(b(s),S(s.role))},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[M&&e.jsx(V,{checked:U.includes(s.id),onChange:()=>{}}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.employee_id}),e.jsx("div",{className:"text-sm text-gray-500",children:s.phone})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:$e[s.role]?.color||"bg-gray-100 text-gray-800",children:s.role}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.station})]})]})},s.id))}),0===H.length&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No users found matching your search"})]})})]}),(N&&!M||U.length>0&&M)&&_&&e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(we,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Assignment Summary"})]})}),e.jsxs(a,{children:[e.jsxs(x,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Selected Role:"})," ",_]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Target Users:"})," ",M?`${U.length} users`:N?.employee_id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Permissions:"})," ",$e[_]?.description]})]})})]}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsxs(o,{onClick:M?async()=>{if(0!==U.length&&_){P(!0);try{let e=0;for(const s of U)await T(s,_),e++;z({title:"Success",description:`${e} users assigned ${_} role successfully`}),w(e=>e.map(e=>U.includes(e.id)?{...e,role:_,detailed_permissions:JSON.stringify(q(_))}:e)),L([]),$(!1),d?.()}catch(e){z({title:"Error",description:`Failed to assign roles: ${e}`,variant:"destructive"})}finally{P(!1)}}else z({title:"Error",description:"Please select users and a role",variant:"destructive"})}:async()=>{if(N&&_){P(!0);try{await T(N.id,_),z({title:"Success",description:`${N.employee_id} assigned ${_} role successfully`}),w(e=>e.map(e=>e.id===N.id?{...e,role:_,detailed_permissions:JSON.stringify(q(_))}:e)),d?.(),R(!1)}catch(e){z({title:"Error",description:`Failed to assign role: ${e}`,variant:"destructive"})}finally{P(!1)}}else z({title:"Error",description:"Please select a user and role",variant:"destructive"})},disabled:O,className:"bg-blue-600 hover:bg-blue-700 flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),O?"Assigning...":`Assign ${_} Role`]}),e.jsx(o,{variant:"outline",onClick:()=>{b(null),L([]),S("")},children:"Clear Selection"})]})]})]})]})})]})]})},Te=["Super Admin","Manager","Supervisor","Employee","Read Only"],Be={"Super Admin":"bg-red-100 text-red-800",Manager:"bg-blue-100 text-blue-800",Supervisor:"bg-purple-100 text-purple-800",Employee:"bg-green-100 text-green-800","Read Only":"bg-gray-100 text-gray-800"},qe=({trigger:t,onRolesAssigned:r})=>{const[d,f]=s.useState([]),[w,N]=s.useState([]),[b,_]=s.useState(""),[S,C]=s.useState(""),[A,k]=s.useState("All"),[E,O]=s.useState("All"),[F,M]=s.useState(!0),[$,z]=s.useState(!1),[I,T]=s.useState(!1),{toast:B}=p();s.useEffect(()=>{I&&q()},[I]);const q=async()=>{try{M(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"employee_id",IsAsc:!0,Filters:[]});if(s)throw s;f(e?.List||[])}catch(e){console.error("Error fetching users:",e),B({title:"Error",description:`Failed to load users: ${e}`,variant:"destructive"})}finally{M(!1)}},H=Array.from(new Set(d.map(e=>e.station))).filter(Boolean),W=d.filter(e=>{const s=e.employee_id.toLowerCase().includes(S.toLowerCase())||e.phone.toLowerCase().includes(S.toLowerCase()),t="All"===A||e.station===A,r="All"===E||e.role===E;return s&&t&&r}),G=e.jsxs(o,{className:"bg-orange-600 hover:bg-orange-700",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Bulk Role Manager"]});return e.jsxs(h,{open:I,onOpenChange:T,children:[e.jsx(u,{asChild:!0,children:t||G}),e.jsxs(j,{className:"max-w-6xl h-[90vh]",children:[e.jsx(g,{children:e.jsxs(v,{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-6 h-6 text-orange-600"}),e.jsx("span",{children:"Bulk Role Manager"}),e.jsx(c,{className:"bg-orange-100 text-orange-800",children:"Mass Assignment"})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"h-full flex flex-col space-y-4",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:"Filter Users"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(y,{placeholder:"Search users...",value:S,onChange:e=>C(e.target.value),className:"pl-10"})]}),e.jsxs(P,{value:A,onValueChange:k,children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Filter by station"})}),e.jsxs(U,{children:[e.jsx(L,{value:"All",children:"All Stations"}),H.map(s=>e.jsx(L,{value:s,children:s},s))]})]}),e.jsxs(P,{value:E,onValueChange:O,children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Filter by current role"})}),e.jsxs(U,{children:[e.jsx(L,{value:"All",children:"All Roles"}),Te.map(s=>e.jsx(L,{value:s,children:s},s))]})]}),e.jsx(o,{variant:"outline",onClick:()=>{C(""),k("All"),O("All")},children:"Clear Filters"})]})})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"w-5 h-5"}),e.jsx("span",{children:"Target Role"})]})}),e.jsx(a,{children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:Te.map(s=>e.jsx(o,{variant:b===s?"default":"outline",className:"h-auto p-3 "+(b===s?"bg-blue-600 hover:bg-blue-700":""),onClick:()=>_(s),children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"font-medium",children:s})})},s))})})]}),e.jsxs(i,{className:"flex-1 overflow-hidden",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsxs("span",{children:["Select Users (",W.length,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",children:[w.length," selected"]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{w.length===W.length?N([]):N(W.map(e=>e.id))},children:w.length===W.length?"Deselect All":"Select All"}),e.jsx(o,{variant:"outline",size:"sm",onClick:q,disabled:F,children:e.jsx(J,{className:"w-4 h-4 "+(F?"animate-spin":"")})})]})]})}),e.jsx(a,{className:"flex-1 overflow-hidden",children:F?e.jsx("div",{className:"text-center py-8",children:"Loading users..."}):e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:W.map(s=>e.jsx("div",{className:"p-3 border rounded-lg cursor-pointer transition-all "+(w.includes(s.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>{return e=s.id,void N(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{checked:w.includes(s.id),onChange:()=>{}}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.employee_id}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.phone," • ",s.station]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:Be[s.role]||"bg-gray-100 text-gray-800",children:s.role}),b&&b!==s.role&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3 h-3 text-gray-400"}),e.jsx(c,{className:Be[b],children:b})]})]})]})})]})},s.id))})})})]}),w.length>0&&b&&e.jsx(i,{children:e.jsxs(a,{className:"pt-6",children:[e.jsxs(x,{children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{children:e.jsxs("strong",{children:["Ready to assign ",b," role to ",w.length," users"]})}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Current roles: ",Object.entries((()=>{const e={};return w.forEach(s=>{const t=d.find(e=>e.id===s);t&&(e[t.role]=(e[t.role]||0)+1)}),e})()).map(([e,s])=>`${s} ${e}`).join(", ")]})]})})]}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsxs(o,{onClick:async()=>{if(0!==w.length&&b){z(!0);try{const s=(e=>{const s={"Super Admin":{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},user_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},site_management:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},system_logs:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},security_settings:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0}},Manager:{dashboard:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},products:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},employees:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},vendors:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},orders:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},inventory:{view:!0,create:!0,edit:!0,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!0,edit:!0,delete:!0,export:!0,print:!0},settings:{view:!0,create:!1,edit:!0,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},Employee:{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},products:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},employees:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},sales_reports:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},vendors:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},orders:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},licenses:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!1,print:!1},delivery:{view:!0,create:!0,edit:!0,delete:!1,export:!1,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}},"Read Only":{dashboard:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},products:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},employees:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},sales_reports:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},vendors:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},orders:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},licenses:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},salary:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},inventory:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},delivery:{view:!0,create:!1,edit:!1,delete:!1,export:!0,print:!0},settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},user_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},site_management:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},system_logs:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1},security_settings:{view:!1,create:!1,edit:!1,delete:!1,export:!1,print:!1}}};return s[e]||s.Employee})(b);let t=0,i=0;for(const r of w)try{const{error:e}=await window.ezsite.apis.tableUpdate(11725,{id:r,role:b,detailed_permissions:JSON.stringify(s)});e?(console.error(`Failed to update user ${r}:`,e),i++):t++}catch(e){console.error(`Error updating user ${r}:`,e),i++}f(e=>e.map(e=>w.includes(e.id)?{...e,role:b,detailed_permissions:JSON.stringify(s)}:e)),t>0&&B({title:"Bulk Assignment Complete",description:`Successfully assigned ${b} role to ${t} users${i>0?`. ${i} failed.`:""}`}),0===i&&(N([]),_(""),r?.())}catch(e){B({title:"Error",description:`Failed to process bulk assignment: ${e}`,variant:"destructive"})}finally{z(!1)}}else B({title:"Error",description:"Please select users and a target role",variant:"destructive"})},disabled:$,className:"bg-orange-600 hover:bg-orange-700 flex-1",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),$?`Processing ${w.length} users...`:`Assign ${b} to All Selected`]}),e.jsx(o,{variant:"outline",onClick:()=>{N([]),_("")},children:"Clear Selection"})]})]})})]})})]})]})},Je={"Super Admin":{icon:B,color:"bg-red-100 text-red-800 border-red-200",level:5,description:"Complete system access with all permissions",responsibilities:["Manage all users and their permissions","Configure system settings and security","Access all data and operations","System maintenance and monitoring","Final approval authority"],access:{dashboard:"✓ Full Access",products:"✓ All Operations",employees:"✓ All Operations",sales:"✓ All Operations",vendors:"✓ All Operations",orders:"✓ All Operations",inventory:"✓ All Operations",delivery:"✓ All Operations",licenses:"✓ All Operations",salary:"✓ All Operations",settings:"✓ All Operations",userManagement:"✓ Full Control",systemLogs:"✓ Full Access",security:"✓ Full Control"},whenToUse:"For IT administrators and owners who need complete system control"},Manager:{icon:ce,color:"bg-blue-100 text-blue-800 border-blue-200",level:4,description:"Full operational access with limited admin features",responsibilities:["Oversee daily business operations","Manage sales, inventory, and orders","View and generate reports","Supervise employee activities","Handle vendor relationships"],access:{dashboard:"✓ Full Access",products:"✓ All Operations",employees:"✓ View, Create, Edit",sales:"✓ All Operations",vendors:"✓ All Operations",orders:"✓ All Operations",inventory:"✓ View, Edit",delivery:"✓ All Operations",licenses:"✓ View Only",salary:"✓ View, Create, Edit",settings:"✓ Basic Settings",userManagement:"✗ No Access",systemLogs:"✓ View Only",security:"✗ No Access"},whenToUse:"For store managers and department heads who run day-to-day operations"},Supervisor:{icon:be,color:"bg-purple-100 text-purple-800 border-purple-200",level:3,description:"Department oversight with specific area management",responsibilities:["Supervise specific departments","Review and approve reports","Train and guide employees","Monitor daily operations","Assist with inventory management"],access:{dashboard:"✓ View Only",products:"✓ View, Edit",employees:"✓ View Only",sales:"✓ View, Create, Edit",vendors:"✓ View Only",orders:"✓ View, Create",inventory:"✓ View, Edit",delivery:"✓ View, Edit",licenses:"✓ View Only",salary:"✓ View Only",settings:"✗ No Access",userManagement:"✗ No Access",systemLogs:"✗ No Access",security:"✗ No Access"},whenToUse:"For assistant managers and team leaders who oversee specific areas"},Employee:{icon:ee,color:"bg-green-100 text-green-800 border-green-200",level:2,description:"Daily operations access for routine tasks",responsibilities:["Process sales transactions","Handle delivery records","Basic inventory monitoring","Customer service","Follow established procedures"],access:{dashboard:"✓ View Only",products:"✓ View Only",employees:"✗ No Access",sales:"✓ Create, Edit",vendors:"✗ No Access",orders:"✗ No Access",inventory:"✓ View Only",delivery:"✓ Create, Edit",licenses:"✗ No Access",salary:"✗ No Access",settings:"✗ No Access",userManagement:"✗ No Access",systemLogs:"✗ No Access",security:"✗ No Access"},whenToUse:"For front-line staff who handle daily customer interactions and basic operations"},"Read Only":{icon:le,color:"bg-gray-100 text-gray-800 border-gray-200",level:1,description:"View-only access for monitoring and reporting",responsibilities:["View reports and data","Monitor business metrics","Export data for analysis","Audit and compliance review","Read-only system access"],access:{dashboard:"✓ View Only",products:"✓ View Only",employees:"✓ View Only",sales:"✓ View Only",vendors:"✓ View Only",orders:"✓ View Only",inventory:"✓ View Only",delivery:"✓ View Only",licenses:"✓ View Only",salary:"✗ No Access",settings:"✗ No Access",userManagement:"✗ No Access",systemLogs:"✗ No Access",security:"✗ No Access"},whenToUse:"For auditors, accountants, and external reviewers who need read-only access"}},He={dashboard:q,products:ve,employees:ee,sales:de,vendors:ne,orders:ne,inventory:ve,delivery:ne,licenses:B,salary:je,settings:ne,userManagement:ce,systemLogs:de,security:B},We=({trigger:s})=>{const t=e.jsxs(o,{variant:"outline",className:"border-gray-300",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Role Guide"]}),r=s=>s.startsWith("✓")?e.jsx(we,{className:"w-4 h-4 text-green-600"}):s.startsWith("✗")?e.jsx(Y,{className:"w-4 h-4 text-red-600"}):e.jsx(le,{className:"w-4 h-4 text-blue-600"});return e.jsxs(h,{children:[e.jsx(u,{asChild:!0,children:s||t}),e.jsxs(j,{className:"max-w-6xl h-[90vh]",children:[e.jsx(g,{children:e.jsxs(v,{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{children:"Role Definitions & Permissions Guide"}),e.jsx(c,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Reference Guide"})]})}),e.jsx(F,{className:"h-full pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{children:"Role Hierarchy"})]})}),e.jsx(a,{children:e.jsx("div",{className:"flex items-center justify-between bg-gradient-to-r from-red-50 to-gray-50 p-4 rounded-lg",children:Object.entries(Je).map(([s,t],r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`p-3 rounded-lg border-2 ${t.color}`,children:e.jsx(t.icon,{className:"w-6 h-6 mx-auto"})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-semibold text-sm",children:s}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Level ",t.level]})]})]}),r<Object.keys(Je).length-1&&e.jsx(Ce,{className:"w-5 h-5 text-gray-400 mx-4"})]},s))})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Object.entries(Je).map(([s,t])=>e.jsxs(i,{className:"border-l-4",style:{borderLeftColor:t.color.includes("red")?"#ef4444":t.color.includes("blue")?"#3b82f6":t.color.includes("purple")?"#8b5cf6":t.color.includes("green")?"#10b981":"#6b7280"},children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-3",children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:s}),e.jsxs(c,{className:t.color,children:["Level ",t.level]})]}),e.jsx("p",{className:"text-sm text-gray-600 font-normal mt-1",children:t.description})]})]})}),e.jsxs(a,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-blue-700",children:"When to Use:"}),e.jsx("p",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:t.whenToUse})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Key Responsibilities:"}),e.jsx("ul",{className:"space-y-1",children:t.responsibilities.map((s,t)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start space-x-2",children:[e.jsx(we,{className:"w-3 h-3 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},t))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"System Access:"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Object.entries(t.access).map(([s,t])=>{const i=He[s]||ne;return e.jsxs("div",{className:"flex items-center justify-between text-xs p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{className:"w-3 h-3 text-gray-600"}),e.jsx("span",{className:"capitalize",children:s.replace(/([A-Z])/g," $1").trim()})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[r(t),e.jsx("span",{className:t.startsWith("✓")?"text-green-700":"text-red-700",children:t.replace("✓ ","").replace("✗ ","")})]})]},s)})})]})]})]},s))}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{children:"Quick Reference"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"High Security Roles"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsx("li",{children:"• Super Admin - IT/Owners only"}),e.jsx("li",{children:"• Full system access"}),e.jsx("li",{children:"• Can manage other users"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Operational Roles"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsx("li",{children:"• Manager - Store operations"}),e.jsx("li",{children:"• Supervisor - Department oversight"}),e.jsx("li",{children:"• Employee - Daily tasks"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Special Access"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsx("li",{children:"• Read Only - Auditors/Reviewers"}),e.jsx("li",{children:"• View reports and data"}),e.jsx("li",{children:"• No modification rights"})]})]})]})})]})]})})]})]})},Ge=()=>{const{isAdmin:t}=f(),[r,x]=s.useState([]),[m,T]=s.useState(!0),[H,W]=s.useState(!1),[G,Q]=s.useState(""),[K,Z]=s.useState("All"),[X,Y]=s.useState("All"),[se,te]=s.useState(!1),[ie,le]=s.useState(!1),[oe,de]=s.useState(!1),[xe,me]=s.useState(!1),[pe,he]=s.useState(null),[ue,je]=s.useState(!1),[ge,ve]=s.useState(!1),{toast:ye}=p(),we=M(),[Ne,be]=s.useState({role:"",station_access:[],is_active:!0}),_e=["admin","manager","employee"],[Se,Ce]=s.useState([]),[Ae,ke]=s.useState({user_id:0,role:"employee",station_access:[],employee_id:"",phone:"",hire_date:"",is_active:!0}),Re=()=>Math.floor(1e6*Math.random())+1e5;s.useEffect(()=>{Le(),Ue();const e=setInterval(()=>{Le()},3e4);return()=>clearInterval(e)},[]);const Ue=async()=>{try{const{data:e,error:s}=await window.ezsite.apis.tablePage(12599,{PageNo:1,PageSize:100});if(s)throw new Error(s);Ce(e?.List||[])}catch(e){console.error("Error fetching stations:",e),ye({title:"Database Error",description:"Failed to fetch stations",variant:"destructive"})}},Le=async()=>{T(!0),await Ve(),T(!1)},Ve=async()=>{try{const{data:e,error:s}=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:100,OrderByField:"id",IsAsc:!1,Filters:[]});if(s)throw console.error("Database API returned error:",s),s;x(e?.List||[])}catch(e){console.error("Error fetching user profiles:",e),ye({title:"Database Error",description:`Failed to fetch user profiles: ${e}`,variant:"destructive"}),x([])}},$e=r.filter(e=>{const s=e=>{const s=(e=>null==e||""===e?"":"string"==typeof e?e:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):String(e))(e);return s?s.toLowerCase():""},t=G?G.toLowerCase():"";if(!e)return!1;const r=!t||s(e.employee_id).includes(t)||s(e.phone).includes(t)||s(e.role).includes(t),i="All"===K||s(e.role)===s(K),a="All"===X||Array.isArray(e.station_access)&&e.station_access.some(e=>s(e).includes(s(X)));return r&&i&&a}),ze=e=>{switch(e){case"admin":return"bg-red-100 text-red-800";case"manager":return"bg-blue-100 text-blue-800";case"employee":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},Te=e=>{if(!e||"string"!=typeof e)return"bg-gray-100 text-gray-800";const s=Se.find(s=>s&&"object"==typeof s&&s.name===e);if(!s||!s.id)return"bg-gray-100 text-gray-800";try{const e=String(s.id).split("").reduce((e,s)=>s.charCodeAt(0)+((e<<5)-e),0),t=["bg-blue-100 text-blue-800","bg-purple-100 text-purple-800","bg-orange-100 text-orange-800","bg-teal-100 text-teal-800","bg-pink-100 text-pink-800"];return t[Math.abs(e)%t.length]}catch(t){return"bg-gray-100 text-gray-800"}};return t?m?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx("div",{className:"text-lg",children:"Loading real-time user management..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Real-Time User Management"}),e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"✓ Production Database Connected - Live Data & Permissions"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),r.length," Users"]}),e.jsxs(o,{onClick:async()=>{W(!0),await Le(),W(!1),ye({title:"Success",description:"Real-time data refreshed successfully"})},disabled:H,variant:"outline",className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-4 h-4 "+(H?"animate-spin":"")}),e.jsx("span",{children:H?"Refreshing...":"Refresh Data"})]})]})]}),e.jsxs(w,{defaultValue:"profiles",className:"w-full",children:[e.jsxs(N,{className:"grid w-full grid-cols-2",children:[e.jsxs(b,{value:"profiles",className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"User Profiles"})]}),e.jsxs(b,{value:"permissions",className:"flex items-center space-x-2",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Real-Time Permission Management"})]})]}),e.jsxs(_,{value:"profiles",className:"space-y-6",children:[e.jsxs(i,{className:"border-blue-200 bg-blue-50",children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center space-x-2 text-blue-800",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{children:"Easy Role Assignment"}),e.jsx(c,{className:"bg-blue-100 text-blue-800",children:"Simplified"})]})}),e.jsx(a,{children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(Ie,{onRoleAssigned:()=>{Ve(),ye({title:"Success",description:"Role assignment completed successfully"})}}),e.jsx(qe,{onRolesAssigned:()=>{Ve(),ye({title:"Success",description:"Bulk role assignment completed successfully"})}}),e.jsx(We,{}),e.jsx("div",{className:"text-sm text-blue-700 max-w-md",children:"Use these simplified tools to quickly assign roles without dealing with complex permission settings."})]})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsxs(o,{onClick:()=>ve(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create New User"]}),e.jsxs(h,{open:se,onOpenChange:e=>{if(e){const e=Re();ke(s=>({...s,user_id:e}))}te(e)},children:[e.jsx(u,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:"border-blue-600 text-blue-600 hover:bg-blue-50",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Add User Profile Only"]})}),e.jsxs(j,{className:"max-w-lg max-h-[85vh]",children:[e.jsx(g,{children:e.jsx(v,{children:"Create User Profile"})}),e.jsx(F,{className:"max-h-[calc(85vh-120px)] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"user_id",children:"User ID (Auto-generated)"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"user_id",type:"number",value:Ae.user_id,readOnly:!0,disabled:!0,className:"bg-gray-50 text-gray-700 cursor-not-allowed",placeholder:"Auto-generated ID"}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-200",onClick:()=>{const e=Re();ke(s=>({...s,user_id:e})),ye({title:"Success",description:`New User ID generated: ${e}`})},title:"Generate new random User ID",children:e.jsx(J,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"User ID is automatically generated. Click the refresh icon to generate a new one."})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"role",children:"Role"}),e.jsxs(P,{value:Ae.role,onValueChange:e=>ke({...Ae,role:e}),children:[e.jsx(D,{children:e.jsx(R,{})}),e.jsx(U,{children:_e.map(s=>e.jsx(L,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"station",children:"Station"}),e.jsxs(P,{onValueChange:e=>ke({...Ae,station_access:[e]}),children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Select a station"})}),e.jsx(U,{children:Se.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"employee_id",children:"Employee ID *"}),e.jsx(y,{id:"employee_id",value:Ae.employee_id,onChange:e=>ke({...Ae,employee_id:e.target.value}),placeholder:"Enter employee ID",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone",children:"Phone *"}),e.jsx(y,{id:"phone",value:Ae.phone,onChange:e=>ke({...Ae,phone:e.target.value}),placeholder:"Enter phone number",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"hire_date",children:"Hire Date"}),e.jsx(y,{id:"hire_date",type:"date",value:Ae.hire_date,onChange:e=>ke({...Ae,hire_date:e.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"is_active",checked:Ae.is_active,onCheckedChange:e=>ke({...Ae,is_active:e})}),e.jsx(d,{htmlFor:"is_active",children:"Active User"})]}),e.jsx(o,{onClick:async()=>{if(Ae.employee_id&&Ae.phone)try{const{error:e}=await window.ezsite.apis.tableCreate(11725,Ae);if(e)throw e;ye({title:"Success",description:"User profile created successfully"}),te(!1),ke({user_id:Re(),role:"employee",station_access:[],employee_id:"",phone:"",hire_date:"",is_active:!0}),Ve()}catch(e){console.error("Error creating profile:",e),ye({title:"Database Error",description:`Failed to create user profile: ${e}`,variant:"destructive"})}else ye({title:"Validation Error",description:"Employee ID and Phone are required fields",variant:"destructive"})},className:"w-full",children:"Create Profile"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ee,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:r.length})]})]})})}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Administrators"}),e.jsx("p",{className:"text-2xl font-bold",children:r.filter(e=>"admin"===e.role).length})]})]})})}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ce,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:r.filter(e=>e.is_active).length})]})]})})}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Managers"}),e.jsx("p",{className:"text-2xl font-bold",children:r.filter(e=>"manager"===e.role).length})]})]})})})]}),e.jsx(i,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(y,{placeholder:"Search by employee ID or phone...",value:G,onChange:e=>Q(e.target.value),className:"pl-10"})]}),e.jsxs(P,{value:K,onValueChange:Z,children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Filter by role"})}),e.jsxs(U,{children:[e.jsx(L,{value:"All",children:"All Roles"}),_e.map(s=>e.jsx(L,{value:s,children:s},s))]})]}),e.jsxs(P,{value:X,onValueChange:Y,children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Filter by station"})}),e.jsxs(U,{children:[e.jsx(L,{value:"All",children:"All Stations"}),Se.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))]})]}),e.jsx(o,{variant:"outline",onClick:()=>{Q(""),Z("All"),Y("All")},children:"Clear Filters"})]})})}),e.jsx($,{selectedCount:we.selectedCount,onBatchEdit:()=>{0!==we.getSelectedData($e,e=>e.id).length?de(!0):ye({title:"No Selection",description:"Please select profiles to edit",variant:"destructive"})},onBatchDelete:()=>{0!==we.getSelectedData($e,e=>e.id).length?me(!0):ye({title:"No Selection",description:"Please select profiles to delete",variant:"destructive"})},onClearSelection:we.clearSelection,isLoading:ue}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(n,{children:["Real-Time User Profiles (",$e.length,")"]})}),e.jsx(a,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(A,{children:[e.jsx(k,{className:"w-12",children:e.jsx(V,{checked:$e.length>0&&we.selectedCount===$e.length,onCheckedChange:()=>we.toggleSelectAll($e,e=>e.id),"aria-label":"Select all profiles"})}),e.jsx(k,{children:"Employee ID"}),e.jsx(k,{children:"Role"}),e.jsx(k,{children:"Station Access"}),e.jsx(k,{children:"Phone"}),e.jsx(k,{children:"Hire Date"}),e.jsx(k,{children:"Status"}),e.jsx(k,{children:"Actions"})]})}),e.jsx(E,{children:0===$e.length?e.jsx(A,{children:e.jsx(O,{colSpan:9,className:"text-center py-8",children:e.jsx("div",{className:"flex flex-col items-center space-y-3",children:0===r.length?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-12 h-12 text-gray-300"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-medium",children:"No User Profiles in Database"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first user profile to get started"})]}),e.jsxs(o,{onClick:()=>ve(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Create First User"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-12 h-12 text-gray-300"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-medium",children:"No Profiles Match Current Filters"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Try adjusting your search criteria"})]}),e.jsx(o,{variant:"outline",onClick:()=>{Q(""),Z("All"),Y("All")},children:"Clear All Filters"})]})})})}):$e.map(s=>e.jsxs(A,{className:we.isSelected(s.id)?"bg-blue-50":"",children:[e.jsx(O,{children:e.jsx(V,{checked:we.isSelected(s.id),onCheckedChange:()=>we.toggleItem(s.id),"aria-label":`Select profile ${s.employee_id}`})}),e.jsx(O,{className:"font-medium",children:s.employee_id}),e.jsx(O,{children:e.jsx(c,{className:ze(s.role),children:s.role})}),e.jsx(O,{children:e.jsx(c,{className:Te(s.station_access?.[0]),children:Array.isArray(s.station_access)&&s.station_access.length>0?s.station_access.join(", "):"N/A"})}),e.jsx(O,{children:s.phone}),e.jsx(O,{children:s.hire_date?new Date(s.hire_date).toLocaleDateString():"N/A"}),e.jsx(O,{children:e.jsx(c,{className:s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:s.is_active?"Active":"Inactive"})}),e.jsx(O,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>(e=>{he(e),ke({user_id:e.user_id,role:e.role,station_access:e.station_access||[],employee_id:e.employee_id,phone:e.phone,hire_date:e.hire_date||"",is_active:e.is_active}),le(!0)})(s),children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx(Ie,{selectedUserId:s.id,trigger:e.jsx(o,{size:"sm",variant:"outline",className:"text-green-600 hover:text-green-700",title:"Quick Role Assignment",children:e.jsx(B,{className:"w-4 h-4"})}),onRoleAssigned:()=>{Ve(),ye({title:"Success",description:"Role updated successfully"})}}),e.jsx(Me,{selectedUserId:s.id,trigger:e.jsx(o,{size:"sm",variant:"outline",className:"text-blue-600 hover:text-blue-700",title:"Advanced Permission Management",children:e.jsx(ne,{className:"w-4 h-4"})})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this user profile? This action cannot be undone."))try{const{error:s}=await window.ezsite.apis.tableDelete(11725,{id:e});if(s)throw s;ye({title:"Success",description:"User profile deleted successfully"}),Ve()}catch(s){console.error("Error deleting profile:",s),ye({title:"Database Error",description:`Failed to delete user profile: ${s}`,variant:"destructive"})}})(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(re,{className:"w-4 h-4"})})]})})]},s.id))})]})})})]}),e.jsx(h,{open:ie,onOpenChange:le,children:e.jsxs(j,{className:"max-w-2xl",children:[e.jsx(g,{children:e.jsx(v,{children:"Edit User Profile"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_role",children:"Role"}),e.jsxs(P,{value:Ae.role,onValueChange:e=>ke({...Ae,role:e}),children:[e.jsx(D,{children:e.jsx(R,{})}),e.jsx(U,{children:_e.map(s=>e.jsx(L,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_station",children:"Station"}),e.jsxs(P,{value:Ae.station_access[0]||"",onValueChange:e=>ke({...Ae,station_access:[e]}),children:[e.jsx(D,{children:e.jsx(R,{})}),e.jsx(U,{children:Se.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_employee_id",children:"Employee ID *"}),e.jsx(y,{id:"edit_employee_id",value:Ae.employee_id,onChange:e=>ke({...Ae,employee_id:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_phone",children:"Phone *"}),e.jsx(y,{id:"edit_phone",value:Ae.phone,onChange:e=>ke({...Ae,phone:e.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_hire_date",children:"Hire Date"}),e.jsx(y,{id:"edit_hire_date",type:"date",value:Ae.hire_date,onChange:e=>ke({...Ae,hire_date:e.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit_is_active",checked:Ae.is_active,onChange:e=>ke({...Ae,is_active:e.target.checked})}),e.jsx(d,{htmlFor:"edit_is_active",children:"Active User"})]}),e.jsx(o,{onClick:async()=>{if(pe)if(Ae.employee_id&&Ae.phone)try{const{error:e}=await window.ezsite.apis.tableUpdate(11725,{id:pe.id,...Ae});if(e)throw e;ye({title:"Success",description:"User profile updated successfully"}),le(!1),he(null),Ve()}catch(e){console.error("Error updating profile:",e),ye({title:"Database Error",description:`Failed to update user profile: ${e}`,variant:"destructive"})}else ye({title:"Validation Error",description:"Employee ID and Phone are required fields",variant:"destructive"})},className:"w-full",children:"Update Profile"})]})]})})]}),e.jsx(_,{value:"permissions",children:e.jsx(De,{})})]}),e.jsx(I,{isOpen:oe,onClose:()=>de(!1),onSave:async()=>{je(!0);try{const e=we.getSelectedData($e,e=>e.id),s=e.map(e=>({id:Number(e.id),...Ne.role&&{role:Ne.role},...Ne.station_access&&{station_access:Ne.station_access},is_active:Ne.is_active}));for(const t of s){const{error:e}=await window.ezsite.apis.tableUpdate(11725,t);if(e)throw e}ye({title:"Success",description:`Updated ${e.length} user profiles successfully`}),de(!1),we.clearSelection(),Ve()}catch(e){console.error("Error in batch edit:",e),ye({title:"Database Error",description:`Failed to update profiles: ${e}`,variant:"destructive"})}finally{je(!1)}},selectedCount:we.selectedCount,isLoading:ue,itemName:"user profiles",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"batch_role",children:"Role"}),e.jsxs(P,{value:Ne.role,onValueChange:e=>be({...Ne,role:e}),children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Select role to update"})}),e.jsxs(U,{children:[e.jsx(L,{value:"",children:"Keep existing roles"}),_e.map(s=>e.jsx(L,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"batch_station",children:"Station"}),e.jsxs(P,{onValueChange:e=>be({...Ne,station_access:[e]}),children:[e.jsx(D,{children:e.jsx(R,{placeholder:"Select station to update"})}),e.jsxs(U,{children:[e.jsx(L,{value:"",children:"Keep existing stations"}),Se.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{id:"batch_is_active",checked:Ne.is_active,onCheckedChange:e=>be({...Ne,is_active:e})}),e.jsx(d,{htmlFor:"batch_is_active",children:"Set all selected users as active"})]})]})}),e.jsx(z,{isOpen:xe,onClose:()=>me(!1),onConfirm:async()=>{je(!0);try{const e=we.getSelectedData($e,e=>e.id);for(const s of e){const{error:e}=await window.ezsite.apis.tableDelete(11725,{id:s.id});if(e)throw e}ye({title:"Success",description:`Deleted ${e.length} user profiles successfully`}),me(!1),we.clearSelection(),Ve()}catch(e){console.error("Error in batch delete:",e),ye({title:"Database Error",description:`Failed to delete profiles: ${e}`,variant:"destructive"})}finally{je(!1)}},selectedCount:we.selectedCount,isLoading:ue,itemName:"user profiles",selectedItems:we.getSelectedData($e,e=>e.id).map(e=>({id:e.id,name:`${e.employee_id} - ${e.role}`}))}),e.jsx(Pe,{isOpen:ge,onClose:()=>ve(!1),onUserCreated:()=>{Le(),ye({title:"Success",description:"New user account and profile created successfully in production database"})}})]}):e.jsx(Fe,{feature:"User Management",requiredRole:"Administrator"})};export{Ge as default};
