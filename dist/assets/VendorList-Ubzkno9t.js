import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{u as a,j as t,t as r,C as n,f as i,g as c,k as l,e as o,B as d,h as m,I as x}from"./index-DQt9P8ND.js";import{T as h,a as v,b as p,c as u,d as j,e as y}from"./table-CD47RM4A.js";import{u as g,V as b}from"./use-keyboard-shortcuts-CpKzVmxr.js";import{u as f}from"./routing-DcURAnU1.js";import{aa as N,W as w,Y as _,ac as C,v as D,a7 as k,y as A,Z as S,V as E}from"./utilities-BV0J3KZr.js";import{m as P}from"./animations-CdlE0-Ca.js";import"./data-management-r38r-ocq.js";const I=()=>{const[I,V]=s.useState([]),[$,F]=s.useState(!0),[z,M]=s.useState(""),[O,L]=s.useState(1),[R,T]=s.useState(0),[Y,B]=s.useState(null),[U,K]=s.useState(!1),[W,Z]=s.useState(null),q=f(),{isAdmin:G}=a(),{canCreate:H,canEdit:J,canDelete:Q,isModuleAccessEnabled:X}=t(),ee=H("vendors"),se=J("vendors")&&G(),ae=Q("vendors")&&G();s.useEffect(()=>{te()},[O,z]);const te=async()=>{try{F(!0);const e=[];z&&e.push({name:"vendor_name",op:"StringContains",value:z});const{data:s,error:a}=await window.ezsite.apis.tablePage("11729",{PageNo:O,PageSize:10,OrderByField:"vendor_name",IsAsc:!0,Filters:e});if(a)throw a;V(s?.List||[]),T(s?.VirtualCount||0)}catch(e){console.error("Error loading vendors:",e),r({title:"Error",description:"Failed to load vendors",variant:"destructive"})}finally{F(!1)}},re=e=>{Z(e),B(e.ID),K(!0)},ne=e=>{if(G())if(se)try{if(!I.find(s=>s.ID===e))return r({title:"Error",description:"Vendor not found. Please refresh the list and try again.",variant:"destructive"}),void te();q(`/vendors/${e}/edit`)}catch(s){console.error("Error navigating to edit form:",s),r({title:"Navigation Error",description:"Failed to open edit form. Please try again.",variant:"destructive"})}else r({title:"Access Denied",description:"You don't have permission to edit vendors.",variant:"destructive"});else r({title:"Access Denied",description:"Only administrators can edit vendors.",variant:"destructive"})},ie=async e=>{if(G())if(ae){if(confirm("Are you sure you want to delete this vendor?"))try{const{error:s}=await window.ezsite.apis.tableDelete("11729",{ID:e});if(s)throw s;r({title:"Success",description:"Vendor deleted successfully"}),te(),K(!1)}catch(s){console.error("Error deleting vendor:",s),r({title:"Error",description:"Failed to delete vendor",variant:"destructive"})}}else r({title:"Access Denied",description:"You don't have permission to delete vendors.",variant:"destructive"});else r({title:"Access Denied",description:"Only administrators can delete vendors.",variant:"destructive"})},ce=()=>{ee?q("/vendors/new"):r({title:"Access Denied",description:"You don't have permission to create vendors.",variant:"destructive"})};g(Y,e=>{const s=I.find(s=>s.ID===e);s&&re(s)},ne,ie,ce);const le=e=>({"Fuel Supplier":"bg-blue-500","Food & Beverages":"bg-green-500",Automotive:"bg-orange-500",Maintenance:"bg-purple-500","Office Supplies":"bg-gray-500",Technology:"bg-indigo-500"}[e]||"bg-gray-500"),oe=Math.ceil(R/10);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"w-6 h-6"}),e.jsx("span",{children:"Vendors"})]}),e.jsx(l,{children:"Manage your vendor contacts and information"})]}),ee?e.jsxs(o,{onClick:ce,className:"flex items-center space-x-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Vendor"})]}):X&&e.jsx(d,{variant:"secondary",className:"text-xs",children:"Create access disabled by admin"})]})}),e.jsxs(m,{children:[e.jsx("div",{className:"flex items-center space-x-2 mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(x,{placeholder:"Search vendors...",value:z,onChange:e=>M(e.target.value),className:"pl-10"})]})}),$?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},a))}):0===I.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No vendors found"}),ee&&e.jsx(o,{variant:"outline",className:"mt-4",onClick:ce,children:"Add Your First Vendor"})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(h,{children:[e.jsx(v,{children:e.jsxs(p,{children:[e.jsx(u,{children:"Vendor Name"}),e.jsx(u,{children:"Contact Person"}),e.jsx(u,{children:"Contact Info"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Payment Terms"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(j,{children:I.map((s,a)=>e.jsxs(P.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"border-b hover:bg-gray-50 transition-colors cursor-pointer "+(Y===s.ID?"bg-blue-50 border-blue-200":""),onClick:()=>B(s.ID),children:[e.jsx(y,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.vendor_name}),s.address&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500 mt-1",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-xs",children:s.address})]})]})}),e.jsx(y,{children:e.jsx("p",{className:"font-medium",children:s.contact_person})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-1",children:[s.email&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx(k,{className:"w-3 h-3"}),e.jsx("span",{children:s.phone})]})]})}),e.jsx(y,{children:e.jsx(d,{className:`text-white ${le(s.category)}`,children:s.category})}),e.jsx(y,{children:e.jsx("span",{className:"text-sm",children:s.payment_terms||"N/A"})}),e.jsx(y,{children:e.jsx(d,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),re(s)},className:"text-blue-600 hover:text-blue-700",children:e.jsx(A,{className:"w-4 h-4"})}),G()&&se&&e.jsx(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),ne(s.ID)},children:e.jsx(S,{className:"w-4 h-4"})}),G()&&ae&&e.jsx(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),ie(s.ID)},className:"text-red-600 hover:text-red-700",children:e.jsx(E,{className:"w-4 h-4"})})]})})]},s.ID))})]})}),(!G()||!se||!ae)&&X&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-amber-700",children:[e.jsx("strong",{children:"Access Restrictions:"}),!G()&&" Edit and Delete access restricted to administrators only.",G()&&!se&&" Edit access disabled by admin.",G()&&!ae&&" Delete access disabled by admin."]})}),oe>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",10*(O-1)+1," to ",Math.min(10*O,R)," of ",R," vendors"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>L(e=>Math.max(e-1,1)),disabled:1===O,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",O," of ",oe]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>L(e=>Math.min(e+1,oe)),disabled:O===oe,children:"Next"})]})]})]})]}),W&&e.jsx(b,{isOpen:U,onClose:()=>{K(!1),Z(null),B(null)},title:W.vendor_name,subtitle:`Contact: ${W.contact_person} â€¢ ${W.category}`,data:W,fields:(de=W,[{key:"vendor_name",label:"Vendor Name",value:de.vendor_name,type:"text",icon:N},{key:"contact_person",label:"Contact Person",value:de.contact_person,type:"text"},{key:"email",label:"Email",value:de.email,type:"email"},{key:"phone",label:"Phone",value:de.phone,type:"phone"},{key:"address",label:"Address",value:de.address,type:"text",icon:C},{key:"category",label:"Category",value:de.category,type:"badge",badgeColor:le(de.category)},{key:"payment_terms",label:"Payment Terms",value:de.payment_terms,type:"text"},{key:"is_active",label:"Status",value:de.is_active,type:"boolean"}]),onEdit:()=>{K(!1),ne(W.ID)},onDelete:()=>ie(W.ID),onExport:()=>{if(!W)return;const e=["Field,Value",`Vendor Name,${W.vendor_name}`,`Contact Person,${W.contact_person}`,`Email,${W.email}`,`Phone,${W.phone}`,`Address,${W.address}`,`Category,${W.category}`,`Payment Terms,${W.payment_terms}`,"Status,"+(W.is_active?"Active":"Inactive")].join("\n"),s=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(s),t=document.createElement("a");t.href=a,t.download=`vendor_${W.vendor_name.replace(/\s+/g,"_")}_details.csv`,t.click(),window.URL.revokeObjectURL(a),r({title:"Success",description:"Vendor details exported successfully"})},canEdit:G()&&se,canDelete:G()&&ae,canExport:!0})]});var de};export{I as default};
