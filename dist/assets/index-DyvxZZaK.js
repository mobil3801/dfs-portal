const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProductList-DO4pGK-B.js","assets/radix-ui-woSLwCdF.js","assets/react-core-CKNU0hQt.js","assets/table-CTSRIdN4.js","assets/utilities-DMEd7dY0.js","assets/use-mobile-BQxxJ7Jh.js","assets/invariantSafeHelper-CpdXj1Qs.js","assets/routing-DcURAnU1.js","assets/data-management-r38r-ocq.js","assets/animations-CdlE0-Ca.js","assets/ProductForm-DwSwQXci.js","assets/number-input-C8fwd0Bs.js","assets/textarea-DRHimfhP.js","assets/select-DxfsAJPc.js","assets/EnhancedFileUpload-DFFx6aVh.js","assets/imageCompression-DvX-F3tO.js","assets/EmployeeList-C3tzvzOP.js","assets/use-keyboard-shortcuts-BAiiJ-1l.js","assets/ProfilePicture-Cend4BjS.js","assets/phoneFormatter-M0vagYYn.js","assets/EmployeeForm-CWevh96X.js","assets/switch-B83LJYhb.js","assets/StationDropdown-CDxlHRcN.js","assets/use-station-store-DDC1HmYO.js","assets/SalesReportList-BtZt4Vne.js","assets/EnhancedSalesReportPrintDialog-CW7LgwrC.js","assets/SalesReportForm-0iLc_IaO.js","assets/progress-BuqgJQWg.js","assets/VendorList-BlYz-2py.js","assets/VendorForm-CsJqDa2x.js","assets/OrderList-CWGyjNMu.js","assets/OrderForm-CXCIcnKr.js","assets/LicenseList-fwWRxGOR.js","assets/supabaseMigrationHelper-D5P1wkFW.js","assets/LicenseForm-BX5uUhkN.js","assets/SalaryList-CM4MbZ8B.js","assets/payPeriodUtils-G1zG_LNG.js","assets/SalaryForm-B3yKhyeN.js","assets/DeliveryList-CLWIAiJv.js","assets/DeliveryForm-DrZZbEZd.js","assets/AppSettings-BfMGU4kg.js","assets/AdminPanel-BYwerESK.js","assets/AccessDenied-CMgfgpRV.js","assets/RealTimeAdminDashboard-DzLah5K3.js","assets/CreateUserDialog-B4ycYjU0.js","assets/UserManagement-D6MiXv8x.js","assets/scroll-area-B80J2Q90.js","assets/BatchDeleteDialog-B0aLDkDP.js","assets/BatchEditDialog-BmGSI7Fd.js","assets/SiteManagement-DeKiMxS-.js","assets/SystemLogs-C37Ze2Y1.js","assets/SecuritySettings-C7LMkRHO.js","assets/SMSManagement-B8aidKr8.js","assets/UserValidationTestPage-DwM5tbwY.js","assets/AuthDiagnosticPage-DPM9TfcG.js","assets/ModuleAccessPage-CYrQq25q.js","assets/NavigationDebugPage-MsbifNQT.js","assets/EnhancedNavigationDebugger-BKnFjS5D.js","assets/NavigationDiagnosticPage-8MjXaBG_.js","assets/DatabaseMonitoring-D1l3DPv1.js","assets/DatabaseDiagnosticsPage-C4qvaD9F.js","assets/AuditMonitoring-Y95ypyiL.js","assets/supabase-test-BdbDFhWj.js","assets/ProfilePictureDemo-GOcYRAuT.js","assets/OverflowTestPage-Bxb43ghQ.js","assets/OverflowTestingPage-CUKea-qG.js","assets/TestAdminPanel-CBZB5rGz.js","assets/TestAdminPanelSimple-Dpst6IY1.js"])))=>i.map(i=>d[i]);
import{j as e,V as t,R as s,A as r,C as a,T as i,D as n,P as o,a as l,b as c,c as d,S as u,d as h,e as m,f,O as p,g,h as y,i as v,k as w,l as b,m as x,n as _,o as j,p as k,q as S,r as N,I as E,s as T,t as P,u as A,L as I,v as O,w as R,x as C,y as D,z as L,B as $,E as U,F as z,G as M}from"./radix-ui-woSLwCdF.js";import{b as F,r as q,g as B,c as V,a as J}from"./react-core-CKNU0hQt.js";import{u as H,a as W,O as K,b as G,B as Y,R as X,c as Q,N as Z}from"./routing-DcURAnU1.js";import{t as ee,c as te,a as se,X as re,u as ae,T as ie,R as ne,I as oe,C as le,b as ce,d as de,e as ue,f as he,E as me,S as fe,g as pe,U as ge,h as ye,i as ve,j as we,H as be,P as xe,F as _e,k as je,l as ke,B as Se,m as Ne,n as Ee,D as Te,L as Pe,M as Ae,o as Ie,p as Oe,A as Re,q as Ce,r as De,s as Le,v as $e,w as Ue,x as ze,y as Me,z as Fe,G as qe,J as Be,K as Ve}from"./utilities-DMEd7dY0.js";import{Q as Je,a as He}from"./data-management-r38r-ocq.js";import{m as We}from"./animations-CdlE0-Ca.js";var Ke;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Ge=F;Ke=Ge.createRoot,Ge.hydrateRoot;const Ye={},Xe=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=e?.nonce||e?.getAttribute("nonce");r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in Ye)return;Ye[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};let Qe=0;const Ze=new Map,et=e=>{if(Ze.has(e))return;const t=setTimeout(()=>{Ze.delete(e),at({type:"REMOVE_TOAST",toastId:e})},1e6);Ze.set(e,t)},tt=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?et(s):e.toasts.forEach(e=>{et(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},st=[];let rt={toasts:[]};function at(e){rt=tt(rt,e),st.forEach(e=>{e(rt)})}function it({...e}){const t=(Qe=(Qe+1)%Number.MAX_SAFE_INTEGER,Qe.toString()),s=()=>at({type:"DISMISS_TOAST",toastId:t});return at({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>at({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function nt(){const[e,t]=q.useState(rt);return q.useEffect(()=>(st.push(t),()=>{const e=st.indexOf(t);e>-1&&st.splice(e,1)}),[e]),{...e,toast:it,dismiss:e=>at({type:"DISMISS_TOAST",toastId:e})}}function ot(...e){return ee(te(e))}const lt=o,ct=q.forwardRef(({className:s,...r},a)=>e.jsx(t,{ref:a,className:ot("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...r}));ct.displayName=t.displayName;const dt=se("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),ut=q.forwardRef(({className:t,variant:r,...a},i)=>e.jsx(s,{ref:i,className:ot(dt({variant:r}),t),...a}));ut.displayName=s.displayName;q.forwardRef(({className:t,...s},a)=>e.jsx(r,{ref:a,className:ot("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s})).displayName=r.displayName;const ht=q.forwardRef(({className:t,...s},r)=>e.jsx(a,{ref:r,className:ot("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(re,{className:"h-4 w-4"})}));ht.displayName=a.displayName;const mt=q.forwardRef(({className:t,...s},r)=>e.jsx(i,{ref:r,className:ot("text-sm font-semibold [&+div]:text-xs",t),...s}));mt.displayName=i.displayName;const ft=q.forwardRef(({className:t,...s},r)=>e.jsx(n,{ref:r,className:ot("text-sm opacity-90",t),...s}));function pt(){const{toasts:t}=nt();return e.jsxs(lt,{children:[t.map(function({id:t,title:s,description:r,action:a,...i}){return e.jsxs(ut,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[s&&e.jsx(mt,{children:s}),r&&e.jsx(ft,{children:r})]}),a,e.jsx(ht,{})]},t)}),e.jsx(ct,{})]})}ft.displayName=n.displayName;const gt=d;q.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(l,{children:e.jsx(c,{ref:a,sideOffset:s,className:ot("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...r})})).displayName=c.displayName;class yt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class vt extends yt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class wt extends yt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class bt extends yt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var xt;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(xt||(xt={}));var _t=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};class jt{constructor(e,{headers:t={},customFetch:s,region:r=xt.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Lt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return _t(this,void 0,void 0,function*(){try{const{headers:r,method:a,body:i}=t;let n={},{region:o}=t;o||(o=this.region);const l=new URL(`${this.url}/${e}`);let c;o&&"any"!==o&&(n["x-region"]=o,l.searchParams.set("forceFunctionRegion",o)),i&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(n["Content-Type"]="application/octet-stream",c=i):"string"==typeof i?(n["Content-Type"]="text/plain",c=i):"undefined"!=typeof FormData&&i instanceof FormData?c=i:(n["Content-Type"]="application/json",c=JSON.stringify(i)));const d=yield this.fetch(l.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},n),this.headers),r),body:c}).catch(e=>{throw new vt(e)}),u=d.headers.get("x-relay-error");if(u&&"true"===u)throw new wt(d);if(!d.ok)throw new bt(d);let h,m=(null!==(s=d.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return h="application/json"===m?yield d.json():"application/octet-stream"===m?yield d.blob():"text/event-stream"===m?d:"multipart/form-data"===m?yield d.formData():yield d.text(),{data:h,error:null,response:d}}catch(r){return{data:null,error:r,response:r instanceof bt||r instanceof wt?r.context:void 0}}})}}var kt={},St={},Nt={},Et={},Tt={},Pt={},At=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const It=At.fetch,Ot=At.fetch.bind(At),Rt=At.Headers,Ct=At.Request,Dt=At.Response,Lt=Object.freeze(Object.defineProperty({__proto__:null,Headers:Rt,Request:Ct,Response:Dt,default:Ot,fetch:It},Symbol.toStringTag,{value:"Module"})),$t=B(Lt);var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});let zt=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Ut.default=zt;var Mt=V&&V.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Pt,"__esModule",{value:!0});const Ft=Mt($t),qt=Mt(Ut);Pt.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=Ft.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,r;let a=null,i=null,n=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(i="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const r=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&c&&c.length>1&&(n=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(a={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,n=null,o=406,l="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=await e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(i=[],a=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):a={message:t}}if(a&&this.isMaybeSingle&&(null===(r=null==a?void 0:a.details)||void 0===r?void 0:r.includes("0 rows"))&&(a=null,o=200,l="OK"),a&&this.shouldThrowOnError)throw new qt.default(a)}return{error:a,data:i,count:n,status:o,statusText:l}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var Bt=V&&V.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Tt,"__esModule",{value:!0});const Vt=Bt(Pt);let Jt=class extends Vt.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:a=r}={}){const i=a?`${a}.order`:"order",n=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const a=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:a=!1,format:i="text"}={}){var n;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!==(n=this.headers.Accept)&&void 0!==n?n:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Tt.default=Jt;var Ht=V&&V.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Et,"__esModule",{value:!0});const Wt=Ht(Tt);let Kt=class extends Wt.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let a="";"plain"===r?a="pl":"phrase"===r?a="ph":"websearch"===r&&(a="w");const i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${a}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Et.default=Kt;var Gt=V&&V.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Nt,"__esModule",{value:!0});const Yt=Gt(Et);Nt.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let a=!1;const i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join("");return this.url.searchParams.set("select",i),s&&(this.headers.Prefer=`count=${s}`),new Yt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Yt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:a=!0}={}){const i=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&i.push(this.headers.Prefer),r&&i.push(`count=${r}`),a||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Yt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Yt.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new Yt.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var Xt={},Qt={};Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.version=void 0,Qt.version="0.0.0-automated",Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.DEFAULT_HEADERS=void 0;const Zt=Qt;Xt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Zt.version}`};var es=V&&V.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(St,"__esModule",{value:!0});const ts=es(Nt),ss=es(Et),rs=Xt;St.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},rs.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new ts.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:a}={}){let i;const n=new URL(`${this.url}/rpc/${e}`);let o;s||r?(i=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{n.searchParams.append(e,t)})):(i="POST",o=t);const l=Object.assign({},this.headers);return a&&(l.Prefer=`count=${a}`),new ss.default({method:i,url:n,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var as=V&&V.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(kt,"__esModule",{value:!0}),kt.PostgrestError=kt.PostgrestBuilder=kt.PostgrestTransformBuilder=kt.PostgrestFilterBuilder=kt.PostgrestQueryBuilder=kt.PostgrestClient=void 0;const is=as(St);kt.PostgrestClient=is.default;const ns=as(Nt);kt.PostgrestQueryBuilder=ns.default;const os=as(Et);kt.PostgrestFilterBuilder=os.default;const ls=as(Tt);kt.PostgrestTransformBuilder=ls.default;const cs=as(Pt);kt.PostgrestBuilder=cs.default;const ds=as(Ut);kt.PostgrestError=ds.default;var us=kt.default={PostgrestClient:is.default,PostgrestQueryBuilder:ns.default,PostgrestFilterBuilder:os.default,PostgrestTransformBuilder:ls.default,PostgrestBuilder:cs.default,PostgrestError:ds.default};const{PostgrestClient:hs,PostgrestQueryBuilder:ms,PostgrestFilterBuilder:fs,PostgrestTransformBuilder:ps,PostgrestBuilder:gs,PostgrestError:ys}=us;const vs=function(){if("undefined"!=typeof WebSocket)return WebSocket;if(void 0!==global.WebSocket)return global.WebSocket;if(void 0!==window.WebSocket)return window.WebSocket;if(void 0!==self.WebSocket)return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}();var ws,bs,xs,_s,js,ks;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(ws||(ws={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(bs||(bs={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(xs||(xs={})),function(e){e.websocket="websocket"}(_s||(_s={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(js||(js={}));class Ss{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),a=t.getUint8(2);let i=this.HEADER_LENGTH+2;const n=s.decode(e.slice(i,i+r));i+=r;const o=s.decode(e.slice(i,i+a));i+=a;return{ref:null,topic:n,event:o,payload:JSON.parse(s.decode(e.slice(i,e.byteLength)))}}}class Ns{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(ks||(ks={}));const Es=(e,t,s={})=>{var r;const a=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((s,r)=>(s[r]=Ts(r,e,t,a),s),{})},Ts=(e,t,s,r)=>{const a=t.find(t=>t.name===e),i=null==a?void 0:a.type,n=s[e];return i&&!r.includes(i)?Ps(i,n):As(n)},Ps=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return Cs(t,s)}switch(e){case ks.bool:return Is(t);case ks.float4:case ks.float8:case ks.int2:case ks.int4:case ks.int8:case ks.numeric:case ks.oid:return Os(t);case ks.json:case ks.jsonb:return Rs(t);case ks.timestamp:return Ds(t);case ks.abstime:case ks.date:case ks.daterange:case ks.int4range:case ks.int8range:case ks.money:case ks.reltime:case ks.text:case ks.time:case ks.timestamptz:case ks.timetz:case ks.tsrange:case ks.tstzrange:default:return As(t)}},As=e=>e,Is=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Os=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Rs=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Cs=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const i=e.slice(1,s);try{r=JSON.parse("["+i+"]")}catch(a){r=i?i.split(","):[]}return r.map(e=>Ps(t,e))}return e},Ds=e=>"string"==typeof e?e.replace(" ","T"):e,Ls=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class $s{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Us,zs,Ms,Fs;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(Us||(Us={}));class qs{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=qs.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=qs.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=qs.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const a=this.cloneDeep(e),i=this.transformState(t),n={},o={};return this.map(a,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{const s=a[e];if(s){const r=t.map(e=>e.presence_ref),a=s.map(e=>e.presence_ref),i=t.filter(e=>a.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);i.length>0&&(n[e]=i),l.length>0&&(o[e]=l)}else n[e]=t}),this.syncDiff(a,{joins:n,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:a,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(a,(t,r)=>{var a;const i=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(r),i.length>0){const s=e[t].map(e=>e.presence_ref),r=i.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,i,r)}),this.map(i,(t,s)=>{let a=e[t];if(!a)return;const i=s.map(e=>e.presence_ref);a=a.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=a,r(t,a,s),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(zs||(zs={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(Ms||(Ms={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Fs||(Fs={}));class Bs{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=bs.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new $s(this,xs.join,this.params,this.timeout),this.rejoinTimer=new Ns(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=bs.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=bs.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=bs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=bs.errored,this.rejoinTimer.scheduleTimeout())}),this._on(xs.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new qs(this),this.broadcastEndpointURL=Ls(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==bs.closed){const{config:{broadcast:a,presence:i,private:n}}=this.params;this._onError(t=>null==e?void 0:e(Fs.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Fs.CLOSED));const o={},l={broadcast:a,presence:i,postgres_changes:null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],private:n};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,a=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,i=[];for(let s=0;s<a;s++){const a=r[s],{filter:{event:n,schema:o,table:l,filter:c}}=a,d=t&&t[s];if(!d||d.event!==n||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=bs.errored,void(null==e||e(Fs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},a),{id:d.id}))}return this.bindings.postgres_changes=i,void(e&&e(Fs.SUBSCRIBED))}null==e||e(Fs.SUBSCRIBED)}).receive("error",t=>{this.state=bs.errored,null==e||e(Fs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Fs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,a,i;const n=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(a=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===a?void 0:a.broadcast)||void 0===i?void 0:i.ack)||s("ok"),n.receive("ok",()=>s("ok")),n.receive("error",()=>s("error")),n.receive("timeout",()=>s("timed out"))});{const{event:i,payload:n}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:n,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(a){return"AbortError"===a.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=bs.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(xs.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new $s(this,xs.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const r=new AbortController,a=setTimeout(()=>r.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(a),i}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new $s(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,a;const i=e.toLocaleLowerCase(),{close:n,error:o,leave:l,join:c}=xs;if(s&&[n,o,l,c].indexOf(i)>=0&&s!==this._joinRef())return;let d=this._onMessage(i,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===i}).map(e=>e.callback(d,s)):null===(a=this.bindings[i])||void 0===a||a.filter(e=>{var s,r,a,n,o,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,n=null===(s=e.filter)||void 0===s?void 0:s.event;return i&&(null===(r=t.ids)||void 0===r?void 0:r.includes(i))&&("*"===n||(null==n?void 0:n.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))}{const s=null===(o=null===(n=null==e?void 0:e.filter)||void 0===n?void 0:n.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:a,errors:i}=e,n={schema:t,table:s,commit_timestamp:r,eventType:a,new:{},old:{},errors:i};d=Object.assign(Object.assign({},n),this._getPayloadRecords(e))}e.callback(d,s)})}_isClosed(){return this.state===bs.closed}_isJoined(){return this.state===bs.joined}_isJoining(){return this.state===bs.joining}_isLeaving(){return this.state===bs.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),a={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Bs.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(xs.close,{},e)}_onError(e){this._on(xs.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=bs.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Es(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Es(e.columns,e.old_record)),t}}const Vs=()=>{};class Js{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Vs,this.ref=0,this.logger=Vs,this.conn=null,this.sendBuffer=[],this.serializer=new Ss,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Lt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${_s.websocket}`,this.httpEndpoint=Ls(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ns(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=vs),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(e=>e.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case ws.connecting:return js.Connecting;case ws.open:return js.Open;case ws.closing:return js.Closing;default:return js.Closed}}isConnected(){return this.connectionState()===js.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new Bs(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:a}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${a})`,r),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.11.15"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(xs.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:s,payload:r,ref:a}=e;"phoenix"===t&&"phx_reply"===s&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${a&&"("+a+")"||""}`,r),Array.from(this.channels).filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,a)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(xs.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class Hs extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ws(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Ks extends Hs{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Gs extends Hs{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ys=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};const Xs=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Lt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Qs=e=>{if(Array.isArray(e))return e.map(e=>Qs(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Qs(s)}),t};var Zs=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};const er=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tr=(e,t,s)=>Zs(void 0,void 0,void 0,function*(){const r=yield Ys(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield Xe(()=>Promise.resolve().then(()=>Lt),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{t(new Ks(er(s),e.status||500))}).catch(e=>{t(new Gs(er(e),e))}):t(new Gs(er(e),e))});function sr(e,t,s,r,a,i){return Zs(this,void 0,void 0,function*(){return new Promise((n,o)=>{e(s,((e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r&&(a.body=JSON.stringify(r)),Object.assign(Object.assign({},a),s))})(t,r,a,i)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>n(e)).catch(e=>tr(e,o,r))})})}function rr(e,t,s,r){return Zs(this,void 0,void 0,function*(){return sr(e,"GET",t,s,r)})}function ar(e,t,s,r,a){return Zs(this,void 0,void 0,function*(){return sr(e,"POST",t,r,a,s)})}function ir(e,t,s,r,a){return Zs(this,void 0,void 0,function*(){return sr(e,"DELETE",t,r,a,s)})}var nr=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};const or={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},lr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class cr{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Xs(r)}uploadOrUpdate(e,t,s,r){return nr(this,void 0,void 0,function*(){try{let a;const i=Object.assign(Object.assign({},lr),r);let n=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const o=i.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(a=new FormData,a.append("cacheControl",i.cacheControl),o&&a.append("metadata",this.encodeMetadata(o)),a.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(a=s,a.append("cacheControl",i.cacheControl),o&&a.append("metadata",this.encodeMetadata(o))):(a=s,n["cache-control"]=`max-age=${i.cacheControl}`,n["content-type"]=i.contentType,o&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(n=Object.assign(Object.assign({},n),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:a,headers:n},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{})),u=yield d.json();if(d.ok)return{data:{path:l,id:u.Id,fullPath:u.Key},error:null};return{data:null,error:u}}catch(a){if(Ws(a))return{data:null,error:a};throw a}})}upload(e,t,s){return nr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return nr(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),i=this._getFinalPath(a),n=new URL(this.url+`/object/upload/sign/${i}`);n.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:lr.upsert},r),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);const o=yield this.fetch(n.toString(),{method:"PUT",body:e,headers:i}),l=yield o.json();if(o.ok)return{data:{path:a,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(Ws(o))return{data:null,error:o};throw o}})}createSignedUploadUrl(e,t){return nr(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const a=yield ar(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(this.url+a.url),n=i.searchParams.get("token");if(!n)throw new Hs("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(s){if(Ws(s))return{data:null,error:s};throw s}})}update(e,t,s){return nr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return nr(this,void 0,void 0,function*(){try{return{data:yield ar(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(Ws(r))return{data:null,error:r};throw r}})}copy(e,t,s){return nr(this,void 0,void 0,function*(){try{return{data:{path:(yield ar(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(Ws(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return nr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),a=yield ar(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${i}`)},{data:a,error:null}}catch(r){if(Ws(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return nr(this,void 0,void 0,function*(){try{const r=yield ar(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${a}`):null})),error:null}}catch(r){if(Ws(r))return{data:null,error:r};throw r}})}download(e,t){return nr(this,void 0,void 0,function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),a=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield rr(this.fetch,`${this.url}/${s}/${t}${a}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(i){if(Ws(i))return{data:null,error:i};throw i}})}info(e){return nr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield rr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Qs(e),error:null}}catch(s){if(Ws(s))return{data:null,error:s};throw s}})}exists(e){return nr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Zs(this,void 0,void 0,function*(){return sr(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Ws(s)&&s instanceof Gs){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],a=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==a&&r.push(a);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==n&&r.push(n);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${o}`)}}}remove(e){return nr(this,void 0,void 0,function*(){try{return{data:yield ir(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Ws(t))return{data:null,error:t};throw t}})}list(e,t,s){return nr(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},or),t),{prefix:e||""});return{data:yield ar(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(Ws(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const dr={"X-Client-Info":"storage-js/2.7.1"};var ur=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};class hr{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},dr),t),this.fetch=Xs(s)}listBuckets(){return ur(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Ws(e))return{data:null,error:e};throw e}})}getBucket(e){return ur(this,void 0,void 0,function*(){try{return{data:yield rr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Ws(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ur(this,void 0,void 0,function*(){try{return{data:yield ar(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Ws(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ur(this,void 0,void 0,function*(){try{const s=yield function(e,t,s,r,a){return Zs(this,void 0,void 0,function*(){return sr(e,"PUT",t,r,a,s)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(Ws(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ur(this,void 0,void 0,function*(){try{return{data:yield ar(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Ws(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ur(this,void 0,void 0,function*(){try{return{data:yield ir(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Ws(t))return{data:null,error:t};throw t}})}}class mr extends hr{constructor(e,t={},s){super(e,t,s)}from(e){return new cr(this.url,this.headers,e,this.fetch)}}let fr="";fr="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const pr={headers:{"X-Client-Info":`supabase-js-${fr}/2.52.0`}},gr={schema:"public"},yr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},vr={};var wr=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};const br=e=>{let t;return t=e||("undefined"==typeof fetch?Ot:fetch),(...e)=>t(...e)},xr=(e,t,s)=>{const r=br(s),a="undefined"==typeof Headers?Rt:Headers;return(s,i)=>wr(void 0,void 0,void 0,function*(){var n;const o=null!==(n=yield t())&&void 0!==n?n:e;let l=new a(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},i),{headers:l}))})};var _r=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};const jr="2.71.1",kr=3e4,Sr=9e4,Nr={"X-Client-Info":`gotrue-js/${jr}`},Er="X-Supabase-Api-Version",Tr={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Pr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;let Ar=class extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}};function Ir(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Or extends Ar{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Rr extends Ar{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Cr extends Ar{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Dr extends Cr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Lr extends Cr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class $r extends Cr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ur extends Cr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zr extends Cr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Mr extends Cr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Fr(e){return Ir(e)&&"AuthRetryableFetchError"===e.name}class qr extends Cr{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Br extends Cr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Vr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Jr=" \t\n\r=".split(""),Hr=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Jr.length;t+=1)e[Jr[t].charCodeAt(0)]=-2;for(let t=0;t<Vr.length;t+=1)e[Vr[t].charCodeAt(0)]=t;return e})();function Wr(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Vr[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Vr[e]),t.queuedBits-=6}}function Kr(e,t,s){const r=Hr[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Gr(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let n=0;n<e.length;n+=1)Kr(e.charCodeAt(n),a,i);return t.join("")}function Yr(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Xr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let a=0;a<e.length;a+=1)Kr(e.charCodeAt(a),s,r);return new Uint8Array(t)}function Qr(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Yr(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Zr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Wr(e,s,r)),Wr(null,s,r),t.join("")}const ea=()=>"undefined"!=typeof window&&"undefined"!=typeof document,ta={tested:!1,writable:!1},sa=()=>{if(!ea())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(ta.tested)return ta.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ta.tested=!0,ta.writable=!0}catch(t){ta.tested=!0,ta.writable=!1}return ta.writable};const ra=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Lt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},aa=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},ia=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}},na=async(e,t)=>{await e.removeItem(t)};class oa{constructor(){this.promise=new oa.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function la(e){const t=e.split(".");if(3!==t.length)throw new Br("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Pr.test(t[s]))throw new Br("JWT not in base64url format");return{header:JSON.parse(Gr(t[0])),payload:JSON.parse(Gr(t[1])),signature:Xr(t[2]),raw:{header:t[0],payload:t[1]}}}function ca(e){return("0"+e.toString(16)).substr(-2)}async function da(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ua(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,ca).join("")}();let a=r;s&&(a+="/PASSWORD_RECOVERY"),await aa(e,`${t}-code-verifier`,a);const i=await da(r);return[i,r===i?"plain":"s256"]}oa.promiseConstructor=Promise;const ha=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const ma=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fa(e){if(!ma.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function pa(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ga(e){return JSON.parse(JSON.stringify(e))}var ya=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};const va=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),wa=[502,503,504];async function ba(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Mr(va(e),0);if(wa.includes(e.status))throw new Mr(va(e),e.status);let r,a;try{r=await e.json()}catch(n){throw new Rr(va(n),n)}const i=function(e){const t=e.headers.get(Er);if(!t)return null;if(!t.match(ha))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(n){return null}}(e);if(i&&i.getTime()>=Tr.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?a=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(a=r.error_code),a){if("weak_password"===a)throw new qr(va(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===a)throw new Dr}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new qr(va(r),e.status,r.weak_password.reasons);throw new Or(va(r),e.status||500,a)}async function xa(e,t,s,r){var a;const i=Object.assign({},null==r?void 0:r.headers);i[Er]||(i[Er]=Tr.name),(null==r?void 0:r.jwt)&&(i.Authorization=`Bearer ${r.jwt}`);const n=null!==(a=null==r?void 0:r.query)&&void 0!==a?a:{};(null==r?void 0:r.redirectTo)&&(n.redirect_to=r.redirectTo);const o=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",l=await async function(e,t,s,r,a,i){const n=((e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))})(t,r,a,i);let o;try{o=await e(s,Object.assign({},n))}catch(l){throw console.error(l),new Mr(va(l),0)}o.ok||await ba(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(l){await ba(l)}}(e,t,s+o,{headers:i,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function _a(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ja(e){const t=_a(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function ka(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Sa(e){return{data:e,error:null}}function Na(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i}=e,n=ya(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i},user:Object.assign({},n)},error:null}}function Ea(e){return e}const Ta=["global","local","others"];var Pa=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};class Aa{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=ra(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Ta[0]){if(Ta.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ta.join(", ")}`);try{return await xa(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ir(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await xa(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ka})}catch(s){if(Ir(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Pa(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await xa(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:Na,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Ir(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await xa(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ka})}catch(t){if(Ir(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,a,i,n,o;try{const l={nextPage:null,lastPage:0,total:0},c=await xa(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:Ea});if(c.error)throw c.error;const d=await c.json(),u=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Ir(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){fa(e);try{return await xa(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ka})}catch(t){if(Ir(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){fa(e);try{return await xa(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ka})}catch(s){if(Ir(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){fa(e);try{return await xa(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ka})}catch(s){if(Ir(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){fa(e.userId);try{const{data:t,error:s}=await xa(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Ir(t))return{data:null,error:t};throw t}}async _deleteFactor(e){fa(e.userId),fa(e.id);try{return{data:await xa(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ir(t))return{data:null,error:t};throw t}}}function Ia(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Oa=!!(globalThis&&sa()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Ra extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ca extends Ra{}async function Da(e,t,s){Oa&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Oa&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw Oa&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Ca(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Oa)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}Oa&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{Oa&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const La={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Nr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function $a(e,t,s){return await s()}const Ua={};class za{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=za.nextInstanceID,za.nextInstanceID+=1,this.instanceID>0&&ea()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},La),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Aa({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=ra(r.fetch),this.lock=r.lock||$a,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:ea()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Da:this.lock=$a,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:sa()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ia(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Ia(this.memoryStorage)),ea()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Ua[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Ua[this.storageKey]=Object.assign(Object.assign({},Ua[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Ua[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ua[this.storageKey]=Object.assign(Object.assign({},Ua[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${jr}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(r){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),ea()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:a}=await this._getSessionFromURL(t,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),function(e){return Ir(e)&&"AuthImplicitGrantRedirectError"===e.name}(a)){const t=null===(e=a.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return await this._removeSession(),{error:a}}const{session:i,redirectType:n}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Ir(t)?{error:t}:{error:new Rr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const a=await xa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:_a}),{data:i,error:n}=a;if(n||!i)return{data:{user:null,session:null},error:n};const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(Ir(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(e){var t,s,r;try{let a;if("email"in e){const{email:s,password:r,options:i}=e;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await ua(this.storage,this.storageKey)),a=await xa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:o},xform:_a})}else{if(!("phone"in e))throw new $r("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:n}=e;a=await xa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(s=null==n?void 0:n.data)&&void 0!==s?s:{},channel:null!==(r=null==n?void 0:n.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:_a})}}const{data:i,error:n}=a;if(n||!i)return{data:{user:null,session:null},error:n};const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(Ir(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:a}=e;t=await xa(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:ja})}else{if(!("phone"in e))throw new $r("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:a}=e;t=await xa(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:ja})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Lr}}catch(t){if(Ir(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,a;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,r,a,i,n,o,l,c,d,u,h;let m,f;if("message"in e)m=e.message,f=e.signature;else{const{chain:u,wallet:h,statement:p,options:g}=e;let y;if(ea())if("object"==typeof h)y=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=h}const v=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==g?void 0:g.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),p?{statement:p}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),f=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(r=null===(s=null==g?void 0:g.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(a=null==g?void 0:g.signInWithSolana)||void 0===a?void 0:a.notBefore)?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...(null===(i=null==g?void 0:g.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...(null===(n=null==g?void 0:g.signInWithSolana)||void 0===n?void 0:n.chainId)?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...(null===(o=null==g?void 0:g.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...(null===(l=null==g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...g.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(m),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=e}}try{const{data:t,error:s}=await xa(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Zr(f)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:_a});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Lr}}catch(p){if(Ir(p))return{data:{user:null,session:null},error:p};throw p}}async _exchangeCodeForSession(e){const t=await ia(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:a}=await xa(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:_a});if(await na(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:a}):{data:{user:null,session:null,redirectType:null},error:new Lr}}catch(a){if(Ir(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:a,nonce:i}=e,n=await xa(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:a,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:_a}),{data:o,error:l}=n;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Lr}}catch(t){if(Ir(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,a,i;try{if("email"in e){const{email:r,options:a}=e;let i=null,n=null;"pkce"===this.flowType&&([i,n]=await ua(this.storage,this.storageKey));const{error:o}=await xa(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(s=null==a?void 0:a.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:n},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:n,error:o}=await xa(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(a=null==s?void 0:s.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(i=null==s?void 0:s.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new $r("You must provide either an email or phone number.")}catch(n){if(Ir(n))return{data:{user:null,session:null},error:n};throw n}}async verifyOtp(e){var t,s;try{let r,a;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:i,error:n}=await xa(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:_a});if(n)throw n;if(!i)throw new Error("An error occurred on token verification.");const o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(Ir(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let a=null,i=null;return"pkce"===this.flowType&&([a,i]=await ua(this.storage,this.storageKey)),await xa(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:i}),headers:this.headers,xform:Sa})}catch(a){if(Ir(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Dr;const{error:r}=await xa(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(Ir(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:a}=e,{error:i}=await xa(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:s,type:r,options:a}=e,{data:i,error:n}=await xa(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:n}}throw new $r("You must provide either an email or phone number and a type")}catch(t){if(Ir(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await ia(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<Sr;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=await ia(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=pa()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await xa(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ka}):await this._useSession(async e=>{var t,s,r;const{data:a,error:i}=e;if(i)throw i;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await xa(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:ka}):{data:{user:null},error:new Dr}})}catch(t){if(Ir(t))return function(e){return Ir(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await na(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:a}=s;if(a)throw a;if(!r.session)throw new Dr;const i=r.session;let n=null,o=null;"pkce"===this.flowType&&null!=e.email&&([n,o]=await ua(this.storage,this.storageKey));const{data:l,error:c}=await xa(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:n,code_challenge_method:o}),jwt:i.access_token,xform:ka});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(s){if(Ir(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Dr;const t=Date.now()/1e3;let s=t,r=!0,a=null;const{payload:i}=la(e.access_token);if(i.exp&&(s=i.exp,r=s<=t),r){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};a=t}else{const{data:r,error:i}=await this._getUser(e.access_token);if(i)throw i;a={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(Ir(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:r,error:a}=t;if(a)throw a;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Dr;const{session:r,error:a}=await this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Ir(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ea())throw new Ur("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ur(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new zr("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Ur("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new zr("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:a,refresh_token:i,expires_in:n,expires_at:o,token_type:l}=e;if(!(a&&n&&i&&l))throw new Ur("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(n);let u=c+d;o&&(u=parseInt(o));const h=u-c;1e3*h<=kr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:f,error:p}=await this._getUser(a);if(p)throw p;const g={provider_token:s,provider_refresh_token:r,access_token:a,expires_in:d,expires_at:u,refresh_token:i,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(s){if(Ir(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ia(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:a}=t;if(a)return{error:a};const i=null===(s=r.session)||void 0===s?void 0:s.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return Ir(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await na(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:r},error:a}=t;if(a)throw a;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(a){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await ua(this.storage,this.storageKey,!0));try{return await xa(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(Ir(a))return{data:null,error:a};throw a}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ir(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async t=>{var s,r,a,i,n;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return await xa(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(n=null===(i=o.session)||void 0===i?void 0:i.access_token)&&void 0!==n?n:void 0})});if(r)throw r;return ea()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(Ir(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:a,error:i}=t;if(i)throw i;return await xa(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})})}catch(t){if(Ir(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const a=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await xa(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_a})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&Fr(t)&&Date.now()+s-a<kr},new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{const t=await s(i);if(!r(i,null,t))return void e(t)}catch(a){if(!r(i,a))return void t(a)}})()}))}catch(a){if(this._debug(t,"error",a),Ir(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),ea()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const a=await ia(this.storage,this.storageKey);if(a&&this.userStorage){let t=await ia(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:a.user},await aa(this.userStorage,this.storageKey+"-user",t)),a.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:pa()}else if(a&&!a.user&&!a.user){const e=await ia(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(a.user=e.user,await na(this.storage,this.storageKey+"-user"),await aa(this.storage,this.storageKey,a)):a.user=pa()}if(this._debug(s,"session from storage",a),!this._isValidSession(a))return this._debug(s,"session is not valid"),void(null!==a&&await this._removeSession());const i=1e3*(null!==(t=a.expires_at)&&void 0!==t?t:1/0)-Date.now()<Sr;if(this._debug(s,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:e}=await this._callRefreshToken(a.refresh_token);e&&(console.error(e),Fr(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(a.user&&!0===a.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(a.access_token);!t&&(null==e?void 0:e.user)?(a.user=e.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){return this._debug(s,"error",a),void console.error(a)}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Dr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new oa;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Dr;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(a){if(this._debug(r,"error",a),Ir(a)){const e={session:null,error:a};return Fr(a)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],a=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(a){r.push(a)}});if(await Promise.all(a),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&await aa(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=ga(e);await aa(this.storage,this.storageKey,r)}else{const e=ga(t);await aa(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await na(this.storage,this.storageKey),await na(this.storage,this.storageKey+"-code-verifier"),await na(this.storage,this.storageKey+"-user"),this.userStorage&&await na(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ea()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),kr);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/kr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Ra))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ea()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await ua(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:a}=t;return a?{data:null,error:a}:await xa(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(Ir(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:a,error:i}=t;if(i)return{data:null,error:i};const n=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await xa(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:null===(s=null==a?void 0:a.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(Ir(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:a}=t;if(a)return{data:null,error:a};const{data:i,error:n}=await xa(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return n?{data:null,error:n}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:n})})}catch(t){if(Ir(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:a}=t;return a?{data:null,error:a}:await xa(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(Ir(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),a=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:r,phone:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:a}=e;if(a)return{data:null,error:a};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=la(r.access_token);let n=null;i.aal&&(n=i.aal);let o=n;(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:n,nextLevel:o,currentAuthenticationMethods:i.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:a,error:i}=await xa(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return a.keys&&0!==a.keys.length?(this.jwks=a,this.jwks_cached_at=r,s=a.keys.find(t=>t.kid===e),s||null):null}async getClaims(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:a,signature:i,raw:{header:n,payload:o}}=la(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:a,header:r,signature:i},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,d,i,Qr(`${n}.${o}`))))throw new Br("Invalid JWT signature");return{data:{claims:a,header:r,signature:i},error:null}}catch(s){if(Ir(s))return{data:null,error:s};throw s}}}za.nextInstanceID=0;const Ma=za;class Fa extends Ma{constructor(e){super(e)}}var qa=function(e,t,s,r){return new(s||(s=Promise))(function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(n,o)}l((r=r.apply(e,t||[])).next())})};class Ba{constructor(e,t,s){var r,a,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const n=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(n);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,r;const{db:a,auth:i,realtime:n,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),a),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},d),n),global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:()=>_r(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:gr,realtime:vr,auth:Object.assign(Object.assign({},yr),{storageKey:c}),global:pr});this.storageKey=null!==(r=d.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(a=d.global.headers)&&void 0!==a?a:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=d.auth)&&void 0!==i?i:{},this.headers,d.global.fetch),this.fetch=xr(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new hs(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new jt(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new mr(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return qa(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:a,flowType:i,lock:n,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Fa({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:i,lock:n,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Js(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const Va=(e,t,s)=>new Ba(e,t,s),Ja=Va("https://nehhjsiuhthflfwkfequ.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5laGhqc2l1aHRoZmxmd2tmZXF1Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzAxMzE3NSwiZXhwIjoyMDY4NTg5MTc1fQ.7naT6l_oNH8VI5MaEKgJ19PoYw1EErv6-ftkEin12wE",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},db:{schema:"public"},global:{headers:{"X-Client-Info":"dfs-manager-portal"}}}),Ha={"08001":{title:"Connection Failed",message:"Unable to establish a connection to the database. Please check your internet connection and try again.",severity:"error",actionable:!0,actionLabel:"Retry Connection",persistent:!0,category:"network"},"08006":{title:"Connection Lost",message:"The connection to the database was lost. Your work may not be saved. Please refresh the page.",severity:"error",actionable:!0,actionLabel:"Refresh Page",persistent:!0,category:"network"},"08P01":{title:"Protocol Error",message:"A communication error occurred with the database. Please try again.",severity:"error",actionable:!0,actionLabel:"Try Again",category:"system"},28e3:{title:"Authentication Failed",message:"Invalid credentials provided. Please check your login information.",severity:"error",actionable:!0,actionLabel:"Try Again",category:"authentication"},"28P01":{title:"Password Authentication Failed",message:"The password you entered is incorrect. Please try again.",severity:"error",actionable:!0,actionLabel:"Reset Password",category:"authentication"},23505:{title:"Duplicate Entry",message:"This record already exists in the system. Please check your information and try again.",severity:"warning",actionable:!0,actionLabel:"View Existing",category:"validation"},23503:{title:"Reference Error",message:"This action cannot be completed because it references data that no longer exists. Please refresh and try again.",severity:"warning",actionable:!0,actionLabel:"Refresh Data",category:"business"},23502:{title:"Missing Required Information",message:"A required field is missing or empty. Please fill in all required information.",severity:"warning",actionable:!0,category:"validation"},"42P01":{title:"Data Source Not Available",message:"The requested information is temporarily unavailable. Our team has been notified.",severity:"error",actionable:!0,actionLabel:"Contact Support",persistent:!0,category:"system"},42703:{title:"Data Structure Issue",message:"There is a mismatch in the expected data format. Please try refreshing the page.",severity:"error",actionable:!0,actionLabel:"Refresh Page",category:"system"},"42P02":{title:"System Configuration Error",message:"A system configuration issue was detected. Please contact support if this persists.",severity:"error",actionable:!0,actionLabel:"Contact Support",category:"system"},"22P02":{title:"Invalid Data Format",message:"The data you entered is in an invalid format. Please check your input and try again.",severity:"warning",actionable:!0,category:"validation"},22003:{title:"Value Out of Range",message:"The value you entered is too large or too small. Please enter a valid value.",severity:"warning",actionable:!0,category:"validation"},22001:{title:"Text Too Long",message:"The text you entered exceeds the maximum allowed length. Please shorten your input.",severity:"warning",actionable:!0,category:"validation"},"25P02":{title:"Transaction Error",message:"An error occurred while processing your request. Please try again.",severity:"error",actionable:!0,actionLabel:"Try Again",category:"system"},"40P01":{title:"Conflict Detected",message:"Another user may have modified this data. Please refresh and try again.",severity:"warning",actionable:!0,actionLabel:"Refresh Data",category:"business"},40001:{title:"Data Conflict",message:"Multiple users are trying to modify the same data. Please wait a moment and try again.",severity:"warning",actionable:!0,actionLabel:"Try Again",category:"business"},53100:{title:"Storage Full",message:"The system storage is full. Please contact support immediately.",severity:"error",actionable:!0,actionLabel:"Contact Support",persistent:!0,category:"system"},53200:{title:"Memory Limit Exceeded",message:"The system is experiencing high load. Please try again in a few moments.",severity:"error",actionable:!0,actionLabel:"Try Again Later",category:"system"},53300:{title:"Service Busy",message:"The system is currently busy processing other requests. Please wait a moment and try again.",severity:"warning",actionable:!0,actionLabel:"Try Again",category:"system"},"57P01":{title:"System Maintenance",message:"The system is currently undergoing maintenance. Please try again later.",severity:"info",actionable:!0,actionLabel:"Check Status",persistent:!0,category:"system"},"57P02":{title:"System Restart",message:"The system has been restarted. Please refresh the page and try again.",severity:"warning",actionable:!0,actionLabel:"Refresh Page",category:"system"},"57P03":{title:"Service Unavailable",message:"The service is temporarily unavailable. Please try again in a few minutes.",severity:"warning",actionable:!0,actionLabel:"Try Again Later",persistent:!0,category:"system"}},Wa={NETWORK_ERROR:{title:"Connection Problem",message:"Unable to connect to the server. Please check your internet connection.",severity:"error",actionable:!0,actionLabel:"Try Again",persistent:!0,category:"network"},TIMEOUT_ERROR:{title:"Request Timeout",message:"The request took too long to complete. Please try again.",severity:"warning",actionable:!0,actionLabel:"Try Again",category:"network"},SERVER_ERROR:{title:"Server Error",message:"An unexpected server error occurred. Our team has been notified.",severity:"error",actionable:!0,actionLabel:"Contact Support",category:"system"},AUTH_INVALID_CREDENTIALS:{title:"Login Failed",message:"Invalid email or password. Please check your credentials and try again.",severity:"error",actionable:!0,actionLabel:"Reset Password",category:"authentication"},AUTH_SESSION_EXPIRED:{title:"Session Expired",message:"Your session has expired. Please log in again to continue.",severity:"warning",actionable:!0,actionLabel:"Log In",category:"authentication"},AUTH_INSUFFICIENT_PERMISSIONS:{title:"Access Denied",message:"You do not have permission to perform this action.",severity:"warning",actionable:!0,actionLabel:"Contact Administrator",category:"permission"},VALIDATION_REQUIRED_FIELD:{title:"Missing Information",message:"Please fill in all required fields before continuing.",severity:"warning",actionable:!0,category:"validation"},VALIDATION_INVALID_EMAIL:{title:"Invalid Email",message:"Please enter a valid email address.",severity:"warning",actionable:!0,category:"validation"},VALIDATION_INVALID_PHONE:{title:"Invalid Phone Number",message:"Please enter a valid phone number.",severity:"warning",actionable:!0,category:"validation"},UPLOAD_FILE_TOO_LARGE:{title:"File Too Large",message:"The selected file is too large. Please choose a smaller file.",severity:"warning",actionable:!0,category:"validation"},UPLOAD_INVALID_FILE_TYPE:{title:"Invalid File Type",message:"This file type is not supported. Please select a different file.",severity:"warning",actionable:!0,category:"validation"},UPLOAD_FAILED:{title:"Upload Failed",message:"The file could not be uploaded. Please try again.",severity:"error",actionable:!0,actionLabel:"Try Again",category:"system"}},Ka={TypeError:{title:"Application Error",message:"An unexpected error occurred. Please refresh the page and try again.",severity:"error",actionable:!0,actionLabel:"Refresh Page",category:"system"},ReferenceError:{title:"Application Error",message:"An unexpected error occurred. Please refresh the page and try again.",severity:"error",actionable:!0,actionLabel:"Refresh Page",category:"system"},ChunkLoadError:{title:"Loading Error",message:"Failed to load application components. Please refresh the page.",severity:"error",actionable:!0,actionLabel:"Refresh Page",persistent:!0,category:"system"}};function Ga(e,t){const s=function(e,t){if(!e)return{title:"Unknown Error",message:"An unexpected error occurred. Please try again.",severity:"error",actionable:!0,actionLabel:"Try Again",category:"system"};if(e.code&&Ha[e.code]){const s=Ha[e.code];return t?{...s,message:`${s.message} (Context: ${t})`}:s}if("string"==typeof e&&Wa[e])return Wa[e];if(e.name&&Ka[e.name])return Ka[e.name];if(e.message){if(e.message.includes("fetch")||e.message.includes("network"))return Wa.NETWORK_ERROR;if(e.message.includes("timeout"))return Wa.TIMEOUT_ERROR;if(e.message.includes("Invalid login credentials"))return Wa.AUTH_INVALID_CREDENTIALS;if(e.message.includes("JWT expired"))return Wa.AUTH_SESSION_EXPIRED}const s={title:"Unexpected Error",message:e.message||"An unexpected error occurred. Please try again.",severity:"error",actionable:!0,actionLabel:"Try Again",category:"system"};return t&&(s.message=`${s.message} (Context: ${t})`),s}(e,t);return s.message}const Ya={"42P01":"Relation (table) does not exist",42703:"Column does not exist","42P02":"Parameter does not exist",23505:"Unique violation (duplicate key)",23503:"Foreign key violation","22P02":"Invalid text representation",22003:"Numeric value out of range","08P01":"Protocol violation","08001":"Connection exception","08006":"Connection failure","25P02":"Transaction state error","40P01":"Deadlock detected",53100:"Disk full",53200:"Out of memory",53300:"Too many connections","57P01":"Admin shutdown","57P02":"Crash shutdown","57P03":"Cannot connect now","57P04":"Database dropped","57P05":"Idle session timeout"},Xa={11725:"user_profiles",11726:"products",11727:"employees",11731:"licenses",12196:"deliveries",12356:"sales_reports",12599:"stations",12611:"alert_settings",12612:"sms_contacts",12613:"alert_history",12706:"audit_logs",24061:"sms_settings",24062:"sms_history",24201:"sms_config",24202:"sms_history",25712:"module_access",26928:"file_uploads",User:"auth.users"};function Qa(e,t={}){const s=e?.code,r=e?.message||"Unknown error",a=e?.details||"",i=e?.hint||"";console.error("========== DATABASE ERROR =========="),console.error(`Error code: ${s} - ${Ya[s]||"Unknown error code"}`),console.error(`Message: ${r}`),a&&console.error(`Detail: ${a}`),i&&console.error(`Hint: ${i}`),console.error("Context:",JSON.stringify(t,null,2)),console.error("Stack trace:",e?.stack||(new Error).stack),console.error("====================================")}function Za(e,t,s={}){console.log("========== SQL QUERY =========="),console.log(`Operation: ${t.toUpperCase()} on table "${e}"`),console.log("Parameters:",JSON.stringify(s,null,2)),console.log("Timestamp:",(new Date).toISOString()),console.log("===============================")}const ei=new class{getTableName(e){const t=Xa[e];if(!t)throw console.error("Table ID mapping failed"),console.error("Requested table ID:",e),console.error("Available mappings:",Object.keys(Xa)),console.error("Mapping values:",Object.values(Xa)),new Error(`Unknown table ID: ${e}`);return t}async tablePage(e,t){const s={operation:"tablePage",tableId:e,params:t};try{const r=this.getTableName(e);if(s.tableName=r,"auth.users"===r)return{data:{List:[],VirtualCount:0},error:null};Za(r,"select",t);let a=Ja.from(r).select("*",{count:"exact"});if(t.Filters&&(a=function(e,t=[]){if(!t||0===t.length)return e;for(const s of t){const{name:t,op:r,value:a}=s;switch(r){case"Equal":e=e.eq(t,a);break;case"NotEqual":e=e.neq(t,a);break;case"GreaterThan":e=e.gt(t,a);break;case"GreaterThanOrEqual":e=e.gte(t,a);break;case"LessThan":e=e.lt(t,a);break;case"LessThanOrEqual":e=e.lte(t,a);break;case"Like":e=e.like(t,`%${a}%`);break;case"StringStartsWith":e=e.like(t,`${a}%`);break;case"StringEndsWith":e=e.like(t,`%${a}`);break;case"In":e=e.in(t,Array.isArray(a)?a:[a]);break;case"IsNull":e=e.is(t,null);break;case"IsNotNull":e=e.not(t,"is",null);break;default:console.warn(`Unknown filter operation: ${r}`)}}return e}(a,t.Filters)),t.OrderByField&&(a=a.order(t.OrderByField,{ascending:!1!==t.IsAsc})),t.PageNo&&t.PageSize){const e=(t.PageNo-1)*t.PageSize,s=e+t.PageSize-1;a=a.range(e,s)}const{data:i,error:n,count:o}=await a;if(n){Qa(n,s);return{data:null,error:Ga(n,`loading data from ${r}`)}}return{data:{List:i||[],VirtualCount:o||0},error:null}}catch(r){console.error("========== UNEXPECTED ERROR =========="),console.error("SupabaseAdapter.tablePage error:",r),console.error("Context:",JSON.stringify(s,null,2)),console.error("Stack trace:",r?.stack||(new Error).stack),console.error("======================================");return{data:null,error:Ga(r,`loading data from ${s.tableName||"table"}`)}}}async tableCreate(e,t){const s={operation:"tableCreate",tableId:e,data:{...t,sensitive_fields_removed:!0}};try{const r=this.getTableName(e);if(s.tableName=r,"auth.users"===r)return{error:"Cannot create users directly in auth.users table"};t.created_at||(t.created_at=(new Date).toISOString()),Za(r,"insert",{recordCount:1});const{error:a}=await Ja.from(r).insert(t);if(a){Qa(a,s);return{error:Ga(a,`creating record in ${r}`)}}return{error:null}}catch(r){console.error("========== UNEXPECTED ERROR =========="),console.error("SupabaseAdapter.tableCreate error:",r),console.error("Context:",JSON.stringify(s,null,2)),console.error("Stack trace:",r?.stack||(new Error).stack),console.error("======================================");return{error:Ga(r,`creating record in ${s.tableName||"table"}`)}}}async tableUpdate(e,t){const s={operation:"tableUpdate",tableId:e,data:{id:t.ID||t.id,sensitive_fields_removed:!0}};try{const r=this.getTableName(e);if(s.tableName=r,"auth.users"===r)return{error:"Cannot update users directly in auth.users table"};const a=t.ID||t.id;if(!a)return{error:"Record ID is required for update operations"};t.updated_at=(new Date).toISOString(),t.ID&&(t.id=t.ID,delete t.ID),Za(r,"update",{id:a});const{error:i}=await Ja.from(r).update(t).eq("id",a);if(i){Qa(i,s);return{error:Ga(i,`updating record in ${r}`)}}return{error:null}}catch(r){console.error("========== UNEXPECTED ERROR =========="),console.error("SupabaseAdapter.tableUpdate error:",r),console.error("Context:",JSON.stringify(s,null,2)),console.error("Stack trace:",r?.stack||(new Error).stack),console.error("======================================");return{error:Ga(r,`updating record in ${s.tableName||"table"}`)}}}async tableDelete(e,t){const s={operation:"tableDelete",tableId:e,recordId:t.ID||t.id};try{const r=this.getTableName(e);if(s.tableName=r,"auth.users"===r)return{error:"Cannot delete users directly from auth.users table"};const a=t.ID||t.id;if(!a)return{error:"Record ID is required for delete operations"};Za(r,"delete",{id:a});const{error:i}=await Ja.from(r).delete().eq("id",a);if(i){Qa(i,s);return{error:Ga(i,`deleting record from ${r}`)}}return{error:null}}catch(r){console.error("========== UNEXPECTED ERROR =========="),console.error("SupabaseAdapter.tableDelete error:",r),console.error("Context:",JSON.stringify(s,null,2)),console.error("Stack trace:",r?.stack||(new Error).stack),console.error("======================================");return{error:Ga(r,`deleting record from ${s.tableName||"table"}`)}}}async sendEmail(e){try{return console.log("Email would be sent:",e),{error:"Email service not yet implemented in Supabase migration"}}catch(t){return console.error("SupabaseAdapter.sendEmail error:",t),{error:t.message||"Unknown error occurred"}}}};class ti{static instance;tableId=12706;static getInstance(){return ti.instance||(ti.instance=new ti),ti.instance}getBrowserInfo(){return{ip_address:"Unknown",user_agent:navigator.userAgent,session_id:this.generateSessionId()}}generateSessionId(){return`sess_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}assessRiskLevel(e,t,s){return"Failed"===t&&"Login"===e?"Medium":"Blocked"===t?"High":"Suspicious"===t?"Critical":"Permission Change"===e||"Admin Action"===e?"High":"Data Modification"===e?"Medium":"Low"}async logEvent(e,t,s={}){try{const r=this.getBrowserInfo(),a=(new Date).toISOString(),i={event_type:e,event_status:t,event_timestamp:a,risk_level:this.assessRiskLevel(e,t,s.additional_data),...r,...s,additional_data:JSON.stringify(s.additional_data||{})},{error:n}=await window.ezsite.apis.tableCreate(this.tableId,i);n&&console.error("Failed to create audit log:",n)}catch(r){console.error("Audit logging error:",r)}}async logLogin(e,t,s,r){await this.logEvent("Login",t?"Success":"Failed",{username:e,user_id:s,action_performed:"authenticate",failure_reason:r,additional_data:{timestamp:(new Date).toISOString()}})}async logLogout(e,t){await this.logEvent("Logout","Success",{username:e,user_id:t,action_performed:"logout"})}async logRegistration(e,t,s){await this.logEvent("Registration",t?"Success":"Failed",{username:e,action_performed:"register",failure_reason:s})}async logPasswordReset(e,t,s){await this.logEvent("Password Reset",t?"Success":"Failed",{username:e,action_performed:"reset_password",failure_reason:s})}async logDataAccess(e,t,s,r,a){await this.logEvent("Data Access","Success",{user_id:s,username:r,resource_accessed:e,action_performed:t,station:a})}async logDataModification(e,t,s,r,a,i){await this.logEvent("Data Modification","Success",{user_id:s,username:r,resource_accessed:e,action_performed:t,station:a,additional_data:{changes:i}})}async logPermissionChange(e,t,s){await this.logEvent("Permission Change","Success",{user_id:t,resource_accessed:`user_${e}`,action_performed:"modify_permissions",additional_data:{target_user_id:e,changes:s}})}async logAdminAction(e,t,s){await this.logEvent("Admin Action","Success",{user_id:t,action_performed:e,additional_data:s})}async logSuspiciousActivity(e,t,s,r){await this.logEvent("Suspicious Activity","Suspicious",{user_id:t,username:s,action_performed:"suspicious_behavior",failure_reason:e,additional_data:r})}async getLogs(e=1,t=50,s={}){try{const r=[];s.event_type&&r.push({name:"event_type",op:"Equal",value:s.event_type}),s.user_id&&r.push({name:"user_id",op:"Equal",value:s.user_id}),s.event_status&&r.push({name:"event_status",op:"Equal",value:s.event_status}),s.risk_level&&r.push({name:"risk_level",op:"Equal",value:s.risk_level}),s.station&&r.push({name:"station",op:"Equal",value:s.station}),s.date_from&&r.push({name:"event_timestamp",op:"GreaterThanOrEqual",value:s.date_from}),s.date_to&&r.push({name:"event_timestamp",op:"LessThanOrEqual",value:s.date_to});const{data:a,error:i}=await window.ezsite.apis.tablePage(this.tableId,{PageNo:e,PageSize:t,OrderByField:"event_timestamp",IsAsc:!1,Filters:r});return{data:a,error:i}}catch(r){return{data:null,error:r instanceof Error?r.message:"Unknown error"}}}async getStatistics(e="week"){try{const t=new Date,s=new Date;switch(e){case"day":s.setDate(t.getDate()-1);break;case"week":s.setDate(t.getDate()-7);break;case"month":s.setMonth(t.getMonth()-1)}const{data:r}=await this.getLogs(1,1e3,{date_from:s.toISOString(),date_to:t.toISOString()});if(!r?.List)return{totalEvents:0,failedAttempts:0,suspiciousActivity:0,topEventTypes:[],riskDistribution:[]};const a=r.List,i=a.length,n=a.filter(e=>"Failed"===e.event_status).length,o=a.filter(e=>"Suspicious"===e.event_status||"Critical"===e.risk_level).length,l={},c={};a.forEach(e=>{l[e.event_type]=(l[e.event_type]||0)+1,c[e.risk_level]=(c[e.risk_level]||0)+1});const d=Object.entries(l).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,5),u=Object.entries(c).map(([e,t])=>({level:e,count:t}));return{totalEvents:i,failedAttempts:n,suspiciousActivity:o,topEventTypes:d,riskDistribution:u}}catch(t){return console.error("Error getting audit statistics:",t),{totalEvents:0,failedAttempts:0,suspiciousActivity:0,topEventTypes:[],riskDistribution:[]}}}}const si=ti.getInstance(),ri=q.createContext(void 0),ai={id:"00000000-0000-0000-0000-000000000000",user_id:"00000000-0000-0000-0000-000000000000",role:"Guest",station:"",employee_id:"",phone:"",hire_date:"",is_active:!1,detailed_permissions:{},profile_image_id:null},ii=({children:t})=>{const[s,r]=q.useState(null),[a,i]=q.useState(null),[n,o]=q.useState(!0),[l,c]=q.useState(null),[d,u]=q.useState(!1),[h,m]=q.useState(!1),{toast:f}=nt(),p=!!s&&!!a,g=async(e=!1)=>{try{const{data:{user:e},error:s}=await Ja.auth.getUser();if(!e||s)return r(null),i(ai),c(null),{success:!1};e.user_metadata?.role||e.app_metadata;const a={ID:e.id,Name:e.user_metadata?.name||e.email?.split("@")[0]||"Unknown User",Email:e.email||"",CreateTime:e.created_at||(new Date).toISOString()};r(a);try{const e=await ei.tablePage(11725,{PageNo:1,PageSize:1,Filters:[{name:"user_id",op:"Equal",value:a.ID}]});if(e.error)i({id:a.ID,user_id:a.ID,role:"employee",station:"MOBIL",employee_id:"",phone:"",hire_date:(new Date).toISOString(),is_active:!0,detailed_permissions:{},profile_image_id:null});else if(e.data?.List?.length>0){const t=e.data.List[0];i(t)}else i({id:a.ID,user_id:a.ID,role:"employee",station:"MOBIL",employee_id:"",phone:"",hire_date:(new Date).toISOString(),is_active:!0,detailed_permissions:{},profile_image_id:null})}catch(t){i({id:a.ID,user_id:a.ID,role:"employee",station:"MOBIL",employee_id:"",phone:"",hire_date:(new Date).toISOString(),is_active:!0,detailed_permissions:{},profile_image_id:null})}return c(null),{success:!0,userData:a}}catch(s){console.error("Error fetching user data:",s);const t=s instanceof Error?s.message:String(s);return e&&!t.includes("not authenticated")&&c(`Failed to load user data: ${t}`),r(null),i(ai),{success:!1}}};q.useEffect(()=>{(async()=>{o(!0);try{await g(!1),Ja.auth.onAuthStateChange(async(e,t)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await g(!1):"SIGNED_OUT"===e&&(r(null),i(ai),c(null))})}catch(e){console.error("Auth initialization failed:",e),c(`Initialization failed: ${e instanceof Error?e.message:String(e)}`),r(null),i(ai)}finally{o(!1),u(!0)}})()},[]);const y={user:s,userProfile:a,isAuthenticated:p,isLoading:n,authError:l,isInitialized:d,login:async(e,t)=>{if(h)return!1;try{m(!0),o(!0),c(null),await new Promise(e=>setTimeout(e,100));const{data:s,error:r}=await Ja.auth.signInWithPassword({email:e,password:t});if(r)return await si.logLogin(e,!1,void 0,r.message),c(r.message),f({title:"Login Failed",description:r.message,variant:"destructive"}),!1;await new Promise(e=>setTimeout(e,200));const a=await g(!0);if(a.success&&a.userData)return await si.logLogin(e,!0,a.userData.ID),f({title:"Login Successful",description:"Welcome back!"}),!0;throw new Error("Failed to load user information after login")}catch(s){console.error("Login error:",s);const t=s instanceof Error?s.message:"An unexpected error occurred";return c(t),await si.logLogin(e,!1,void 0,t),f({title:"Login Failed",description:t,variant:"destructive"}),!1}finally{o(!1),m(!1)}},logout:async()=>{try{s&&await si.logLogout(s.Email,s.ID),await Ja.auth.signOut(),r(null),i(ai),c(null),f({title:"Logged Out",description:"You have been successfully logged out"})}catch(e){console.error("Logout error:",e),r(null),i(ai),c(null)}},register:async(e,t,s)=>{try{o(!0),c(null);const{data:r,error:a}=await Ja.auth.signUp({email:e,password:t,options:{data:{name:s}}});return a?(await si.logRegistration(e,!1,a.message),c(a.message),f({title:"Registration Failed",description:a.message,variant:"destructive"}),!1):(await si.logRegistration(e,!0),f({title:"Registration Successful",description:"Please check your email to verify your account"}),!0)}catch(r){console.error("Registration error:",r);const t=r instanceof Error?r.message:"An unexpected error occurred";return c(t),await si.logRegistration(e,!1,t),f({title:"Registration Failed",description:t,variant:"destructive"}),!1}finally{o(!1)}},refreshUserData:async()=>{o(!0),await g(!0),o(!1)},hasPermission:(e,t)=>{if(!a)return!1;if("Guest"===a.role)return!1;if("admin"===a.role)return!0;if(a.detailed_permissions)try{let s;if(s="string"==typeof a.detailed_permissions?a.detailed_permissions.trim().startsWith("{")||a.detailed_permissions.trim().startsWith("[")?JSON.parse(a.detailed_permissions):{}:a.detailed_permissions,t&&s[t]&&s[t][e])return!0}catch(s){console.warn("Error parsing permissions, using default role-based permissions:",s)}if(["manager"].some(e=>a.role===e)){return["view","create","edit"].includes(e)}return"Employee"===a.role&&"view"===e},isAdmin:()=>"admin"===a?.role,isManager:()=>"manager"===a?.role||"admin"===a?.role,clearError:()=>{c(null)},checkRoleFromBothSources:e=>{if(!s||!a)return!1;const t=s.user_metadata?.role||s.app_metadata?.role,r=a.role,i=e=>e?.toLowerCase().trim(),n=i(e),o=i(t)===n,l=i(r)===n;return o||l},synchronizeRoles:async()=>{if(s&&a)try{const{data:{user:e}}=await Ja.auth.getUser(),t=e?.user_metadata?.role||e?.app_metadata?.role,s=a.role;if(t!==s){const{error:e}=await Ja.auth.updateUser({data:{role:s}});e&&console.error("Failed to synchronize roles:",e)}}catch(e){console.error("Role synchronization failed:",e)}}};return e.jsx(ri.Provider,{value:y,children:t})},ni=()=>{const e=q.useContext(ri);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},oi=q.createContext(void 0),li=()=>{const e=q.useContext(oi);if(!e)throw new Error("useModuleAccess must be used within a ModuleAccessProvider");return e},ci=({children:t})=>{const[s,r]=q.useState([]),[a,i]=q.useState(!1),[n,o]=q.useState(null),[l,c]=q.useState(!0),d=[{module_name:"products",display_name:"Products",create_enabled:!0,edit_enabled:!0,delete_enabled:!0},{module_name:"employees",display_name:"Employees",create_enabled:!0,edit_enabled:!0,delete_enabled:!0},{module_name:"sales",display_name:"Sales Reports",create_enabled:!0,edit_enabled:!0,delete_enabled:!0},{module_name:"vendors",display_name:"Vendors",create_enabled:!0,edit_enabled:!0,delete_enabled:!0},{module_name:"orders",display_name:"Orders",create_enabled:!0,edit_enabled:!0,delete_enabled:!0},{module_name:"licenses",display_name:"Licenses & Certificates",create_enabled:!0,edit_enabled:!0,delete_enabled:!0},{module_name:"salary",display_name:"Salary Records",create_enabled:!0,edit_enabled:!0,delete_enabled:!0},{module_name:"delivery",display_name:"Delivery Records",create_enabled:!0,edit_enabled:!0,delete_enabled:!0}],u=async()=>{try{i(!0);for(const e of d){const{error:t}=await window.ezsite.apis.tableCreate("25712",{module_name:e.module_name,display_name:e.display_name,create_enabled:e.create_enabled,edit_enabled:e.edit_enabled,delete_enabled:e.delete_enabled,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()});t&&console.warn(`Failed to create module ${e.module_name}:`,t)}await h(),ae.success("Default modules created successfully")}catch(e){const t=e instanceof Error?e.message:"Failed to create default modules";console.error("Error creating default modules:",e),ae.error(t)}finally{i(!1)}},h=async()=>{try{i(!0),o(null);const e=await window.ezsite.apis.tablePage("25712",{PageNo:1,PageSize:100,OrderByField:"id",IsAsc:!0,Filters:[]});if(e.error)throw new Error(e.error);let t=e.data.List||[];if(t=t.map(e=>{if("create_enabled"in e)return{id:e.id,module_name:e.module_name,display_name:e.display_name||e.module_name,create_enabled:e.create_enabled,edit_enabled:e.edit_enabled,delete_enabled:e.delete_enabled,created_at:e.created_at,updated_at:e.updated_at};if("permissions"in e&&e.permissions){const t="string"==typeof e.permissions?JSON.parse(e.permissions):e.permissions;return{id:e.id,module_name:e.module_name,display_name:e.display_name||e.module_name,create_enabled:t.create_enabled??!0,edit_enabled:t.edit_enabled??!0,delete_enabled:t.delete_enabled??!0,created_at:e.created_at,updated_at:e.updated_at}}return{id:e.id,module_name:e.module_name,display_name:e.display_name||e.module_name,create_enabled:!0,edit_enabled:!0,delete_enabled:!0,created_at:e.created_at,updated_at:e.updated_at}}),0===t.length)return console.log("No modules found, creating default modules..."),void(await u());r(t),c(!0)}catch(e){const t=e instanceof Error?e.message:"Failed to fetch module access";o(t),c(!1),console.error("Error fetching module access:",e),r(d.map((e,t)=>({id:t+1,...e,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()})))}finally{i(!1)}},m=async(e,t)=>{try{const s=await window.ezsite.apis.tableUpdate("25712",{ID:e,...t,updated_at:(new Date).toISOString()});if(s.error)throw new Error(s.error);r(s=>s.map(s=>s.id===e?{...s,...t,updated_at:(new Date).toISOString()}:s)),ae.success("Module access updated successfully")}catch(s){const e=s instanceof Error?s.message:"Failed to update module access";o(e),ae.error(e),console.error("Error updating module access:",s),await h()}},f=e=>{if(!l)return!0;const t=s.find(t=>t.module_name.toLowerCase()===e.toLowerCase());return t?.create_enabled??!0},p=e=>{if(!l)return!0;const t=s.find(t=>t.module_name.toLowerCase()===e.toLowerCase());return t?.edit_enabled??!0},g=e=>{if(!l)return!0;const t=s.find(t=>t.module_name.toLowerCase()===e.toLowerCase());return t?.delete_enabled??!0};q.useEffect(()=>{h()},[]);const y=q.useMemo(()=>({moduleAccess:s,loading:a,error:n,fetchModuleAccess:h,updateModuleAccess:m,createDefaultModules:u,canCreate:f,canEdit:p,canDelete:g,isModuleAccessEnabled:l}),[s,a,n,l]);return e.jsx(oi.Provider,{value:y,children:t})},di=q.createContext(void 0),ui={notifications:[],maxNotifications:5};function hi(e,t){switch(t.type){case"ADD_NOTIFICATION":{const s={...t.payload,id:mi(),timestamp:new Date,dismissed:!1},r=e.notifications.length>=e.maxNotifications?e.notifications.slice(1):e.notifications;return{...e,notifications:[...r,s]}}case"DISMISS_NOTIFICATION":return{...e,notifications:e.notifications.map(e=>e.id===t.payload?{...e,dismissed:!0}:e)};case"AUTO_DISMISS_NOTIFICATION":return{...e,notifications:e.notifications.filter(e=>e.id!==t.payload)};case"DISMISS_ALL":return{...e,notifications:e.notifications.map(e=>({...e,dismissed:!0}))};case"CLEAR_OLD_NOTIFICATIONS":{const t=(new Date).getTime()-3e5;return{...e,notifications:e.notifications.filter(e=>!e.dismissed||e.timestamp.getTime()>t)}}default:return e}}function mi(){return`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const fi={success:4e3,info:6e3,warning:8e3,error:0},pi=({children:t})=>{const[s,r]=q.useReducer(hi,ui),a=q.useRef(new Map);q.useEffect(()=>()=>{a.current.forEach(e=>clearTimeout(e)),a.current.clear()},[]),q.useEffect(()=>{const e=setInterval(()=>{r({type:"CLEAR_OLD_NOTIFICATIONS"})},6e4);return()=>clearInterval(e)},[]);const i=q.useCallback(e=>{const t=mi();r({type:"ADD_NOTIFICATION",payload:{...e,duration:e.duration??fi[e.severity]}});const s=e.duration??fi[e.severity];if(s>0&&!e.persistent){const e=setTimeout(()=>{r({type:"AUTO_DISMISS_NOTIFICATION",payload:t}),a.current.delete(t)},s);a.current.set(t,e)}return t},[]),n=q.useCallback(e=>{const t=a.current.get(e);t&&(clearTimeout(t),a.current.delete(e)),r({type:"DISMISS_NOTIFICATION",payload:e}),setTimeout(()=>{r({type:"AUTO_DISMISS_NOTIFICATION",payload:e})},300)},[]),o=q.useCallback(()=>{a.current.forEach(e=>clearTimeout(e)),a.current.clear(),r({type:"DISMISS_ALL"}),setTimeout(()=>{r({type:"CLEAR_OLD_NOTIFICATIONS"})},300)},[]),l=q.useCallback((e,t,s={})=>i({title:e,message:t,severity:"error",...s}),[i]),c=q.useCallback((e,t,s={})=>i({title:e,message:t,severity:"warning",...s}),[i]),d=q.useCallback((e,t,s={})=>i({title:e,message:t,severity:"success",...s}),[i]),u=q.useCallback((e,t,s={})=>i({title:e,message:t,severity:"info",...s}),[i]),h=q.useCallback((e,t)=>{let s,r="Database Error",a="An error occurred while accessing the database.";if(e?.code)switch(s=e.code,e.code){case"42P01":r="Table Not Found",a="The requested data table is not available. Please contact support if this persists.";break;case"42703":r="Data Structure Issue",a="There is a mismatch in the expected data structure. Please try refreshing or contact support.";break;case"23505":r="Duplicate Entry",a="This record already exists. Please check your input and try again.";break;case"23503":r="Invalid Reference",a="This action references data that no longer exists. Please refresh and try again.";break;case"08001":case"08006":r="Connection Issue",a="Unable to connect to the database. Please check your internet connection and try again.";break;case"53300":r="Service Busy",a="The database service is currently busy. Please wait a moment and try again.";break;default:e.message&&(a=`Database error: ${e.message}`)}else e?.message&&(a=e.message);return t&&(a+=` (Context: ${t})`),l(r,a,{errorCode:s,persistent:!0,actionLabel:"View Details",actionCallback:()=>{console.group("Database Error Details"),console.error("Error object:",e),console.error("Context:",t),console.groupEnd()}})},[l]),m=q.useCallback(e=>l("Connection Error",e||"Unable to connect to the server. Please check your internet connection and try again.",{persistent:!0,actionLabel:"Retry",actionCallback:()=>window.location.reload()}),[l]),f={notifications:s.notifications,addNotification:i,dismissNotification:n,dismissAll:o,showError:l,showWarning:c,showSuccess:d,showInfo:u,showDatabaseError:h,showConnectionError:m};return e.jsx(di.Provider,{value:f,children:t})},gi=()=>{const e=q.useContext(di);if(void 0===e)throw new Error("useErrorNotification must be used within an ErrorNotificationProvider");return e},yi=q.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ot("rounded-xl border bg-card text-card-foreground shadow",t),...s}));yi.displayName="Card";const vi=q.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ot("flex flex-col space-y-1.5 p-6",t),...s}));vi.displayName="CardHeader";const wi=q.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ot("font-semibold leading-none tracking-tight",t),...s}));wi.displayName="CardTitle";const bi=q.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ot("text-sm text-muted-foreground",t),...s}));bi.displayName="CardDescription";const xi=q.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ot("p-6 pt-0",t),...s}));xi.displayName="CardContent";q.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ot("flex items-center p-6 pt-0",t),...s})).displayName="CardFooter";const _i=se("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),ji=q.forwardRef(({className:t,variant:s,size:r,asChild:a=!1,...i},n)=>{const o=a?u:"button";return e.jsx(o,{className:ot(_i({variant:s,size:r,className:t})),ref:n,...i})});ji.displayName="Button";const ki=se("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Si({className:t,variant:s,...r}){return e.jsx("div",{className:ot(ki({variant:s}),t),...r})}const Ni=h,Ei=m,Ti=f;class Pi extends q.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){if(console.error("Error caught by ErrorBoundary:",e),console.error("Component stack trace:",t.componentStack),this.setState({errorInfo:t}),this.props.showErrorNotification){const t=Ga(e,`displaying ${this.props.componentName||"component"}`),s=`${this.props.componentName||"Component"} Error`;this.props.showErrorNotification(t,s)}this.props.onError&&this.props.onError(e,t)}resetErrorBoundary=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){const{hasError:t,error:s,errorInfo:r}=this.state,{children:a,fallbackComponent:i,componentName:n}=this.props;return t&&s?i?e.jsx(i,{error:s,errorInfo:r,resetError:this.resetErrorBoundary,componentName:n}):e.jsx(Ai,{error:s,errorInfo:r,resetError:this.resetErrorBoundary,componentName:n}):a}}const Ai=({error:t,errorInfo:s,resetError:r,componentName:a})=>{const[i,n]=J.useState(!1);return e.jsxs(yi,{className:"w-full max-w-2xl mx-auto my-4 border-2 border-red-200 bg-red-50",children:[e.jsxs(vi,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsx("div",{className:"p-3 rounded-full bg-white shadow-md text-red-600",children:e.jsx(ie,{size:28})})}),e.jsx(wi,{className:"text-xl font-bold text-red-600",children:"Component Error"}),a&&e.jsx(Si,{variant:"outline",className:"mt-2",children:a})]}),e.jsxs(xi,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700 text-center",children:"Something went wrong while rendering this component. This has been logged for investigation."}),e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:["Error: ",t.message]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(ji,{onClick:r,variant:"default",className:"flex items-center gap-2",children:[e.jsx(ne,{size:16}),"Try Again"]})}),e.jsxs(Ni,{open:i,onOpenChange:n,className:"mt-4",children:[e.jsx(Ei,{asChild:!0,children:e.jsx(ji,{variant:"ghost",size:"sm",className:"w-full flex items-center justify-center text-gray-600",children:i?"Hide Details":"Show Technical Details"})}),e.jsx(Ti,{className:"mt-2",children:e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 text-sm font-mono",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Error Type:"})," ",t.name]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Message:"})," ",t.message]}),t.stack&&e.jsxs("div",{children:[e.jsx("strong",{children:"Stack Trace:"}),e.jsx("pre",{className:"mt-1 text-xs text-gray-600 whitespace-pre-wrap overflow-x-auto",children:t.stack})]}),s&&s.componentStack&&e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Component Stack:"}),e.jsx("pre",{className:"mt-1 text-xs text-gray-600 whitespace-pre-wrap overflow-x-auto",children:s.componentStack})]})]})})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg text-center text-sm text-gray-600",children:[e.jsx("p",{children:"If this error persists, please contact support with the error details above."}),e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Error ID:"})," ",Date.now().toString(36)]})]})]})]})},Ii=t=>{const{showError:s}=gi();return e.jsx(Pi,{...t,showErrorNotification:s})},Oi=se("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Ri=q.forwardRef(({className:t,variant:s,...r},a)=>e.jsx("div",{ref:a,role:"alert",className:ot(Oi({variant:s}),t),...r}));Ri.displayName="Alert";const Ci=q.forwardRef(({className:t,...s},r)=>e.jsx("h5",{ref:r,className:ot("mb-1 font-medium leading-none tracking-tight",t),...s}));Ci.displayName="AlertTitle";const Di=q.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:ot("text-sm [&_p]:leading-relaxed",t),...s}));Di.displayName="AlertDescription";const Li=x,$i=_,Ui=g,zi=q.forwardRef(({className:t,...s},r)=>e.jsx(p,{ref:r,className:ot("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));zi.displayName=p.displayName;const Mi=q.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(Ui,{children:[e.jsx(zi,{}),e.jsxs(y,{ref:a,className:ot("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r,children:[s,e.jsxs(v,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Mi.displayName=y.displayName;const Fi=({className:t,...s})=>e.jsx("div",{className:ot("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});Fi.displayName="DialogHeader";const qi=({className:t,...s})=>e.jsx("div",{className:ot("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});qi.displayName="DialogFooter";const Bi=q.forwardRef(({className:t,...s},r)=>e.jsx(w,{ref:r,className:ot("text-lg font-semibold leading-none tracking-tight",t),...s}));Bi.displayName=w.displayName;const Vi=q.forwardRef(({className:t,...s},r)=>e.jsx(b,{ref:r,className:ot("text-sm text-muted-foreground",t),...s}));Vi.displayName=b.displayName;const Ji={error:ce,warning:ie,success:le,info:oe},Hi={error:{toast:"border-red-200 bg-red-50 text-red-800",icon:"text-red-600",badge:"bg-red-100 text-red-800",button:"hover:bg-red-100"},warning:{toast:"border-orange-200 bg-orange-50 text-orange-800",icon:"text-orange-600",badge:"bg-orange-100 text-orange-800",button:"hover:bg-orange-100"},success:{toast:"border-green-200 bg-green-50 text-green-800",icon:"text-green-600",badge:"bg-green-100 text-green-800",button:"hover:bg-green-100"},info:{toast:"border-blue-200 bg-blue-50 text-blue-800",icon:"text-blue-600",badge:"bg-blue-100 text-blue-800",button:"hover:bg-blue-100"}},Wi=({notification:t,onDismiss:s})=>{const[r,a]=q.useState(!1),[i,n]=q.useState(!1),o=Ji[t.severity],l=Hi[t.severity];return e.jsx("div",{className:ot("transform transition-all duration-300 ease-in-out mb-2",i?"translate-x-full opacity-0 scale-95":"translate-x-0 opacity-100 scale-100",t.dismissed?"translate-x-full opacity-0":""),children:e.jsxs(Ri,{className:ot("relative pr-12",l.toast,"shadow-md border-l-4"),children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(o,{className:ot("h-5 w-5 mt-0.5 flex-shrink-0",l.icon)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm leading-tight",children:t.title}),e.jsx(Di,{className:"mt-1 text-sm",children:t.message}),t.errorCode&&e.jsxs(Si,{variant:"outline",className:ot("mt-2 text-xs",l.badge),children:["Code: ",t.errorCode]}),(t.actionLabel||t.errorCode)&&e.jsx("div",{className:"mt-2",children:e.jsx(ji,{variant:"ghost",size:"sm",onClick:()=>{a(!r)},className:ot("h-6 px-2 text-xs",l.button),children:r?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"More"]})})}),r&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),t.timestamp.toLocaleTimeString()]}),t.actionCallback&&t.actionLabel&&e.jsxs(ji,{variant:"outline",size:"sm",onClick:t.actionCallback,className:"h-7 text-xs",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),t.actionLabel]})]})]})})})]}),e.jsxs(ji,{variant:"ghost",size:"sm",onClick:()=>{n(!0),setTimeout(()=>s(t.id),150)},className:"absolute top-2 right-2 h-6 w-6 p-0 hover:bg-black/10 rounded-full",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Dismiss"})]})]})})},Ki=({notification:t,isOpen:s,onDismiss:r})=>{const a=Ji[t.severity],i=Hi[t.severity],n=()=>{r(t.id)};return e.jsx(Li,{open:s,onOpenChange:()=>n(),children:e.jsxs(Mi,{className:"sm:max-w-lg",children:[e.jsx(Fi,{children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:ot("p-2 rounded-full",i.toast),children:e.jsx(a,{className:ot("h-6 w-6",i.icon)})}),e.jsxs("div",{children:[e.jsx(Bi,{className:"text-lg font-semibold",children:t.title}),t.errorCode&&e.jsxs(Si,{variant:"outline",className:ot("mt-1",i.badge),children:["Error Code: ",t.errorCode]})]})]})}),e.jsx(Vi,{className:"text-base leading-relaxed",children:t.message}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 text-sm text-gray-600",children:e.jsx("div",{className:"flex items-center space-x-4 text-xs",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),t.timestamp.toLocaleString()]})})}),e.jsxs(qi,{className:"flex space-x-2",children:[t.actionCallback&&t.actionLabel&&e.jsxs(ji,{variant:"outline",onClick:()=>{t.actionCallback?.(),n()},children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),t.actionLabel]}),e.jsx(ji,{onClick:n,children:"Dismiss"})]})]})})},Gi=({position:t="top-right",maxToasts:s=5,showModalForCritical:r=!0})=>{const{notifications:a,dismissNotification:i,dismissAll:n}=gi(),o=a.filter(e=>!e.dismissed),l=r?o.filter(e=>"error"===e.severity&&e.persistent):[],c=o.filter(e=>!r||"error"!==e.severity||!e.persistent).slice(-s);return 0===o.length?null:e.jsxs(e.Fragment,{children:[c.length>0&&e.jsxs("div",{className:ot({"top-right":"fixed top-4 right-4 z-50","top-left":"fixed top-4 left-4 z-50","bottom-right":"fixed bottom-4 right-4 z-50","bottom-left":"fixed bottom-4 left-4 z-50","top-center":"fixed top-4 left-1/2 transform -translate-x-1/2 z-50"}[t],"w-80 max-w-sm"),children:[c.length>1&&e.jsx("div",{className:"mb-2 flex justify-end",children:e.jsxs(ji,{variant:"ghost",size:"sm",onClick:n,className:"text-xs h-6 px-2 bg-black/5 hover:bg-black/10",children:["Dismiss All (",c.length,")"]})}),e.jsx("div",{className:"space-y-2",children:c.map(t=>e.jsx(Wi,{notification:t,onDismiss:i},t.id))})]}),l.map(t=>e.jsx(Ki,{notification:t,isOpen:!0,onDismiss:i},t.id))]})},Yi=()=>{const{user:e,userProfile:t,isAuthenticated:s,isLoading:r,authError:a}=ni(),[i,n]=q.useState({isAdmin:!1,isManager:!1,isEmployee:!1,isGuest:!0,hasAccess:!1,role:"Guest",station:"",loading:!0,error:null});return q.useEffect(()=>{if(r)return void n(e=>({...e,loading:!0}));if(a)return void n(e=>({...e,loading:!1,error:a,hasAccess:!1}));if(!s||!e||!t)return void n({isAdmin:!1,isManager:!1,isEmployee:!1,isGuest:!0,hasAccess:!1,role:"Guest",station:"",loading:!1,error:null});const i="admin"===t.role,o="manager"===t.role||i,l="employee"===t.role;n({isAdmin:i,isManager:o,isEmployee:l,isGuest:!1,hasAccess:i||o,role:t.role,station:t.station||"",loading:!1,error:null})},[e,t,s,r,a]),i},Xi=()=>{const t=ni(),s=Yi(),[r,a]=q.useState(!1),[i,n]=q.useState(null);if(!t.isAuthenticated||!t.user||!s.isAdmin)return null;const o=t=>t?e.jsx(le,{className:"h-4 w-4 text-green-600"}):e.jsx(ie,{className:"h-4 w-4 text-red-600"}),l=(t,s,r)=>e.jsx(Si,{variant:t?"default":"destructive",className:"ml-2",children:t?s:r});return r?e.jsx("div",{className:"fixed bottom-4 right-4 z-50 w-96",children:e.jsxs(yi,{className:"p-4 shadow-lg bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Auth Debugger"]}),e.jsx(ji,{onClick:()=>a(!1),variant:"ghost",size:"sm",children:"×"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Authenticated"}),e.jsxs("div",{className:"flex items-center",children:[o(t.isAuthenticated),l(t.isAuthenticated,"Yes","No")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Loading"}),e.jsxs("div",{className:"flex items-center",children:[o(!t.isLoading),l(!t.isLoading,"Ready","Loading")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Initialized"}),e.jsxs("div",{className:"flex items-center",children:[o(t.isInitialized),l(t.isInitialized,"Yes","No")]})]}),t.user&&e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm font-medium",children:"User Details"})]}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",t.user.Name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",t.user.Email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ID:"})," ",t.user.ID]})]})]}),t.userProfile&&e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Role:"})," ",t.userProfile.role]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Station:"})," ",t.userProfile.station||"Not assigned"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("strong",{children:"Admin Access:"}),l(s.isAdmin,"Yes","No")]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("strong",{children:"Manager Access:"}),l(s.isManager,"Yes","No")]})]})}),t.authError&&e.jsxs(Ri,{variant:"destructive",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(Di,{className:"text-xs",children:t.authError})]}),i&&e.jsx(Ri,{children:e.jsx(Di,{className:"text-xs",children:i})}),e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsx(ji,{onClick:async()=>{try{n("Testing authentication...");const e=await window.ezsite.apis.getUserInfo();if(console.log("Auth Test - getUserInfo:",e),e.error)return void n(`❌ Auth Test Failed: ${e.error}`);if(!e.data)return void n("⚠️ Auth Test: No user data (not authenticated)");const t=await window.ezsite.apis.tablePage(11725,{PageNo:1,PageSize:1,Filters:[{name:"user_id",op:"Equal",value:e.data.ID}]});console.log("Auth Test - Profile:",t),n("✅ Auth Test: All systems functional")}catch(e){console.error("Auth test error:",e),n(`❌ Auth Test Error: ${e instanceof Error?e.message:String(e)}`)}},variant:"outline",size:"sm",className:"w-full text-xs",children:"Run Auth Test"}),e.jsx(ji,{onClick:t.refreshUserData,variant:"outline",size:"sm",className:"w-full text-xs",children:"Refresh User Data"}),t.authError&&e.jsx(ji,{onClick:t.clearError,variant:"outline",size:"sm",className:"w-full text-xs",children:"Clear Error"})]})]})]})}):e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs(ji,{onClick:()=>a(!0),variant:"outline",size:"sm",className:"bg-white shadow-lg",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Auth Debug"]})})},Qi=R,Zi=C;q.forwardRef(({className:t,inset:s,children:r,...a},i)=>e.jsxs(j,{ref:i,className:ot("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...a,children:[r,e.jsx(ye,{className:"ml-auto"})]})).displayName=j.displayName;q.forwardRef(({className:t,...s},r)=>e.jsx(k,{ref:r,className:ot("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s})).displayName=k.displayName;const en=q.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(S,{children:e.jsx(N,{ref:a,sideOffset:s,className:ot("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...r})}));en.displayName=N.displayName;const tn=q.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(E,{ref:a,className:ot("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...r}));tn.displayName=E.displayName;q.forwardRef(({className:t,children:s,checked:r,...a},i)=>e.jsxs(T,{ref:i,className:ot("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(P,{children:e.jsx(ve,{className:"h-4 w-4"})})}),s]})).displayName=T.displayName;q.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(A,{ref:a,className:ot("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(P,{children:e.jsx(we,{className:"h-2 w-2 fill-current"})})}),s]})).displayName=A.displayName;const sn=q.forwardRef(({className:t,inset:s,...r},a)=>e.jsx(I,{ref:a,className:ot("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...r}));sn.displayName=I.displayName;const rn=q.forwardRef(({className:t,...s},r)=>e.jsx(O,{ref:r,className:ot("-mx-1 my-1 h-px bg-muted",t),...s}));rn.displayName=O.displayName;const an=({item:t,mobile:s=!1,dropdown:r=!1,navigate:a,setMobileMenuOpen:i,isActiveRoute:n,canAccessRoute:o})=>{if(!o(t.requiredRole))return null;const l=t.icon,c=n(t.href);let d,u;d=s?"flex items-center space-x-3 px-4 py-3 text-left w-full transition-colors text-sm font-medium rounded-md mx-2":r?"flex items-center space-x-2 text-sm font-medium text-gray-700 hover:text-gray-900 w-full":"flex items-center space-x-2 px-3 py-2 rounded-md transition-all duration-200 whitespace-nowrap text-sm font-medium hover:scale-105 min-w-fit max-w-fit flex-shrink-0",u=c?"bg-blue-600 text-white shadow-md":s?"text-gray-700 hover:bg-gray-100 hover:text-gray-900":r?"text-gray-700 hover:text-gray-900":"text-gray-700 hover:bg-gray-100 hover:text-gray-900 hover:shadow-sm";const h=()=>{a(t.href),s&&i(!1)};return r?e.jsxs(tn,{onClick:h,className:d,children:[e.jsx(l,{className:"mr-2 h-4 w-4"}),t.name]}):e.jsxs("button",{onClick:h,className:`${d} ${u}`,"data-testid":`nav-${t.name.toLowerCase()}`,children:[e.jsx(l,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"ml-2",children:t.name})]})},nn=({accessibleSecondaryItems:t,navigate:s,setMobileMenuOpen:r,isActiveRoute:a,canAccessRoute:i})=>0===t.length?null:e.jsxs(Qi,{children:[e.jsx(Zi,{asChild:!0,children:e.jsxs(ji,{variant:"ghost",className:"flex items-center space-x-2 px-3 py-2 rounded-md transition-all duration-200 whitespace-nowrap text-sm font-medium hover:scale-105 min-w-fit max-w-fit flex-shrink-0 text-gray-700 hover:bg-gray-100 hover:text-gray-900 hover:shadow-sm",children:[e.jsx(Ie,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"ml-2",children:"More Menu"}),e.jsx(ue,{className:"h-3 w-3 flex-shrink-0"})]})}),e.jsxs(en,{align:"center",className:"w-56",children:[e.jsx(sn,{children:"More Options"}),e.jsx(rn,{}),t.map(t=>e.jsx(an,{item:t,dropdown:!0,navigate:s,setMobileMenuOpen:r,isActiveRoute:a,canAccessRoute:i},t.href))]})]}),on=()=>{const{user:t,userProfile:s,logout:r,isAdmin:a,isManager:i,isAuthenticated:n,isLoading:o,isInitialized:l}=ni(),c=H(),d=W(),[u,h]=q.useState(!1),[m,f]=q.useState(!1);q.useEffect(()=>{if(m){let e="None";t&&(e=a()?"Admin":i()?"Manager":"Employee"),console.log("TopNavigation Debug:",{isAuthenticated:n,isLoading:o,isInitialized:l,user:t?.Name,userRole:e})}},[n,o,l,t,a,i,m]),q.useEffect(()=>{h(!1)},[d.pathname]),q.useEffect(()=>{const e=()=>{window.innerWidth>=1024&&h(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const p=[{name:"Dashboard",href:"/dashboard",icon:be,requiredRole:null},{name:"Products",href:"/products",icon:xe,requiredRole:null},{name:"Sales",href:"/sales",icon:_e,requiredRole:null},{name:"Delivery",href:"/delivery",icon:je,requiredRole:null},{name:"Employee",href:"/employees",icon:ke,requiredRole:null}],g=[{name:"Vendor",href:"/vendors",icon:Se,requiredRole:null},{name:"Order",href:"/orders",icon:Ne,requiredRole:null},{name:"Licenses",href:"/licenses",icon:Ee,requiredRole:null},{name:"Salary",href:"/salary",icon:Te,requiredRole:null},{name:"Settings",href:"/settings",icon:fe,requiredRole:null}];n&&a()&&g.push({name:"Admin",href:"/admin",icon:pe,requiredRole:"admin"});const y=async()=>{try{await r(),c("/login")}catch(e){console.error("Logout failed:",e)}},v=e=>d.pathname.startsWith(e),w=e=>!e||!!n&&("admin"===e.toLowerCase()?a():"manager"!==e.toLowerCase()||i()),b=p.filter(e=>w(e.requiredRole)),x=g.filter(e=>w(e.requiredRole));return!l||o?e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-50 w-full shadow-sm",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:"https://cdn.ezsite.ai/AutoDev/19016/c533e5f9-97eb-43d2-8be6-bcdff5709bba.png",alt:"DFS Manager Portal",className:"h-10 w-auto"}),e.jsx("span",{className:"text-xl font-bold text-gray-900 hidden sm:block",children:"DFS Manager Portal"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-16 h-8 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"w-16 h-8 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"w-16 h-8 bg-gray-200 rounded animate-pulse"})]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full animate-pulse"})]})]})})}):n?e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-50 w-full shadow-sm",children:[e.jsx("div",{className:"w-full max-w-full px-4 sm:px-6 lg:px-8 overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between h-16 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-shrink-0 min-w-0",children:[e.jsx("img",{src:"https://cdn.ezsite.ai/AutoDev/19016/c533e5f9-97eb-43d2-8be6-bcdff5709bba.png",alt:"DFS Manager Portal",className:"h-10 w-auto flex-shrink-0"}),e.jsx("span",{className:"text-xl font-bold text-gray-900 hidden sm:block truncate",children:"DFS Manager Portal"})]}),e.jsx("nav",{className:"hidden lg:flex items-center flex-1 justify-center min-w-0 mx-4",children:e.jsxs("div",{className:"flex items-center space-x-2 overflow-x-auto scrollbar-hide max-w-full",children:[b.map(t=>e.jsx(an,{item:t,navigate:c,setMobileMenuOpen:h,isActiveRoute:v,canAccessRoute:w},t.href)),e.jsx(nn,{accessibleSecondaryItems:x,navigate:c,setMobileMenuOpen:h,isActiveRoute:v,canAccessRoute:w})]})}),e.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0 min-w-0",children:[!1,e.jsxs(Qi,{children:[e.jsx(Zi,{asChild:!0,children:e.jsxs(ji,{variant:"ghost",className:"flex items-center space-x-2 px-2 py-1.5 h-auto min-w-0 max-w-fit",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-medium text-blue-700",children:t?.Name?.charAt(0)?.toUpperCase()||"U"})}),e.jsxs("div",{className:"hidden xl:block text-left min-w-0 max-w-32",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 leading-none truncate",children:t?.Name||"User"}),e.jsx("p",{className:"text-xs text-gray-500 leading-none mt-0.5 truncate",children:t?.Email})]}),e.jsx(ue,{className:"h-3 w-3 text-gray-500 flex-shrink-0"})]})}),e.jsxs(en,{align:"end",className:"w-56",children:[e.jsx(sn,{children:"My Account"}),e.jsx(rn,{}),e.jsxs(tn,{onClick:()=>c("/settings"),children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Settings"]}),e.jsx(rn,{}),e.jsxs(tn,{onClick:y,children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]}),e.jsxs(ji,{variant:"ghost",size:"sm",className:"lg:hidden p-2",onClick:()=>h(!0),children:[e.jsx(Ae,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Open navigation menu"})]})]})]})}),m&&e.jsx("div",{className:"bg-yellow-50 border-b border-yellow-200 px-4 py-2",children:e.jsxs("div",{className:"text-xs text-yellow-800",children:[e.jsx("strong",{children:"Debug:"})," Auth: ",n?"Yes":"No"," | Primary: ",b.length," | Secondary: ",x.length," | Role: ",a()?"Admin":i()?"Manager":"Employee"," | User: ",t?.Name||"None"]})})]}),u&&e.jsxs("div",{className:"lg:hidden fixed inset-0 z-50",children:[e.jsx("button",{type:"button",className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity duration-300 border-none cursor-default",onClick:()=>h(!1),onKeyDown:e=>{"Escape"===e.key&&h(!1)},"aria-label":"Close navigation menu"}),e.jsx("div",{className:"fixed top-0 right-0 w-80 max-w-[90vw] h-full bg-white shadow-xl transform transition-transform duration-300 ease-in-out overflow-hidden "+(u?"translate-x-0":"translate-x-full"),children:e.jsxs("div",{className:"flex flex-col h-full max-h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[e.jsx("img",{src:"https://cdn.ezsite.ai/AutoDev/19016/c533e5f9-97eb-43d2-8be6-bcdff5709bba.png",alt:"DFS Manager Portal",className:"h-8 w-auto flex-shrink-0"}),e.jsx("span",{className:"text-lg font-bold text-gray-900 truncate",children:"DFS Manager Portal"})]}),e.jsxs(ji,{variant:"ghost",size:"sm",onClick:()=>h(!1),className:"flex-shrink-0",children:[e.jsx(re,{className:"h-6 w-6"}),e.jsx("span",{className:"sr-only",children:"Close menu"})]})]}),e.jsx("div",{className:"flex-1 py-4 overflow-y-auto min-h-0",children:e.jsxs("div",{className:"space-y-2 px-2",children:[b.map(t=>e.jsx(an,{item:t,mobile:!0,navigate:c,setMobileMenuOpen:h,isActiveRoute:v,canAccessRoute:w},t.href)),x.length>0&&e.jsx("div",{className:"border-t border-gray-200 my-4 mx-2"}),x.map(t=>e.jsx(an,{item:t,mobile:!0,navigate:c,setMobileMenuOpen:h,isActiveRoute:v,canAccessRoute:w},t.href))]})}),e.jsxs("div",{className:"border-t p-4 bg-gray-50 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-medium text-blue-700",children:t?.Name?.charAt(0)?.toUpperCase()||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t?.Name||"User"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t?.Email})]})]}),e.jsxs(ji,{variant:"outline",size:"sm",onClick:y,className:"w-full justify-start",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]})})]})]}):null},ln=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(on,{}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsx(Ii,{componentName:"Dashboard Layout",children:e.jsx(K,{})})})})]}),cn=U,dn=q.forwardRef(({className:t,...s},r)=>e.jsx(D,{ref:r,className:ot("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...s}));dn.displayName=D.displayName;const un=q.forwardRef(({className:t,...s},r)=>e.jsx(L,{ref:r,className:ot("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...s}));un.displayName=L.displayName;const hn=q.forwardRef(({className:t,...s},r)=>e.jsx($,{ref:r,className:ot("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));hn.displayName=$.displayName;const mn=()=>{const{user:t,userProfile:s,isAdmin:r,isManager:a}=ni(),i=H(),{toast:n}=nt(),[o,l]=q.useState({totalEmployees:0,activeProducts:0,todayReports:0,pendingDeliveries:0,expiringLicenses:0,totalSales:0}),[c,d]=q.useState(!0),u=async()=>{try{d(!0);const e=await window.ezsite.apis.tablePage(11727,{PageNo:1,PageSize:1,Filters:[{name:"is_active",op:"Equal",value:!0}]}),t=await window.ezsite.apis.tablePage(11726,{PageNo:1,PageSize:1}),s=(new Date).toISOString().split("T")[0],r=await window.ezsite.apis.tablePage(12356,{PageNo:1,PageSize:10,Filters:[{name:"report_date",op:"StringStartsWith",value:s}]}),a=await window.ezsite.apis.tablePage(12196,{PageNo:1,PageSize:1}),i=new Date;i.setDate(i.getDate()+30);const n=await window.ezsite.apis.tablePage(11731,{PageNo:1,PageSize:1,Filters:[{name:"expiry_date",op:"LessThanOrEqual",value:i.toISOString()},{name:"status",op:"Equal",value:"Active"}]});let o=0;r.data?.List&&(o=r.data.List.reduce((e,t)=>e+(t.total_sales||0),0)),l({totalEmployees:e.data?.VirtualCount||0,activeProducts:t.data?.VirtualCount||0,todayReports:r.data?.VirtualCount||0,pendingDeliveries:a.data?.VirtualCount||0,expiringLicenses:n.data?.VirtualCount||0,totalSales:o})}catch(e){console.error("Error fetching dashboard data:",e),n({title:"Error",description:"Failed to load dashboard data",variant:"destructive"})}finally{d(!1)}};q.useEffect(()=>{u();const e=setInterval(u,3e5);return()=>clearInterval(e)},[]);const h=({title:t,value:s,icon:r,color:a,onClick:i})=>e.jsx(yi,{className:"p-6 cursor-pointer hover:shadow-lg transition-shadow "+(i?"hover:bg-gray-50":""),onClick:i,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:t}),e.jsx("p",{className:"text-2xl font-bold",children:c?"...":s})]}),e.jsx(r,{className:`h-8 w-8 ${a}`})]})}),m=({title:t,description:s,icon:r,onClick:a,color:i="text-blue-600"})=>e.jsx(yi,{className:"p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:a,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(r,{className:`h-6 w-6 ${i} mt-1`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t}),e.jsx("p",{className:"text-sm text-gray-600",children:s})]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",t?.Name||"User","!"]}),e.jsxs("p",{className:"opacity-90",children:[s?.station||"All Stations"," • ",s?.role||"User"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsx(h,{title:"Employees",value:o.totalEmployees,icon:ke,color:"text-blue-600",onClick:()=>i("/employees")}),e.jsx(h,{title:"Products",value:o.activeProducts,icon:xe,color:"text-green-600",onClick:()=>i("/products")}),e.jsx(h,{title:"Today's Reports",value:o.todayReports,icon:_e,color:"text-purple-600",onClick:()=>i("/sales")}),e.jsx(h,{title:"Deliveries",value:o.pendingDeliveries,icon:je,color:"text-orange-600",onClick:()=>i("/delivery")}),e.jsx(h,{title:"Expiring Licenses",value:o.expiringLicenses,icon:ie,color:"text-red-600",onClick:()=>i("/licenses")}),e.jsx(h,{title:"Today's Sales",value:`$${o.totalSales.toLocaleString()}`,icon:Oe,color:"text-emerald-600"})]}),e.jsxs(cn,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(dn,{className:"grid w-full lg:w-[400px] grid-cols-2",children:[e.jsx(un,{value:"overview",children:"Overview"}),e.jsx(un,{value:"quick-actions",children:"Quick Actions"})]}),e.jsxs(hn,{value:"overview",className:"space-y-4",children:[o.expiringLicenses>0&&e.jsx(yi,{className:"p-4 border-orange-200 bg-orange-50",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-orange-800",children:"License Expiry Alert"}),e.jsxs("p",{className:"text-sm text-orange-700",children:[o.expiringLicenses," license(s) expiring within 30 days"]})]}),e.jsx(ji,{variant:"outline",size:"sm",className:"ml-auto",onClick:()=>i("/licenses"),children:"View Licenses"})]})}),e.jsxs(yi,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Re,{className:"h-5 w-5"}),e.jsx("h3",{className:"text-lg font-semibold",children:"System Status"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Database Connection"}),e.jsx(Si,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Last Data Sync"}),e.jsx("span",{className:"text-sm text-gray-500",children:(new Date).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"User Session"}),e.jsx(Si,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Active"})]})]})]})]}),e.jsx(hn,{value:"quick-actions",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(m,{title:"New Sales Report",description:"Create a daily sales report",icon:_e,onClick:()=>i("/sales/new")}),e.jsx(m,{title:"Record Delivery",description:"Log a new fuel delivery",icon:je,onClick:()=>i("/delivery/new")}),e.jsx(m,{title:"Add Product",description:"Register a new product",icon:xe,onClick:()=>i("/products/new")}),a()&&e.jsxs(e.Fragment,{children:[e.jsx(m,{title:"Manage Employees",description:"View and edit employee records",icon:ke,onClick:()=>i("/employees")}),e.jsx(m,{title:"Check Licenses",description:"Review license status and renewals",icon:Ee,onClick:()=>i("/licenses")})]}),r()&&e.jsx(m,{title:"Admin Panel",description:"System administration and settings",icon:Ce,onClick:()=>i("/admin"),color:"text-red-600"})]})})]})]})},fn=q.forwardRef(({className:t,type:s,...r},a)=>e.jsx("input",{type:s,className:ot("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r}));fn.displayName="Input";const pn=se("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),gn=q.forwardRef(({className:t,...s},r)=>e.jsx(z,{ref:r,className:ot(pn(),t),...s}));gn.displayName=z.displayName;const yn=q.forwardRef(({className:t,orientation:s="horizontal",decorative:r=!0,...a},i)=>e.jsx(M,{ref:i,decorative:r,orientation:s,className:ot("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",t),...a}));yn.displayName=M.displayName;const vn=({className:t="",size:s="md",showText:r=!1})=>{const a={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-20 h-20"},i={sm:"text-sm",md:"text-lg",lg:"text-xl",xl:"text-2xl"};return e.jsxs("div",{className:`flex items-center gap-3 ${t}`,children:[e.jsxs("div",{className:`${a[s]} flex-shrink-0`,children:[e.jsx("img",{src:"https://cdn.ezsite.ai/AutoDev/19016/c533e5f9-97eb-43d2-8be6-bcdff5709bba.png",alt:"DFS Manager Logo",className:"w-full h-full object-contain rounded-lg shadow-sm",onError:e=>{const t=e.target;t.style.display="none",t.nextElementSibling?.classList.remove("hidden")}}),e.jsx("div",{className:`hidden ${a[s]} bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center text-white font-bold ${i[s]}`,children:"DFS"})]}),r&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`font-bold text-gray-800 ${i[s]}`,children:"DFS Manager"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Gas Station Management"})]})]})},wn=()=>{const[t,s]=q.useState(""),[r,a]=q.useState(""),[i,n]=q.useState(""),[o,l]=q.useState("login"),[c,d]=q.useState(!1),[u,h]=q.useState(!1),[m,f]=q.useState(!1),[p,g]=q.useState(""),[y,v]=q.useState("error"),[w,b]=q.useState(0),{login:x,register:_,clearError:j,authError:k}=ni(),S=H(),{toast:N}=nt();q.useEffect(()=>{j(),g("")},[o,j]),q.useEffect(()=>{k&&(g(k),v("error"))},[k]);const E=()=>{s(""),a(""),n(""),g(""),j()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center p-4 min-h-screen",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 transform hover:scale-105 transition-transform duration-200",children:e.jsx(vn,{className:"mb-4"})}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-800 to-indigo-800 bg-clip-text text-transparent mb-2",children:"DFS Manager Portal"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Gas Station Management System"})]})}),e.jsxs(yi,{className:"shadow-2xl border-0 backdrop-blur-sm bg-white/95",children:[e.jsxs(vi,{className:"space-y-1 pb-6",children:[e.jsx(wi,{className:"text-2xl font-bold text-center text-slate-800",children:(()=>{switch(o){case"login":return"Welcome Back";case"register":return"Create Account";case"forgot-password":return"Reset Password";default:return"Sign In"}})()}),e.jsx(bi,{className:"text-center text-slate-600",children:(()=>{switch(o){case"login":return"Enter your credentials to access the portal";case"register":return"Create a new account to get started";case"forgot-password":return"Enter your email to receive a password reset link";default:return""}})()})]}),e.jsxs(xi,{children:[p&&e.jsxs(Ri,{className:"mb-4 "+("success"===y?"border-green-200 bg-green-50":"border-red-200 bg-red-50"),children:["success"===y?e.jsx(De,{className:"h-4 w-4 text-green-600"}):e.jsx(Le,{className:"h-4 w-4 text-red-600"}),e.jsx(Di,{className:"success"===y?"text-green-800":"text-red-800",children:p})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const s=Date.now();if(!(s-w<1e3)){if(b(s),g(""),j(),"forgot-password"===o)return(async e=>{if(e.preventDefault(),!t)return g("Please enter your email address"),void v("error");d(!0),g("");try{const{error:e}=await window.ezsite.apis.sendResetPwdEmail({email:t});e?(g(e),v("error"),N({title:"Error",description:e,variant:"destructive"})):(g("Password reset link has been sent to your email address"),v("success"),N({title:"Success",description:"Password reset link sent to your email"}),setTimeout(()=>{l("login"),E()},3e3))}catch(s){const e=s instanceof Error?s.message:"Failed to send reset email";g(e),v("error"),N({title:"Error",description:e,variant:"destructive"})}finally{d(!1)}})(e);if("register"===o&&r!==i)return g("Passwords do not match"),void v("error");d(!0);try{if("login"===o){await x(t,r)&&(N({title:"Welcome back!",description:"Successfully logged in"}),S("/dashboard"))}else if("register"===o){await _(t,r,t.split("@")[0])&&(g("Account created successfully! Please check your email for verification."),v("success"),N({title:"Account Created",description:"Please check your email for verification"}),setTimeout(()=>{l("login"),E()},3e3))}}catch(a){console.error("❌ Form submission error:",a);const e=a instanceof Error?a.message:"An error occurred";g(e),v("error"),N({title:"Error",description:e,variant:"destructive"})}finally{d(!1)}}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(gn,{htmlFor:"email",className:"text-slate-700 font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(fn,{id:"email",type:"email",placeholder:"Enter your email",value:t,onChange:e=>s(e.target.value),required:!0,disabled:c,className:"h-11 pl-10 border-slate-200 focus:border-blue-500 focus:ring-blue-500"})]})]}),"forgot-password"!==o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(gn,{htmlFor:"password",className:"text-slate-700 font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(fn,{id:"password",type:u?"text":"password",placeholder:"Enter your password",value:r,onChange:e=>a(e.target.value),required:!0,disabled:c,className:"h-11 pl-10 pr-10 border-slate-200 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>h(!u),disabled:c,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 disabled:opacity-50",children:u?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Me,{className:"h-4 w-4"})})]})]}),"register"===o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(gn,{htmlFor:"confirmPassword",className:"text-slate-700 font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(fn,{id:"confirmPassword",type:m?"text":"password",placeholder:"Confirm your password",value:i,onChange:e=>n(e.target.value),required:!0,disabled:c,className:"h-11 pl-10 pr-10 border-slate-200 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>f(!m),disabled:c,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 disabled:opacity-50",children:m?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Me,{className:"h-4 w-4"})})]})]}),"login"===o&&e.jsx("div",{className:"text-right",children:e.jsx(ji,{type:"button",variant:"link",className:"p-0 h-auto text-blue-600 hover:text-blue-800 text-sm",disabled:c,onClick:()=>{l("forgot-password"),a(""),g(""),j()},children:"Forgot password?"})}),e.jsxs(ji,{type:"submit",className:"w-full h-11 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium transition-all duration-200 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:c,children:[(()=>{if(c)return e.jsx(Fe,{className:"mr-2 h-4 w-4 animate-spin"});switch(o){case"login":return e.jsx(Be,{className:"mr-2 h-4 w-4"});case"register":return e.jsx(qe,{className:"mr-2 h-4 w-4"});case"forgot-password":return e.jsx($e,{className:"mr-2 h-4 w-4"});default:return null}})(),(()=>{if(c)return"Please wait...";switch(o){case"login":return"Sign In";case"register":return"Create Account";case"forgot-password":return"Send Reset Link";default:return"Submit"}})()]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx(yn,{className:"my-4"}),e.jsxs("div",{className:"text-center space-y-2",children:["login"===o&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Don't have an account? "}),e.jsx(ji,{variant:"link",className:"p-0 h-auto font-semibold text-blue-600 hover:text-blue-800",disabled:c,onClick:()=>{l("register"),E()},children:"Create account"})]}),"register"===o&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Already have an account? "}),e.jsx(ji,{variant:"link",className:"p-0 h-auto font-semibold text-blue-600 hover:text-blue-800",disabled:c,onClick:()=>{l("login"),E()},children:"Sign in"})]}),"forgot-password"===o&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Remember your password? "}),e.jsx(ji,{variant:"link",className:"p-0 h-auto font-semibold text-blue-600 hover:text-blue-800",disabled:c,onClick:()=>{l("login"),E()},children:"Sign in"})]})]})]})]})]}),e.jsx("div",{className:"text-center mt-6 text-sm text-slate-500",children:e.jsx("p",{children:"© 2024 DFS Management Systems. All rights reserved."})})]})})})},bn=()=>{const[t,s]=q.useState(5),r=H();return q.useEffect(()=>{const e=setInterval(()=>{s(t=>t<=1?(clearInterval(e),r("/login"),0):t-1)},1e3);return()=>clearInterval(e)},[r]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(yi,{className:"shadow-xl border-0 text-center",children:[e.jsxs(vi,{className:"pb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center",children:e.jsx(le,{className:"w-8 h-8 text-white"})}),e.jsx(wi,{className:"text-2xl font-bold text-gray-900",children:"Email Verified Successfully!"})]}),e.jsxs(xi,{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Your email has been verified and your account is now active."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["You will be redirected to the login page in ",t," seconds..."]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-1000",style:{width:(5-t)/5*100+"%"}})})]})]})})})},xn=()=>{const[t,s]=q.useState(""),[r,a]=q.useState(""),[i,n]=q.useState(!1),[o,l]=q.useState(!1),[c,d]=q.useState(!1),[u,h]=q.useState(""),[m,f]=q.useState("error"),[p,g]=q.useState(null),y=H(),[v]=G(),{toast:w}=nt();q.useEffect(()=>{const e=v.get("token");e?g(e):(h("Invalid or missing reset token"),f("error"))},[v]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:e.jsx("div",{className:"flex items-center justify-center p-4 min-h-screen",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 transform hover:scale-105 transition-transform duration-200",children:e.jsx(vn,{className:"mb-4"})}),e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-800 to-indigo-800 bg-clip-text text-transparent mb-2",children:"DFS Manager Portal"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"Reset Your Password"})]})}),e.jsxs(yi,{className:"shadow-2xl border-0 backdrop-blur-sm bg-white/95",children:[e.jsxs(vi,{className:"space-y-1 pb-6",children:[e.jsx(wi,{className:"text-2xl font-bold text-center text-slate-800",children:"Reset Password"}),e.jsx(bi,{className:"text-center text-slate-600",children:"Enter your new password below"})]}),e.jsxs(xi,{children:[u&&e.jsxs(Ri,{className:"mb-4 "+("success"===m?"border-green-200 bg-green-50":"border-red-200 bg-red-50"),children:["success"===m?e.jsx(De,{className:"h-4 w-4 text-green-600"}):e.jsx(Le,{className:"h-4 w-4 text-red-600"}),e.jsx(Di,{className:"success"===m?"text-green-800":"text-red-800",children:u})]}),p?e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h(""),!p)return h("Invalid reset token"),void f("error");if(t!==r)return h("Passwords do not match"),void f("error");if(t.length<6)return h("Password must be at least 6 characters long"),void f("error");n(!0);try{const{error:e}=await window.ezsite.apis.resetPassword({token:p,password:t});e?(h(e),f("error"),w({title:"Error",description:e,variant:"destructive"})):(h("Password has been reset successfully! Redirecting to login..."),f("success"),w({title:"Success",description:"Password reset successfully"}),setTimeout(()=>{y("/login")},3e3))}catch(s){const e=s instanceof Error?s.message:"Failed to reset password";h(e),f("error"),w({title:"Error",description:e,variant:"destructive"})}finally{n(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(gn,{htmlFor:"password",className:"text-slate-700 font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(fn,{id:"password",type:o?"text":"password",placeholder:"Enter your new password",value:t,onChange:e=>s(e.target.value),required:!0,minLength:6,className:"h-11 pl-10 pr-10 border-slate-200 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600",children:o?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Me,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(gn,{htmlFor:"confirmPassword",className:"text-slate-700 font-medium",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(fn,{id:"confirmPassword",type:c?"text":"password",placeholder:"Confirm your new password",value:r,onChange:e=>a(e.target.value),required:!0,minLength:6,className:"h-11 pl-10 pr-10 border-slate-200 focus:border-blue-500 focus:ring-blue-500"}),e.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600",children:c?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Me,{className:"h-4 w-4"})})]})]}),e.jsxs(ji,{type:"submit",className:"w-full h-11 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium transition-all duration-200 transform hover:scale-[1.02]",disabled:i,children:[i?e.jsx(Fe,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ue,{className:"mr-2 h-4 w-4"}),i?"Resetting Password...":"Reset Password"]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(Le,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Invalid or missing reset token"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs(ji,{variant:"link",className:"p-0 h-auto font-semibold text-blue-600 hover:text-blue-800",onClick:()=>y("/login"),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Back to Login"]})})]})]}),e.jsx("div",{className:"text-center mt-6 text-sm text-slate-500",children:e.jsx("p",{children:"© 2024 DFS Management Systems. All rights reserved."})})]})})})},_n=()=>{const t=W();return q.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center space-y-6 p-8",children:[e.jsx(We.div,{initial:{scale:.5},animate:{scale:1},transition:{duration:.5,delay:.2},children:e.jsx("h1",{className:"text-8xl font-bold text-primary",children:"404"})}),e.jsxs(We.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:"Page Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"Sorry, the page you are looking for does not exist or has been removed."})]}),e.jsx(We.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},children:e.jsx(ji,{asChild:!0,variant:"default",size:"lg",children:e.jsx("a",{href:"/",children:"Back to Home"})})})]})})},jn=q.lazy(()=>Xe(()=>import("./ProductList-DO4pGK-B.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),kn=q.lazy(()=>Xe(()=>import("./ProductForm-DwSwQXci.js"),__vite__mapDeps([10,1,2,11,12,13,4,3,14,15,7,8,9]))),Sn=q.lazy(()=>Xe(()=>import("./EmployeeList-C3tzvzOP.js"),__vite__mapDeps([16,1,2,13,4,3,17,9,5,18,15,19,7,8]))),Nn=q.lazy(()=>Xe(()=>import("./EmployeeForm-CWevh96X.js"),__vite__mapDeps([20,1,2,11,12,13,4,21,14,15,22,23,18,19,7,8,9]))),En=q.lazy(()=>Xe(()=>import("./SalesReportList-BtZt4Vne.js"),__vite__mapDeps([24,1,2,6,3,25,4,22,23,13,7,8,9]))),Tn=q.lazy(()=>Xe(()=>import("./SalesReportForm-0iLc_IaO.js"),__vite__mapDeps([26,1,2,12,13,4,22,23,11,5,27,14,15,25,7,8,9]))),Pn=q.lazy(()=>Xe(()=>import("./VendorList-BlYz-2py.js"),__vite__mapDeps([28,1,2,3,17,9,4,7,8]))),An=q.lazy(()=>Xe(()=>import("./VendorForm-CsJqDa2x.js"),__vite__mapDeps([29,1,2,12,13,4,21,22,23,7,8,9]))),In=q.lazy(()=>Xe(()=>import("./OrderList-CWGyjNMu.js"),__vite__mapDeps([30,1,2,3,17,9,4,7,8]))),On=q.lazy(()=>Xe(()=>import("./OrderForm-CXCIcnKr.js"),__vite__mapDeps([31,1,2,11,13,4,7,8,9]))),Rn=q.lazy(()=>Xe(()=>import("./LicenseList-fwWRxGOR.js"),__vite__mapDeps([32,1,2,3,4,33,7,8,9]))),Cn=q.lazy(()=>Xe(()=>import("./LicenseForm-BX5uUhkN.js"),__vite__mapDeps([34,1,2,13,4,14,15,7,8,9]))),Dn=q.lazy(()=>Xe(()=>import("./SalaryList-CM4MbZ8B.js"),__vite__mapDeps([35,1,2,11,13,4,12,36,7,8,9]))),Ln=q.lazy(()=>Xe(()=>import("./SalaryForm-B3yKhyeN.js"),__vite__mapDeps([37,1,2,11,12,13,4,36,7,8,9]))),$n=q.lazy(()=>Xe(()=>import("./DeliveryList-CLWIAiJv.js"),__vite__mapDeps([38,1,2,3,13,4,7,8,9]))),Un=q.lazy(()=>Xe(()=>import("./DeliveryForm-DrZZbEZd.js"),__vite__mapDeps([39,1,2,11,12,22,23,13,4,7,8,9]))),zn=q.lazy(()=>Xe(()=>import("./AppSettings-BfMGU4kg.js"),__vite__mapDeps([40,1,2,21,13,4,7,8,9]))),Mn=q.lazy(()=>Xe(()=>import("./AdminPanel-BYwerESK.js"),__vite__mapDeps([41,1,2,42,7,4,43,27,3,13,44,8,9]))),Fn=q.lazy(()=>Xe(()=>import("./UserManagement-D6MiXv8x.js"),__vite__mapDeps([45,1,2,3,46,13,4,47,48,21,42,7,44,8,9]))),qn=q.lazy(()=>Xe(()=>import("./SiteManagement-DeKiMxS-.js"),__vite__mapDeps([49,1,2,21,12,47,4,23,48,13,42,7,8,9]))),Bn=q.lazy(()=>Xe(()=>import("./SystemLogs-C37Ze2Y1.js"),__vite__mapDeps([50,1,2,3,13,4,47,42,7,8,9]))),Vn=q.lazy(()=>Xe(()=>import("./SecuritySettings-C7LMkRHO.js"),__vite__mapDeps([51,1,2,21,3,47,4,42,7,8,9]))),Jn=q.lazy(()=>Xe(()=>import("./SMSManagement-B8aidKr8.js"),__vite__mapDeps([52,1,2,21,12,4,7,8,9]))),Hn=q.lazy(()=>Xe(()=>import("./UserValidationTestPage-DwM5tbwY.js"),__vite__mapDeps([53,1,2,13,4,21,3,27,42,7,8,9]))),Wn=q.lazy(()=>Xe(()=>import("./AuthDiagnosticPage-DPM9TfcG.js"),__vite__mapDeps([54,1,2,4,7,8,9]))),Kn=q.lazy(()=>Xe(()=>import("./ModuleAccessPage-CYrQq25q.js"),__vite__mapDeps([55,1,2,21,4,7,8,9]))),Gn=q.lazy(()=>Xe(()=>import("./NavigationDebugPage-MsbifNQT.js"),__vite__mapDeps([56,1,2,57,3,7,4,42,8,9]))),Yn=q.lazy(()=>Xe(()=>import("./NavigationDiagnosticPage-8MjXaBG_.js"),__vite__mapDeps([58,1,2,21,7,4,57,3,8,9]))),Xn=q.lazy(()=>Xe(()=>import("./DatabaseMonitoring-D1l3DPv1.js"),__vite__mapDeps([59,1,2,27,4,42,7,8,9]))),Qn=q.lazy(()=>Xe(()=>import("./DatabaseDiagnosticsPage-C4qvaD9F.js"),__vite__mapDeps([60,1,2,27,4,42,7,8,9]))),Zn=q.lazy(()=>Xe(()=>import("./AuditMonitoring-Y95ypyiL.js"),__vite__mapDeps([61,1,2,42,7,4,13,3,8,9]))),eo=q.lazy(()=>Xe(()=>import("./supabase-test-BdbDFhWj.js"),__vite__mapDeps([62,1,2,33,7,4,8,9]))),to=q.lazy(()=>Xe(()=>import("./ProfilePictureDemo-GOcYRAuT.js"),__vite__mapDeps([63,1,2,18,15,4,7,8,9]))),so=q.lazy(()=>Xe(()=>import("./OverflowTestPage-Bxb43ghQ.js"),__vite__mapDeps([64,1,2,13,4,3,46,7,8,9]))),ro=q.lazy(()=>Xe(()=>import("./OverflowTestingPage-CUKea-qG.js"),__vite__mapDeps([65,1,2,27,46,4,21,7,8,9]))),ao=q.lazy(()=>Xe(()=>import("./TestAdminPanel-CBZB5rGz.js"),__vite__mapDeps([66,1,2,41,42,7,4,43,27,3,13,44,8,9]))),io=q.lazy(()=>Xe(()=>import("./TestAdminPanelSimple-Dpst6IY1.js"),__vite__mapDeps([67,1,2,43,27,3,13,4,44,7,8,9]))),no=new Je({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:3e5}}}),oo=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading DFS Manager Portal..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Initializing authentication system..."})]})}),lo=()=>e.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Loading page..."})]})}),co=({error:t,onRetry:s})=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"max-w-md w-full text-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Authentication Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:t}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:s,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.href="/login",className:"w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors",children:"Go to Login"})]})]})})}),uo=({children:t})=>{const{isAuthenticated:s,isLoading:r,authError:a,isInitialized:i,refreshUserData:n}=ni();return!i||r?e.jsx(oo,{}):a&&a.includes("Failed to load user data")?e.jsx(co,{error:a,onRetry:n}):s?e.jsx(e.Fragment,{children:t}):e.jsx(Z,{to:"/login",replace:!0})},ho=()=>{const{isInitialized:t}=ni();return t?e.jsx(Y,{children:e.jsxs("div",{className:"App",children:[e.jsxs(X,{children:[e.jsx(Q,{path:"/login",element:e.jsx(wn,{})}),e.jsx(Q,{path:"/onauthsuccess",element:e.jsx(bn,{})}),e.jsx(Q,{path:"/resetpassword",element:e.jsx(xn,{})}),e.jsx(Q,{path:"/test-admin-panel",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(ao,{})})}),e.jsx(Q,{path:"/test-admin-simple",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(io,{})})}),e.jsxs(Q,{path:"/",element:e.jsx(uo,{children:e.jsx(ln,{})}),children:[e.jsx(Q,{index:!0,element:e.jsx(Z,{to:"/dashboard",replace:!0})}),e.jsx(Q,{path:"dashboard",element:e.jsx(mn,{})}),e.jsx(Q,{path:"products",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(jn,{})})}),e.jsx(Q,{path:"products/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(kn,{})})}),e.jsx(Q,{path:"products/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(kn,{})})}),e.jsx(Q,{path:"employees",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Sn,{})})}),e.jsx(Q,{path:"employees/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Nn,{})})}),e.jsx(Q,{path:"employees/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Nn,{})})}),e.jsx(Q,{path:"sales",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(En,{})})}),e.jsx(Q,{path:"sales/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Tn,{})})}),e.jsx(Q,{path:"sales/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Tn,{})})}),e.jsx(Q,{path:"vendors",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Pn,{})})}),e.jsx(Q,{path:"vendors/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(An,{})})}),e.jsx(Q,{path:"vendors/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(An,{})})}),e.jsx(Q,{path:"orders",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(In,{})})}),e.jsx(Q,{path:"orders/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(On,{})})}),e.jsx(Q,{path:"orders/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(On,{})})}),e.jsx(Q,{path:"licenses",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Rn,{})})}),e.jsx(Q,{path:"licenses/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Cn,{})})}),e.jsx(Q,{path:"licenses/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Cn,{})})}),e.jsx(Q,{path:"salary",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Dn,{})})}),e.jsx(Q,{path:"salary/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Ln,{})})}),e.jsx(Q,{path:"salary/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Ln,{})})}),e.jsx(Q,{path:"delivery",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx($n,{})})}),e.jsx(Q,{path:"delivery/new",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Un,{})})}),e.jsx(Q,{path:"delivery/:id/edit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Un,{})})}),e.jsx(Q,{path:"settings",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(zn,{})})}),e.jsx(Q,{path:"profile-picture-demo",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(to,{})})}),e.jsx(Q,{path:"overflow-test",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(so,{})})}),e.jsx(Q,{path:"overflow-testing",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(ro,{})})}),e.jsx(Q,{path:"admin",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Mn,{})})}),e.jsx(Q,{path:"admin/users",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Fn,{})})}),e.jsx(Q,{path:"admin/sites",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(qn,{})})}),e.jsx(Q,{path:"admin/logs",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Bn,{})})}),e.jsx(Q,{path:"admin/security",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Vn,{})})}),e.jsx(Q,{path:"admin/sms",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Jn,{})})}),e.jsx(Q,{path:"admin/user-validation",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Hn,{})})}),e.jsx(Q,{path:"admin/auth-diagnostic",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Wn,{})})}),e.jsx(Q,{path:"admin/module-access",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Kn,{})})}),e.jsx(Q,{path:"admin/navigation-debug",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Gn,{})})}),e.jsx(Q,{path:"admin/navigation-diagnostic",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Yn,{})})}),e.jsx(Q,{path:"admin/database",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Xn,{})})}),e.jsx(Q,{path:"admin/database-diagnostics",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Qn,{})})}),e.jsx(Q,{path:"admin/audit",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(Zn,{})})}),e.jsx(Q,{path:"admin/supabase-test",element:e.jsx(q.Suspense,{fallback:e.jsx(lo,{}),children:e.jsx(eo,{})})})]}),e.jsx(Q,{path:"*",element:e.jsx(_n,{})})]}),e.jsx(Xi,{})]})}):e.jsx(oo,{})};function mo(){return e.jsxs(He,{client:no,children:[e.jsx(gt,{children:e.jsxs(pi,{children:[e.jsx(Ii,{componentName:"Application",children:e.jsx(ii,{children:e.jsx(ci,{children:e.jsx(ho,{})})})}),e.jsx(Gi,{})]})}),e.jsx(pt,{})]})}const fo=new class{isPerformanceSupported;isMemorySupported;isNavigationTimingSupported;constructor(){this.isPerformanceSupported=this.checkPerformanceSupport(),this.isMemorySupported=this.checkMemorySupport(),this.isNavigationTimingSupported=this.checkNavigationTimingSupport()}checkPerformanceSupport(){return"undefined"!=typeof window&&void 0!==window.performance&&null!==window.performance}checkMemorySupport(){if(!this.isPerformanceSupported)return!1;try{const e=window.performance;return e.memory&&"number"==typeof e.memory.usedJSHeapSize}catch(e){return!1}}checkNavigationTimingSupport(){if(!this.isPerformanceSupported)return!1;try{const t=window.performance;if(!t||"object"!=typeof t)return!1;if("function"!=typeof t.getEntriesByType)return!1;try{const e=t.getEntriesByType("navigation");return Array.isArray(e)}catch(e){return console.warn("Performance.getEntriesByType test call failed:",e),!1}}catch(t){return console.warn("Performance.getEntriesByType not available:",t),!1}}getMemoryUsage(){if(!this.isMemorySupported)return null;try{const e=window.performance.memory;return{usedJSHeapSize:e.usedJSHeapSize||0,totalJSHeapSize:e.totalJSHeapSize||0,jsHeapSizeLimit:e.jsHeapSizeLimit||0}}catch(e){return console.warn("Error accessing performance.memory:",e),null}}getNavigationTiming(){if(!this.isNavigationTimingSupported)return null;try{if("function"!=typeof window.performance.getEntriesByType)return console.warn("getEntriesByType method not available"),null;const e=window.performance.getEntriesByType("navigation");return e.length>0?e[0]:null}catch(e){return console.warn("Error accessing navigation timing:",e),null}}getResourceTiming(){if(!this.isNavigationTimingSupported)return[];try{return"function"!=typeof window.performance.getEntriesByType?(console.warn("getEntriesByType method not available for resource timing"),[]):window.performance.getEntriesByType("resource")}catch(e){return console.warn("Error accessing resource timing:",e),[]}}getMarks(){if(!this.isNavigationTimingSupported)return[];try{return"function"!=typeof window.performance.getEntriesByType?(console.warn("getEntriesByType method not available for marks"),[]):window.performance.getEntriesByType("mark")}catch(e){return console.warn("Error accessing performance marks:",e),[]}}getMeasures(){if(!this.isNavigationTimingSupported)return[];try{return"function"!=typeof window.performance.getEntriesByType?(console.warn("getEntriesByType method not available for measures"),[]):window.performance.getEntriesByType("measure")}catch(e){return console.warn("Error accessing performance measures:",e),[]}}mark(e){if(this.isPerformanceSupported)try{"function"==typeof window.performance.mark&&window.performance.mark(e)}catch(t){console.warn("Error creating performance mark:",t)}}measure(e,t,s){if(this.isPerformanceSupported)try{"function"==typeof window.performance.measure&&window.performance.measure(e,t,s)}catch(r){console.warn("Error creating performance measure:",r)}}now(){if(!this.isPerformanceSupported)return Date.now();try{return window.performance.now()}catch(e){return console.warn("Error getting performance.now():",e),Date.now()}}getSupportInfo(){return{performance:this.isPerformanceSupported,memory:this.isMemorySupported,navigationTiming:this.isNavigationTimingSupported,marks:this.isPerformanceSupported&&"function"==typeof window.performance.mark,measures:this.isPerformanceSupported&&"function"==typeof window.performance.measure,now:this.isPerformanceSupported&&"function"==typeof window.performance.now}}isFullySupported(){return this.isPerformanceSupported&&this.isMemorySupported&&this.isNavigationTimingSupported}},po="undefined"!=typeof window&&window.location.search.includes("memory-debug=true")&&"undefined"!=typeof window&&fo.getSupportInfo().performance;const go=e=>{if(!e)return!0;return!/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/.test(e)};function yo(){return{...{tablePage:ei.tablePage.bind(ei),tableCreate:ei.tableCreate.bind(ei),tableUpdate:ei.tableUpdate.bind(ei),tableDelete:ei.tableDelete.bind(ei),sendEmail:ei.sendEmail.bind(ei)},upload:async e=>{try{if(!e.file)return{data:null,error:"No file provided"};const t=e.file,s=`public/${e.filename}`,{data:r,error:a}=await Ja.storage.from("uploads").upload(s,t);if(a)return{data:null,error:a.message};const{data:i}=Ja.storage.from("uploads").getPublicUrl(s);return{data:i.publicUrl,error:null}}catch(t){return{data:null,error:t.message||"Upload failed"}}},getUserInfo:async()=>{try{const{data:{user:e},error:t}=await Ja.auth.getUser();if(!e||t)return{data:null,error:t?.message||"User not authenticated"};return{data:{ID:parseInt(e.id.replace(/\D/g,"").slice(-8)),Name:e.user_metadata?.name||e.email?.split("@")[0]||"Unknown User",Email:e.email||"",CreateTime:e.created_at||(new Date).toISOString()},error:null}}catch(e){return{data:null,error:e.message||"Failed to get user info"}}},login:async e=>{try{const{error:t}=await Ja.auth.signInWithPassword({email:e.email,password:e.password});return t?{error:t.message}:{error:null}}catch(t){return{error:t.message||"Login failed"}}},logout:async()=>{try{const{error:e}=await Ja.auth.signOut();return e?{error:e.message}:{error:null}}catch(e){return{error:e.message||"Logout failed"}}},register:async e=>{try{const{error:t}=await Ja.auth.signUp({email:e.email,password:e.password,options:{data:{name:e.name}}});return t?{error:t.message}:{error:null}}catch(t){return{error:t.message||"Registration failed"}}},resetPassword:async e=>{try{const{error:t}=await Ja.auth.updateUser({password:e.password});return t?{error:t.message}:{error:null}}catch(t){return{error:t.message||"Password reset failed"}}},sendResetPwdEmail:async e=>{try{const{error:t}=await Ja.auth.resetPasswordForEmail(e.email,{redirectTo:`${window.location.origin}/reset-password`});return t?{error:t.message}:{error:null}}catch(t){return{error:t.message||"Failed to send reset email"}}}}}console.log("Initializing global EZSite API replacement with Supabase..."),window.ezsite?window.ezsite.apis=yo():window.ezsite={apis:yo()},console.log("Global EZSite API replacement initialized - all existing code now uses Supabase"),"undefined"==typeof window||window.performance?"undefined"!=typeof window&&window.performance&&!window.performance.getEntriesByType&&(console.warn("Performance.getEntriesByType not available, providing polyfill"),window.performance.getEntriesByType=()=>[]):(console.warn("Performance API not available, providing minimal polyfill"),window.performance={now:()=>Date.now(),mark:()=>{},measure:()=>{},getEntriesByType:()=>[],memory:null});const vo=window.onerror;window.onerror=(e,t,s,r,a)=>"string"==typeof e&&(e.includes("getEntriesByType is not a function")||e.includes("getEntriesByType is not defined")||e.includes("performance")||e.includes("PerformanceEntry")||e.includes("usedJSHeapSize")||e.includes("totalJSHeapSize")||e.includes("jsHeapSizeLimit"))?(console.warn("Performance API error detected and handled:",e),!0):a&&a.stack&&(a.stack.includes("performance")||a.stack.includes("memory")||a.stack.includes("getEntriesByType"))?(console.warn("Memory monitoring error detected and handled:",a),!0):!!vo&&vo(e,t,s,r,a),window.addEventListener("unhandledrejection",e=>{if(e.reason){const t=e.reason,s="string"==typeof t?t:t.message||t.toString();(s.includes("getEntriesByType")||s.includes("performance")||s.includes("memory")||s.includes("PerformanceEntry")||s.includes("usedJSHeapSize"))&&(console.warn("Performance/Memory API promise rejection handled:",t),e.preventDefault())}});try{!function(){if(po&&"undefined"!=typeof window)try{console.log("Memory leak detection initialized");const e=window.setTimeout,t=window.setInterval,s=window.clearTimeout,r=window.clearInterval,a=new Set,i=new Set;window.setTimeout=function(t,s,...r){const i=e.call(window,(...e)=>(a.delete(i),t(...e)),s,...r);return a.add(i),a.size>50&&console.warn(`High number of active timers detected: ${a.size}`),i},window.setInterval=function(e,s,...r){const a=t.call(window,e,s,...r);return i.add(a),i.size>20&&console.warn(`High number of active intervals detected: ${i.size}`),a},window.clearTimeout=function(e){return e&&a.delete(e),s.call(window,e)},window.clearInterval=function(e){return e&&i.delete(e),r.call(window,e)};const n=window.fetch,o=new Set;window.fetch=function(e,t){"string"==typeof e||e.toString();const s=`${Date.now()}-${Math.random()}`;return o.add(s),o.size>100&&console.warn(`High number of active fetch requests: ${o.size}`),n.call(window,e,t).finally(()=>{o.delete(s)})},window.addEventListener("beforeunload",()=>{const e=[];a.size>0&&e.push(`${a.size} active timers`),i.size>0&&e.push(`${i.size} active intervals`),o.size>0&&e.push(`${o.size} active requests`),e.length>0&&console.warn("Potential memory leaks detected on page unload:",e.join(", "))}),setInterval(()=>{try{const e=fo.getMemoryUsage();if(e){const t=(e.usedJSHeapSize/1024/1024).toFixed(2),s=(e.totalJSHeapSize/1024/1024).toFixed(2),r=(e.jsHeapSizeLimit/1024/1024).toFixed(2);console.log(`Memory: ${t}MB used, ${s}MB total, ${r}MB limit`);const a=e.usedJSHeapSize/e.jsHeapSizeLimit;a>.8&&console.warn(`High memory pressure: ${(100*a).toFixed(1)}%`)}}catch(e){console.warn("Performance monitoring error (non-critical):",e.message)}},3e4),console.log("Memory leak detection patches applied")}catch(e){console.warn("Memory leak detection initialization failed:",e)}else console.log("Memory leak detection disabled (not supported or disabled in environment)")}()}catch(wo){console.warn("Memory leak detection initialization failed:",wo)}try{(()=>{const e=console.error;console.error=(...t)=>{const s=t.join(" ");(s.includes("InvalidCharacterError")||s.includes("invalid characters"))&&(console.group("InvalidCharacterError Debug Info"),console.error("Original error:",...t),console.error("Stack trace:",(new Error).stack),console.error("Current URL:",window.location.href),console.error("User agent:",navigator.userAgent),console.error("Form elements count:",document.forms.length),Array.from(document.forms).forEach((e,t)=>{console.error(`Form ${t} action:`,e.action);const s=new FormData(e);for(const[r,a]of s.entries())"string"!=typeof a||go(a)||console.error(`Problematic form field found - ${r}:`,a)}),console.groupEnd()),e.apply(console,t)},new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;Array.from(t.attributes||[]).forEach(e=>{go(e.value)||console.warn("Potentially problematic attribute detected:",{element:t.tagName,attribute:e.name,value:e.value})})}})})}).observe(document.body,{childList:!0,subtree:!0,attributes:!0})})()}catch(wo){console.warn("Invalid character error monitoring initialization failed:",wo)}Ke(document.getElementById("root")).render(e.jsx(mo,{}));export{Ri as A,Si as B,yi as C,Li as D,Ii as E,Qi as F,Zi as G,en as H,fn as I,tn as J,ii as K,gn as L,ci as M,yn as S,cn as T,Mi as a,Fi as b,Bi as c,Vi as d,ji as e,vi as f,wi as g,xi as h,ot as i,li as j,bi as k,nt as l,$i as m,Di as n,qi as o,gi as p,dn as q,un as r,hn as s,it as t,ni as u,Yi as v,_i as w,Ci as x,Ja as y,Va as z};
