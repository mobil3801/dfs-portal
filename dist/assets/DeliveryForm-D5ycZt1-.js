import{j as e}from"./radix-ui-woSLwCdF.js";import{r as s}from"./react-core-CKNU0hQt.js";import{l as a,e as r,C as l,f as i,g as n,h as t,L as d,I as c}from"./index-CIZJQuMw.js";import{N as o}from"./number-input-DhsXivwV.js";import{T as u}from"./textarea-DdzPPZR3.js";import{S as p}from"./StationDropdown-D4NIKsDZ.js";import{u as x,d as _}from"./routing-DcURAnU1.js";import{K as h,k as m,T as v,C as j,b as g,Q as f}from"./utilities-DMEd7dY0.js";import"./data-management-r38r-ocq.js";import"./animations-CdlE0-Ca.js";import"./use-station-store-C4ohXaU1.js";import"./select-aqE1UuiG.js";const y=()=>{const y=x(),{id:b}=_(),{toast:k}=a(),[N,w]=s.useState(!1),[D,S]=s.useState({delivery_date:(new Date).toISOString().split("T")[0],bol_number:"",station:"",regular_tank_volume:0,plus_tank_volume:0,super_tank_volume:0,regular_delivered:0,plus_delivered:0,super_delivered:0,delivery_notes:"",created_by:1}),[F,C]=s.useState({regular_tank_final:0,plus_tank_final:0,super_tank_final:0}),[P,L]=s.useState({regular_expected:0,plus_expected:0,super_expected:0,regular_discrepancy:0,plus_discrepancy:0,super_discrepancy:0,has_discrepancy:!1});s.useEffect(()=>{const e=D.regular_tank_volume+D.regular_delivered,s=D.plus_tank_volume+D.plus_delivered,a=D.super_tank_volume+D.super_delivered,r=F.regular_tank_final-e,l=F.plus_tank_final-s,i=F.super_tank_final-a,n=Math.abs(r)>5||Math.abs(l)>5||Math.abs(i)>5;L({regular_expected:e,plus_expected:s,super_expected:a,regular_discrepancy:r,plus_discrepancy:l,super_discrepancy:i,has_discrepancy:n})},[D,F.regular_tank_final,F.plus_tank_final,F.super_tank_final]),s.useEffect(()=>{b&&I()},[b]);const I=async()=>{try{w(!0);const{data:e,error:s}=await window.ezsite.apis.tablePage(12196,{PageNo:1,PageSize:1,Filters:[{name:"id",op:"Equal",value:parseInt(b)}]});if(s)throw s;if(e?.List?.length>0){const a=e.List[0];S({...a,delivery_date:a.delivery_date?new Date(a.delivery_date).toISOString().split("T")[0]:""}),(async e=>{try{const{data:s,error:a}=await window.ezsite.apis.tablePage(12331,{PageNo:1,PageSize:1,Filters:[{name:"delivery_record_id",op:"Equal",value:e}]});if(a)throw a;if(s?.List?.length>0){const e=s.List[0];C({regular_tank_final:e.regular_tank_final||0,plus_tank_final:e.plus_tank_final||0,super_tank_final:e.super_tank_final||0})}}catch(s){console.error("Error loading after delivery report:",s)}})(parseInt(b))}}catch(e){console.error("Error loading delivery record:",e),k({title:"Error",description:"Failed to load delivery record",variant:"destructive"})}finally{w(!1)}},E=(e,s)=>{S(a=>({...a,[e]:s}))},T=(e,s)=>{C(a=>({...a,[e]:s}))};return N&&b?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading delivery record..."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(r,{onClick:()=>y("/delivery"),variant:"ghost",className:"mb-4",children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Back to Delivery List"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(m,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:b?"Edit Delivery Record":"New Delivery Record"})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),D.station&&D.delivery_date&&D.bol_number)if("ALL"!==D.station)try{w(!0);const e={...D,delivery_date:new Date(D.delivery_date).toISOString()};let s;if(b){const{error:a}=await window.ezsite.apis.tableUpdate(12196,{ID:parseInt(b),...e});if(a)throw a;s=parseInt(b),k({title:"Success",description:"Delivery record updated successfully"})}else{const{data:a,error:r}=await window.ezsite.apis.tableCreate(12196,e);if(r)throw r;s=a.ID,k({title:"Success",description:"Delivery record created successfully"})}if(F.regular_tank_final>0||F.plus_tank_final>0||F.super_tank_final>0){const e={report_date:(new Date).toISOString(),station:D.station,delivery_record_id:s,bol_number:D.bol_number,regular_tank_final:F.regular_tank_final,plus_tank_final:F.plus_tank_final,super_tank_final:F.super_tank_final,created_by:D.created_by},{data:a}=await window.ezsite.apis.tablePage(12331,{PageNo:1,PageSize:1,Filters:[{name:"delivery_record_id",op:"Equal",value:s}]});if(a?.List?.length>0){const{error:s}=await window.ezsite.apis.tableUpdate(12331,{ID:a.List[0].ID,...e});if(s)throw s}else{const{error:s}=await window.ezsite.apis.tableCreate(12331,e);if(s)throw s}}y("/delivery")}catch(s){console.error("Error saving delivery record:",s),k({title:"Error",description:"Failed to save delivery record",variant:"destructive"})}finally{w(!1)}else k({title:"Invalid Station Selection",description:"Please select a specific station for delivery records. 'ALL' is not allowed.",variant:"destructive"});else k({title:"Validation Error",description:"Please fill in all required fields (Date, BOL Number, and Station)",variant:"destructive"})},className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(n,{children:"Delivery Information"})}),e.jsx(t,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"delivery_date",children:"Delivery Date *"}),e.jsx(c,{id:"delivery_date",type:"date",value:D.delivery_date,onChange:e=>E("delivery_date",e.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"bol_number",children:"BOL Number *"}),e.jsx(c,{id:"bol_number",type:"text",placeholder:"Enter BOL Number",value:D.bol_number,onChange:e=>E("bol_number",e.target.value),required:!0})]}),e.jsx("div",{children:e.jsx(p,{id:"station",label:"Station",value:D.station,onValueChange:e=>E("station",e),placeholder:"Select station",required:!0,includeAll:!1})})]})})]}),e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(n,{children:"Before Delivery Tank Report"})}),e.jsx(t,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"regular_tank_volume",children:"Regular Tank Volume (Gallons)"}),e.jsx(o,{id:"regular_tank_volume",step:"0.01",value:D.regular_tank_volume,onChange:e=>E("regular_tank_volume",e)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"plus_tank_volume",children:"Plus Tank Volume (Gallons)"}),e.jsx(o,{id:"plus_tank_volume",step:"0.01",value:D.plus_tank_volume,onChange:e=>E("plus_tank_volume",e)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"super_tank_volume",children:"Super Tank Volume (Gallons)"}),e.jsx(o,{id:"super_tank_volume",step:"0.01",value:D.super_tank_volume,onChange:e=>E("super_tank_volume",e)})]})]})})]}),e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(n,{children:"Delivery Amounts"})}),e.jsx(t,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"regular_delivered",children:"Regular Delivered (Gallons)"}),e.jsx(o,{id:"regular_delivered",step:"0.01",value:D.regular_delivered,onChange:e=>E("regular_delivered",e)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"plus_delivered",children:"Plus Delivered (Gallons)"}),e.jsx(o,{id:"plus_delivered",step:"0.01",value:D.plus_delivered,onChange:e=>E("plus_delivered",e)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"super_delivered",children:"Super Delivered (Gallons)"}),e.jsx(o,{id:"super_delivered",step:"0.01",value:D.super_delivered,onChange:e=>E("super_delivered",e)})]})]})})]}),e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(n,{children:"After Delivery Tank Report"})}),e.jsx(t,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"regular_tank_final",children:"Regular Tank Final (Gallons)"}),e.jsx(o,{id:"regular_tank_final",step:"0.01",value:F.regular_tank_final,onChange:e=>T("regular_tank_final",e)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"plus_tank_final",children:"Plus Tank Final (Gallons)"}),e.jsx(o,{id:"plus_tank_final",step:"0.01",value:F.plus_tank_final,onChange:e=>T("plus_tank_final",e)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"super_tank_final",children:"Super Tank Final (Gallons)"}),e.jsx(o,{id:"super_tank_final",step:"0.01",value:F.super_tank_final,onChange:e=>T("super_tank_final",e)})]})]})})]}),e.jsxs(l,{children:[e.jsx(i,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[P.has_discrepancy?e.jsx(v,{className:"h-5 w-5 text-red-500"}):e.jsx(j,{className:"h-5 w-5 text-green-500"}),"Discrepancy Analysis"]})}),e.jsxs(t,{className:"space-y-4",children:[P.has_discrepancy&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(g,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"font-medium text-red-800",children:"Discrepancies Detected"})]}),e.jsx("p",{className:"text-red-700 text-sm",children:"One or more tank levels show discrepancies greater than 5 gallons. Please review and verify the measurements."})]}),!P.has_discrepancy&&(F.regular_tank_final>0||F.plus_tank_final>0||F.super_tank_final>0)&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium text-green-800",children:"All Measurements Verified"})]}),e.jsx("p",{className:"text-green-700 text-sm",children:"Tank levels are within acceptable tolerance limits (±5 gallons)."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Regular Gas"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Before + Delivered:"}),e.jsxs("span",{children:[P.regular_expected.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"After Delivery:"}),e.jsxs("span",{children:[F.regular_tank_final.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"flex justify-between font-medium "+(Math.abs(P.regular_discrepancy)>5?"text-red-600":"text-green-600"),children:[e.jsx("span",{children:"Difference:"}),e.jsxs("span",{children:[P.regular_discrepancy>=0?"+":"",P.regular_discrepancy.toFixed(2)," gal"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Plus Gas"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Before + Delivered:"}),e.jsxs("span",{children:[P.plus_expected.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"After Delivery:"}),e.jsxs("span",{children:[F.plus_tank_final.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"flex justify-between font-medium "+(Math.abs(P.plus_discrepancy)>5?"text-red-600":"text-green-600"),children:[e.jsx("span",{children:"Difference:"}),e.jsxs("span",{children:[P.plus_discrepancy>=0?"+":"",P.plus_discrepancy.toFixed(2)," gal"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Super Gas"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Before + Delivered:"}),e.jsxs("span",{children:[P.super_expected.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"After Delivery:"}),e.jsxs("span",{children:[F.super_tank_final.toFixed(2)," gal"]})]}),e.jsxs("div",{className:"flex justify-between font-medium "+(Math.abs(P.super_discrepancy)>5?"text-red-600":"text-green-600"),children:[e.jsx("span",{children:"Difference:"}),e.jsxs("span",{children:[P.super_discrepancy>=0?"+":"",P.super_discrepancy.toFixed(2)," gal"]})]})]})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Note:"})," Acceptable tolerance is ±5 gallons. Differences outside this range should be investigated and documented."]})})]})]}),e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(n,{children:"Additional Notes"})}),e.jsx(t,{children:e.jsxs("div",{children:[e.jsx(d,{htmlFor:"delivery_notes",children:"Delivery Notes"}),e.jsx(u,{id:"delivery_notes",value:D.delivery_notes,onChange:e=>E("delivery_notes",e.target.value),placeholder:"Enter any additional notes about the delivery...",rows:3})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>y("/delivery"),children:"Cancel"}),e.jsxs(r,{type:"submit",disabled:N,children:[e.jsx(f,{className:"mr-2 h-4 w-4"}),N?"Saving...":"Save Delivery Record"]})]})]})]})};export{y as default};
