import{j as e}from"./radix-ui-Crli8-Dx.js";import{r as s}from"./react-core-CKNU0hQt.js";import{n as t,f as i,C as a,i as r,A as l,m as c,g as n,h as d,B as o,I as x,T as m,a as h,b as u,c as j,d as g,e as p,v,p as N,q as f,r as b,s as w}from"./index-CNwujOOT.js";import{A as y}from"./AccessDenied-C7Oks6IT.js";import{R as A,d as S,T as L,w as k,n as E,K as R,A as M,U as C,a6 as _,$ as T,o as $,S as D}from"./utilities-BH0DC7Sl.js";import{S as F,c as P,d as U,a as B,b as O}from"./select-Cf4csPfA.js";import"./routing-DcURAnU1.js";import"./data-management-CVsxhheF.js";import"./animations-CAl9KjXG.js";const z=()=>{const[x,m]=s.useState({totalEvents:0,failedAttempts:0,suspiciousActivity:0,securityScore:100}),[h,u]=s.useState([]),[j,g]=s.useState(!0),[p,v]=s.useState(!1),{toast:N}=t(),f=async()=>{g(!0);try{console.log("Fetching real-time audit log data...");const{data:e,error:s}=await window.ezsite.apis.tablePage(12706,{PageNo:1,PageSize:100,OrderByField:"event_timestamp",IsAsc:!1,Filters:[]});if(s)throw console.error("Error fetching audit logs:",s),new Error(s);const t=e?.List||[];console.log("Audit logs loaded:",t.length,"entries");const i=t.length,a=t.filter(e=>"Failed"===e.event_status||"Blocked"===e.event_status).length,r=t.filter(e=>"High"===e.risk_level||"Critical"===e.risk_level).length,l=t.filter(e=>"Success"===e.event_status).length,c=i>0?Math.round(l/i*100):100;m({totalEvents:i,failedAttempts:a,suspiciousActivity:r,securityScore:c}),u(t.slice(0,10))}catch(e){console.error("Error fetching audit data:",e),N({title:"Error Loading Audit Data",description:"Failed to fetch audit log information. Please try again.",variant:"destructive"}),m({totalEvents:0,failedAttempts:0,suspiciousActivity:0,securityScore:100}),u([])}finally{g(!1)}};s.useEffect(()=>{f()},[]);const b=e=>{if(!e)return"unknown time";const s=new Date,t=new Date(e),i=Math.floor((s.getTime()-t.getTime())/6e4);return i<1?"just now":i<60?`${i} minutes ago`:i<1440?`${Math.floor(i/60)} hours ago`:`${Math.floor(i/1440)} days ago`},w=e=>{switch(e.toLowerCase()){case"success":return"bg-green-500 text-white";case"failed":case"blocked":return"bg-red-500 text-white";case"suspicious":return"bg-orange-500 text-white";default:return"bg-blue-500 text-white"}},y=s=>{switch(s.toLowerCase()){case"login":case"logout":return e.jsx(C,{className:"h-4 w-4"});case"data access":case"data modification":return e.jsx(k,{className:"h-4 w-4"});default:return e.jsx(M,{className:"h-4 w-4"})}};return j?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(A,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading real-time audit data..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Audit Log Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Real-time security monitoring and audit trail analysis"})]}),e.jsxs(i,{onClick:async()=>{v(!0),await f(),v(!1),N({title:"Data Refreshed",description:"Audit log data has been updated with latest information."})},disabled:p,variant:"outline",size:"sm",children:[e.jsx(A,{className:"w-4 h-4 mr-2 "+(p?"animate-spin":"")}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(a,{children:e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Events"}),e.jsx("p",{className:"text-3xl font-bold",children:x.totalEvents.toLocaleString()})]}),e.jsx(S,{className:"h-8 w-8 text-blue-600"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"All recorded events"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Failed Attempts"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:x.failedAttempts})]}),e.jsx(L,{className:"h-8 w-8 text-red-600"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:x.totalEvents>0?`${(x.failedAttempts/x.totalEvents*100).toFixed(1)}% of total events`:"No events recorded"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Suspicious Activity"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:x.suspiciousActivity})]}),e.jsx(k,{className:"h-8 w-8 text-orange-600"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:x.suspiciousActivity>0?"Requires attention":"All clear"})]})}),e.jsx(a,{children:e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Security Score"}),e.jsxs("p",{className:"text-3xl font-bold "+(x.securityScore>=95?"text-green-600":x.securityScore>=80?"text-yellow-600":"text-red-600"),children:[x.securityScore,"%"]})]}),e.jsx(E,{className:"h-8 w-8 "+(x.securityScore>=95?"text-green-600":x.securityScore>=80?"text-yellow-600":"text-red-600")})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Based on security events"})]})})]}),x.suspiciousActivity>0&&e.jsxs(l,{className:"border-orange-500 bg-orange-50",children:[e.jsx(L,{className:"h-4 w-4 text-orange-600"}),e.jsxs(c,{children:[e.jsx("strong",{children:"Security Alert:"})," ",x.suspiciousActivity," suspicious activities detected. Review the recent events below for more details."]})]}),x.securityScore<80&&e.jsxs(l,{className:"border-red-500 bg-red-50",children:[e.jsx(L,{className:"h-4 w-4 text-red-600"}),e.jsxs(c,{children:[e.jsx("strong",{children:"Low Security Score:"})," Your system security score is ",x.securityScore,"%. This indicates a high number of failed or blocked events that require investigation."]})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(d,{children:"Recent Security Events"})}),e.jsx(r,{children:0===h.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No audit events recorded yet."}),e.jsx("p",{className:"text-sm mt-1",children:"Security events will appear here as they occur."})]}):e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(o,{className:w(s.event_status),children:[y(s.event_type),e.jsx("span",{className:"ml-1",children:s.event_status})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[s.event_type,": ",s.action_performed||s.resource_accessed||"System action"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.username||"Unknown user"," from ",s.ip_address||"unknown IP",s.station&&` • Station: ${s.station}`,s.failure_reason&&` • Reason: ${s.failure_reason}`]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),b(s.event_timestamp)]}),s.risk_level&&"Low"!==s.risk_level&&e.jsxs(o,{variant:"Critical"===s.risk_level?"destructive":"secondary",className:"mt-1 text-xs",children:[s.risk_level," Risk"]})]})]},s.id))})})]})]})},I=()=>{const[t,l]=s.useState(!1),c=[{id:1,timestamp:"2024-01-15 14:30:22",eventType:"Login",user:"admin@dfsmanager.com",status:"Success",riskLevel:"Low",resource:"/dashboard",action:"View",station:"MOBIL",ipAddress:"192.168.1.100"},{id:2,timestamp:"2024-01-15 14:25:15",eventType:"Failed Login",user:"unknown",status:"Failed",riskLevel:"Medium",resource:"/login",action:"Authenticate",station:"N/A",ipAddress:"203.0.113.10"},{id:3,timestamp:"2024-01-15 14:20:08",eventType:"Data Access",user:"manager@dfsmanager.com",status:"Success",riskLevel:"Low",resource:"/sales/reports",action:"View",station:"AMOCO ROSEDALE",ipAddress:"192.168.1.150"}],v=e=>{switch(e){case"Critical":return"bg-red-500 hover:bg-red-600";case"High":return"bg-orange-500 hover:bg-orange-600";case"Medium":return"bg-yellow-500 hover:bg-yellow-600";case"Low":return"bg-green-500 hover:bg-green-600";default:return"bg-gray-500 hover:bg-gray-600"}},N=e=>{switch(e){case"Success":return"bg-green-500 hover:bg-green-600";case"Failed":return"bg-red-500 hover:bg-red-600";case"Blocked":return"bg-orange-500 hover:bg-orange-600";case"Suspicious":return"bg-purple-500 hover:bg-purple-600";default:return"bg-gray-500 hover:bg-gray-600"}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600"}),e.jsx(d,{children:"Audit Log Viewer"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>l(!t),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Filters"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{const e=["Timestamp,Event Type,User,Status,Risk Level,Resource,Action,Station,IP Address",...c.map(e=>`"${e.timestamp}","${e.eventType}","${e.user}","${e.status}","${e.riskLevel}","${e.resource}","${e.action}","${e.station}","${e.ipAddress}"`)].join("\n"),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),i=document.createElement("a");i.href=t,i.download=`audit-logs-${(new Date).toISOString().split("T")[0]}.csv`,i.click(),window.URL.revokeObjectURL(t)},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})}),t&&e.jsx(r,{className:"border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Event Type"}),e.jsxs(F,{children:[e.jsx(P,{children:e.jsx(U,{placeholder:"All events"})}),e.jsxs(B,{children:[e.jsx(O,{value:"",children:"All Events"}),e.jsx(O,{value:"Login",children:"Login"}),e.jsx(O,{value:"Logout",children:"Logout"}),e.jsx(O,{value:"Failed Login",children:"Failed Login"}),e.jsx(O,{value:"Data Access",children:"Data Access"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Status"}),e.jsxs(F,{children:[e.jsx(P,{children:e.jsx(U,{placeholder:"All statuses"})}),e.jsxs(B,{children:[e.jsx(O,{value:"",children:"All Statuses"}),e.jsx(O,{value:"Success",children:"Success"}),e.jsx(O,{value:"Failed",children:"Failed"}),e.jsx(O,{value:"Blocked",children:"Blocked"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Risk Level"}),e.jsxs(F,{children:[e.jsx(P,{children:e.jsx(U,{placeholder:"All risk levels"})}),e.jsxs(B,{children:[e.jsx(O,{value:"",children:"All Risk Levels"}),e.jsx(O,{value:"Low",children:"Low"}),e.jsx(O,{value:"Medium",children:"Medium"}),e.jsx(O,{value:"High",children:"High"}),e.jsx(O,{value:"Critical",children:"Critical"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Username"}),e.jsx(x,{placeholder:"Search username..."})]})]})}),e.jsx(r,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(u,{children:[e.jsx(j,{children:"Timestamp"}),e.jsx(j,{children:"Event Type"}),e.jsx(j,{children:"User"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Risk Level"}),e.jsx(j,{children:"Resource"}),e.jsx(j,{children:"Action"}),e.jsx(j,{children:"Station"}),e.jsx(j,{children:"IP Address"})]})}),e.jsx(g,{children:c.map(s=>e.jsxs(u,{children:[e.jsx(p,{className:"text-sm",children:s.timestamp}),e.jsx(p,{children:e.jsx(o,{variant:"outline",children:s.eventType})}),e.jsx(p,{children:s.user}),e.jsx(p,{children:e.jsx(o,{className:`text-white ${N(s.status)}`,children:s.status})}),e.jsx(p,{children:e.jsx(o,{className:`text-white ${v(s.riskLevel)}`,children:s.riskLevel})}),e.jsx(p,{className:"text-sm",children:s.resource}),e.jsx(p,{className:"text-sm",children:s.action}),e.jsx(p,{children:s.station}),e.jsx(p,{className:"text-sm",children:s.ipAddress})]},s.id))})]})})})]})})},H=()=>{const{isAdmin:t}=v(),[l,c]=s.useState("dashboard");return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Audit & Security Monitoring"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(o,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Active Monitoring"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(a,{className:"border-blue-200 bg-blue-50",children:e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Monitoring Status"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:"Active"})]}),e.jsx(S,{className:"h-8 w-8 text-blue-600"})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"All access attempts are being logged"})]})}),e.jsx(a,{className:"border-orange-200 bg-orange-50",children:e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-700",children:"Security Level"}),e.jsx("p",{className:"text-2xl font-bold text-orange-800",children:"High"})]}),e.jsx(k,{className:"h-8 w-8 text-orange-600"})]}),e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:"Enhanced monitoring enabled"})]})}),e.jsx(a,{className:"border-green-200 bg-green-50",children:e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Compliance"}),e.jsx("p",{className:"text-2xl font-bold text-green-800",children:"100%"})]}),e.jsx($,{className:"h-8 w-8 text-green-600"})]}),e.jsx("p",{className:"text-xs text-green-600 mt-2",children:"Meeting security standards"})]})})]}),e.jsxs(N,{value:l,onValueChange:c,className:"space-y-6",children:[e.jsxs(f,{className:"grid w-full grid-cols-4",children:[e.jsxs(b,{value:"dashboard",className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(b,{value:"logs",className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{children:"Audit Logs"})]}),e.jsxs(b,{value:"alerts",className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:"Security Alerts"})]}),e.jsxs(b,{value:"settings",className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Settings"})]})]}),e.jsx(w,{value:"dashboard",children:e.jsx(z,{})}),e.jsx(w,{value:"logs",children:e.jsx(I,{})}),e.jsx(w,{value:"alerts",children:e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs(d,{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-5 w-5 text-orange-500"}),e.jsx("span",{children:"Security Alerts Configuration"})]})}),e.jsx(r,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(a,{className:"border-yellow-200",children:e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Failed Login Threshold"}),e.jsx(o,{className:"bg-yellow-500 text-white",children:"Active"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Alert when more than 5 failed login attempts occur within 15 minutes"})]})}),e.jsx(a,{className:"border-red-200",children:e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Suspicious Activity Detection"}),e.jsx(o,{className:"bg-red-500 text-white",children:"Active"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor for unusual access patterns and data modification attempts"})]})}),e.jsx(a,{className:"border-blue-200",children:e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Data Access Monitoring"}),e.jsx(o,{className:"bg-blue-500 text-white",children:"Active"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track all sensitive data access and modifications"})]})}),e.jsx(a,{className:"border-purple-200",children:e.jsxs(r,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:"Permission Changes"}),e.jsx(o,{className:"bg-purple-500 text-white",children:"Active"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor all user permission and role modifications"})]})})]})})})]})}),e.jsx(w,{value:"settings",children:e.jsxs(a,{children:[e.jsx(n,{children:e.jsxs(d,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-5 w-5"}),e.jsx("span",{children:"Audit Logging Settings"})]})}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Logging Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Log Retention Period"}),e.jsx("div",{className:"p-3 border rounded-md bg-gray-50",children:e.jsx("span",{className:"text-sm",children:"90 days (recommended)"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Log Level"}),e.jsx("div",{className:"p-3 border rounded-md bg-gray-50",children:e.jsx("span",{className:"text-sm",children:"Detailed (All Events)"})})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Monitored Events"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:["Login Attempts","Logout Events","Registration","Password Resets","Data Access","Data Modifications","Permission Changes","Admin Actions","File Uploads","Report Generation","System Errors","Suspicious Activity"].map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded-md",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-xs",children:s})]},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Export & Compliance"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Export Weekly Report"]}),e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Export Monthly Report"]}),e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Compliance Report"]})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Audit Logging Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All security events are being monitored and logged"})]}),e.jsxs(o,{className:"bg-green-500 text-white",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Active"]})]})})]})})]})})]})]}):e.jsx(y,{feature:"Audit Monitoring System",requiredRole:"Administrator"})};export{H as default};
